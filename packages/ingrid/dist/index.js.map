{"version":3,"file":"index.js","sources":["../src/model/actions.js","../src/types.js","../src/cells/formatting/cellValueFormatter.js","../src/cells/cell-utils.js","../src/cells/cell.jsx","../src/cells/rendering/renderers/checkbox-cell.jsx","../src/cells/rendering/renderers/background-cell.jsx","../src/cells/formatting/formatters/string-formatter.js","../src/cells/formatting/utils/number.js","../src/cells/formatting/formatters/number-formatter.jsx","../src/cells/group-cell.jsx","../src/registry/datatype-registry.jsx","../src/utils/domUtils.js","../src/model/model-reducer.js","../src/draggable/draggable.jsx","../src/header/sort-icon.jsx","../src/header/sort-indicator.jsx","../src/grid-context.js","../src/header/toggle-icon.jsx","../src/header/header-cell.jsx","../src/model/utils.js","../src/header/group-header-cell.jsx","../src/header/column-group-header.jsx","../src/header/header.jsx","../src/services/popups/popup-service.jsx","../src/services/popups/context-menu/context-menu.jsx","../src/header/column-filter.jsx","../src/header/inline-filter.jsx","../src/core/row.jsx","../src/core/canvas.jsx","../src/core/column-bearer.jsx","../src/model/dataReducer.js","../src/core/viewport.jsx","../src/grid-reducer.js","../src/context-menu/grid-context-menu.jsx","../src/use-context-menu.jsx","../src/grid.jsx"],"sourcesContent":["export const COLUMN_COLLAPSE = 'COLUMN_COLLAPSE';\nexport const COLUMN_EXPAND = 'COLUMN_EXPAND';\nexport const INITIALIZE = 'INITIALIZE';\nexport const ROWCOUNT = 'ROWCOUNT';\nexport const GROUP = 'GROUP';\nexport const SORT = 'SORT';\nexport const SORT_GROUP = 'SORT_GROUP';\nexport const GRID_RESIZE = 'GRID_RESIZE';\nexport const COLUMN_RESIZE_BEGIN = 'COLUMN_RESIZE_BEGIN';\nexport const COLUMN_RESIZE = 'COLUMN_RESIZE';\nexport const COLUMN_RESIZE_END = 'COLUMN_RESIZE_END';\nexport const GROUP_COLUMN_WIDTH = 'GROUP_COLUMN_WIDTH';\nexport const RESIZE_HEADING = 'RESIZE_HEADING';\nexport const MOVE_BEGIN = 'MOVE_BEGIN';\nexport const MOVE = 'MOVE';\nexport const MOVE_END = 'MOVE_END';\nexport const TOGGLE = 'TOGGLE';\nexport const TOGGLE_FILTERS = 'TOGGLE_FILTERS'\n// export const SCROLLLEFT = 'SCROLLLEFT';\nexport const SCROLL_LEFT = 'SCROLL_LEFT';\nexport const SCROLL_RIGHT = 'SCROLL_RIGHT';\nexport const RANGE = 'RANGE';\nexport const groupExtend = 'GROUP_EXTEND';\n","export const CHECKBOX = 'checkbox';\nexport const SINGLE_ROW = 'single-row';\nexport const MULTIPLE_ROW = 'multiple-row';\n\nexport const Selection = {\n    Checkbox: CHECKBOX,\n    SingleRow: SINGLE_ROW,\n    MultipleRow: MULTIPLE_ROW\n};\n","import * as React from 'react';\n\nconst DEFAULT_TYPE = {name:'string'};\n\nexport function renderCellContent(props){\n\n    const {column, row} = props;\n    const {type=DEFAULT_TYPE, formatter} = column;\n    const value = row[column.key];\n\n    if (React.isValidElement(formatter)){\n        return React.cloneElement(formatter, props);\n    } else {\n        return formatter(value, type, row); \n    }\n}","import cx from 'classnames';\n\nconst columnType = column =>\n  !column.type ? null\n    : typeof column.type === 'string' ? column.type\n    : column.type.name;\n\n// we want to allow css class to be determined by value\nexport function getGridCellClassName(column, value){\n\n  return cx(\n      'GridCell',\n      column.className,\n      columnType(column),\n      column.resizing ? 'resizing' : null,\n      column.moving ? 'moving' : null\n  );\n}\n","import React, {useCallback} from 'react';\nimport {renderCellContent} from './formatting/cellValueFormatter';\nimport {getGridCellClassName} from './cell-utils'\n\nimport './cell.css';\n\nexport default React.memo(({\n    idx,\n    column,\n    row,\n    onClick\n}) => {\n    const style = {width: column.width};\n    const value = row[column.key]\n\n    const clickHandler = useCallback(() => {\n        onClick(idx);\n    },[idx, onClick])\n    \n\n    return (\n        <div className={getGridCellClassName(column, value)} \n            style={style}\n            tabIndex={0}\n            onClick={clickHandler}>\n            {renderCellContent({column,row })}\n        </div>\n    );\n})\n\n","import React from 'react';\nimport {rowUtils} from '@heswell/data';\nimport {getGridCellClassName} from '../../cell-utils'\nimport './checkbox-cell.css';\n\nexport default React.memo(({value, cellClass, column, row, meta}) => {\n    const isSelected = row[meta.SELECTED] === 1;\n    return (\n        <div\n            className={getGridCellClassName(column, value, cellClass)}\n            style={{ width: column.width }}\n            tabIndex={0} >\n            {!rowUtils.isEmptyRow(row) && \n                <div className=\"checkbox\">\n                    <i className=\"material-icons\">{isSelected ? 'check_box_outline' : 'check_box_outline_blank'}</i>\n                </div>\n            }\n        </div>\n    );\n})\n// original checked row.length as part of shouldComponentUpdate","import React, { useEffect,useRef } from 'react';\nimport { renderCellContent } from '../../formatting/cellValueFormatter';\nimport { getGridCellClassName } from '../../cell-utils'\n\nimport './background-cell.css';\n\nconst CHAR_ARROW_UP = String.fromCharCode(11014);\nconst CHAR_ARROW_DOWN = String.fromCharCode(11015);\n\nconst UP1 = 'up1';\nconst UP2 = 'up2';\nconst DOWN1 = 'down1';\nconst DOWN2 = 'down2';\n\n// TODO these sre repeated from PriceFormatter - where shoud they live ?\nconst FlashStyle = {\n  ArrowOnly: 'arrow',\n  BackgroundOnly: 'bg-only',\n  ArrowBackground: 'arrow-bg'\n};\n\nconst INITIAL_VALUE = [null, null, null, null]\n\nfunction useDirection(key, value, column) {\n  const ref = useRef();\n  const [prevKey, prevValue, prevColumn, prevDirection] = ref.current || INITIAL_VALUE;\n  const direction = key === prevKey &&  column === prevColumn && \n    Number.isFinite(prevValue) && Number.isFinite(value)\n    ? getDirection(prevDirection, prevValue, value, column)\n    : '';\n\n  useEffect(() => {\n    ref.current = [key, value, column, direction]\n  })\n\n  return direction;\n}\n\nexport default React.memo(props => {\n  //TODO what baout click handling\n  const { column, row, meta}  = props;\n  const { key, width, type: { renderer: { flashStyle } } } = column;\n  const value = row[key];\n\n  const direction = useDirection(row[meta.KEY], value, column)\n\n  const arrow = flashStyle === FlashStyle.ArrowOnly || flashStyle === FlashStyle.ArrowBackground\n    ? direction === UP1 || direction === UP2 ? CHAR_ARROW_UP :\n      direction === DOWN1 || direction === DOWN2 ? CHAR_ARROW_DOWN : null\n    : null;\n\n  const dirClass = direction ? ` ` + direction : '';\n  const arrowClass = flashStyle === FlashStyle.ArrowOnly ? ' arrow-only' :\n    flashStyle === FlashStyle.ArrowBackground ? ' arrow' : '';\n\n  return (\n    <div\n      className={`${getGridCellClassName(column, value)}${dirClass}${arrowClass}`}\n      style={{ width }}>\n      <div className='flasher'>{arrow}</div>\n      {renderCellContent(props)}\n    </div>\n  );\n})\n\nfunction getDirection(direction, prevValue, newValue, column) {\n  if (!Number.isFinite(newValue)) {\n    return '';\n  } else if (prevValue !== null && newValue !== null){\n    let diff = newValue - prevValue;\n    if (diff) {\n      // make sure there is still a diff when reduced to number of decimals to be displayed\n      const { type: dataType } = column;\n      let decimals = dataType && dataType.formatting && dataType.formatting.decimals;\n      if (typeof decimals === 'number') {\n        diff = +newValue.toFixed(decimals) - +prevValue.toFixed(decimals);\n      }\n    }\n\n    if (diff) {\n      if (direction === '') {\n        if (diff < 0) {\n          return DOWN1;\n        } else {\n          return UP1;\n        }\n      } else if (diff > 0) {\n        if (direction === DOWN1 || direction === DOWN2 || direction === UP2) {\n          return UP1;\n        } else {\n          return UP2;\n        }\n      } else if (direction === UP1 || direction === UP2 || direction === DOWN2) {\n        return DOWN1;\n      } else {\n        return DOWN2;\n      }\n    }\n  }\n\n}\n\n\n","const Left = 'left';\nconst Right = 'right';\n\nconst None = 'none';\nconst Capitalize = 'capitalize';\n\nconst defaultFormatting = {align:Left, capitalization:None};\nconst defaultOptions = {formatting:defaultFormatting};\n\nexport default class StringFormatter {\n\n    static cellCSS({formatting=defaultFormatting}=defaultOptions){\n        const {align=Left, capitalization=None} = formatting;\n        const result = [];\n        if (align === Right){\n            result.push(Right);\n        }\n        if (capitalization !== Capitalize){\n            result.push(capitalization);\n        }\n        return result.length ? result.join(' ') : '';\n    }\n\n    static formatter(value){\n        return value;\n    }\n\n}\n\n","\nconst PUNCTUATION_STR = String.fromCharCode(8200);\nconst DIGIT_STR = String.fromCharCode(8199);\nexport const DECIMALS_AUTO = -1;\n\nconst Space = {\n    DIGIT : DIGIT_STR,\n    TWO_DIGITS : DIGIT_STR + DIGIT_STR,\n    THREE_DIGITS: DIGIT_STR + DIGIT_STR + DIGIT_STR,\n    FULL_PADDING : [\n        null,\n        PUNCTUATION_STR + DIGIT_STR,\n        PUNCTUATION_STR + DIGIT_STR + DIGIT_STR,\n        PUNCTUATION_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR,\n        PUNCTUATION_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR\n    ]\n};\n\n// const LEADING_THOUSAND = DIGIT_STR + DIGIT_STR + DIGIT_STR + PUNCTUATION_STR;\n//const LEADING_FILL = LEADING_THOUSAND + LEADING_THOUSAND + LEADING_THOUSAND;\nconst LEADING_FILL = DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR + DIGIT_STR;\n\nexport const Align = {\n    Right : 'right',\n    Center : 'center',\n    Left : 'left'\n};\n\nconst Zero = {\n    DIGIT : '0',\n    TWO_DIGITS : '00',\n    THREE_DIGITS : '000',\n    FULL_PADDING : [\n        null,\n        '.0',\n        '.00',\n        '.000',\n        '.0000'\n    ]\n};\n\nfunction pad(n,dp, Pad){\n\n    let len = n.length;\n    const diff = dp - len;\n\n    if (diff > 0){\n\n        if (diff === 1){\n            n = n + Pad.DIGIT;\n        } else if (diff === 2){\n            n = n + Pad.TWO_DIGITS;\n        } else if (diff === 3){\n            n = n + Pad.THREE_DIGITS;\n        }\n    } else {\n\n        if (diff < 0){\n            n = n.slice(0, dp);\n            len = dp;\n        }\t\n\n        if (Pad === Space && n.charAt(len-1) === '0'){\n            n = n.replace(/0+$/,'');\n            return pad(n,dp,Pad);\n        }\n    }\n    return n;\t\n}\n\nexport function roundDecimal(value, align=Align.Right, decimals=4, zeroPad, alignOnDecimals){\n    //onsole.log(`roundDecimal ${value} dp ${decimals} align=${align} zeroPad ? ${zeroPad} alignOnDecimals ${alignOnDecimals}`);\n    if (value === undefined || typeof value !== 'number' || isNaN(value)){\n        return '';\n    }\n\n    let integral, fraction, Pad;\n\n    const [part1, part2=''] = value.toString().split('.');\n    const actualDecimals = part2.length;\n\n    integral = parseFloat(part1).toLocaleString();\n\n    if (align === Align.Left && alignOnDecimals){\n        integral = padLeft(integral);\n    }\n\n    if (decimals === DECIMALS_AUTO || actualDecimals === decimals){\n        fraction = part2;\n    } else if (actualDecimals > decimals){\n        fraction = parseFloat('0.'+part2).toFixed(decimals).slice(2);\n    } else {\n        if (Pad = zeroPad ? Zero \n                : alignOnDecimals && align !== Align.Left ? Space\n                : null) {\n\n            if (actualDecimals === 0){\n                fraction = Pad.FULL_PADDING[decimals];\n            } else {\n                fraction = pad(part2, decimals, Pad);\n            }\n        } else {\n            fraction = part2;\n        }\n    }\n\n    return integral + (fraction ? '.' + fraction : '');\n\n}\n\nexport function padLeft(value, maxLength=6){\n    return (LEADING_FILL + value).slice(-maxLength);\n}","import React from 'react';\nimport {roundDecimal} from '../utils/number';\nimport {DECIMALS_AUTO} from '../utils/number';\n\nconst Right = 'right';\nconst defaultFormatting = {align:Right, decimals: DECIMALS_AUTO};\nconst numberOr = (value, fallback) => typeof value === 'number' ? value : fallback;\n\nexport default class NumberFormatter {\n    \n    static cellCSS({formatting=defaultFormatting}){\n        const {align=Right} = formatting;\n        if (align === Right){\n            return Right;\n        } else {\n            return '';\n        }\n    }\n\n    static formatter(value, {formatting=defaultFormatting}){\n        const {align, decimals, zeroPad, alignOnDecimals=false} = formatting;\n        const numberOfDecimals = numberOr(decimals,4);\n        const number = typeof value === 'number' ? value :\n                       typeof value === 'string' ? parseFloat(value) :\n                       null;\n        return <div className='num'>{roundDecimal(number, align, numberOfDecimals, zeroPad, alignOnDecimals)}</div>;\n    }\n\n} ","import React, {useCallback} from 'react';\nimport {getGridCellClassName} from './cell-utils';\n\nimport './group-cell.css';\n\nexport default React.memo(({value, idx, cellClass, row, column, onClick, meta}) => {\n\n    const clickHandler = useCallback(e => {\n        e.preventDefault();\n        e.stopPropagation();\n        onClick(idx);\n    },[idx, onClick])\n\n    const isExpanded = row[meta.DEPTH] > 0;\n\n    return (\n        <div \n            className={getGridCellClassName(column, value, cellClass)}\n            style={{ width: column.width }} tabIndex={0} >\n            {getContent(row, column.columns, meta, isExpanded, clickHandler)}\n        </div>\n    );\n})\n\nfunction getContent(row, columns, meta, rowExpanded, onClick) {\n\n    const count = row[meta.COUNT];\n    const result = getValue(row,columns, meta)\n\n    if (result) {\n        const [value, depth] = result;\n        return (\n            <div className='GroupCell' style={{ paddingLeft: depth * 20 }} tabIndex={0}\n                onClick={onClick}>\n                <i className='material-icons icon'>{rowExpanded ? 'arrow_drop_down' : 'arrow_right'}</i>\n                <span className='group-value'>{value}</span>\n                <span> ({count})</span>\n            </div>\n        );\n    }\n}\n\nfunction getValue(row, columns, meta){\n    const depth = Math.abs(row[meta.DEPTH]);\n    for (let i=0;i<columns.length;i++){\n        const column = columns[i];\n        if (column.groupLevel === depth) {\n            return [row[column.key],i];\n        }\n    }\n    return null;\n}\n","import * as React from 'react';\nimport Cell from '../cells/cell.jsx';\nimport CheckboxRenderer from '../cells/rendering/renderers/checkbox-cell.jsx';\nimport BackgroundCellRenderer from '../cells/rendering/renderers/background-cell.jsx';\nimport StringFormatter from '../cells/formatting/formatters/string-formatter';\nimport NumberFormatter from '../cells/formatting/formatters/number-formatter.jsx';\nimport GroupCell from '../cells/group-cell.jsx';\n\nconst FormatRegistry = {};\nconst RegistryOfCellRenderers = {};\n\nexport default FormatRegistry;\n\nconst defaultFormatter = {\n    formatter: value => value == null ? '' : value,\n    cellCSS : () => ''\n};\n\nexport function registerFormatter(type, component){\t\n    FormatRegistry[type] = component;\n}\n\nexport function registerRenderer(type, component){\t\n    RegistryOfCellRenderers[type] = component;\n}\n\nexport function getFormatter(type=null){\n    const t = type === null\n        ? 'string'\n        : typeof type === 'string' ? type : type.name;\n         \n    return FormatRegistry[t] ? FormatRegistry[t] : defaultFormatter;\n}\n\n// is getCellRenderer the most appropriate name here, as what we return is a\n// JSX element, not a renderer\nexport function getCellRenderer(props){\n    const {column} = props;\n    const type = column && column.type && \n        (column.type.renderer \n            ? column.type.renderer.name \n            : column.type.name || null);\n    let Type;\n\n    if (type && (Type = RegistryOfCellRenderers[type])){\n        return <Type {...props} />;\n    } else if (column.isGroup) {\n        return <GroupCell {...props}/>;\n    } else {\n        return <Cell {...props}/>;\n    }\n}\n\n// register defaults\nregisterRenderer('selection-checkbox', CheckboxRenderer);\nregisterRenderer('background', BackgroundCellRenderer);\nregisterFormatter('number', NumberFormatter);\nregisterFormatter('string', StringFormatter);\n\n","let size;\n\nexport function getScrollbarSize() {\n    if (size === undefined) {\n\n        let outer = document.createElement('div');\n        outer.className = 'scrollable-content';\n        outer.style.width = '50px';\n        outer.style.height = '50px';\n        outer.style.overflowY = 'scroll';\n        outer.style.position = 'absolute';\n        outer.style.top = '-200px';\n        outer.style.left = '-200px';\n        const inner = document.createElement('div');\n        inner.style.height = '100px';\n        inner.style.width = '100%';\n        outer.appendChild(inner);\n        document.body.appendChild(outer);\n        const outerWidth = outer.offsetWidth;\n        const innerWidth = inner.offsetWidth;\n        document.body.removeChild(outer);\n        size = outerWidth - innerWidth;\n        outer = null;\n    }\n\n    return size;\n}\n\nexport function getColumnWidth(column) {\n    const {columns} = column;\n    let outer = document.createElement('div');\n    outer.className = 'Grid GroupbyHeaderCell';\n    outer.style.cssText = 'display:inline-block';\n    outer.innerText = columns.map(col => col.name).join(``);\n    document.body.appendChild(outer);\n    const w = outer.offsetWidth;\n    document.body.removeChild(outer);\n    outer = null;\n    return w + 50 + (columns.length-1) * 50;\n}\n","import {columnUtils, groupHelpers, ASC, DSC, sortUtils, arrayUtils} from '@heswell/data'\n\nimport * as Action from './actions';\nimport {Selection} from '../types';\nimport {getFormatter} from '../registry/datatype-registry.jsx';\n// will have to be mocked for testing\nimport {getColumnWidth} from '../utils/domUtils';\n\nconst {metaData} = columnUtils;\n\nexport default function reducer(state, action){\n    return (handlers[action.type] || MISSING_HANDLER)(state, action);\n}\n\nexport const DEFAULT_MODEL_STATE = {\n    width: 400,\n    height: 300,\n    headerHeight: 25,\n    rowHeight: 23,\n    minColumnWidth: 80,\n    groupColumnWidth: 'auto',\n    columns: [],\n    // Note: values which have never been set are undefined, once set, they are unset to null\n    range: undefined,\n    sortBy: undefined,\n    groupBy: undefined,\n    groupState: undefined,\n    rowCount: 0,\n    scrollbarSize: 15,\n    scrollLeft: 0,\n    collapsedColumns: null,\n\n    displayWidth: 400,\n    totalColumnWidth: 0,\n    selectionModel: Selection.MultipleRow,\n\n    meta: null,\n\n    _columns: null,\n    _columnMap: null,\n    _movingColumn: null,\n    _groups: null,\n    _overTheLine: 0,\n    _columnDragPlaceholder: null,\n    _headingDepth: 1,\n    _headingResize: undefined\n};\n\nconst RESIZING = {resizing: true};\nconst NOT_RESIZING = {resizing: false};\nconst EMPTY_ARRAY = [];\n\nconst MISSING_HANDLER = (state, action) => {\n    console.warn(`gridActionHandlers. No handler for action.type ${action.type}`);\n    return state;\n};\n\nconst MISSING_TYPE_HANDLER = (state) => {\n    console.warn(`gridActionHandlers. Invalid action:  missing attribute 'type'`);\n    return state;\n};\n\nconst MAX_OVER_THE_LINE = 20;\n\nconst MISSING_TYPE = undefined;\nconst handlers = {\n    [Action.INITIALIZE]: initialize,\n    [Action.ROWCOUNT]: setRowCount,\n    [Action.SORT]: sort,\n    [Action.SORT_GROUP]: sortGroup,\n    [Action.GROUP]: setGroupBy,\n    [Action.groupExtend]: extendGroup,\n    [Action.COLUMN_RESIZE_BEGIN]: columnResizeBegin,\n    [Action.GRID_RESIZE]: gridResize,\n    [Action.COLUMN_RESIZE]: columnResize,\n    [Action.GROUP_COLUMN_WIDTH]: groupColumnWidth,\n    [Action.RESIZE_HEADING]: resizeHeading,\n    [Action.COLUMN_RESIZE_END]: columnResizeEnd,\n    [Action.MOVE_BEGIN]: moveBegin,\n    [Action.MOVE]: move,\n    [Action.MOVE_END]: moveEnd,\n    [Action.TOGGLE]: toggle,\n    [Action.RANGE]: setRange,\n    // [Action.SCROLLLEFT]: setScrollLeft,\n    [Action.SCROLL_LEFT]: autoScrollLeft,\n    [Action.SCROLL_RIGHT]: autoScrollRight,\n    [Action.COLUMN_COLLAPSE]: collapseColumn,\n    [Action.COLUMN_EXPAND]: expandColumn,\n    [MISSING_TYPE]: MISSING_TYPE_HANDLER\n};\n\nexport const initModel = model =>\n    initialize(DEFAULT_MODEL_STATE, {type: Action.INITIALIZE, gridState: model})\n  \n\nfunction initialize(state, action) {\n    const {\n        width=state.width,\n        height=state.height,\n        headerHeight=state.headerHeight,\n        rowHeight=state.rowHeight,\n        minColumnWidth=state.minColumnWidth,\n        groupColumnWidth=state.groupColumnWidth,\n        columns=state.columns,\n        columnMap=state.columnMap,\n        sortBy=state.sortBy,\n        groupBy=state.groupBy,\n        range=state.range,\n        groupState=state.groupState,\n        rowCount=state.rowCount,\n        scrollbarSize=state.scrollbarSize,\n        collapsedColumns=state.collapsedColumns,\n        selectionModel=state.selectionModel\n    } = action.gridState;\n\n    const preCols = selectionModel === Selection.Checkbox\n        ? [{name: '', width: 25, sortable: false, type: {name: 'checkbox', renderer: {name: 'selection-checkbox'}}}]\n        :EMPTY_ARRAY;\n\n    const _columns = preCols.concat(columns.map(toColumn));\n\n    const [_groups, _headingDepth] = splitIntoGroups(_columns, sortBy, groupBy || [], collapsedColumns, minColumnWidth);\n    // problem, this doesn't account for width of grouped cols, as we do it on the raw columns\n    const _totalColumnWidth = sumWidth(_columns, minColumnWidth);\n    const displayWidth = getDisplayWidth(height-headerHeight, rowHeight*rowCount, width, _totalColumnWidth, scrollbarSize);\n\n    const totalColumnWidth = measure(_groups, displayWidth, minColumnWidth, groupColumnWidth);\n    console.log(`initialize rowCount = ${rowCount}`)\n    return {\n        ...state,\n        width,\n        height,\n        headerHeight,\n        rowHeight,\n        rowCount,\n        minColumnWidth,\n        meta: metaData(columns),\n        columns,\n        columnMap,\n        sortBy,\n        groupBy,\n        range,\n        groupState,\n        collapsedColumns,\n        selectionModel,\n        _headingDepth,\n        _columns,\n        _groups,\n        totalColumnWidth,\n        displayWidth};\n}\n\nfunction setRowCount(state, {rowCount}) {\n    if (rowCount === state.rowCount){\n        return state;\n    } else {\n        const {height, headerHeight,rowHeight,width,totalColumnWidth,scrollbarSize} = state;\n        const displayWidth = getDisplayWidth(height-headerHeight, rowHeight*rowCount, width, totalColumnWidth, scrollbarSize);\n    \n        if (displayWidth === state.displayWidth){\n            return { ...state, rowCount };\n        } else {\n            return initialize(state, {gridState: {rowCount}});\n        }\n    }\n}\n\nfunction sort(state, {column, direction, preserveExistingSort=false}) {\n    const newSortCriteria = [[column.name, direction || (column.sorted === 1 ? DSC : ASC)]];\n    const sortBy = state.sortBy === null || preserveExistingSort !== true\n        ? newSortCriteria\n        : state.sortBy.concat(newSortCriteria);\n\n    // be careful - re-assigns keys to columns\n    return initialize(state, {gridState: {sortBy}});\n}\n\nfunction sortGroup(state, {column}) {\n    const {groupBy: existingGroupBy} = state;\n    if (existingGroupBy) {\n        const groupIdx = groupHelpers.indexOfCol(column.name, existingGroupBy);\n        if (groupIdx !== -1){\n            const [colName, sortDirection] = existingGroupBy[groupIdx];\n            const sortCol = sortDirection === ASC\n                ? [colName, DSC]\n                : [colName, ASC];\n\n            const groupBy = existingGroupBy.map((groupCol,i) => i === groupIdx\n                ? sortCol\n                : groupCol);\n\n            return initialize(state, {gridState: {groupBy}});\n        }\n    }\n    return state;\n}\n\nfunction extendGroup(state, {column, rowCount=state.rowCount}) {\n    const groupBy = groupHelpers.updateGroupBy(state.groupBy, column);\n    console.log(`modelReducer applyGroup new Group ${groupBy}`)\n    return initialize(state, {gridState: {groupBy, rowCount}});\n}\n\nfunction setGroupBy(state, {column, rowCount=state.rowCount}) {\n    const groupBy = [[column.name, ASC]];\n    return initialize(state, {gridState: {groupBy, rowCount}});\n}\n\nfunction toggle(state, {groupRow}) {\n    const groupState = toggleGroupState(groupRow, state)\n    return {...state, groupState};\n}\n\nfunction toggleGroupState(groupedRow, model) {\n\n    let { columns, columnMap, groupBy, groupState, meta } = model;\n    const groupLevel = groupedRow[meta.DEPTH];\n    const groupByIdx = groupBy.length - Math.abs(groupLevel);\n\n    const newGroupState = groupState === null ? {} : { ...groupState };\n    let stateEntry = newGroupState;\n\n    for (let i = 0; i <= groupByIdx; i++) {\n        const [groupCol] = groupBy[i];\n        const column = columns.find(col => col.name === groupCol);\n        const key = columnMap[column.name];\n        const groupVal = groupedRow[key];\n\n        if (i === groupByIdx) {\n            if (stateEntry[groupVal]) {\n                stateEntry[groupVal] = null;\n            } else {\n                stateEntry[groupVal] = i === groupBy.length - 1 ? true : {};\n            }\n        } else if (stateEntry[groupVal] === true) {\n            stateEntry = stateEntry[groupVal] = {};\n        } else {\n            // clone as we descend\n            stateEntry = stateEntry[groupVal] = { ...stateEntry[groupVal] };\n            if (!stateEntry) {\n                console.log(`Grid.toggleGroup something is wrong - trying to toggle a node whose parent is not expanded`);\n                return;\n            }\n        }\n    }\n\n    return newGroupState;\n\n}\n\nfunction setRange(state, {lo, hi}) {\n    const {range} = state;\n    if (range && lo === range.lo && hi === range.hi){\n        return state;\n    } else {\n        return {\n            ...state,\n            range: {\n                lo, hi\n            }\n        };\n    }\n}\n\nconst splitKeys = compositeKey => `${compositeKey}`.split(':').map(k => parseInt(k,10));\n\nfunction columnResizeBegin(state, {column}) {\n    const {updatedGroups: _groups} = column.isHeading\n        ? updateGroupHeading(state._groups, column, RESIZING,RESIZING,RESIZING)\n        : updateGroupColumn(state._groups, column, RESIZING);\n\n    let _headingResize = column.isHeading\n        ? {lastSizedCol: 0, ...getColumnPositions(_groups, splitKeys(column.key))}\n        : undefined;\n\n    return {...state, _groups, _headingResize};\n}\n\nfunction resizeHeading(state, {column, width}) {\n    if (width === column.width){\n        return state;\n    } else {\n        const diff = width - column.width;\n        const {lastSizedCol: pos, groupIdx, groupColIdx} = state._headingResize;\n        const [lastSizedCol,diffs] = getColumnAdjustments(pos,groupColIdx.length,diff);\n        const _headingResize = {lastSizedCol, groupIdx, groupColIdx};\n        let newState = state;\n        for (let i=0;i<diffs.length;i++){\n            if (typeof diffs[i] === 'number'){\n                const targetCol = state._groups[groupIdx].columns[groupColIdx[i]];\n                newState = columnResize({...newState, _headingResize}, {column: targetCol, width: targetCol.width + diffs[i]});\n            }\n        }\n        return newState;\n    }\n}\n\nfunction getColumnAdjustments(pos, numCols, diff){\n    const sign = diff < 0 ?-1 : 1;\n    const absDiff = diff*sign;\n    const numSlotsToFill = Math.min(absDiff,numCols);\n    const each = Math.floor(absDiff/numCols);\n    let diffs = absDiff % numCols;\n    const results = [];\n\n    for (let i=0;i<numSlotsToFill;i++,pos++){\n        if (pos === numCols){\n            pos = 0;\n        }\n        results[pos] = sign * (each + (diffs ? 1 : 0));\n        if (diffs){\n            diffs -=1;\n        }\n    }\n    return [pos, results];\n}\n\nfunction gridResize(state, {width,height}) {\n    return initialize(state, {gridState: {width,height}});\n}\n\n// called as a one-off rather than continuous resize, e.g. for grouped column\nfunction groupColumnWidth(state, {/*column, */width}){\n    return initialize(state, {gridState: {groupColumnWidth: width}});\n}\n\nfunction columnResize(state, {column, width}) {\n\n    if (column.width <= state.minColumnWidth && width <= column.width) {\n        return state;\n    }\n\n    const {updatedGroups: _groups, updatedGroup, groupIdx} = updateGroupColumn(state._groups, column, {width});\n    updateColumnHeading(updatedGroup);\n    const widthAdjustment = width - column.width;\n    const totalColumnWidth = state.totalColumnWidth + widthAdjustment;\n\n    if (totalColumnWidth < state.displayWidth) {\n        // what do we do about empty space\n    }\n\n    updatedGroup.width += widthAdjustment;\n\n    if (updatedGroup.locked) {\n        updatedGroup.renderWidth += widthAdjustment;\n        for (let i = groupIdx + 1; i < _groups.length; i++) {\n            const {locked, renderLeft, renderWidth} = _groups[i];\n            _groups[i] = {\n                ..._groups[i],\n                renderLeft: renderLeft + widthAdjustment,\n                renderWidth: locked ? renderWidth : renderWidth - widthAdjustment\n            };\n        }\n    }\n\n    const groupColumnWidth = column.isGroup\n        ? width\n        : state.groupColumnWidth;\n\n    return {...state, _groups, totalColumnWidth, groupColumnWidth};\n\n}\n\nfunction columnResizeEnd(state, {column}) {\n    const columns = column.isHeading\n        ? state.columns // TODO\n        : updateColumn(state.columns, column.name, {width: column.width});\n    const {updatedGroups: _groups} = column.isHeading\n        ? updateGroupHeading(state._groups, column, NOT_RESIZING,NOT_RESIZING,NOT_RESIZING)\n        : updateGroupColumn(state._groups, column, NOT_RESIZING);\n    const groupColumnWidth = column.isGroup ? column.width : state.groupColumnWidth;\n    return {...state, columns, _groups, groupColumnWidth, _headingResize: undefined};\n}\n\n// function setScrollLeft(state, {scrollLeft}) {\n//     return {...state,scrollLeft};\n// }\n\nfunction autoScrollLeft(state, {scrollDistance}) {\n    const {_overTheLine,  _movingColumn: column} = state;\n\n    const scrollLeft = Math.max(state.scrollLeft + scrollDistance, 0);\n    if (scrollLeft === state.scrollLeft){\n        return _overTheLine === 0\n            ? state\n            : { ...state, _overTheLine: 0 };\n    } else if (column) {\n        const _virtualLeft = column.left + scrollLeft;\n        const _movingColumn = {...column, _virtualLeft};\n        return _updateColumnPosition({...state, scrollLeft,_movingColumn}, column);\n    } else {\n        return state;\n    }\n}\n\nfunction autoScrollRight(state, {scrollDistance}) {\n    const {totalColumnWidth, displayWidth, _movingColumn: column, _overTheLine} = state;\n    const maxScroll = totalColumnWidth - displayWidth;\n    const scrollLeft = Math.min(state.scrollLeft + scrollDistance, maxScroll);\n    if (scrollLeft === state.scrollLeft){\n        return _overTheLine === 0\n            ? state\n            : { ...state, _overTheLine: 0 };\n    } else if (column) {\n        const _virtualLeft = column.left + scrollLeft;\n        const _movingColumn = {...column, _virtualLeft};\n        return _updateColumnPosition({...state, scrollLeft,_movingColumn}, column);\n    } else {\n        return state;\n    }\n}\n\nfunction moveBegin(state, {column, scrollLeft=0}) {\n    const _virtualLeft = getColumnLeft(state._groups,column);\n    const left = _virtualLeft - scrollLeft;\n    const moveBoundaries = getColumnMoveBoundaries(state._groups);\n    const {updatedGroups: _groups, groupIdx, groupColIdx} = replaceGroupColumn(state._groups,column,{ \n        key: 'move-target',\n        isPlaceHolder: true, \n        width: column.width,\n        formatter: column.formatter\n    });\n    const _movingColumn = {...column, moving: true,left,_virtualLeft,moveBoundaries,groupIdx,groupColIdx};\n    return {...state, _groups, _movingColumn, _columnDragPlaceholder: {groupIdx, groupColIdx}, scrollLeft};\n}\n\nfunction move(state, {distance, scrollLeft=0}) {\n    const column = state._movingColumn;    \n    const oldPosLeft = column.left;\n    const canScroll = state.displayWidth < state.totalColumnWidth;\n\n    // TODO take current scroll position into account when determining farRight\n    const farLeft = scrollLeft === 0 ? 0 : -MAX_OVER_THE_LINE;\n    const rightLine = state.displayWidth - column.width;\n    const farRight = rightLine + (canScroll ? MAX_OVER_THE_LINE : 0);\n    const newPosLeft = Math.min(farRight, Math.max(farLeft, oldPosLeft + distance));\n    // If we slip furthar than farLeft or farRight, we need to capture mouse position  \n\n    const _movingColumn = {...column, left: newPosLeft, _virtualLeft: newPosLeft + scrollLeft};\n    const overTheLineLeft = newPosLeft < 0;\n    const overTheLineRight = newPosLeft > rightLine;\n    const _overTheLine =\n        overTheLineLeft\n            ? newPosLeft\n            : overTheLineRight\n                ? newPosLeft - rightLine\n                : 0;\n\n    return _updateColumnPosition({...state, _overTheLine, _movingColumn},column);\n}\n\nfunction collapseColumn(state, {column}) {\n    const collapsedColumns = state.collapsedColumns === null\n        ? [column.label]\n        : state.collapsedColumns.concat(column.label);\n\n    return initialize(state, {gridState: {collapsedColumns}});\n}\n\nfunction expandColumn(state, {column}) {\n    const updatedCollapsedColumns = state.collapsedColumns.filter(name => name !== column.label);\n    const collapsedColumns = updatedCollapsedColumns.length === 0\n        ? null\n        : updatedCollapsedColumns;\n\n    return initialize(state, {gridState: {collapsedColumns}});\n}\n\n// This function manipulates state without cloning - it is an internal function called on \n// an already transformed state object to perform additional transformation. \nfunction _updateColumnPosition(state,prevColumn) {\n\n    const column = state._movingColumn;\n    const { left: positionsLeft, right: positionsRight } = column.moveBoundaries;\n    const { groupColIdx: columnPosition } = column;\n\n    let insertionIdx = -1;\n    let insertionGroupIdx = -1;\n    let groupColCount = 0;\n    let earlierGroupColCount = 0;\n    let lastGroup = 0;\n\n    if (prevColumn._virtualLeft > column._virtualLeft) /* moving left */ {\n        for (let idx=0,i=0; i < positionsLeft.length && insertionIdx === -1; i+=2, idx++) {\n            insertionGroupIdx = positionsLeft[i+1];\n            if (insertionGroupIdx !== lastGroup) {\n                earlierGroupColCount = groupColCount;\n                lastGroup = insertionGroupIdx;\n            }\n            groupColCount += 1;\n            const adjustment = idx > columnPosition ? column.width : 0;\n            const position = positionsLeft[i] - adjustment;\n            if (prevColumn._virtualLeft >= position && column._virtualLeft < position) {\n                insertionIdx = (adjustment ? idx -1 : idx) - earlierGroupColCount;\n            }\n        }\n    } else /* moving right */{\n        // TODO need an adjustment if we are dragging from one group to another\n        for (let idx=0,i=0; i < positionsRight.length && insertionIdx === -1; i+=2, idx++) {\n            insertionGroupIdx = positionsRight[i+1];\n            if (insertionGroupIdx !== lastGroup) {\n                earlierGroupColCount = groupColCount;\n                lastGroup = insertionGroupIdx;\n            }\n            groupColCount += 1;\n            const adjustment = idx < columnPosition ? column.width : 0;\n            const position = positionsRight[i] + adjustment;\n            if (prevColumn._virtualLeft + prevColumn.width < position && column._virtualLeft+column.width >= position) {\n                insertionIdx = (adjustment ? idx+1 : idx) - earlierGroupColCount;\n            }\n        }\n    }\n\n    if (insertionIdx !== -1) {\n        const {groupIdx, groupColIdx} = state._columnDragPlaceholder;\n        const _columnDragPlaceholder = {groupIdx: insertionGroupIdx, groupColIdx: insertionIdx};\n        const {updatedGroups: _groups} = moveGroupColumn(state._groups, groupIdx, groupColIdx, insertionGroupIdx, insertionIdx);  \n        return {...state, _groups, _columnDragPlaceholder};\n    } else {\n        return state;\n    }\n}\n\nfunction moveEnd(state, {column}) {\n    // eslint-disable-next-line no-unused-vars\n    const {groupIdx, groupColIdx,moveBoundaries,left, ...movingColumn} = state._movingColumn;\n    const {groupColIdx:finalIdx} = state._columnDragPlaceholder;\n    const {updatedGroups:_groups} = replaceGroupColumn(state._groups,{key:'move-target'}, movingColumn);    \n    const columns = reorderColumns(state.columns, column, finalIdx);\n    replaceColumnHeadings(_groups, state._headingDepth);\n    return {...state, columns, _groups, _movingColumn:null, _columnDragPlaceholder:null};\n}\n\nfunction updateColumn(columns, name, updates){\n    return columns.map(column => column.name === name\n        ? {...column, ...updates}\n        : column\n    );\n}\n\nfunction reorderColumns(columns, column, idx){\n    const from = columns.findIndex(c => c.name === column.name);\n    const results = columns.slice();\n    const [col] = results.splice(from,1);\n    results.splice(idx,0,col);\n    return results;\n}\n\nfunction moveGroupColumn(groups, fromGroupIdx, fromColumnIdx, toGroupIdx, toColumnIdx){\n\n    const column = groups[fromGroupIdx].columns[fromColumnIdx];\n    const updatedGroups = groups.slice();\n\n    if (fromGroupIdx === toGroupIdx){\n        const updatedGroup = cloneGroup(updatedGroups[fromGroupIdx]);\n        updatedGroup.columns.splice(fromColumnIdx,1);\n        updatedGroup.columns.splice(toColumnIdx,0,column);\n        updatedGroups[fromGroupIdx] = updatedGroup;\n\n    } else {\n        const shiftLeft = fromGroupIdx > toGroupIdx;\n        updatedGroups[fromGroupIdx] = removeColumnFromGroup(updatedGroups[fromGroupIdx],fromColumnIdx,shiftLeft);\n        updatedGroups[toGroupIdx] = addColumnToGroup(updatedGroups[toGroupIdx], column, toColumnIdx, shiftLeft);\n    }\n\n    return {updatedGroups};        \n\n}\n\nfunction cloneGroup(group){\n    return { ...group, columns: [...group.columns] };\n}\n\nfunction removeColumnFromGroup(group, columnIdx, shiftLeft){\n    const updatedGroup = cloneGroup(group);\n    const column = updatedGroup.columns[columnIdx];\n    updatedGroup.columns.splice(columnIdx,1);\n    updatedGroup.width -= column.width;\n    updatedGroup.renderWidth -= column.width;\n    if (shiftLeft){\n        updatedGroup.renderLeft += column.width;\n    }\n    return updatedGroup;\n}\n\nfunction addColumnToGroup(group, column, columnIdx,shiftLeft){\n    const updatedGroup = cloneGroup(group);\n    updatedGroup.columns.splice(columnIdx,0,column);\n    updatedGroup.width += column.width;\n    updatedGroup.renderWidth += column.width;\n    if (!shiftLeft){\n        updatedGroup.renderLeft -= column.width;\n    }\n    return updatedGroup;\n}\n\nfunction updateGroupHeading(groups, column, headingUpdates, subHeadingUpdates, columnUpdates){\n    const keys = splitKeys(column.key);\n    const { groupIdx, groupHeadingIdx, headingColIdx } = getHeadingPosition(groups, column);\n\n    const group = groups[groupIdx];\n    const updatedGroup = { ...group, headings: [...group.headings]};\n\n    // 1) Apply changes to the target heading ...\n    const heading = updatedGroup.headings[groupHeadingIdx];\n    const updatedHeading = [...heading];\n    updatedGroup.headings[groupHeadingIdx] = updatedHeading;\n    updatedHeading[headingColIdx] = {...column, ...headingUpdates};\n    \n    // 2) Optionally, apply updates to nested sub-headings ...\n    if (subHeadingUpdates){\n        for (let i=0;i<groupHeadingIdx;i++){\n            const h = updatedGroup.headings[i];\n            let updatedH = null;\n            for (let j = 0; j < h.length; j++) {\n                if (column.key.indexOf(h[j].key) !== -1) {\n                    updatedH = updatedH || [...h];\n                    updatedH[j] = { ...h[j], ...subHeadingUpdates };\n                }\n            }\n            if (updatedH !== null) {\n                updatedGroup.headings[i] = updatedH;\n            }\n        }\n    }\n\n    // 3) Optionally, apply updates to underlying columns ...\n    if (columnUpdates){\n        const { groupColIdx } = getColumnPositions(groups, keys);\n        updatedGroup.columns = [...group.columns];\n        groupColIdx.forEach(idx => {\n            const updatedColumn = { ...updatedGroup.columns[idx], ...columnUpdates };\n            updatedGroup.columns[idx] = updatedColumn;\n        });\n    }\n\n    const updatedGroups = [...groups];\n    updatedGroups[groupIdx] = updatedGroup;\n    return {updatedGroups, updatedGroup};\n\n}\n\nfunction updateGroupColumn(groups, column, updates){\n    const { groupIdx, groupColIdx } = getColumnPosition(groups, column);\n    const group = groups[groupIdx];\n    const updatedGroup = { ...group, columns: [...group.columns] };\n    const updatedColumn = { ...column, ...updates };\n    updatedGroup.columns[groupColIdx] = updatedColumn;\n    const updatedGroups = [...groups];\n    updatedGroups[groupIdx] = updatedGroup;\n    return {updatedGroups, updatedGroup, updatedColumn, groupIdx, groupColIdx};\n}\n\nfunction replaceGroupColumn(groups, targetColumn, replacementColumn){\n    const { groupIdx, groupColIdx } = getColumnPosition(groups, targetColumn);\n    const group = groups[groupIdx];\n    const updatedGroup = { ...group, columns: [...group.columns] };\n    updatedGroup.columns[groupColIdx] = replacementColumn;\n    const updatedGroups = [...groups];\n    updatedGroups[groupIdx] = updatedGroup;\n    return {updatedGroups, updatedGroup, groupIdx, groupColIdx};\n}\n\nfunction getHeadingPosition(groups, column) {\n    for (let i = 0; i < groups.length; i++) {\n        const {headings=null} = groups[i];\n        for (let j=0;headings && j<headings.length;j++){\n            const idx = headings[j].findIndex(h => h.key === column.key && h.label === column.label);\n            if (idx !== -1) {\n                return { groupIdx: i, groupHeadingIdx: j, headingColIdx: idx };\n            }\n        }\n\n    }\n    return { groupIdx: -1, groupHeadingIdx: -1, headingColIdx: -1 };\n}\n\nfunction getColumnPosition(groups, column) {\n    for (let i = 0; i < groups.length; i++) {\n        const idx = groups[i].columns.findIndex(c => c.key === column.key);\n        if (idx !== -1) {\n            return { groupIdx: i, groupColIdx: idx };\n        }\n    }\n    return { groupIdx: -1, groupColIdx: -1 };\n}\n\nconst columnKeysToIndices = (keys,columns) =>\n    keys.map(key => columns.findIndex(c => c.key === key));\n\nconst columnKeysToColumns = (keys,columns) =>\n    keys.map(key => columns.find(c => c.key === key));\n\nfunction getColumnPositions(groups, keys) {\n    for (let i = 0; i < groups.length; i++) {\n        const indices = columnKeysToIndices(keys, groups[i].columns);\n        if (indices.every(key => key !== -1)) {\n            return { groupIdx: i, groupColIdx: indices };\n        }\n    }\n    return { groupIdx: -1, groupColIdx: [] };\n}\n\n\n// TODO missing presenter/formatter etc details\nfunction toColumn(column) {\n    //TODO roll cellCSS into className\n    const {name, label=name} = column;\n    // >>>>> Don't like rolling functions into model, think about this\n    // we should keep the model clean here and enrich it beofre passing into render tree\n    // type is not sufficient, need to look at formatting metadata\n    const presenter = getFormatter(column.type);\n    return { \n        ...column, \n        label: column.heading \n            ? Array.isArray(column.heading) ? column.heading[0] : column.heading\n            : label,\n        formatter: presenter.formatter, \n        cellCSS: presenter.cellCSS(column.type)            \n    };\n}\n\nconst getWidth = minWidth => column => Math.max(column.width || 0, minWidth);\nconst add = (val1, val2) => val1 + val2;\nfunction sumWidth(list, minWidth = 0) {\n    return list.length === 0 ? 0 : list.map(getWidth(minWidth)).reduce(add);\n}\n\nfunction updateColumnHeading(group){\n    if (group.headings){\n        const columns = group.columns;\n        group.headings = group.headings.map(heading => heading.map(colHeading => {\n            const indices = columnKeysToIndices(splitKeys(colHeading.key),columns);\n            const colWidth = indices.reduce((sum, idx) => sum + (columns[idx].width), 0);\n            return colWidth === colHeading.width \n                ? colHeading\n                : {...colHeading, width: colWidth};\n        }));\n    }\n}\n\nfunction replaceColumnHeadings(groups,maxHeadingDepth){\n\n    if (maxHeadingDepth > 1){\n        groups.forEach(group => {\n            const headings = [];\n            group.columns.forEach(column => {\n                addColumnToHeadings(maxHeadingDepth, column, headings);\n            });\n            group.headings = headings;\n        });\n    }\n\n    return maxHeadingDepth;\n}\n\nfunction endsWith(string, subString){\n    const str = typeof string === 'string'\n        ? string\n        : string.toString();\n    \n    return subString.length >= str.length\n        ? false\n        : str.slice(-subString.length) === subString;    \n\n}\n\nfunction splitIntoGroups(columns, sortBy=null, groupBy=null, collapsedColumns=null, minColumnWidth) {\n    const sortMap = sortUtils.sortByToMap(sortBy);\n    const groups = [];\n    const maxHeadingDepth = Math.max(...columns.map(({heading}) => Array.isArray(heading) ? heading.length: 1));\n\n    let group = null;\n\n    const [groupColumn, nonGroupedColumns] = extractGroupColumn(columns, groupBy, minColumnWidth);\n    if (groupColumn){\n        const headings = maxHeadingDepth > 1 ? [] : undefined;\n        groups.push(group = { locked: false, columns: [groupColumn], headings, width:0, renderWidth:0, renderLeft:0 });\n        addColumnToHeadings(maxHeadingDepth, groupColumn, group.headings);\n    }\n\n    for (let i = 0; i < nonGroupedColumns.length; i++) {\n        const column = nonGroupedColumns[i];\n        const {key: columnKey, name, locked=false} = column;\n\n        if (group === null || group.locked !== locked) {\n            const headings = maxHeadingDepth > 1 ? [] : undefined;\n            groups.push(group = { locked, columns: [], headings, width:0, renderWidth:0, renderLeft:0 });\n        }\n\n        // TODO for each collapsed heading, insert a placeholder\n        const sorted = sortMap[name];\n        addColumnToHeadings(maxHeadingDepth, column, group.headings, collapsedColumns);\n        let {hidden} = column;\n        if (group.headings){\n            const lastColHeaders = group.headings.map(heading => heading[heading.length-1]);\n            const collapsedHeading = lastColHeaders.find(header => header.collapsed);\n            hidden = hidden || !!collapsedHeading;\n            if (collapsedHeading && collapsedHeading.key === columnKey){\n                group.columns.push({ key: collapsedHeading.key, isPlaceHolder: true, width: 25 });\n            }\n        }\n        group.columns.push({ ...column, sorted, hidden });\n          \n    }\n\n    return [groups, maxHeadingDepth];\n}\n\nfunction extractGroupColumn(columns, groupBy, minColumnWidth){\n    if (groupBy){\n        const isGroup = ({name}) => groupHelpers.indexOfCol(name, groupBy) !== -1\n        const [groupedColumns, rest] = arrayUtils.partition(columns, isGroup);\n        const groupCount = groupBy.length;\n\n        if (groupedColumns.length){\n            const groupCols = groupedColumns.map(column => {\n                const idx = groupHelpers.indexOfCol(column.name, groupBy);\n                return {\n                    ...column,\n                    groupLevel: groupCount - idx\n                }\n            })\n            const groupCol = {\n                key: -1,\n                name: 'group-col',\n                isGroup: true,\n                columns: groupCols,\n                width: Math.max(...groupCols.map(col => col.width || minColumnWidth)) + 50\n            };\n            return [groupCol, rest];\n        }\n    }\n    return [null, columns]\n}\n\nfunction addColumnToHeadings(maxHeadingDepth, column, headings, collapsedColumns=null){\n    const sortable = false;\n    const collapsible = true;\n    const isHeading = true;\n\n    const {key, heading: colHeader=[column.name], width} = column;\n    for (let depth = 1; depth < maxHeadingDepth; depth++) {\n\n        const heading = headings[depth-1] || (headings[depth-1] = []);\n        const colHeaderLabel = colHeader[depth];\n        const lastHeading = heading.length > 0\n            ? heading[heading.length-1]\n            : null;\n\n        if (colHeaderLabel !== undefined){\n\n            if (lastHeading && lastHeading.label === colHeader[depth]){\n                lastHeading.width += width;\n                lastHeading.key += `:${key}`;\n            } else {\n                const collapsed = collapsedColumns && collapsedColumns.indexOf(colHeaderLabel) !== -1;\n                let hide = false;\n                if (collapsed){\n                    // lower depth headings are subheadings, nested subheadings below a collapsed heading\n                    // will be hidden. Q: would it be better to iterate higher to lower ? When we encounter\n                    // a collapsed heading for a given column, the first subheading at any lower level \n                    // will already have been created, so we need to hide them.\n                    for (let d=0;d<depth-1;d++){\n                        const head = headings[d];\n                        head[head.length-1].hidden = true;\n                    } \n\n                } else if (depth < maxHeadingDepth-1){\n                    // ...likewise if we encounter a subheading, which is not the first for a given\n                    // higher -level heading, and that higher-level heading is collapsed, we need to hide it.\n                    for (let d=depth;d<maxHeadingDepth;d++){\n                        const head = headings[d];\n                        const colHeadingLabel = colHeader[d+1];\n                        if (head && head.length && colHeaderLabel){\n                            const {collapsed: isCollapsed,hidden,label} = head[head.length - 1];\n                            if ((isCollapsed || hidden) && label === colHeadingLabel){\n                                hide = true;\n                            }\n                        }\n                    } \n\n                }\n                heading.push({key,label: colHeaderLabel,width,sortable,collapsible,collapsed,hidden: hide,isHeading});\n            }\n        } else {\n\n            const lowerDepth = headings[depth-2];\n            const lastLowerDepth = lowerDepth\n                ? lowerDepth[lowerDepth.length-1]\n                : null;\n\n            if (lastLowerDepth && lastLowerDepth.key === key){\n            // Need to check whether a heading at level below is collapsed\n                heading.push({key,label: '',width,collapsed: lastLowerDepth.collapsed,sortable,isHeading});\n            } else if (lastLowerDepth && endsWith(lastLowerDepth.key,`:${key}`)){\n                lastHeading.width += width;\n                lastHeading.key += `:${key}`;\n            } else {\n                heading.push({key,label: '',width,isHeading});\n            }\n        }\n    }\n\n}\n\nfunction measure(groups, displayWidth, minColumnWidth, groupColumnWidth) {\n\n    const columns = flatMap(groups);\n    const [firstColumn] = columns;\n    if (groupColumnWidth && firstColumn.isGroup) {\n        firstColumn.width = Math.max(\n            groupColumnWidth === 'auto' ? getColumnWidth(firstColumn) : groupColumnWidth,\n            firstColumn.width);\n    }\n\n    const visibleColumns = columns.filter(col => !col.hidden);\n    const [unsizedCols, sizedCols] = partition(visibleColumns, col => col.width === undefined, col => !col.hidden);\n    let totalColumnWidth = sumWidth(sizedCols);\n    const defaultCount = visibleColumns.length - sizedCols.length;\n    //TODO pluggable width assignment algo\n    // default behaviour - give each columns at least the min col width. If there is surplus space,\n    // divide it equally between the no-width columns. (this can leave a remainder)\n    const defaultWidth = defaultCount === 0\n        ? 0\n        : Math.max(Math.floor((displayWidth - totalColumnWidth) / defaultCount), minColumnWidth);\n    totalColumnWidth += defaultCount * defaultWidth;\n    unsizedCols.forEach(column => column.width = defaultWidth);\n\n    let lockedGroupWidth = 0;\n    let scrollGroupWidth = 0;\n\n    //TODO account for collapsed/hidden headings and columns\n    groups.forEach(group => {\n        group.width = sumWidth(group.columns.filter(col => !col.hidden));\n        if (group.locked) {\n            lockedGroupWidth += group.width;\n        }\n        if (group.headings){\n            console.log(`group headings ${JSON.stringify(group.headings,null,2)}`)\n            group.headings.forEach(heading =>\n                heading.forEach(colHeading => {\n                    colHeading.width = sumWidth(columnKeysToColumns(splitKeys(colHeading.key),group.columns).filter(col => !col.hidden));\n                }\n                ));\n        }\n    });\n\n    // Note: there is only ever one scrollGroup, can be two locked groups (at either end)\n    if (displayWidth - lockedGroupWidth < minColumnWidth) {\n        // Locked group consumes too much of available space, not enough room to host the scrolling group(s). \n        // Fall back to single grid-wide scrollbar and no locked groups\n        groups = [{ locked: false, width: totalColumnWidth, columns: columns }];\n        scrollGroupWidth = displayWidth; // shouldn't this be totalColumnWidth ?\n    } else {\n        scrollGroupWidth = displayWidth - lockedGroupWidth;\n    }\n\n    for (let left = 0, i = 0; i < groups.length; i++) {\n        const group = groups[i];\n        group.renderLeft = left;\n        group.renderWidth = group.locked ? group.width : scrollGroupWidth;\n        left += group.renderWidth;\n    }\n\n    return totalColumnWidth;\n\n}\n\nfunction flatMap(groups) {\n    let columns = [];\n    groups.forEach(group => {\n        columns = columns.concat(group.columns);\n    });\n    return columns;\n}\n\nfunction partition(list, test1, test2=null) {\n    const results1 = [];\n    const misses = [];\n    const results2 = test2===null ? null : [];\n\n    for (let i = 0; i < list.length; i++) {\n        if (test1(list[i])) {\n            results1.push(list[i]);\n        } else if (test2 !== null && test2(list[i])) {    \n            results2.push(list[i]);\n        } else {\n            misses.push(list[i]);\n        }\n    }\n\n    return test2 === null\n        ? [results1, misses]\n        : [results1, results2, misses];\n}\n\nfunction getDisplayWidth(clientHeight, contentHeight, width, totalColumnWidth, scrollbarSize) {\n\n    const horizontalScrollbar = scrollbarNeeded(totalColumnWidth, width, scrollbarSize);\n    const verticalScrollbar = scrollbarNeeded(contentHeight, clientHeight, scrollbarSize);\n\n    if (verticalScrollbar === 'YES') {\n        return width - scrollbarSize;\n    } else if (verticalScrollbar === 'NO') {\n        return width;\n    } else if (horizontalScrollbar === 'NO') {\n        return width;\n    } else if (horizontalScrollbar === 'YES') {\n        return width - scrollbarSize;\n    } else if (horizontalScrollbar === 'MAYBE') {\n        // is this right ?\n        return width - scrollbarSize;\n    }\n\n}\n\nfunction scrollbarNeeded(contentSize, containerSize, scrollbarSize) {\n    return contentSize > containerSize ? 'YES' :\n        contentSize <= (containerSize - scrollbarSize) ? 'NO' :\n            'MAYBE';\n}\n\nfunction getColumnLeft(groups, column) {\n    let result = 0;\n    for (let i = 0; i < groups.length; i++) {\n        const { columns } = groups[i];\n        for (let j = 0; j < columns.length; j++) {\n            if (columns[j] === column) {\n                return result;\n            }\n            result += columns[j].width;\n        }\n    }\n    return result;\n}\n\n// do we need to calculate them all - will it be fast enough to calculate \n// them as we move along the container ?\nfunction getColumnMoveBoundaries(groups) {\n    const results = {\n        left: [],\n        right: []\n    };\n\n    let position = 0;\n\n    for (let i = 0; i < groups.length; i++) {\n        const { columns } = groups[i];\n        for (let j = 0; j < columns.length; j++) {\n            results.left.push(position + 20,i);\n            position += columns[j].width;\n            results.right.push(position - 20,i);\n        }\n    }\n    return results;\n}\n","import React, {useRef, useCallback} from 'react';\n\nconst NOOP = () => {}\n\nexport default allProps => {\n    const {\n        component:Component,\n        ...props\n    } = allProps;\n\n    const {onDrag, onDragStart=NOOP, onDragEnd=NOOP, children: child} = allProps;\n    const position = useRef({x:0,y:0});\n    const dragState = useRef(null);\n\n    const handleMouseDown = e => {\n        // what is dragState supposed to be exactly ?\n        const newDragState = onDragStart(e);\n        if (newDragState === null && e.button !== 0) {\n            return;\n        }\n\n        position.current.x = e.clientX;\n        position.current.y = e.clientY;\n\n        window.addEventListener('mouseup', onMouseUp);\n        window.addEventListener('mousemove', onMouseMove);\n\n        dragState.current = newDragState;\n\n        if (e.stopPropagation) {\n            e.stopPropagation();\n        }\n\n        if (e.preventDefault) {\n            e.preventDefault();\n        }        \n    }\n\n    const onMouseMove = useCallback(e => {\n        if (dragState.current === null) {\n            return;\n        }\n\n        if (e.stopPropagation) {\n            e.stopPropagation();\n        }\n\n        if (e.preventDefault) {\n            e.preventDefault();\n        }\n\n        const x = e.clientX;\n        const y = e.clientY;\n\n        const deltaX = x - position.current.x;\n        const deltaY = y - position.current.y;\n\n        position.current.x = x;\n        position.current.y = y;\n\n        onDrag(e, deltaX, deltaY);\n    },[])\n\n    const onMouseUp = useCallback(e => {\n        cleanUp();\n        onDragEnd(e, dragState.drag);\n        dragState.current = null;\n    },[]);\n\n    const cleanUp = () => {\n        window.removeEventListener('mouseup', onMouseUp);\n        window.removeEventListener('mousemove', onMouseMove);\n    }\n\n    if (child && !Array.isArray(child)){\n        return React.cloneElement(child, {...props, onMouseDown: handleMouseDown});\n    } else \n    if (Component){\n        return <Component onMouseDown={handleMouseDown} {...props}/>;\n    } else {\n        return <div onMouseDown={handleMouseDown} {...props}/>;\n    }\n}\n","import React from 'react';\n\nexport const Direction = {\n  ASC: 'asc',\n  DSC: 'desc'\n}\n\nexport default ({direction}) =>\n  direction === Direction.ASC\n    ? <i className=\"material-icons\">arrow_drop_up</i>\n    : <i className=\"material-icons\">arrow_drop_down</i>\n","import React from 'react';\nimport SortIcon, {Direction} from './sort-icon.jsx';\n\nexport default ({column, multiColumnSort}) => {\n  const {sortable, sorted, isPlaceHolder} = column;\n\n  if (sortable === false || isPlaceHolder || !sorted) {\n    return null;\n  }\n\n  const direction = sorted < 0\n    ? Direction.DSC\n    : Direction.ASC;\n\n  return multiColumnSort ? (\n      <div className={`sort-col multi-col ${direction}`}>\n          <SortIcon direction={direction}/>\n          <span className='sort-col-num'>{Math.abs(sorted)}</span>\n      </div>\n  ) : (\n      <div className=\"sort-col single-col\">\n          <SortIcon direction={direction}/>\n      </div>\n\n  )\n}","import React from 'react';\n\nexport default React.createContext(null);\n","import React, {useContext} from 'react';\nimport * as Action from '../model/actions';\nimport GridContext from '../grid-context';\n\nexport default ({column}) => {\n\n  const {dispatch} = useContext(GridContext);\n\n  const handleToggleCollapse = () => {\n    const action = column.collapsed ? Action.COLUMN_EXPAND : Action.COLUMN_COLLAPSE;\n    dispatch({ type: action, column });\n  }\n\n  if (!column.collapsible || column.isHidden){\n    return null;\n  }\n\n  return (\n    <i className='material-icons toggle-icon' onClick={handleToggleCollapse}>{'arrow_right'}</i>\n  );\n}","\nimport React, { useRef, useCallback, useEffect} from 'react';\nimport cx from 'classnames';\nimport Draggable from '../draggable/draggable.jsx';\nimport SortIndicator from './sort-indicator.jsx';\nimport ToggleIcon from './toggle-icon.jsx';\n\nimport './header-cell.css';\n\nconst Label = ({ column }) =>\n    column.collapsed || column.hidden\n        ? ''\n        : column.label || '';\n\nexport default ({\n    className: propClassName,\n    column: col,\n    multiColumnSort,\n    onClick=() => {},\n    onResize,\n    onMove,\n    onContextMenu\n}) => {\n\n    const dragging = useRef(false);\n    const wasDragging = useRef(false);\n    const column = useRef(col);\n    const el = useRef(null);\n    const position = useRef({x:0,y:0})\n\n    useEffect(() => {\n        column.current = col;\n    }, [col])\n\n    const handleClick = () => {\n\n        if (wasDragging.current) {\n            wasDragging.current = false;\n        } else {\n            onClick(column.current);\n        }\n    }\n\n    const onMouseUp = useCallback(() => {\n        cleanUp();\n        if (dragging.current) {\n\n            wasDragging.current = true;\n            // shouldn't we set dragging to false ?\n            onMove('end', column.current);\n        } else {\n            // drag aborted\n        }\n    },[])\n\n    const onMouseMove = useCallback(e => {\n        console.log(`onMouseMove`)\n        if (e.stopPropagation) {\n            e.stopPropagation();\n        }\n\n        if (e.preventDefault) {\n            e.preventDefault();\n        }\n\n        const x = e.clientX;\n        const y = e.clientY;\n        const deltaX = x - position.current.x;\n\n        if (dragging.current) {\n            position.current.x = x;\n            position.current.y = y;\n            onMove('move', column.current, deltaX);\n\n        } else {\n            if (Math.abs(deltaX) > 3) {\n\n                dragging.current = true;\n                position.current.x = x;\n                position.current.y = y;\n                onMove('begin', column.current, deltaX);\n            }\n        }\n    },[])\n\n    const handleMouseDown = e => {\n        position.current = {x: e.clientX, y: e.clientY};\n        window.addEventListener('mouseup', onMouseUp);\n        window.addEventListener('mousemove', onMouseMove);\n    }\n\n    const cleanUp = () => {\n        window.removeEventListener('mouseup', onMouseUp);\n        window.removeEventListener('mousemove', onMouseMove);\n    }\n\n    const handleContextMenu = e => {\n        onContextMenu(e, 'header', { column: column.current });\n    }\n\n    const handleResizeStart = () => onResize('begin', column.current);\n    \n\n    const handleResize = useCallback((e) => {\n        const width = getWidthFromMouseEvent(e);\n        if (width > 0) {\n            console.log(`resize ${width} resizing ? ${column.resizing}`)\n            onResize('resize', column.current, width);\n        }\n    },[])\n\n    const handleResizeEnd = (e) => {\n        wasDragging.current = true; // is this right ?\n        const width = getWidthFromMouseEvent(e);\n        onResize('end', column.current, width);\n    }\n\n    const getWidthFromMouseEvent = e => {\n        const right = e.pageX;\n        const left = el.current.getBoundingClientRect().left;\n        return right - left;\n    }\n\n    const className = cx(\n        'HeaderCell',\n        col.className,\n        col.cellCSS,\n        propClassName, {\n            'HeaderCell--resizing': col.resizing,\n            'hidden': col.hidden,\n            'collapsed': col.collapsed\n        });\n\n    const style = { width: col.width };\n\n    if (col.hidden && col.width === 0) {\n        style.display = 'none';\n    }\n\n    return (\n        <div ref={el} className={className} style={style}\n            onClick={handleClick} onMouseDown={handleMouseDown} onContextMenu={handleContextMenu}>\n            <SortIndicator column={column} multiColumnSort={multiColumnSort}/>\n            <ToggleIcon column={col}/>\n            <div className='InnerHeaderCell'>\n                <div className='cell-wrapper'>\n                    <Label column={col}/>\n                </div>\n            </div>\n            {col.resizeable !== false &&\n                <Draggable className='resizeHandle'\n                    onDrag={handleResize}\n                    onDragStart={handleResizeStart}\n                    onDragEnd={handleResizeEnd} />\n                }\n        </div>\n    );\n}\n\n","export function expandStatesfromGroupState({columns},groupState){\n    const results = Array(columns.length).fill(-1);\n    let all = groupState && groupState['*'];\n    let idx = 0;\n    while (all){\n        results[idx] = 1;\n        all = all['*'];\n    }\n    return results;\n}\n","import React, {useRef, useEffect, useCallback} from 'react';\nimport cx from 'classnames';\nimport Draggable from '../draggable/draggable.jsx';\nimport {expandStatesfromGroupState} from '../model/utils';\n\nimport './header.css';\n\nconst styles = {\n    groupByHeaderCell: 'GroupbyHeaderCell'\n}\n\nconst ColHeader = (props) => {\n    const {column, className, onClick, onRemoveColumn, expandState, onToggle} = props\n    const expanded = expandState === 1;\n    return (\n        <div className={cx('ColHeader', className,{expanded, collapsed: !expanded})}>\n            <i className='material-icons toggle-icon' onClick={() => onToggle(column, -expandState)}>{expanded ? 'arrow_drop_down' : 'arrow_right'}</i>\n            <span className='ColHeaderLabel' onClick={() => onClick(column)}>{column.name}</span>\n            <i className='material-icons remove-icon' onClick={() => onRemoveColumn(column)}>cancel</i>\n        </div>\n    );\n};\n\nexport default ({\n    className: propClassName,\n    column: groupCol,\n    groupState,\n    onClick,\n    onContextMenu,\n    onRemoveColumn,\n    onResize,\n    onToggleGroupState}) => {\n\n    const el = useRef(null);\n    const column = useRef(groupCol);\n\n    useEffect(() => {\n        column.current = groupCol;\n    }, [groupCol])\n\n    const handleClick = () => {\n        onClick(groupCol);\n    }\n\n    // All duplicated in header-cell\n    const handleResizeStart = () => onResize('begin', column.current);\n\n    const handleResize = useCallback((e) => {\n        const width = getWidthFromMouseEvent(e);\n        if (width > 0) {\n            onResize('resize', column.current, width);\n        }\n    },[])\n\n    const handleResizeEnd = (e) => {\n        const width = getWidthFromMouseEvent(e);\n        onResize('end', column.current, width);\n    }\n\n    const getWidthFromMouseEvent = e => {\n        const right = e.pageX;\n        const left = el.current.getBoundingClientRect().left;\n        return right - left;\n    }\n\n    const handleContextMenu = e => {\n        onContextMenu(e, 'header', { column: groupCol });\n    }\n\n        const {columns, resizing, width} = groupCol;\n        const className = cx(\n            styles.groupByHeaderCell,\n            'HeaderCell group',\n            propClassName,\n            resizing ? 'HeaderCell--resizing': ''\n        );\n        const expandStates = expandStatesfromGroupState(groupCol, groupState);\n        return (\n            <div ref={el} className={className} style={{paddingLeft: 0,width: width}}\n                onContextMenu={handleContextMenu}>\n                <div className='inner-container'>\n                    {columns.map(\n                        (column,idx) => <ColHeader\n                            key={column.key}\n                            column={column}\n                            expandState={expandStates[idx]}\n                            onClick={handleClick}\n                            onRemoveColumn={onRemoveColumn}\n                            onToggle={onToggleGroupState}\n                            className={columnClassName(columns, idx, column)}\n                        />)}\n                </div>\n                <Draggable className='resizeHandle' onDrag={handleResize} onDragStart={handleResizeStart} onDragEnd={handleResizeEnd} />\n            </div>\n        );\n}\n\nfunction columnClassName(columns, idx/*, column*/){\n\n    const classes = [];\n\n    if (idx === 0){\n        classes.push('first');\n    }\n\n    if (idx === columns.length-1){\n        classes.push('last');\n    }\n\n    return classes.join(' ');\n\n}\n","import React, {useContext, useCallback, useRef, useImperativeHandle, forwardRef} from 'react';\nimport cx from 'classnames';\nimport HeaderCell from './header-cell.jsx';\nimport GroupbyHeaderCell from './group-header-cell.jsx';\nimport * as Action from '../model/actions';\nimport GridContext from '../grid-context';\n\nimport './column-group-header.css';\n\nexport default forwardRef(ColumnGrouHeader);\n\nexport function ColumnGrouHeader({\n    columnGroup,\n    colGroupHeaderRenderer,\n    colHeaderRenderer,\n    ignoreHeadings,\n    model,\n    onColumnMove\n\n},ref) {\n\n    const {dispatch, showContextMenu} = useContext(GridContext);\n    const containerEl = useRef(null);\n\n    useImperativeHandle(ref, () => ({\n        scrollLeft: scrollLeft => {\n                containerEl.current.scrollLeft = scrollLeft;\n        }\n      }))\n\n    const handleColumnResize = useCallback((phase, column, width) => {\n        if (phase === 'resize') {\n            if (column.isHeading) {\n                dispatch({ type: Action.RESIZE_HEADING, column, width });\n            } else {\n                // TODO do we need to consider scrolling ?\n                dispatch({ type: Action.COLUMN_RESIZE, column, width });\n            }\n        } else if (phase === 'begin') {\n            dispatch({ type: Action.COLUMN_RESIZE_BEGIN, column });\n        } else if (phase === 'end') {\n            dispatch({ type: Action.COLUMN_RESIZE_END, column });\n        }\n    },[]);\n\n    const handleRemoveGroupBy = useCallback(column => {\n        dispatch({ type: Action.groupExtend, column });\n    },[]);\n\n    const handleHeaderCellClick = column => {\n        let result = true;\n        if (result !== false && column.sortable !== false) {\n            // this will transform the columns which will cause whole grid to re-render down to cell level. All\n            // we really need if for headers to rerender. SHould we store sort criteria outside of columns ?\n            dispatch({ type: Action.SORT, column });\n        }\n    }\n\n    const handleToggleGroupState = useCallback((column, expanded) => {\n        const groupState = expanded === 1\n            ? { '*': true }\n            : {};\n        dispatch({ type: Action.TOGGLE, groupState })\n    },[]);\n\n    const renderColHeadings = heading =>\n        heading.map((item, idx) =>\n            <HeaderCell\n                key={idx}\n                className={cx('colgroup-header', { bottomless: item.label === '' })}\n                column={item}\n                onResize={handleColumnResize}\n                onMove={onColumnMove}\n                onContextMenu={showContextMenu}\n            />\n        )\n\n    const renderHeaderCells = () => {\n\n        return columnGroup.columns.filter(column => !column.hidden).map(column => {\n\n            const props = {\n                key: column.key,\n                column,\n                onResize: handleColumnResize,\n                onMove: onColumnMove,\n                onContextMenu: showContextMenu\n            };\n\n            const multiColumnSort = model.sortBy && model.sortBy.length > 1;\n\n            if (column.isGroup) {\n\n                return renderGroupHeader({\n                    ...props,\n                    groupState: model.groupState,\n                    onClick: handleGroupHeaderCellClick,\n                    onToggleGroupState: handleToggleGroupState,\n                    onRemoveColumn: handleRemoveGroupBy\n                });\n\n            } else {\n\n                return renderCell({\n                    ...props,\n                    value: column.name,\n                    multiColumnSort,\n                    onClick: handleHeaderCellClick\n                });\n            }\n        });\n    }\n\n    const renderGroupHeader = (props) => {\n\n        const renderer = colGroupHeaderRenderer;\n\n        return React.isValidElement(renderer)\n            ? React.cloneElement(renderer, props)\n            : ((renderer && renderer(props)) || <GroupbyHeaderCell {...props} />);\n\n    }\n\n    // TODO separate this pattern into reusable code\n    const renderCell = (props) => {\n\n        const renderer = colHeaderRenderer;\n\n        return React.isValidElement(renderer)\n            ? React.cloneElement(renderer, props)\n            : ((renderer && renderer(props)) || <HeaderCell {...props} />);\n\n    }\n\n    const handleGroupHeaderCellClick = useCallback(column => {\n        if (column.sortable !== false) {\n            dispatch({ type: Action.SORT_GROUP, column });\n        }\n    },[])\n\n    const { width, renderWidth, renderLeft, headings = [] } = columnGroup;\n\n    return (\n        <div ref={containerEl} className='ColumnGroupHeader' style={{ width: renderWidth, left: renderLeft }}>\n\n            {!ignoreHeadings && headings.map((heading, idx) =>\n                <div className='group-heading' key={idx} style={{ width }}>\n                    {renderColHeadings(heading)}\n                </div>\n            ).reverse()}\n\n            <div className=\"header-cells\" style={{ whiteSpace: 'nowrap', width, position: 'relative' }}>\n                {renderHeaderCells()}\n            </div>\n        </div>\n    );\n}\n","\nimport React, { memo, useRef, forwardRef, useContext, useImperativeHandle} from 'react';\nimport cx from 'classnames';\nimport ColumnGroupHeader from './column-group-header.jsx';\nimport * as Action from '../model/actions';\nimport GridContext from '../grid-context';\n\nexport default memo(forwardRef(({\n    className: propClassName,\n    colGroupHeaderRenderer,\n    colHeaderRenderer,\n    height,\n    ignoreHeadings=false,\n    model,\n    style: propStyle\n}, ref) => {\n\n    const { dispatch } = useContext(GridContext);\n    const scrollingHeader = useRef(null);\n    const scrollLeft = useRef(0);\n\n    useImperativeHandle(ref, () => ({\n        scrollLeft: pos => {\n            scrollLeft.current = pos;\n            scrollingHeader.current.scrollLeft(pos);\n        }\n      }))\n    \n    const handleColumnMove = (phase, column, distance) => {\n        if (!column.isHeading) {\n            const pos = scrollLeft.current;\n            if (phase === 'move' && distance !== 0) {\n                dispatch({ type: Action.MOVE, distance, scrollLeft: pos });\n            } else if (phase === 'begin') {\n                dispatch({ type: Action.MOVE_BEGIN, column, scrollLeft: pos });\n            } else if (phase === 'end') {\n                dispatch({ type: Action.MOVE_END, column });\n            }\n        }\n    }\n\n    const className = cx('Header', propClassName);\n    const style = { \n        ...propStyle, \n        height\n    };\n\n    return (\n        <div className={className} style={style}>\n            {\n                model._groups.map((group, idx) => {\n                    return (\n                        <ColumnGroupHeader\n                            key={idx}\n                            ref={group.locked ? null : scrollingHeader}\n                            columnGroup={group}\n                            model={model}\n                            ignoreHeadings={ignoreHeadings}\n                            onColumnMove={handleColumnMove}\n                            colHeaderRenderer={colHeaderRenderer}\n                            colGroupHeaderRenderer={colGroupHeaderRenderer}\n                        />\n\n                    );\n\n                })}\n        </div>\n    );\n\n}))\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\n\nimport './popup-service.css';\n\nlet _dialogOpen = false;\nconst _popups = [];\n\nfunction specialKeyHandler(e) {\n\n    if (e.keyCode === 27 /* ESC */) {\n        if (_popups.length) {\n            closeAllPopups();\n            console.log('unmount the open popup(s)');\n        } else if (_dialogOpen) {\n            console.log('unmount the open dialog');\n            ReactDOM.unmountComponentAtNode(document.body.querySelector('.react-dialog'));\n        }\n    }\n}\n\nfunction outsideClickHandler(e) {\n\n    if (_popups.length) {\n        // onsole.log(`Popup.outsideClickHandler`);\n        const popupContainers = document.body.querySelectorAll('.react-popup');\n        for (let i = 0; i < popupContainers.length; i++) {\n            if (popupContainers[i].contains(e.target)) {\n                return;\n            }\n        }\n        console.log(`close all popups`);\n        closeAllPopups();\n    }\n}\n\nfunction closeAllPopups() {\n    if (_popups.length) {\n\n        // onsole.log(`closeAllPopups`);\n        const popupContainers = document.body.querySelectorAll('.react-popup');\n        for (let i = 0; i < popupContainers.length; i++) {\n            console.log(`unmountComponentAtNode`);\n            ReactDOM.unmountComponentAtNode(popupContainers[i]);\n        }\n        popupClosed('*');\n    }\n}\n\nfunction dialogOpened() {\n    if (_dialogOpen === false) {\n        console.log('PopupService, dialog opened');\n        _dialogOpen = true;\n        window.addEventListener('keydown', specialKeyHandler, true);\n    }\n}\n\nfunction dialogClosed() {\n    if (_dialogOpen) {\n        console.log('PopupService, dialog closed');\n        _dialogOpen = false;\n        window.removeEventListener('keydown', specialKeyHandler, true);\n    }\n}\n\nfunction popupOpened(name/*, group*/) {\n    if (_popups.indexOf(name) === -1) {\n        _popups.push(name);\n        //onsole.log('PopupService, popup opened ' + name + '  popups : ' + _popups);\n        if (_dialogOpen === false) {\n            window.addEventListener('keydown', specialKeyHandler, true);\n            window.addEventListener('click', outsideClickHandler, true);\n        }\n    }\n}\n\nfunction popupClosed(name/*, group=null*/) {\n    if (_popups.length) {\n\n        if (name === '*') {\n            _popups.length = 0;\n        } else {\n            const pos = _popups.indexOf(name);\n            if (pos !== -1) {\n                _popups.splice(pos, 1);\n            }\n        }\n        //onsole.log('PopupService, popup closed ' + name + '  popups : ' + _popups);\n        if (_popups.length === 0 && _dialogOpen === false) {\n            window.removeEventListener('keydown', specialKeyHandler, true);\n            window.removeEventListener('click', outsideClickHandler, true);\n        }\n\n    }\n}\n\nexport class PopupService {\n\n    static showPopup({name='anon', group='all'/*, depth=0*/, position='', left=0, top=0, width='auto', component}) {\n\n        // onsole.log(`PopupService.showPopup ${name} in ${group} ${left} ${top} ${width} depth ${depth}`);\n\n        popupOpened(name, group);\n\n        let el = document.body.querySelector('.react-popup.' + group);\n        if (el === null) {\n            el = document.createElement('div');\n            el.className = 'react-popup ' + group;\n            document.body.appendChild(el);\n        }\n\n        const className = cx('popup-container', position);\n        ReactDOM.render(\n            <div className={className} style= {{position: 'absolute', left, top, width }}>{ component } </div>, \n            el, \n            () => {PopupService.keepWithinThePage(el);}\n        );\n    }\n\n    static hidePopup(name='anon', group='all'){\n        //onsole.log('PopupService.hidePopup name=' + name + ', group=' + group)\n\n        if (_popups.indexOf(name) !== -1) {\n            popupClosed(name, group);\n            ReactDOM.unmountComponentAtNode(document.body.querySelector(`.react-popup.${group}`));\n        }\n    }\n\n    static movePopup(x, y, name='anon', group='all'){\n        const container = document.querySelector(`.react-popup.${group} .popup-container`);\n        container.style.top = (parseInt(container.style.top,10) + y) + 'px';\n        container.style.left = (parseInt(container.style.left,10) + x) + 'px';\n    }\n\n    static keepWithinThePage(el) {\n\n        //onsole.log(`PopupService.keepWithinThePage`);\n\n        const container = el.querySelector('.popup-container');\n        const {top, left, width, height} = container.firstChild.getBoundingClientRect();\n\n        const w = window.innerWidth;\n        const h = window.innerHeight;\n\n        const overflowH = h - (top + height);\n        if (overflowH < 0) {\n            container.style.top = (parseInt(container.style.top,10) + overflowH) + 'px';\n        }\n\n        const overflowW = w - (left + width);\n        if (overflowW < 0) {\n            container.style.left = (parseInt(container.style.left,10) + overflowW) + 'px';\n        }\n\n    }\n}\n\nexport class DialogService {\n\n    static showDialog(dialog) {\n\n        const containerEl = '.react-dialog';\n        const onClose = dialog.props.onClose;\n\n        dialogOpened();\n\n        ReactDOM.render(React.cloneElement(dialog, {\n            container: containerEl,\n            onClose: () => {\n                DialogService.closeDialog();\n                if (onClose) {\n                    onClose();\n                }\n            }\n        }),\n            document.body.querySelector(containerEl)\n        );\n\n    }\n\n    static closeDialog() {\n        dialogClosed();\n        ReactDOM.unmountComponentAtNode(document.body.querySelector('.react-dialog'));\n    }\n}\n\nexport class Popup extends React.Component {\n\n    constructor(props){\n        super(props);\n        this.pendingTask = null;\n    }\n\n    render() {\n        return <div className='popup-proxy' > </div>;\n    }\n\n    componentDidMount() {\n\n        const domNode = ReactDOM.findDOMNode(this);\n        if (domNode) {\n            const el = domNode.parentElement;\n            const boundingClientRect = el.getBoundingClientRect();\n            //onsole.log(`%cPopup.componentDidMount about to call show`,'color:green');\n            this.show(this.props, boundingClientRect);\n        }\n\n    }\n\n    componentWillUnmount() {\n        PopupService.hidePopup(this.props.name, this.props.group);\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        const domNode = ReactDOM.findDOMNode(this);\n        if (domNode) {\n            const el = domNode.parentElement;\n            const boundingClientRect = el.getBoundingClientRect();\n            //onsole.log(`%cPopup.componentWillReceiveProps about to call show`,'color:green');\n            this.show(nextProps, boundingClientRect);\n        }\n    }\n\n    show(props, boundingClientRect) {\n\n        const {name, group, depth, width} = props;\n        let left, top;\n\n        if (this.pendingTask) {\n            clearTimeout(this.pendingTask);\n            this.pendingTask = null;\n        }\n\n        if (props.close === true) {\n            console.log('Popup.show hide popup name=' + name + ', group=' + group + ',depth=' + depth);\n            PopupService.hidePopup(name, group);\n        } else {\n            const {position, children: component} = props;\n            const {left: targetLeft, top: targetTop, width: clientWidth, bottom: targetBottom} = boundingClientRect;\n\n            if (position === 'below') {\n                left = targetLeft;\n                top = targetBottom;\n            } else if (position === 'above') {\n                left = targetLeft;\n                top = targetTop;\n            }\n\n            console.log('%cPopup.show about to setTimeout', 'color:red;font-weight:bold');\n            this.pendingTask = setTimeout(() => {\n                console.log(`%c...timeout fires`, 'color:red;font-weight:bold');\n                PopupService.showPopup({ name, group, depth, position, left, top, width: width || clientWidth, component });\n            }, 10);\n        }\n\n    }\n}\n","import * as React from 'react';\nimport cx from 'classnames';\nimport { PopupService } from '../popup-service.jsx';\nimport './context-menu.css';\n\nlet subMenuTimeout = null;\n\nexport class MenuItem extends React.Component {\n\n    constructor(props){\n        super(props);\n        this.state = {\n            hasChildMenuItems: props.children && props.children.length > 0\n    };\n    }\n\n    render() {\n\n        const nestedMenu = this.props.submenuShowing ?\n            <ContextMenu doAction={this.props.doAction}>{this.props.children}</ContextMenu> :\n            null;\n\n        const className = cx(\n            'menu-item',\n            this.props.disabled ? 'disabled' : null,\n            this.state.hasChildMenuItems ? 'root' : null,\n            this.props.submenuShowing ? 'showing' : null\n        );\n\n        return (\n            <li className={className}>\n                <button tabIndex={-1} onClick={e => this.handleClick(e)}\n                    onMouseOver={() => this.handleMouseOver()}>{this.props.label}</button>\n                {nestedMenu}\n            </li>\n        );\n    }\n\n    handleClick(e){\n        e.preventDefault();\n        if (this.props.disabled !== true) {\n            this.props.doAction(this.props.action, this.props.data);\n        }\n    }\n\n    handleMouseOver() {\n        this.props.onMouseOver(this.props.idx, this.state.hasChildMenuItems, this.props.submenuShowing);\n    }\n\n}\n\nexport const Separator = () => <li className='divider'></li>;\n\nexport class ContextMenu extends React.Component {\n\n\n    constructor(props){\n        super(props);\n        this.state = {\n            left: props.left,\n            top: props.top,\n            bottom: props.bottom,\n            submenuShowing: false,\n            submenuIdx: null\n        };\n    }\n\n    render() {\n\n        const {top, left, bottom} = this.state;\n        const children = this.props.children;\n        const style = { position: 'absolute', top, left, bottom };\n        const submenuIdx = this.state.submenuShowing ? this.state.submenuIdx : -1;\n        const menuItems = children ? children.map((menuItem, idx) => React.cloneElement(menuItem, {\n            key: String(idx),\n            idx,\n            action: menuItem.props.action,\n            doAction: (key, data) => this.handleMenuAction(key, data),\n            onMouseOver: (idx, hasChildMenuItems) => this.handleMenuItemMouseOver(idx, hasChildMenuItems),\n            submenuShowing: submenuIdx === idx\n\n        })) : null;\n\n        return <ul className='popup-menu' style={style}>{menuItems}</ul>;\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        if (nextProps.left !== '100%' && nextProps.top !== 0) {\n\n            if (nextProps.left !== this.state.left || nextProps.top !== this.state.top) {\n\n                this.setState({\n                    left: nextProps.left,\n                    top: nextProps.top,\n                    submenuShowing: false,\n                    submenuIdx: null\n                });\n\n            }\n        }\n    }\n\n    handleMenuAction(key, data){\n        if (this.props.doAction) {\n            this.props.doAction(key, data);\n        } else if (this.props.onAction) {\n            this.props.onAction(key, data);\n        }\n        this.close();\n    }\n\n    handleMenuItemMouseOver(idx, hasChildMenuItems){\n\n        if (subMenuTimeout) {\n            clearTimeout(subMenuTimeout);\n            subMenuTimeout = null;\n        }\n\n        if (hasChildMenuItems) {\n            if (this.state.submenuShowing !== true) {\n                subMenuTimeout = setTimeout(() => this.showSubmenu(), 400);\n            }\n            this.setState({\n                submenuIdx: idx\n            });\n        } else if (this.state.submenuIdx !== null) {\n            this.setState({\n                submenuIdx: null,\n                submenuShowing: false\n            });\n        }\n    }\n\n    showSubmenu(){\n        subMenuTimeout = null;\n        this.setState({\n            submenuShowing: true\n        });\n    }\n\n    close() {\n        PopupService.hidePopup();\n    }\n\n\n}\n\nContextMenu.defaultProps = {\n    left: '100%',\n    top: 0,\n    bottom: 'auto'\n};\n","import React, { useRef, useEffect, useCallback } from 'react';\nimport cx from 'classnames';\nimport { columnUtils, filter as filterUtils } from '@heswell/data';\nimport { SetFilter, NumberFilter, MultiColumnFilter } from '@heswell/ingrid-extras';\n\nimport Draggable from '../draggable/draggable.jsx';\nimport { PopupService } from '../services/index';\n\nimport './column-filter.css';\n\nexport default ({\n    column,\n    dataView,\n    filter,\n    onClearFilter,\n    onFilterOpen,\n    onFilterClose,\n    showFilter,\n    onFilter\n}) => {\n\n    const rootEl = useRef(null);\n\n    const toggleFilterDisplay = () => {\n        onFilterOpen(column);\n    }\n\n    // close filter is a user action\n    const closeFilter = () => {\n        PopupService.hidePopup();\n    }\n\n    // hide fires when the filter has been closed\n    const hideFilter = useCallback(() => {\n        setTimeout(() => {\n            // needs delay to ensure firing after ColumnFilter is rerendered with new \n            // clickhandler which would otherwise immediately re-open filter.\n            onFilterClose();\n        }, 50);\n    },[]);\n\n    const handleKeyDown = useCallback(e => {\n        if (e.keyCode === 13) { // ENTER\n            dataView.filter({\n                 type: filterUtils.STARTS_WITH,\n                 colName: column.name,\n                 value: e.target.value\n            })\n        }\n    },[]);\n\n    const clearFilter = useCallback(() => {\n        onClearFilter(column);\n    },[])\n\n    const handleNumberFilterChange = (column, filter) => {\n        onFilter(column, filter);\n    }\n\n    const handleFilter = (/*filter*/) => {\n        // Do we still need - see Numberfilter and group\n    }\n\n    useEffect(() => {\n        if (showFilter){\n            const component = getFilter();\n            const el = rootEl.current;\n            const { left, top } = el.getBoundingClientRect();\n            // TODO without the timeout, it does not render until next render cycle\n            requestAnimationFrame(() => {\n                PopupService.showPopup({ left: Math.round(left), top: top - 26, component });\n            })\n        }\n    },[showFilter]);\n\n    const moveFilter = (e, deltaX, deltaY) => {\n        console.log(`move Filter by ${deltaX} ${deltaY}`)\n        PopupService.movePopup(deltaX, deltaY);\n    }\n\n    const getFilter = () => {\n        console.log(`getFilter ${JSON.stringify(column)}`)\n        if (!column.isGroup || column.columns.length === 1) {\n            switch (columnUtils.getFilterType(column)) {\n                case 'number':\n                    return (\n                        <NumberFilter column={column} height={250}\n                            className='FilterPanel'\n                            dataView={dataView}\n                            filter={filter}\n                            onHide={hideFilter}\n                            onClose={closeFilter}\n                            onApplyFilter={handleNumberFilterChange} />\n                    );\n                default:\n                    return (\n                        <Draggable onDrag={moveFilter}>\n                            <SetFilter className='FilterPanel'\n                                column={column}\n                                filter={filter}\n                                height={350}\n                                width={column.width + 120}\n                                dataView={dataView}\n                                onHide={hideFilter}\n                                onClose={closeFilter}\n                            />\n                        </Draggable>\n                    );\n            }\n\n        } else {\n            return <MultiColumnFilter\n                column={column}\n                height={261}\n                width={300}\n                filter={filter}\n                dataView={dataView}\n                onHide={hideFilter}\n                onClose={closeFilter}\n                onApplyFilter={handleFilter}\n            />;\n        }\n    }\n\n    const isActive = filterUtils.includesColumn(filter, column);\n    const className = cx('HeaderCell', { 'filter-active': isActive, 'filter-showing': showFilter });\n\n    return (\n        // we only need care about opening the filter - the Popup service will close if for us.\n        <div ref={rootEl} className={className} style={{ padding: 0, width: column.width }}>\n            <div className='filter-button' onClick={toggleFilterDisplay}>\n                <i className=\"material-icons\">filter_list</i>\n            </div>\n            <div className=\"filter-input-container\">\n                <input className=\"filter-input\" type='text' onKeyDown={handleKeyDown} />\n            </div>\n            {isActive &&\n                <div className='filter-clear-button' onClick={clearFilter}>\n                    <i className=\"material-icons\">cancel</i>\n                </div>}\n        </div>\n    );\n}\n","import React, { forwardRef, useRef, useCallback, useImperativeHandle, useState } from 'react';\nimport { filter as filterUtils, DataTypes } from '@heswell/data'\nimport Header from './header.jsx';\nimport ColumnFilter from './column-filter.jsx';\n\nimport './inline-filter.css';\n\nconst { STARTS_WITH, NOT_IN } = filterUtils;\n\nexport default forwardRef(({ \n    dataView,\n    height,\n    model,\n    filter: serverFilter,\n    style\n}, ref) => {\n\n    const header = useRef(null);\n    const [showFilter, setShowFilter] = useState(null);\n\n    useImperativeHandle(ref, () => ({\n        scrollLeft: pos => {\n            header.current.scrollLeft(pos);\n        }\n    }))\n\n    const onFilterOpen = column => {\n        const { key, name } = column.isGroup ? column.columns[0] : column;\n        if (showFilter !== name){\n            dataView.getFilterData({\n                key, name\n            });\n            setShowFilter(column.name);\n        }\n    }\n\n    const onFilterClose = () => {\n        setShowFilter(null);\n        // I think we're doing this so that if same filter is opened again, dataView sends rows\n        dataView.setFilterRange(0, 0);\n    }\n\n    // not used for setfilter any more\n    const handleFilter = (column, newFilter) => {\n        //TODO move this into model\n        const filter = filterUtils.addFilter(serverFilter, newFilter);\n        console.log(`\n                add filter ${JSON.stringify(newFilter, null, 2)}\n                to filter ${JSON.stringify(serverFilter, null, 2)}\n                creates new filter = ${JSON.stringify(filter, null, 2)}\n            `)\n\n        dataView.filter(filter);\n\n        if (newFilter.isNumeric) {\n            // re-request the filterData, this will re-create bins on the filtered data\n            const { key, name } = column.isGroup ? column.columns[0] : column;\n            dataView.getFilterData({ key, name });\n        }\n    }\n\n    const handleClearFilter = useCallback(column => {\n        dataView.filter({\n            type: NOT_IN,\n            colName: column.name,\n            values: []\n        }, DataTypes.ROW_DATA, true);\n    },[]);\n\n    const colHeaderRenderer = ({ key, column }) =>\n        <ColumnFilter key={key}\n            column={column}\n            dataView={dataView}\n            // TODO we use this to mark the column as filtered \n            filter={serverFilter}\n            onClearFilter={handleClearFilter}\n            onFilterOpen={onFilterOpen}\n            onFilterClose={onFilterClose}\n            showFilter={showFilter === column.name}\n            onFilter={handleFilter}\n        />;\n\n    return (\n        <Header className='InlineFilter'\n            ref={header}\n            model={model}\n            height={height}\n            style={style}\n            ignoreHeadings={true}\n            colGroupHeaderRenderer={colHeaderRenderer}\n            colHeaderRenderer={colHeaderRenderer}\n        />\n    );\n\n})","import React, {useCallback, useContext/*, useEffect, useRef*/} from 'react';\nimport cx from 'classnames';\nimport {getCellRenderer} from '../registry/datatype-registry.jsx';\nimport GridContext from '../grid-context';\nimport * as Action from '../model/actions';\n\nexport default React.memo(({\n    row,\n    idx,\n    columns,\n    gridModel\n}) => {\n\n    const {meta, rowHeight} = gridModel;\n    const handleContextMenu = useCallback(e => showContextMenu(e, 'row', {idx, row}),[idx, row]);\n    const {dispatch, callbackPropsDispatch, showContextMenu} = useContext(GridContext);\n\n    const handleClick = useCallback(e => {\n        const rangeSelect = e.shiftKey;\n        const keepExistingSelection = e.ctrlKey || e.metaKey /* mac only */;\n        console.log(`Row about to call callbackPropsDIspatch('selection')`);\n        callbackPropsDispatch({type:'selection', idx, row, rangeSelect, keepExistingSelection})\n    },[idx, row])\n\n    const handleDoubleClick = useCallback(() => callbackPropsDispatch({type: 'double-click', idx, row}),[idx, row]);\n\n    const onClick = useCallback(cellIdx => {\n        if (isGroup){\n            dispatch({ type: Action.TOGGLE, groupRow: row });\n        }\n        callbackPropsDispatch({type: 'select-cell', idx, cellIdx})\n    },[idx, row])\n\n    const groupLevel = row[meta.DEPTH];\n    const isGroup = groupLevel !== 0;\n    const isSelected = row[meta.SELECTED] === 1;\n\n    const className = cx(\n        'GridRow',\n        isSelected ? 'selected' : null,\n        isGroup \n            ? `group ${groupLevel < 0 ? 'collapsed' :'expanded'}`\n            : (idx % 2 === 0 ? 'even' : 'odd') \n    );\n\n    //TODO load default formatters here and pass formatter/cellClass down to cell \n    const cells = columns.filter(column => !column.hidden).map((column,i) => {\n\n        const props = {\n            key: i,\n            idx: i,\n            column,\n            meta,\n            row,\n            onClick\n        }\n\n        return React.isValidElement(column.renderer) \n            ? React.cloneElement(column.renderer,props)\n            : (column.renderer && column.renderer(props)) || getCellRenderer(props); \n    });\n\n    return (\n        <div className={className}\n            tabIndex={0}\n            style={{transform: `translate3d(0px, ${idx*rowHeight}px, 0px)`}}\n            onClick={handleClick} \n            onDoubleClick={handleDoubleClick} \n            onContextMenu={handleContextMenu}>\n            {cells}\n        </div>\n    );\n})\n \n","import React, { useContext, useRef, useImperativeHandle, forwardRef } from 'react';\nimport cx from 'classnames';\nimport Row from './row.jsx';\nimport GridContext from '../grid-context';\n\nconst byKey = ([key1], [key2]) => key1 - key2;\n\nconst cssCanvas = {\n  position: 'absolute',\n  top:0,\n  overflow:'hidden'\n};\n\nconst cssCanvasContent = {\n  position: 'absolute',\n  overflow : 'hidden'\n};\n\nexport default forwardRef(Canvas)\n\nexport function Canvas ({\n  columnGroup,\n  firstVisibleRow,\n  gridModel,\n  height,\n  rows,\n  onKeyDown\n}, ref) {\n  const contentEl = useRef(null);\n  const {showContextMenu} = useContext(GridContext);\n\n  useImperativeHandle(ref, () => ({\n    scrollLeft: scrollLeft => {\n      contentEl.current.style.left = `-${scrollLeft}px`;\n    }\n  }))\n\n  const handleContextMenuFromCanvas = (e) => {\n    showContextMenu(e, 'canvas')\n  }\n\n  const { renderLeft: left, renderWidth: width } = columnGroup;\n  const { RENDER_IDX } = gridModel.meta;\n  const rowPositions = rows.map((row, idx) => {\n    const absIdx = firstVisibleRow + idx\n    return [row[RENDER_IDX], absIdx, row]\n  })\n  .sort(byKey)\n\n  const gridRows = rowPositions\n    .map(([key, abs_idx, row]) => {\n      return (\n        <Row key={key}\n          idx={abs_idx}\n          row={row}\n          gridModel={gridModel}\n          columns={columnGroup.columns}\n        />\n      )\n    });\n\n  const className = cx('Canvas', {\n    fixed: columnGroup.locked\n  });\n\n  return (\n    <div style={{ ...cssCanvas, left, width, height }} className={className}\n      onContextMenu={handleContextMenuFromCanvas}\n      onKeyDown={onKeyDown} >\n      <div ref={contentEl}\n        style={{ ...cssCanvasContent, width: Math.max(columnGroup.width, width), height }}>\n        {gridRows}\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport HeaderCell from '../header/header-cell.jsx';\nimport {getCellRenderer} from '../registry/datatype-registry.jsx';\n\nimport './column-bearer.css';\n\nconst NULL_FORMATTER = () => {};\n\nconst ColumnBearer = (props) => {\n    \n    const {rows, gridModel} = props;\n    const {_movingColumn: column, meta, headerHeight, _headingDepth: headingDepth} = gridModel\n\n    const {left,width} = column;\n    const top = (headingDepth - 1) * headerHeight; \n    console.log(`render ColumnBearer`)\n    return (\n        <div className='ColumnBearer' style={{top,left,width}}>\n            <div className='Header' style={{height:headerHeight}}> \n                <HeaderCell column={column}/>\n            </div>\n            {\n                rows.map((row,idx) => \n                    <div key={idx} className='Row'>\n                        {getCellRenderer({\n                            idx,\n                            column,\n                            meta,\n                            formatter: column.formatter || NULL_FORMATTER,\n                            row,\n                            value:row[column.key]})}\n                    </div>\n                )\n            }\n        </div>\n    );\n};\n\nexport default ColumnBearer;","\n\nconst INITIAL_RANGE = {lo:0,hi:-1}\n\nexport const initialData = {\n  rows: [],\n  rowCount: 0,\n  range: INITIAL_RANGE,\n  offset: 0,\n  // selected: [],\n  _keys: {\n    free: [],\n    used: {}\n  }\n}\n\n// This assumes model.meta never changes. If it does (columns etc)\n// we will need additional action types to update\nexport default function (model) {\n  return (state, action) => {\n    if (action.type === 'range'){\n      return setRange(state, action, model.meta)\n    } else if (action.type === 'data'){\n      return setData(state, action, model.meta)\n    } else if (action.type === 'selected'){\n      return applySelection(state, action, model.meta)\n    }\n  }\n}\n\nfunction setKeys(keys, {lo,hi}){\n  const free = [];\n  const keyCount = hi - lo;\n  for (let i=0;i<keyCount;i++){\n    const usedKey =  keys.used[i];\n    if (usedKey === 3 || usedKey === undefined ){\n      free.push(i);\n    }\n  }\n  return {\n    used: keys.used, \n    free\n  }\n\n}\n\n//TODO we HAVE to remove out=of-range rows and add empty placeholders\nfunction setRange(state, {range}, meta){\n  // return {\n  //   ...state,\n  //   range,\n  //   _keys: setKeys(state._keys, range)\n  // }\n\n  // const { IDX, SELECTED } = meta;\n  const {rows, rowCount, offset} = state;\n  const keys = setKeys(state._keys, range)\n  const [mergedRows, _keys] = mergeAndPurge(range, rows, offset, [], rowCount, meta, keys)\n  // const selected = rows.filter(row => row[SELECTED]).map(row => row[IDX]);\n  return {\n    rows: mergedRows,\n    rowCount,\n    offset,\n    range,\n    // selected,\n    _keys\n  }\n}\n\nfunction setData(state, action, meta){\n  // const { IDX, SELECTED } = meta;\n  const { rows, rowCount, offset } = action;\n  const range = action.range.reset || state.range === INITIAL_RANGE ?\n    action.range\n    : state.range;\n    \n  const [mergedRows, _keys] = mergeAndPurge(range, state.rows, offset, rows, rowCount, meta, state._keys)\n  \n  // const selected = rows.filter(row => row[SELECTED]).map(row => row[IDX]);\n\n  return {\n    rows: mergedRows,\n    rowCount,\n    offset,\n    range,\n    // selected,\n    _keys\n  }\n\n}\n\nfunction applySelection(state, {selected, deselected}, meta){\n  const { IDX, SELECTED } = meta;\n  const {rows: input, rowCount} = state;\n  const results = [];\n  const rows = [];\n\n  // TODO whare do we apply the offset\n  const offset = 100;\n\n  for (let i=0;i<input.length;i++){\n    const row = input[i];\n    const rowIdx = row[IDX];\n    const wasSelected = row[SELECTED];\n    const nowSelected = !wasSelected && selected.includes(rowIdx-offset);\n    const nowDeselected = wasSelected && deselected.includes(rowIdx-offset);\n\n    if (!nowSelected && !nowDeselected){\n      rows[i] = row;\n      if (wasSelected){\n        results.push(rowIdx-100);\n      }\n    } else {\n      const dolly = row.slice();\n      if (nowSelected){\n        dolly[SELECTED] = 1;\n        results.push(rowIdx-100);\n      } else {\n        dolly[SELECTED] = 0;\n      }\n      rows[i] = dolly;\n    }\n  }\n\n  return {\n    rows,\n    rowCount,\n    // selected: results\n  }\n}\n\n\n// TODO create a pool of these and reuse them\nfunction emptyRow(idx, { IDX, count }) {\n  const row = Array(count);\n  row[IDX] = idx;\n  return row;\n}\n\nfunction mergeAndPurge({ lo, hi }, rows, offset = 0, incomingRows, size, meta, keys) {\n  // console.log(`dataReducer.mergeAndPurge: entry\n  //   range ${lo} - ${hi}\n  //   keys: \n  //     free: ${keys.free.join(',')}\n  //     used : ${Object.keys(keys.used).join(',')}\n  //     existing rows : ${rows.map(r=>r[meta.IDX]-offset).join(',')}\n  //     incoming rows : ${incomingRows.map(r=>r[meta.IDX]-offset).join(',')}\n  // `)\n\n\n  const { IDX, RENDER_IDX } = meta;\n  const {free: freeKeys, used: usedKeys} = keys;\n  const low = lo + offset;\n  const high = Math.min(hi + offset, size + offset);\n  const rowCount = hi - lo;  \n  const results = [];\n  const used = {};\n  const free = freeKeys.slice();\n  \n  let maxKey = rows.length;\n  let pos, row, rowIdx, rowKey;\n\n  // 1) iterate existing rows, copy to correct slot in results if still in range\n  //    if not still in range, collect rowKey\n  \n  for (let i = 0; i < rows.length; i++) {\n    if (row = rows[i]) {\n      rowIdx = row[IDX];\n      rowKey = row[RENDER_IDX];\n      pos = rowIdx - low;\n\n      if (usedKeys[rowKey] === 1 && rowIdx >= low && rowIdx < high) {\n        results[pos] = rows[i];\n        used[rowKey] = 1;\n      } else if (usedKeys[rowKey] === 1 && rowKey < rowCount){\n        free.push(rowKey);\n        used[rowKey] = undefined;\n      }\n    }\n  }\n\n  // 2) iterate new rows, if not already in results (shouldn't be) , move to correct slot in results\n  //      assign rowKey from free values\n  for (let i = 0; i < incomingRows.length; i++) {\n    if (row = incomingRows[i]) {\n      rowIdx = row[IDX];\n      pos = rowIdx - low;\n\n      if (rowIdx >= low && rowIdx < high) {\n        if (results[pos]){\n          rowKey = results[pos][RENDER_IDX]\n        } else {\n          rowKey = free.shift();\n          if (rowKey === undefined){\n            rowKey = maxKey++;\n          }\n          used[rowKey] = 1;\n        }\n        results[pos] = row;\n        row[RENDER_IDX] = rowKey; \n\n      } else {\n        console.warn('new row outside range')\n      }\n    }\n  }\n  // 3) assign empty row to any free slots in results\n  // TODO make this more efficient\n  for (let i = 0, freeIdx=0; i < rowCount; i++) {\n    if (results[i] === undefined) {\n      const row = results[i] = emptyRow(i + low, meta);\n      rowKey = free[freeIdx++]; // don't remove from free\n      row[RENDER_IDX] = rowKey; \n      used[rowKey] = 3;\n    }\n  }\n\n//   console.log(`dataReducer.mergeAndPurge: exit\n//   range ${lo} - ${hi}\n//   keys: \n//     free: ${free.join(',')}\n//     used : ${Object.keys(used).join(',')}\n//     row keys : ${results.map(r=>r[RENDER_IDX]).join(',')}\n// `)\n\n  return [results,{\n    free,\n    used\n  }];\n\n}\n","import React, { /*useState, */useCallback, useContext, useRef, useEffect, useReducer } from 'react';\nimport { createLogger, logColor } from '@heswell/utils';\nimport Canvas from './canvas.jsx';\nimport ColumnBearer from './column-bearer.jsx';\n// import SelectionModel from '../model/selectionModel';\nimport * as Action from '../model/actions';\nimport dataReducer, { initialData } from '..//model/dataReducer';\nimport { getScrollbarSize } from '../utils/domUtils';\nimport GridContext from '../grid-context';\n\nconst logger = createLogger('Viewport', logColor.green)\n\nconst scrollbarSize = getScrollbarSize();\n\nconst cssViewport = {\n    position: 'absolute',\n    top: 25,\n    left:0,\n    right:0,\n    bottom:0,\n    padding:0,\n    overflow: 'hidden'\n};\n\nconst cssViewportContent = {\n    position: 'absolute',\n    top:0,\n    left:0,\n    right:0,\n    padding:0\n};\n\nfunction useThrottledScroll(callback) {\n\n    const timeoutHandler = useRef(null);\n    const prevValue = useRef(null);\n    const value = useRef(null);\n\n    const raf = () => {\n        if (value.current !== prevValue.current){\n            callback(value.current);\n            prevValue.current = value.current;\n            timeoutHandler.current = requestAnimationFrame(raf)\n        } else {\n            timeoutHandler.current = null;\n        }\n    }\n\n    const throttledCallback = useCallback(\n        e => {\n            value.current = e.target.scrollTop;\n            if (timeoutHandler.current === null){\n                timeoutHandler.current = requestAnimationFrame(raf);\n            }\n        },\n        [callback]\n    );\n\n    return throttledCallback;\n}\n\nexport const Viewport = React.memo(({\n    style,\n    height,\n    dataView,\n    model,\n    onFilterChange\n    // selectedRows\n}) => {\n    const scrollingCanvas = useRef(null);\n    const scrollableContainerEl = useRef(null);\n    const verticalScrollContainer = useRef(null);\n    const scrollTop = useRef(0);\n    const firstVisibleRow = useRef(0);\n    const groupBy = useRef(model.groupBy);\n\n    const { dispatch, callbackPropsDispatch } = useContext(GridContext);\n\n    // const [selectionState, setSelectionState] = useState(SelectionModel.getInitialState(selectedRows));\n\n    const [data, dispatchData] = useReducer(dataReducer(model), initialData);\n\n    useEffect(() => {\n\n        const rowCount = Math.ceil(height / model.rowHeight) + 1\n        dataView.subscribe({\n            columns: model.columns,\n            range: { lo: 0, hi: rowCount }\n        },\n            /* postMessageToClient */\n            ({\n                rows=null,\n                filter = undefined,\n                size: rowCount = null,\n                offset,\n                range,\n                selected = null,\n                deselected = null}) => {\n\n                if (range && range.reset) {\n                    setSrollTop(0);\n                }\n\n                if (filter !== undefined){\n                    onFilterChange(filter);\n                }\n\n                if (rowCount !== null && rowCount !== model.rowCount) {\n                    dispatch({ type: Action.ROWCOUNT, rowCount })\n                }\n                if (rows !== null) {\n                    dispatchData({ type: 'data', rows, rowCount, offset, range })\n                } else if (selected !== null) {\n                    dispatchData({ type: 'selected', selected, deselected })\n                }\n            }\n        )\n\n        return () => dataView.unsubscribe();\n\n    }, [dataView]);\n\n    useEffect(() => {\n        const rowCount = Math.ceil(height / model.rowHeight) + 1;\n        if (rowCount !== model.rowCount) {\n            dispatch({ type: Action.ROWCOUNT, rowCount })\n            const firstRow = firstVisibleRow.current;\n            setRange(firstRow, firstRow + rowCount);\n        }\n\n    }, [height])\n\n    const handleVerticalScroll = useThrottledScroll(useCallback(value => {\n        scrollTop.current = value;\n        const firstRow = Math.floor(value / model.rowHeight)\n        if (firstRow !== firstVisibleRow.current) {\n            const numberOfRowsInViewport = Math.ceil(height / model.rowHeight) + 1;\n            firstVisibleRow.current = firstRow;\n            setRange(firstRow, firstRow + numberOfRowsInViewport);\n        }\n\n    }, []), 30);\n\n    const handleHorizontalScroll = useCallback(e => {\n        if (e.target === e.currentTarget) {\n            const scrollLeft = e.target.scrollLeft;\n            scrollingCanvas.current.scrollLeft(scrollLeft);\n            callbackPropsDispatch({ type: 'scroll', scrollLeft })\n        }\n    }, [])\n\n    const setSrollTop = useCallback((value) => {\n        verticalScrollContainer.current.scrollTop = scrollTop.current = value;\n    }, [])\n\n    const setRange = useCallback((lo, hi) => {\n        //logger.log(`setRange ===>  ${lo} : ${hi}`)\n        dispatchData({ type: 'range', range: { lo, hi } });\n        dataView.setRange(lo, hi);\n    }, [])\n\n    // all of these calculations belong in the modelReducer\n    const horizontalScrollingRequired = model.totalColumnWidth > model.displayWidth;\n    // we shouldn't need to change this but chrome does not handle this correctly - vertical scrollbar is still\n    // displayed even when not needed, when grid is stretched.\n    const maxContentHeight = horizontalScrollingRequired ? height - 15 : height; // we should know the scrollbarHeight\n    const contentHeight = Math.max(model.rowHeight * data.rowCount, maxContentHeight);\n    const displayWidth = contentHeight > height\n        ? model.width - scrollbarSize\n        : model.width;\n    const overflow = displayWidth === model.width ? 'hidden' : 'auto';\n\n    let emptyRows = groupBy.current === model.groupBy\n        ? null\n        : ((groupBy.current = model.groupBy), []);\n\n\n    return (\n        <>\n            <div className='Viewport' style={{ ...cssViewport, ...style }}>\n\n                {horizontalScrollingRequired &&\n                    model._groups.filter(colGroup => !colGroup.locked).map((colGroup, idx) =>\n                        <div className='CanvasScroller horizontal scrollable-content'\n                            ref={scrollableContainerEl}\n                            key={idx} style={{ left: colGroup.renderLeft, width: colGroup.renderWidth }}\n                            onScroll={handleHorizontalScroll}>\n\n                            <div className='CanvasScroller-content' style={{ width: colGroup.width, height: 15 }} />\n                        </div>\n                    )\n                }\n\n                <div className='ViewportContent scrollable-content'\n                    ref={verticalScrollContainer}\n                    style={{ ...cssViewportContent, bottom: horizontalScrollingRequired ? 15 : 0, overflow }}\n                    onScroll={handleVerticalScroll} >\n\n                    <div className='scrolling-canvas-container'\n                        style={{ width: model.displayWidth, height: contentHeight }}>\n                        {\n                            model._groups.map((columnGroup, idx) =>\n                                <Canvas\n                                    key={idx}\n                                    gridModel={model}\n                                    rows={emptyRows || data.rows}\n                                    firstVisibleRow={firstVisibleRow.current}\n                                    height={contentHeight}\n                                    ref={columnGroup.locked ? null : scrollingCanvas}\n                                    columnGroup={columnGroup}\n                                />\n                            )}\n                    </div>\n                </div>\n            </div>\n            {model._movingColumn &&\n                <ColumnBearer gridModel={model} rows={data.rows} />}\n\n        </>\n    );\n\n})\n","\nexport default (\n  onScroll,\n  onSelectionChange,\n  onSelectCell,\n  onDoubleClick\n\n) => (state, action) => {\n  const { type, ...props } = action;\n  console.log(`%cgridReducer ${type}`,'color:blue;font-weight: bold;')\n  if (type === 'scroll') {\n      onScroll && onScroll(props);\n  } else if (type === 'selection') {\n      const {idx, row, rangeSelect, keepExistingSelection} = action;\n      onSelectionChange(idx, row, rangeSelect, keepExistingSelection);\n  } else if (type === 'select-cell') {\n      const { idx: rowIdx, cellIdx } = action;\n      onSelectCell && onSelectCell(rowIdx, cellIdx);\n  } else if (type === 'double-click') {\n    const { idx, row } = action;\n    onDoubleClick && onDoubleClick(idx, row);\n  }\n  return state;\n}\n","import React from 'react';\nimport { ContextMenu, MenuItem, Separator } from '../services/popups/index';\nimport * as Action from '../model/actions';\n\nexport const ContextMenuActions = {\n    SortAscending : 'sort-asc',\n    SortAddAscending : 'sort-add-asc',\n    SortDescending : 'sort-dsc',\n    SortAddDescending : 'sort-add-dsc',\n    GroupBy : 'groupby',\n    GroupByReplace : 'groupby-replace'\n};\n\nexport default class GridContextMenu extends React.Component {\n\n    handleMenuAction(action, data){\n        const {dispatch, doAction} = this.props;\n        switch(action){\n            case ContextMenuActions.GroupBy:\n                dispatch({ type: Action.groupExtend, column: data.column });\n                break;\n            case ContextMenuActions.GroupByReplace:\n                dispatch({ type: Action.GROUP, column: data.column });\n                break;\n            case ContextMenuActions.SortAscending: \n                return this.sort(data.column, 'asc');\n            case ContextMenuActions.SortDescending: \n                return this.sort(data.column, 'dsc');\n            case ContextMenuActions.SortAddAscending:\n                return this.sort(data.column, 'asc', true);\n            case ContextMenuActions.SortAddDescending:\n                return this.sort(data.column, 'dsc', true);\n    \n            default:\n                doAction(action, data)\n        }\n    }\n\n    sort(column, direction = null, preserveExistingSort = false){\n        const {dispatch} = this.props;\n        // this will transform the columns which will cause whole grid to re-render down to cell level. All\n        // we really need if for headers to rerender. SHould we store sort criteria outside of columns ?\n        dispatch({ type: Action.SORT, column, direction, preserveExistingSort });\n    }\n\n    render() {\n\n        const {location, options} = this.props;\n\n        return (\n            // TODO replace the inline function when we move to SFC\n            <ContextMenu doAction={(action, data) => this.handleMenuAction(action, data)}>\n                {this.menuItems(location, options)}\n            </ContextMenu>\n        );\n\n    }\n\n    menuItems(location, options) {\n\n        const menuItems = [];\n\n        if (location === 'header') {\n\n            const {model, column: {name: colName, sorted, isGroup}} = options;\n            const {groupBy, sortBy:sortCriteria} = model;\n\n            if (!sorted) {\n                menuItems.push(\n                    <MenuItem key='sort-asc' action='sort-asc' data={options} label='Sort' >\n                        <MenuItem key='sort-asc' action='sort-asc' data={options} label='ASC' />\n                        <MenuItem key='sort-dsc' action='sort-dsc' data={options} label='DESC' />\n                    </MenuItem>\n                );\n\n                if (sortCriteria && sortCriteria.length){\n                    menuItems.push(\n                        <MenuItem key='sort-add-asc' action='sort-add-asc' data={options} label='Add to Sort' >\n                            <MenuItem key='sort-add-asc' action='sort-add-asc' data={options} label='ASC' />\n                            <MenuItem key='sort-add-dsc' action='sort-add-dsc' data={options} label='DESC' />\n                        </MenuItem>\n                    );\n                }\n                                \n            } else {    \n\n                if (sortCriteria && sortCriteria.length > 1){\n                    menuItems.push(\n                       <MenuItem key='sort-remove' action='sort-remove' data={options} label='Remove from Sort' />\n                    );\n                }\n        \n                if (sorted === 1) {\n                    menuItems.push(<MenuItem key='sort-asc' action='sort-dsc' data={options} label='Sort (DESC)' />);\n                } else {\n                    menuItems.push(<MenuItem key='sort-dsc' action='sort-asc' data={options} label='Sort (ASC)' />);\n                }\n            }\n\n            if (groupBy && groupBy.length) {\n                if (!isGroup){\n                    menuItems.push(<MenuItem key='groupby-add' action='groupby' data={options} label={`Add ${colName} to Group`} />);\n                }\n            } else {\n                menuItems.push(<MenuItem key='groupby-add' action='groupby' data={options} label={`Group by ${colName}`} />);\n            }\n\n        } else if (location === 'row') {\n            menuItems.push(<MenuItem key='delete-row' action='delete-row' label='Delete Row' />);\n        }\n\n        menuItems.push(<Separator key='1' />);\n\n        if (options.showFilters) {\n            menuItems.push(<MenuItem key='hide-filters' action={Action.TOGGLE_FILTERS} label='Hide Filters' />);\n        } else {\n            menuItems.push(<MenuItem key='show-filters' action={Action.TOGGLE_FILTERS} label='Column Filters' />);\n        }\n        menuItems.push(<MenuItem key='settings' action='settings' label='Settings' />);\n\n        return menuItems;\n\n    }\n\n}\n\n","import React, { useCallback } from 'react';\nimport { PopupService } from './services/index';\nimport GridContextMenu from './context-menu/grid-context-menu.jsx';\nimport * as Action from './model/actions';\n\nexport const useContextMenu = (model, showFilters, setShowFilters, dispatch) => {\n\n  const handleContextMenuAction = useCallback(action => {\n\n    if (action === Action.TOGGLE_FILTERS) {\n      setShowFilters(state =>  !state);\n    }\n  }, [showFilters]);\n\n  return useCallback((e, location, options) => {\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { clientX: left, clientY: top } = e;\n    const component = (\n      <GridContextMenu\n        location={location}\n        options={{\n          ...options,\n          model,\n          showFilters\n        }}\n        dispatch={dispatch}\n        doAction={handleContextMenuAction}\n      />)\n      ;\n\n    PopupService.showPopup({ left: Math.round(left), top: Math.round(top), component });\n\n  },[model, showFilters])\n\n\n}\n\n","\n// TODO calculate width, height if not specified\n/*global requestAnimationFrame cancelAnimationFrame */\nimport React, { useRef, useState, useReducer, useEffect, useCallback } from 'react';\nimport cx from 'classnames';\nimport { columnUtils } from '@heswell/data';\nimport { createLogger, logColor } from '@heswell/utils';\nimport * as Action from './model/actions';\nimport { Motion, spring } from 'react-motion';\n// import { useAnimate } from 'react-simple-animate'\nimport modelReducer, { initModel } from './model/model-reducer';\nimport Header from './header/header.jsx';\nimport InlineFilter from './header/inline-filter.jsx';\nimport { Viewport } from './core/viewport.jsx';\nimport { getScrollbarSize } from './utils/domUtils';\nimport GridContext from './grid-context';\nimport gridReducer from './grid-reducer';\nimport {useContextMenu} from './use-context-menu.jsx';\n\nimport './grid.css';\n\nconst logger = createLogger('Grid', logColor.green)\n\nconst scrollbarSize = getScrollbarSize();\n//TODO \n// 1) how do we assign extra horizontal space\n\nexport default function Grid({\n    dataView,\n    columns,\n    style,\n    showHeaders = true,\n    headerHeight = showHeaders ? 24 : 0,\n    showFilters:initialShowFilters = false,\n    onScroll,\n    // TODO capture these as callbackProps\n    onSelectCell=() => {},\n    onSingleSelect,\n    onSelectionChange,\n    onDoubleClick,\n    //TODO be explicit, what can we have here - which of these make sense as grid props ?\n    ...props\n    // width\n    // height\n    // rowHeight\n    // minColumnWidth\n    // groupColumnWidth\n    // sortBy\n    // groupBy\n    // range\n    // groupState\n    // filter\n    // collapsedColumns\n    // selectionModel\n}) {\n    const header = useRef(null);\n    const inlineFilter = useRef(null);\n    const scrollLeft = useRef(0);\n    const overTheLine = useRef(0);\n    const inputWidth = props.width || style.width; \n    const inputHeight = props.height || style.height; \n\n    const [showFilters, setShowFilters] = useState(initialShowFilters);\n    const [filter, setFilter] = useState(null);\n\n    const handleScroll = useCallback(params => {\n        const { scrollLeft: pos = -1 } = params;\n        if (pos !== -1) {\n            if (scrollLeft.current !== pos) {\n                scrollLeft.current = pos;\n                if (header.current) {\n                    header.current.scrollLeft(pos);\n                }\n                if (inlineFilter.current) {\n                    inlineFilter.current.scrollLeft(pos);\n                }\n            }\n        }\n        onScroll && onScroll(params);\n    },[]);\n\n    const handleSelectionChange = useCallback((idx, row, rangeSelect, keepExistingSelection) => {\n        dataView.select(idx, row, rangeSelect,keepExistingSelection);\n        if (onSelectionChange){\n            const isSelected = row[model.meta.SELECTED] === 1;\n            // TODO what about range selections\n            onSelectionChange && onSelectionChange(idx, row, !isSelected)\n        }\n      // if (selected.length === 1 && onSingleSelect) {\n      //     onSingleSelect(selected[0], selectedItem);\n      // }\n\n    },[])\n\n    // this reducer is a no=op - always returns same state\n    // TODO why not use existing reducer ?\n    const [, callbackPropsDispatch] = useReducer(useCallback(gridReducer(\n        handleScroll,\n        handleSelectionChange,\n        onSelectCell,\n        onDoubleClick\n    ),[]), null);\n\n    const [model, dispatch] = useReducer(modelReducer, {\n        //TODO which props exactly does the model still use ?\n        ...props,\n        columns: columns.map(columnUtils.toKeyedColumn),\n        columnMap: columnUtils.buildColumnMap(columns),\n        scrollbarSize,\n        headerHeight\n    }, initModel);\n\n    const showContextMenu = useContextMenu(model, showFilters, setShowFilters, dispatch);\n\n    const {\n        height,\n        width,\n        _headingDepth,\n        groupBy,\n        groupState,\n        sortBy,\n        _overTheLine } = model;\n\n    useEffect(() => {\n        overTheLine.current = _overTheLine;\n        logger.log(`<useEffect _overTheLine>`);\n        // we want to keep dispatching scroll as long as the column is over the line\n        const scroll = () => {\n            if (overTheLine.current !== 0) {\n                const type = overTheLine.current > 0 ? Action.SCROLL_RIGHT : Action.SCROLL_LEFT;\n                const scrollDistance = type === Action.SCROLL_RIGHT ? 3 : -3;\n                dispatch({ type, scrollDistance });\n                requestAnimationFrame(scroll);\n            }\n        };\n        scroll();\n\n    }, [_overTheLine])\n\n    useEffect(() => {\n        dispatch({type: Action.GRID_RESIZE, width: inputWidth, height: inputHeight})\n    },[inputWidth, inputHeight])\n\n    useEffect(() => {\n        if (sortBy !== undefined) {\n            dataView.sort(sortBy);\n        }\n    }, [dataView, sortBy]);\n\n    useEffect(() => {\n        if (groupBy !== undefined) {\n            dataView.group(groupBy);\n        }\n    }, [dataView, groupBy])\n\n    useEffect(() => {\n        if (groupState !== undefined) {\n            dataView.setGroupState(groupState);\n        }\n    }, [dataView, groupState]);\n\n    const filterHeight = showFilters ? 24 : 0;\n    const headingHeight = showHeaders ? headerHeight * _headingDepth : 0;\n    const totalHeaderHeight = headingHeight + filterHeight;\n    const isEmpty = dataView.size <= 0;\n    const emptyDisplay = (isEmpty && props.emptyDisplay) || null;\n    const className = cx(\n        'Grid',\n        props.className,\n        emptyDisplay ? 'empty' : '',\n        isEmpty && props.showHeaderWhenEmpty === false ? 'no-header' : ''\n    );\n\n    return (\n        // we can roll context menu into the context once more of the child components are functions\n        <GridContext.Provider value={{dispatch, callbackPropsDispatch, showContextMenu}}>\n            <div style={{ position: 'relative', height, width, ...style }} className={className}>\n                {showHeaders && headerHeight !== 0 &&\n                    <Header ref={header}\n                        height={headingHeight}\n                        model={model}\n                        colHeaderRenderer={props.colHeaderRenderer}\n                    />}\n\n                {showFilters &&\n                    <InlineFilter ref={inlineFilter}\n                        dataView={dataView}\n                        model={model}\n                        filter={filter}\n                        height={filterHeight}\n                        style={{ position: 'absolute', top: headingHeight, height: filterHeight, width }} />}\n\n                <Motion defaultStyle={{ top: headingHeight }} style={{ top: spring(totalHeaderHeight) }}>\n                    {interpolatingStyle =>\n                        <Viewport\n                            dataView={dataView}\n                            model={model}\n                            style={interpolatingStyle}\n                            height={height - totalHeaderHeight}\n                            onFilterChange={setFilter}\n                        />}\n                </Motion>\n                {emptyDisplay}\n            </div>\n        </GridContext.Provider>\n    );\n}"],"names":["COLUMN_COLLAPSE","COLUMN_EXPAND","INITIALIZE","ROWCOUNT","GROUP","SORT","SORT_GROUP","GRID_RESIZE","COLUMN_RESIZE_BEGIN","COLUMN_RESIZE","COLUMN_RESIZE_END","GROUP_COLUMN_WIDTH","RESIZE_HEADING","MOVE_BEGIN","MOVE","MOVE_END","TOGGLE","TOGGLE_FILTERS","SCROLL_LEFT","SCROLL_RIGHT","RANGE","groupExtend","CHECKBOX","SINGLE_ROW","MULTIPLE_ROW","Selection","Checkbox","SingleRow","MultipleRow","DEFAULT_TYPE","name","renderCellContent","props","column","row","type","formatter","value","key","React","columnType","getGridCellClassName","cx","className","resizing","moving","memo","idx","onClick","style","width","clickHandler","useCallback","cellClass","meta","isSelected","SELECTED","rowUtils","isEmptyRow","CHAR_ARROW_UP","String","fromCharCode","CHAR_ARROW_DOWN","UP1","UP2","DOWN1","DOWN2","FlashStyle","ArrowOnly","BackgroundOnly","ArrowBackground","INITIAL_VALUE","useDirection","ref","useRef","prevKey","prevValue","prevColumn","prevDirection","current","direction","Number","isFinite","getDirection","useEffect","renderer","flashStyle","KEY","arrow","dirClass","arrowClass","newValue","diff","dataType","decimals","formatting","toFixed","Left","Right","None","Capitalize","defaultFormatting","align","capitalization","defaultOptions","StringFormatter","cellCSS","result","push","length","join","PUNCTUATION_STR","DIGIT_STR","DECIMALS_AUTO","Space","DIGIT","TWO_DIGITS","THREE_DIGITS","FULL_PADDING","LEADING_FILL","Align","Center","Zero","pad","n","dp","Pad","len","slice","charAt","replace","roundDecimal","zeroPad","alignOnDecimals","undefined","isNaN","integral","fraction","part1","part2","toString","split","actualDecimals","parseFloat","toLocaleString","padLeft","maxLength","numberOr","fallback","NumberFormatter","numberOfDecimals","number","e","preventDefault","stopPropagation","isExpanded","DEPTH","getContent","columns","rowExpanded","count","COUNT","getValue","depth","paddingLeft","Math","abs","i","groupLevel","FormatRegistry","RegistryOfCellRenderers","defaultFormatter","registerFormatter","component","registerRenderer","getFormatter","t","getCellRenderer","Type","React.createElement","isGroup","CheckboxRenderer","BackgroundCellRenderer","size","getScrollbarSize","outer","document","createElement","height","overflowY","position","top","left","inner","appendChild","body","outerWidth","offsetWidth","innerWidth","removeChild","getColumnWidth","cssText","innerText","map","col","w","metaData","columnUtils","reducer","state","action","handlers","MISSING_HANDLER","DEFAULT_MODEL_STATE","headerHeight","rowHeight","minColumnWidth","groupColumnWidth","range","sortBy","groupBy","groupState","rowCount","scrollbarSize","scrollLeft","collapsedColumns","displayWidth","totalColumnWidth","selectionModel","_columns","_columnMap","_movingColumn","_groups","_overTheLine","_columnDragPlaceholder","_headingDepth","_headingResize","RESIZING","NOT_RESIZING","EMPTY_ARRAY","console","warn","MISSING_TYPE_HANDLER","MAX_OVER_THE_LINE","MISSING_TYPE","Action","initialize","setRowCount","sort","sortGroup","setGroupBy","extendGroup","columnResizeBegin","gridResize","columnResize","resizeHeading","columnResizeEnd","moveBegin","move","moveEnd","toggle","setRange","autoScrollLeft","autoScrollRight","collapseColumn","expandColumn","initModel","model","gridState","columnMap","preCols","sortable","concat","toColumn","splitIntoGroups","_totalColumnWidth","sumWidth","getDisplayWidth","measure","log","preserveExistingSort","newSortCriteria","sorted","DSC","ASC","existingGroupBy","groupIdx","groupHelpers","indexOfCol","colName","sortDirection","sortCol","groupCol","updateGroupBy","groupRow","toggleGroupState","groupedRow","groupByIdx","newGroupState","stateEntry","find","groupVal","lo","hi","splitKeys","compositeKey","k","parseInt","updatedGroups","isHeading","updateGroupHeading","updateGroupColumn","lastSizedCol","getColumnPositions","pos","groupColIdx","diffs","getColumnAdjustments","newState","targetCol","numCols","sign","absDiff","numSlotsToFill","min","each","floor","results","updatedGroup","updateColumnHeading","widthAdjustment","locked","renderWidth","renderLeft","updateColumn","scrollDistance","max","_virtualLeft","_updateColumnPosition","maxScroll","getColumnLeft","moveBoundaries","getColumnMoveBoundaries","replaceGroupColumn","isPlaceHolder","distance","oldPosLeft","canScroll","farLeft","rightLine","farRight","newPosLeft","overTheLineLeft","overTheLineRight","label","updatedCollapsedColumns","filter","positionsLeft","right","positionsRight","columnPosition","insertionIdx","insertionGroupIdx","groupColCount","earlierGroupColCount","lastGroup","adjustment","moveGroupColumn","movingColumn","finalIdx","reorderColumns","replaceColumnHeadings","updates","from","findIndex","c","splice","groups","fromGroupIdx","fromColumnIdx","toGroupIdx","toColumnIdx","cloneGroup","shiftLeft","removeColumnFromGroup","addColumnToGroup","group","columnIdx","headingUpdates","subHeadingUpdates","columnUpdates","keys","groupHeadingIdx","headingColIdx","getHeadingPosition","headings","heading","updatedHeading","h","updatedH","j","indexOf","forEach","updatedColumn","getColumnPosition","targetColumn","replacementColumn","columnKeysToIndices","columnKeysToColumns","indices","every","presenter","Array","isArray","getWidth","minWidth","add","val1","val2","list","reduce","colHeading","colWidth","sum","maxHeadingDepth","addColumnToHeadings","endsWith","string","subString","str","sortMap","sortUtils","sortByToMap","groupColumn","nonGroupedColumns","extractGroupColumn","columnKey","hidden","lastColHeaders","collapsedHeading","header","collapsed","groupedColumns","rest","arrayUtils","partition","groupCount","groupCols","collapsible","colHeader","colHeaderLabel","lastHeading","hide","d","head","colHeadingLabel","isCollapsed","lowerDepth","lastLowerDepth","flatMap","firstColumn","visibleColumns","unsizedCols","sizedCols","defaultCount","defaultWidth","lockedGroupWidth","scrollGroupWidth","JSON","stringify","test1","test2","results1","misses","results2","clientHeight","contentHeight","horizontalScrollbar","scrollbarNeeded","verticalScrollbar","contentSize","containerSize","NOOP","allProps","Component","onDrag","onDragStart","onDragEnd","children","child","x","y","dragState","handleMouseDown","newDragState","button","clientX","clientY","window","addEventListener","onMouseUp","onMouseMove","deltaX","deltaY","cleanUp","drag","removeEventListener","cloneElement","onMouseDown","Direction","multiColumnSort","createContext","dispatch","useContext","GridContext","handleToggleCollapse","isHidden","Label","propClassName","onResize","onMove","onContextMenu","dragging","wasDragging","el","handleClick","handleContextMenu","handleResizeStart","handleResize","getWidthFromMouseEvent","handleResizeEnd","pageX","getBoundingClientRect","display","resizeable","expandStatesfromGroupState","fill","all","styles","groupByHeaderCell","ColHeader","onRemoveColumn","expandState","onToggle","expanded","onToggleGroupState","expandStates","columnClassName","classes","forwardRef","ColumnGrouHeader","columnGroup","colGroupHeaderRenderer","colHeaderRenderer","ignoreHeadings","onColumnMove","showContextMenu","containerEl","useImperativeHandle","handleColumnResize","phase","handleRemoveGroupBy","handleHeaderCellClick","handleToggleGroupState","renderColHeadings","item","bottomless","renderHeaderCells","renderGroupHeader","handleGroupHeaderCellClick","renderCell","isValidElement","reverse","whiteSpace","propStyle","scrollingHeader","handleColumnMove","_dialogOpen","_popups","specialKeyHandler","keyCode","closeAllPopups","ReactDOM","unmountComponentAtNode","querySelector","outsideClickHandler","popupContainers","querySelectorAll","contains","target","popupClosed","dialogOpened","dialogClosed","popupOpened","PopupService","showPopup","render","keepWithinThePage","hidePopup","movePopup","container","firstChild","innerHeight","overflowH","overflowW","DialogService","showDialog","dialog","onClose","closeDialog","Popup","constructor","pendingTask","componentDidMount","domNode","findDOMNode","parentElement","boundingClientRect","show","componentWillUnmount","componentWillReceiveProps","nextProps","clearTimeout","close","targetLeft","targetTop","clientWidth","bottom","targetBottom","setTimeout","subMenuTimeout","MenuItem","hasChildMenuItems","nestedMenu","submenuShowing","doAction","disabled","handleMouseOver","data","onMouseOver","Separator","ContextMenu","submenuIdx","menuItems","menuItem","handleMenuAction","handleMenuItemMouseOver","setState","onAction","showSubmenu","defaultProps","dataView","onClearFilter","onFilterOpen","onFilterClose","showFilter","onFilter","rootEl","toggleFilterDisplay","closeFilter","hideFilter","handleKeyDown","filterUtils","STARTS_WITH","clearFilter","handleNumberFilterChange","handleFilter","getFilter","requestAnimationFrame","round","moveFilter","getFilterType","isActive","includesColumn","padding","NOT_IN","serverFilter","setShowFilter","useState","getFilterData","setFilterRange","newFilter","addFilter","isNumeric","handleClearFilter","values","DataTypes","ROW_DATA","gridModel","callbackPropsDispatch","rangeSelect","shiftKey","keepExistingSelection","ctrlKey","metaKey","handleDoubleClick","cellIdx","cells","transform","byKey","key1","key2","cssCanvas","overflow","cssCanvasContent","Canvas","firstVisibleRow","rows","onKeyDown","contentEl","handleContextMenuFromCanvas","RENDER_IDX","rowPositions","absIdx","gridRows","abs_idx","fixed","NULL_FORMATTER","ColumnBearer","headingDepth","INITIAL_RANGE","initialData","offset","_keys","free","used","setData","applySelection","setKeys","keyCount","usedKey","mergedRows","mergeAndPurge","reset","selected","deselected","IDX","input","rowIdx","wasSelected","nowSelected","includes","nowDeselected","dolly","emptyRow","incomingRows","freeKeys","usedKeys","low","high","maxKey","rowKey","shift","freeIdx","logger","createLogger","logColor","green","cssViewport","cssViewportContent","useThrottledScroll","callback","timeoutHandler","raf","throttledCallback","scrollTop","Viewport","onFilterChange","scrollingCanvas","scrollableContainerEl","verticalScrollContainer","dispatchData","useReducer","dataReducer","ceil","subscribe","setSrollTop","unsubscribe","firstRow","handleVerticalScroll","numberOfRowsInViewport","handleHorizontalScroll","currentTarget","horizontalScrollingRequired","maxContentHeight","emptyRows","colGroup","onScroll","onSelectionChange","onSelectCell","onDoubleClick","ContextMenuActions","SortAscending","SortAddAscending","SortDescending","SortAddDescending","GroupBy","GroupByReplace","GridContextMenu","location","options","sortCriteria","showFilters","useContextMenu","setShowFilters","handleContextMenuAction","Grid","showHeaders","initialShowFilters","onSingleSelect","inlineFilter","overTheLine","inputWidth","inputHeight","setFilter","handleScroll","params","handleSelectionChange","select","gridReducer","modelReducer","toKeyedColumn","buildColumnMap","scroll","setGroupState","filterHeight","headingHeight","totalHeaderHeight","isEmpty","emptyDisplay","showHeaderWhenEmpty","spring","interpolatingStyle"],"mappings":"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"}