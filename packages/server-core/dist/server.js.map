{
  "version": 3,
  "sources": ["../src/server.ts"],
  "sourcesContent": ["import { configure as configureRequestHandlers } from './requestHandlers.js';\nimport { configure as configureXhr } from './xhrHandler.js';\nimport { requestHandler as viewserverRequestHandler } from './handlers/viewserverRequestHandler.js';\nimport { handleAuthenticationRequest } from './handlers/authenticationHandler.js';\nimport serveStatic from 'serve-static';\n\nimport http from 'http';\nimport WebSocket from 'ws';\n\nconst logger = console;\n\nclass SubscriptionCounter {\n  constructor() {\n    this._count = 0;\n  }\n  next() {\n    this._count += 1;\n    return this._count;\n  }\n}\n\n//const mapArgs = (map, arg) => {let [n,v]=arg.split('=');map[n.toLowerCase()]=v;return map;};\n// const args = process.argv.slice(2).reduce(mapArgs,{});\nconst port = /* argv.port || */ 8090;\n\n//onsole.log(`args ${JSON.stringify(process.argv)}`);\n\n//const port = process.env.OPENSHIFT_NODEJS_PORT || argv.port || 9090;\nconst PRIORITY_UPDATE_FREQUENCY = 20;\nconst CLIENT_UPDATE_FREQUENCY = 50;\nconst HEARTBEAT_FREQUENCY = 5000;\n\nexport function start(config) {\n  configureRequestHandlers({\n    ...config,\n    subscriptionCounter: new SubscriptionCounter()\n  });\n\n  const msgConfig = {\n    CLIENT_UPDATE_FREQUENCY,\n    HEARTBEAT_FREQUENCY,\n    PRIORITY_UPDATE_FREQUENCY\n  };\n\n  configureXhr(msgConfig);\n\n  var serve = serveStatic('/Users/steve/git/venuu-io/vuu/vuu-ui/packages/app-vuu-example/public', {\n    index: ['index.html']\n  });\n\n  const httpServer = http.createServer(function (request, response) {\n    console.log(`req ${request.url}`);\n    if (request.url.match(/login|index|chunk|worker|favicon/)) {\n      serve(request, response, (req, res) => {\n        console.log(`what do we do now`, {\n          req\n        });\n      });\n    } else if (request.url === '/xhr') {\n      handleXhrRequest(request, response);\n    } else if (request.url === '/api/authn') {\n      handleAuthenticationRequest(request, response);\n    } else if (request.url.match(/\\/ws\\/info/)) {\n      // doesn't belng here\n      const HTTP_HEADERS = {\n        'Access-Control-Allow-Credentials': true,\n        'Access-Control-Allow-Origin': request.headers['origin'],\n        'Cache-Control': 'no-store, no-cache, must-revalidate, max-age=0',\n        // 'Content-Length':77,\n        'Content-type': 'application/json;charset=UTF-8'\n      };\n      response.writeHead(200, HTTP_HEADERS);\n      response.end(\n        JSON.stringify({ entropy: 9006110, origins: ['*:*'], cookie_needed: true, websocket: true })\n      );\n    } else {\n      console.log(new Date() + ' received request for ' + request.url);\n      request\n        .addListener('end', function () {\n          // do nothing\n        })\n        .resume();\n    }\n  });\n\n  const wss = new WebSocket.Server({ server: httpServer });\n\n  const requestHandler = viewserverRequestHandler;\n\n  wss.on('connection', requestHandler(msgConfig, logger));\n\n  // const ipaddress = '127.0.0.1';\n  httpServer.listen(port, function () {\n    console.log(`HTTP Server is listening on port ${port}`);\n  });\n}\n\nfunction handleXhrRequest(request, response) {\n  let content = '';\n  request.on('data', (data) => (content += data));\n  request.on('end', () => {\n    console.log(`got a client request ${content}`);\n    let { clientId, message } = JSON.parse(content);\n  });\n}\n"],
  "mappings": "AAAA,SAAS,aAAa,gCAAgC;AACtD,SAAS,aAAa,oBAAoB;AAC1C,SAAS,kBAAkB,gCAAgC;AAC3D,SAAS,mCAAmC;AAC5C,OAAO,iBAAiB;AAExB,OAAO,UAAU;AACjB,OAAO,eAAe;AAEtB,MAAM,SAAS;AAEf,MAAM,oBAAoB;AAAA,EACxB,cAAc;AACZ,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,OAAO;AACL,SAAK,UAAU;AACf,WAAO,KAAK;AAAA,EACd;AACF;AAIA,MAAM,OAA0B;AAKhC,MAAM,4BAA4B;AAClC,MAAM,0BAA0B;AAChC,MAAM,sBAAsB;AAErB,SAAS,MAAM,QAAQ;AAC5B,2BAAyB;AAAA,IACvB,GAAG;AAAA,IACH,qBAAqB,IAAI,oBAAoB;AAAA,EAC/C,CAAC;AAED,QAAM,YAAY;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAEA,eAAa,SAAS;AAEtB,MAAI,QAAQ,YAAY,wEAAwE;AAAA,IAC9F,OAAO,CAAC,YAAY;AAAA,EACtB,CAAC;AAED,QAAM,aAAa,KAAK,aAAa,SAAU,SAAS,UAAU;AAChE,YAAQ,IAAI,OAAO,QAAQ,KAAK;AAChC,QAAI,QAAQ,IAAI,MAAM,kCAAkC,GAAG;AACzD,YAAM,SAAS,UAAU,CAAC,KAAK,QAAQ;AACrC,gBAAQ,IAAI,qBAAqB;AAAA,UAC/B;AAAA,QACF,CAAC;AAAA,MACH,CAAC;AAAA,IACH,WAAW,QAAQ,QAAQ,QAAQ;AACjC,uBAAiB,SAAS,QAAQ;AAAA,IACpC,WAAW,QAAQ,QAAQ,cAAc;AACvC,kCAA4B,SAAS,QAAQ;AAAA,IAC/C,WAAW,QAAQ,IAAI,MAAM,YAAY,GAAG;AAE1C,YAAM,eAAe;AAAA,QACnB,oCAAoC;AAAA,QACpC,+BAA+B,QAAQ,QAAQ;AAAA,QAC/C,iBAAiB;AAAA,QAEjB,gBAAgB;AAAA,MAClB;AACA,eAAS,UAAU,KAAK,YAAY;AACpC,eAAS;AAAA,QACP,KAAK,UAAU,EAAE,SAAS,SAAS,SAAS,CAAC,KAAK,GAAG,eAAe,MAAM,WAAW,KAAK,CAAC;AAAA,MAC7F;AAAA,IACF,OAAO;AACL,cAAQ,IAAI,IAAI,KAAK,IAAI,2BAA2B,QAAQ,GAAG;AAC/D,cACG,YAAY,OAAO,WAAY;AAAA,MAEhC,CAAC,EACA,OAAO;AAAA,IACZ;AAAA,EACF,CAAC;AAED,QAAM,MAAM,IAAI,UAAU,OAAO,EAAE,QAAQ,WAAW,CAAC;AAEvD,QAAM,iBAAiB;AAEvB,MAAI,GAAG,cAAc,eAAe,WAAW,MAAM,CAAC;AAGtD,aAAW,OAAO,MAAM,WAAY;AAClC,YAAQ,IAAI,oCAAoC,MAAM;AAAA,EACxD,CAAC;AACH;AAEA,SAAS,iBAAiB,SAAS,UAAU;AAC3C,MAAI,UAAU;AACd,UAAQ,GAAG,QAAQ,CAAC,SAAU,WAAW,IAAK;AAC9C,UAAQ,GAAG,OAAO,MAAM;AACtB,YAAQ,IAAI,wBAAwB,SAAS;AAC7C,QAAI,EAAE,UAAU,QAAQ,IAAI,KAAK,MAAM,OAAO;AAAA,EAChD,CAAC;AACH;",
  "names": []
}
