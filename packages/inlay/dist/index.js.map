{"version":3,"file":"index.js","sources":["../src/componentRegistry.js","../src/util/component-utils.js","../src/component/component-header.js","../src/componentContextMenu.js","../src/redux/actions.js","../src/model/boxModel.js","../src/model/pathUtils.js","../src/model/layoutTypes.js","../src/model/layoutUtils.js","../src/model/layoutModel.js","../src/containers/layout-item.js","../src/components/drop-menu/drop-menu.jsx","../src/drop-menu.js","../src/drop-target-canvas.js","../src/drop-target.js","../src/drag-state.js","../src/draggable.js","../src/containers/container.js","../src/splitter.js","../src/containers/flexbox.js","../src/tabstrip.js","../src/containers/tabbed-container.js","../src/component/component.js","../src/placeHolder.js","../src/util/componentFromLayout.js","../src/containers/dynamic-container.js","../src/containers/surface.js","../src/containers/dragSurface.js","../src/components/ComponentIcon.js","../src/redux/layoutReducer.js","../src/application/application.js"],"sourcesContent":["const _containers = {};\n\nexport const ComponentRegistry = {};\n\nexport function isContainer(className){\n    return _containers[className] === true;\n}\n\nexport function registerClass(className, component, isContainer){\n    ComponentRegistry[className] = component;\n\n    if (isContainer){\n        _containers[className] = true;\n    }\n}\n","import React from 'react';\nimport {uuid} from '@heswell/utils';\n\nimport shallowCloneObject from './shallowCloneObject';\nimport {isContainer} from '../componentRegistry';\n\nexport function typeOf(element){\n\n\tvar type;\n\n\n\n\tif (typeof element.type === 'function'){\n\t\ttype = element.type.displayName || element.type.name; \n\t}  \n\telse if (typeof element.type === 'string'){\n\t\ttype = element.type;\n\t}\n\telse if (element.constructor){\n\t\ttype = element.constructor.displayName; \n\t}\n\telse {\n\t\tdebugger;\n\t}\n\n\treturn type;\n\n}\n\n//TODO components should be able to register props here\nconst LayoutProps = {\n\tresizeable: true,\n\theader: true,\n\ttitle: true,\n\tactive: true,\n\ttabstripHeight: true,\n\tdragStyle: true\n}\n\nfunction layoutProps({props}){\n\tconst results = {};\n\tObject.entries(props).forEach(([key, value]) => {\n\t\t\tif (LayoutProps[key]){\n\t\t\t\t\tresults[key] = value;\n\t\t\t}\n\t})\n\treturn results;\n}\n\n\nexport const getLayoutModel = (component) => ({\n\ttype: typeOf(component),\n\t$id: component.props.id || uuid(),\n\t...layoutProps(component),\n\tstyle: component.props.style,\n\tchildren: isLayout(component) ? getLayoutModelChildren(component) : []\n})\n\nfunction getLayoutModelChildren(component){\n\tvar {children, contentModel=null} = component.props;\n\t// TODO don't recurse into children of non-layout\n\tif (React.isValidElement(children)){\n\t\t\treturn [getLayoutModel(children)];\n\t} else if (Array.isArray(children)){\n\t\t\treturn children.filter(child => child).map(child => getLayoutModel(child));\n\t} else if (contentModel !== null){\n\t\t\treturn [contentModel];\n\t} else {\n\t\t\treturn []; // is this safe ?\n\t}\n}\n\nexport function isLayout(element){\n\tif (typeof element !== 'string'){\n\t\t\telement = (element.type && element.type.displayName) ||\n\t\t\t\t\t(element.constructor && element.constructor.displayName);\n\t}\n\treturn isContainer(element);\n}\n\n\nexport function JSONfromComponent(component, parent, ignoreChildren){\n\n\tvar props = component.props;\n\tvar type;\n\tvar flexDirection;\n\n\tif (parent != null){\n\t\n\t\t// var parentType = (parent.type || parent.constructor).displayName;\n\t\t\n\t\t// var flexDirection = parent.props.flexDirection;\n\n\t\t// var dim = flexDirection === 'row' ? 'width' : 'height';\n\n\t}\n\t\n\tif (typeof component.type === 'function'){\n\t\ttype = component.type.displayName || component.type.name; \n\t}  \n\telse if (typeof component.type === 'string'){\n\t\ttype = component.type;\n\t}\n\telse if (component.constructor){\n\t\ttype = component.constructor.displayName; \n\t}\n\telse {\n\t\tdebugger;\n\t}\n\n\n\tvar json = { type, id: uuid(), flexDirection};\n\n\t// var props = component.props;\n\tvar propertyNames = Object.getOwnPropertyNames(props);\n\n\tpropertyNames.forEach(property => {\n\n\t\tif (property === 'children' && ignoreChildren !== true){\n\t\t\tvar content = json.content = [];\n\t\t\tReact.Children.forEach(props.children, child => \n\t\t\t\tcontent.push(JSONfromComponent(child,component))\n\t\t\t);\n\t\t}\n\t\telse if (property === 'style'){\n\t\t\tjson.style = shallowCloneObject(props.style);\n\t\t}\n\t\telse if (isSimpleType(typeof props[property])){\n\t\t\tjson[property] = props[property];\n\t\t}\n\t\t// EXPERIMENT\n\t\telse if (Array.isArray(props[property])){\n\t\t\tjson[property] = props[property];\n\t\t}\n\t\telse if (typeof props[property] === 'function'){\n\t\t\tconsole.log('How do we deal with function props like ' + property);\n\t\t\tjson[property] = props[property];\n\t\t}\n\t});\n\n\treturn json;\n}\n\nfunction isSimpleType(type){\n\treturn type === 'string' || type === 'number' || type === 'boolean';\n}\n\n// function isLayoutType(type){\n// \treturn type === 'FlexBox' || type === 'TabbedContainer';\n// }\n","import React from 'react';\n// import Icon from 'react-icons/lib/fa/ellipsis-v';\nimport './component-header.css';\n\nexport default class ComponentHeader extends React.Component {\n\n    render() {\n\n        var { style, fixed, minimized, onMouseDown, menu = true } = this.props;\n\n        return (\n            <header className=\"ComponentHeader\" onMouseDown={onMouseDown} style={style}>\n                <span className=\"title\">{this.props.title}</span>\n                {fixed && !minimized ? <span className=\"icon-pushpin\"></span> : null}\n                {menu && <button className=\"icon-menu\" data-key=\"menu\"\n                    onClick={e => this.handleMenuClick(e)}>\n                    {/* <Icon /> */}\n                </button>}\n            </header>\n        );\n    }\n\n    handleMenuClick(e){\n        if (this.props.onAction) {\n            this.props.onAction('menu', { left: e.clientX, top: e.clientY });\n        }\n    }\n\n}\n","import React from 'react';\nimport {ContextMenu, MenuItem, Separator} from '@heswell/ui-controls';\n\nexport default class ComponentContextMenu extends React.Component {\n\n\trender(){\n\n\t\treturn (\n\t\t\t<ContextMenu doAction={this.props.doAction}>\n\t\t\t\t{this.menuItems()}\n\t\t\t</ContextMenu>\n\t\t);\n\n\t}\n\n\tmenuItems(){\n\n\t\tvar {state, children:targetComponent} = this.props.component.props; // state is too vague\n\t\tvar minimized = state === 1;\n\t\tvar maximized = state === 2;;\n\t\tvar normal = !(maximized || minimized);\n\n\t\tconsole.log(`ComponentContextMenu.menuItems minimized=${minimized}`)\n\n\n\t\tvar menuItems = [];\n\n\t\t// menuItems.push(\t<MenuItem action=\"pin\" label=\"Fix Size\"/> );\n\t\tmenuItems.push(\t<MenuItem key=\"remove\" action=\"remove\" label=\"Remove\"/> );\n\t\tif (normal){\n\t\t\tmenuItems.push( \n\t\t\t\t<MenuItem key=\"minimize\" action=\"minimize\" label=\"Minimize\"/> ,\n\t\t\t\t<MenuItem key=\"maximize\" action=\"maximize\" label=\"Maximize\"/> );\n\t\t}\n\t\telse {\n\t\t\tmenuItems.push( <MenuItem key=\"restore\" action=\"restore\" label=\"Restore\"/> );\n\t\t} \t\n\n\t\tvar {contextMenuItems=[]} = targetComponent.props;\n\t\tconst componentMenuItems = contextMenuItems.map(({text, action}) =>\n\t\t\t<MenuItem key={action} action={action} label={text}/>\n\t\t); \n\t\tif (componentMenuItems.length){\n\t\t\tmenuItems.push(\t<Separator key=\"1\"/>, ...componentMenuItems );\n\t\t}\n\n\t\tmenuItems.push(\t\n\t\t\t<Separator key=\"1\"/>, \n\t\t\t<MenuItem key=\"settings\" action=\"settings\" label=\"Settings\"/> );\n\n\t\treturn menuItems;\n\t}\n\n\n}\n\n","export const DROP = 'DROP';\nexport const LAYOUT_REMOVE = 'LAYOUT_REMOVE';\nexport const LAYOUT_REPLACE = 'LAYOUT_REPLACE';\nexport const LAYOUT_SWITCH_TAB = 'LAYOUT_SWITCH_TAB';\nexport const LAYOUT_MODEL = 'LAYOUT_MODEL';\n\nexport const layoutModel = model => ({\n    type : LAYOUT_MODEL,\n    layoutModel: model\n});\n\n\nexport const drop = (draggedComponent, dropTarget) => ({\n    type:DROP,\n    draggedComponent,\n    dropTarget\n});\n\nexport const remove = targetNode => ({\n    type: LAYOUT_REMOVE,\n    targetNode\n});\n\nexport const replace = (targetNode, replacementNode) => ({\n    type:LAYOUT_REPLACE,\n    targetNode,\n    replacementNode\n});\n\nexport const switchTab = (path, idx, nextIdx) => ({\n    type:LAYOUT_SWITCH_TAB,\n    path,\n    idx,\n    nextIdx\n});","\nexport var positionValues = {\n    'north': 1,\n    'east': 2,\n    'south': 4,\n    'west': 8,\n    'header': 16,\n    'centre': 32,\n    'absolute': 64\n};\n\nexport var Position = Object.freeze({\n    'North': _position('north'),\n    'East': _position('east'),\n    'South': _position('south'),\n    'West': _position('west'),\n    'Header': _position('header'),\n    'Centre': _position('centre'),\n    'Absolute': _position('absolute')\n});\n\nfunction _position(str) {\n    return Object.freeze({\n        offset: str === 'north' || str === 'west' ? 0 : str === 'south' || str === 'east' ? 1 : NaN,\n        valueOf: function () { return positionValues[str]; },\n        toString: function () { return str; },\n        North: str === 'north',\n        South: str === 'south',\n        East: str === 'east',\n        West: str === 'west',\n        Header: str === 'header',\n        Centre: str === 'centre',\n        NorthOrSouth: str === 'north' || str === 'south',\n        EastOrWest: str === 'east' || str === 'west',\n        NorthOrWest: str === 'north' || str === 'west',\n        SouthOrEast: str === 'east' || str === 'south',\n        Absolute: str === 'absolute'\n    });\n}\n\nvar NORTH = Position.North,\n    SOUTH = Position.South,\n    EAST = Position.East,\n    WEST = Position.West,\n    HEADER = Position.Header,\n    CENTRE = Position.Centre;\n\nexport class BoxModel {\n\n    //TODO we should accept initial let,top offsets here\n    static measure(model) {\n        var measurements = {};\n        addMeasurements(model, measurements, 0, 0, 0, 0, 0, 0);\n        return measurements;\n    }\n\n    static smallestBoxContainingPoint(layout, measurements, x, y) {\n        return smallestBoxContainingPoint(layout, measurements, x, y);\n    }\n\n\n}\n\n\nexport function pointPositionWithinRect(x, y, rect) {\n\n    const width = rect.right - rect.left;\n    const height = rect.bottom - rect.top;\n    const posX = x - rect.left;\n    const posY = y - rect.top;\n    const pctX = posX / width;\n    const pctY = posY / height;\n\n    let closeToTheEdge;\n    let position;\n    let tab;\n\n    const borderZone = 30;\n\n    if (rect.header && containsPoint(rect.header, x, y)) {\n        position = HEADER;\n\n        if (rect.tabs){\n            const tabCount = rect.tabs.length;\n            const targetTab = rect.tabs.find(({ left, right }) => x >= left && x <= right);\n            if (targetTab){\n                tab = {\n                    left: targetTab.left,\n                    index: rect.tabs.indexOf(targetTab)\n                };\n            } else {\n                const lastTab = rect.tabs[tabCount - 1];\n                tab = {\n                    left: lastTab.right,\n                    index: tabCount\n                };\n            }\n        } else {\n            tab = { \n                left: rect.left,\n                index: -1\n            }\n        }\n    }\n    else {\n        const w = width * 0.4;\n        const h = height * 0.4;\n        const centerBox = { left: rect.left + w, top: rect.top + h, right: rect.right - w, bottom: rect.bottom - h }\n\n        if (containsPoint(centerBox, x, y)) {\n            position = CENTRE;\n        } else {\n\n            const quadrant = (pctY < 0.5 ? 'north' : 'south') + (pctX < 0.5 ? 'west' : 'east');\n\n            switch (quadrant) {\n            case 'northwest': position = (pctX > pctY) ? NORTH : WEST; break;\n            case 'northeast': position = ((1 - pctX) > pctY) ? NORTH : EAST; break;\n            case 'southeast': position = (pctX > pctY) ? EAST : SOUTH; break;\n            case 'southwest': position = ((1 - pctX) > pctY) ? WEST : SOUTH; break;\n            default:\n            }\n        }\n    }\n\n    // Set closeToTheEdge even when we have already established that we are in a Header.\n    // When we use position to walk the containment hierarchy, building the chain of\n    // dropTargets, the Header loses significance after the first dropTarget, but\n    // closeToTheEdge remains meaningful.\n    if (typeof borderZone === 'number') {\n        // var closeToTheEdge = 0;\n        if (posX < borderZone) closeToTheEdge += 8;\n        if (posX > width - borderZone) closeToTheEdge += 2;\n        if (posY < borderZone) closeToTheEdge += 1;\n        if (posY > height - borderZone) closeToTheEdge += 4;\n    }\n\n    // we might want to also know if we are in the center - this will be used to allow\n    // stack default option\n\n    return { position, x, y, pctX, pctY, closeToTheEdge, tab };\n\n}\n\nfunction addMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    var componentMeasurements;\n\n    if (model) {\n\n        //onsole.log(`\\naddMeasurements\t\t\tx:${x}\ty:${y}\tpreX:${preX}\tposX:${posX}\tpreY:${preY}\tposY:${posY}   ${model.type} ${model.type === 'FlexBox' ? model.style.flexDirection :''} ${model.$path}`);\n\n        componentMeasurements = addClientMeasurements(model, measurements, x, y, preX, posX, preY, posY);\n\n        if (model.children) {\n            collectChildMeasurements(\n                model,\n                measurements,\n                model.layout.left + x,\n                model.layout.top + y,\n                preX, posX, preY, posY);\n        }\n\n    }\n\n    return componentMeasurements;\n\n}\n\nfunction addClientMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    var { $path, header } = model;\n    var { top, left, width, height } = model.layout;\n\n    left = x + left - preX;\n    top = y + top - preY;\n\n    var right = preX + left + width + posX;\n\n    measurements[$path] = {\n        top,\n        left,\n        right,\n        bottom: preY + top + height + posY\n    };\n\n    if (header || model.type === 'TabbedContainer') {\n        //TODO don't assume headerheight = 34\n        measurements[$path].header = { top, left, right, bottom: top + 34 };\n\n        if (model.type === 'TabbedContainer') {\n            console.log(`measuring a tabbedContainer ${$path}`);\n\n            const start = performance.now();\n            const tabMeasurements = measureTabs($path);\n            const end = performance.now();\n            console.log(`took ${end - start}ms to measure tabs`);\n            measurements[$path].tabs = tabMeasurements;\n\n        }\n    }\n\n    return measurements[$path];\n\n}\n\nfunction isSplitter(model) {\n    return model && model.type === 'Splitter';\n}\n\nfunction collectChildMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    //onsole.log(`   collectChildMeasurements\tx:${x}\ty:${y}\tpreX:${preX}\tposX:${posX}\tpreY:${preY}\tposY:${posY}`);\n\n    var components = model.children\n        .reduce((arr, child, idx, all) => {\n\n            // generate a 'local' splitter adjustment for children adjacent to splitters\n            var localPreX = 0;\n            var localPosX = 0;\n            var localPreY = 0;\n            var localPosY = 0;\n\n            if (child.type !== 'Splitter') {\n\n                if (model.type === 'FlexBox') {\n\n                    var flexDirection = model.style.flexDirection;\n                    var prev = all[idx - 1];\n                    var next = all[idx + 1];\n                    var n = all.length - 1;\n\n                    if (flexDirection === 'row') {\n                        localPreX = idx === 0 ? preX : isSplitter(prev) ? prev.layout.width / 2 : 0;\n                        localPosX = idx === n ? posX : isSplitter(next) ? next.layout.width / 2 : 0;\n                        localPreY = preY;\n                        localPosY = posY;\n                    }\n                    else if (flexDirection === 'column') {\n                        localPreX = preX;\n                        localPosX = posX;\n                        localPreY = idx === 0 ? preY : isSplitter(prev) ? prev.layout.height / 2 : 0;\n                        localPosY = idx === n ? posY : isSplitter(next) ? next.layout.height / 2 : 0;\n                    }\n                }\n                else {\n                    localPreX = preX;\n                    localPosX = posX;\n                    localPreY = preY;\n                    localPosY = posY;\n                }\n\n                arr.push(addMeasurements(child, measurements, x, y, localPreX, localPosX, localPreY, localPosY));\n\n            }\n\n            return arr;\n        }, [])\n        .filter(c => c) // the dragging component will return undefined, unrendered tabbed children\n    // .sort(byPosition);\n\n\n    if (components.length) {\n        measurements[model.$path].children = components;\n    }\n\n}\n\n\nfunction smallestBoxContainingPoint(layout, measurements, x, y) {\n\n    //onsole.log('smallestBoxContainingPoint in ' + component.constructor.displayName);\n\n    var rect = measurements[layout.$path];\n    if (!containsPoint(rect, x, y)) return null;\n\n    if (!layout.children) {\n        return layout;\n    }\n\n\n    if (rect.header && containsPoint(rect.header, x, y)) {\n        return layout;\n    }\n\n    var subLayout;\n    var children = layout.children;\n\n    for (var i = 0; i < children.length; i++) {\n        if (layout.type === 'TabbedContainer' && layout.active !== i) {\n            continue;\n        }\n        if (subLayout = smallestBoxContainingPoint(children[i], measurements, x, y)) {\n            return subLayout;\n        }\n    }\n\n    return layout;\n}\n\n\nfunction containsPoint(rect, x, y) {\n\n    //\tif (component.props.isHidden || component.props.dragging === true) return false;\n    if (rect) {\n        return x >= rect.left && x < rect.right && y >= rect.top && y < rect.bottom;\n    }\n}\n\n// function byPosition(c1, c2) {\n//     if (c1.top < c2.top || c1.left < c2.left) return -1;\n//     if (c1.top > c2.top || c1.left > c2.left) return 1;\n//     return 0;\n// }\n\nfunction measureTabs(id) {\n    // Note the :scope selector is not supported on IE \n    return Array.from(document.getElementById(id).querySelectorAll(`:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab`))\n        .map(tab => tab.getBoundingClientRect())\n        .map(({ left, right }) => ({ left, right }))\n}\n","\nexport function followPath(model, path) {\n\n    if (path.indexOf(model.$path) !== 0) {\n        throw Error(`pathUtils.followPath path ${path} is not within model.path ${model.$path}`);\n    }\n\n    var route = path.slice(model.$path.length + 1);\n    if (route === '') {\n        return model;\n    }\n    var paths = route.split('.');\n\n    for (var i = 0; i < paths.length; i++) {\n\n        if (model.children === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children, so cannot fulfill rest of path ${paths.slice(i).join('.')}`);\n            return;\n        }\n\n        model = (model.children)[paths[i]];\n\n        if (model === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children that fulfill next step of path ${paths.slice(i).join('.')}`);\n            return;\n        }\n    }\n    return model;\n}\n\nexport function followPathToParent(layout, path) {\n\n    if (path === '0') return null;\n    if (path === layout.$path) return null;\n\n    return followPath(layout, path.replace(/.\\d+$/, ''));\n}\n\nexport function breadcrumb(model, path){\n    if (!model){\n        return [];\n    }\n    if (path.indexOf(model.$path) !== 0) {\n        throw Error(`pathUtils.breadcrumb path ${path} is not within model.path ${model.$path}`);\n    }\n\n    const result = [model];\n\n    const route = path.slice(model.$path.length + 1);\n    if (route === '') {\n        return result;\n    }\n\n    const paths = route.split('.');\n    for (var i = 0; i < paths.length; i++) {\n        if (model.children === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children, so cannot fulfill rest of path ${paths.slice(i).join('.')}`);\n            return [];\n        }\n        result.push(model = (model.children)[paths[i]]);\n        if (model === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children that fulfill next step of path ${paths.slice(i).join('.')}`);\n            return [];\n        }\n    }\n    return result;\n}\n\nexport function adjustPath(path, removedPath, containerRemoved) {\n\n    var steps = path.split('.');\n    var rem = removedPath.split('.');\n\n    // pos needs to be first point at which paths differ, not necessarily last pos\n    var pos = forkPoint(steps, rem);\n    var remIdx = parseInt(rem[pos]);\n    var stepIdx = parseInt(steps[pos]);\n\n    if (pos === rem.length - 1) {\n\n        if (containerRemoved === 1) {\n            steps.splice(pos, 1);\n            return steps.join('.');\n        }\n        else if (containerRemoved === 2) {\n            steps.splice(pos - 1, 2);\n            var topLevelIdx = parseInt(rem[pos - 1], 10);\n            steps[pos - 1] = parseInt(steps[pos - 1]) + topLevelIdx;\n\n            return steps.join('.');\n        }\n\n        if (remIdx < stepIdx) {\n            steps[pos] = parseInt(steps[pos]) - 1;\n            return steps.join('.')\n        }\n\n    }\n\n    if (containerRemoved && remIdx === stepIdx) {\n        return path.replace(/.\\d+$/, '');\n    } else {\n        return path;\n    }\n}\n\nfunction forkPoint(path1, path2) {\n    var len = Math.min(path1.length, path2.length);\n\n    for (var i = 0; i < len; i++) {\n        if (path1[i] !== path2[i]) {\n            return i;\n        }\n    }\n    return -1;\n}\n\nexport function nextStep(pathSoFar, targetPath) {\n    if (pathSoFar === targetPath) {\n        return { idx: -1, finalStep: true };\n    }\n    var regex = new RegExp(`^${pathSoFar}.`);\n    // check that pathSoFar startsWith targetPath and if not, throw\n    var paths = targetPath.replace(regex, '').split('.').map(n => parseInt(n, 10));\n    return { idx: paths[0], finalStep: paths.length === 1 };\n}\n","export const FLEXBOX = 'FlexBox';\nexport const SURFACE = 'Surface';\nexport const TABBED_CONTAINER = 'TabbedContainer';\n","import React from 'react';\nimport yoga, { Node } from 'yoga-layout';\nimport {TABBED_CONTAINER, SURFACE} from './layoutTypes'\nimport { isContainer } from '../componentRegistry';\n\nconst NO_CHILDREN = [];\nconst NO_STYLE = {}\nconst CSS_DIGIT = '(\\\\d+)(?:px)?';\nconst CSS_MEASURE = `^(?:${CSS_DIGIT}(?:\\\\s${CSS_DIGIT}(?:\\\\s${CSS_DIGIT}(?:\\\\s${CSS_DIGIT})?)?)?)$`\nconst CSS_REX = new RegExp(CSS_MEASURE)\nconst BORDER_REX = /^(?:(\\d+)(?:px)\\ssolid\\s([a-zA-Z,0-9().]+))$/;\nconst ROW = 'row';\nconst COLUMN = 'column';\nconst FLEX_DIRECTION = {\n    [ROW]: yoga.FLEX_DIRECTION_ROW,\n    [COLUMN]: yoga.FLEX_DIRECTION_COLUMN\n}\nconst LAYOUT = 'layout';\nconst FLEXBOX = 'FlexBox';\nconst SPLITTER = 'Splitter';\n\nconst BORDER_STYLES = {\n    border: true,\n    borderWidth: true,\n    borderTopWidth: true,\n    borderRightWidth: true,\n    borderBottomWidth: true,\n    borderLeftWidth: true\n}\nconst BORDER_LIST = Object.keys(BORDER_STYLES);\n\nconst LAYOUT_STYLES = {\n    ...BORDER_STYLES,\n    margin: true,\n    marginTop: true,\n    marginRight: true,\n    marginBottom: true,\n    marginLeft: true,\n    padding: true,\n    paddingTop: true,\n    paddingRight: true,\n    paddingBottom: true,\n    paddingLeft: true\n}\n\nconst LAYOUT_LIST = Object.keys(LAYOUT_STYLES);\n\nexport function layoutStyleDiff(style1, style2){\n    if (!style1 && !style2){\n        return false;\n    } else if (style1 && !style2){\n        return LAYOUT_LIST.some(style => style1[style]);\n    } else if (style2 && !style1){\n        return LAYOUT_LIST.some(style => style2[style]);\n    } else {\n        return LAYOUT_LIST.some(style => style1[style] !== style2[style]);\n    }\n}\n\nexport function stripLayout(model){\n    return {\n        ...model,\n        layout: undefined,\n        children: model.children\n            ? model.children.map(child => stripLayout(child))\n            : undefined\n    }\n}\nexport function computeLayout(model, width, height, top=0, left=0, path){\n    const tree = createTree(model, path || model.$path);\n    const layoutModel = createYogaTree(tree);\n    layoutModel.node.calculateLayout(width, height, yoga.DIRECTION_LTR);\n    setLayout(layoutModel)\n    layoutModel.node.freeRecursive();\n\n    if (left !== 0){\n        layoutModel.layout.left += left\n    }\n    if (top !== 0){\n        layoutModel.layout.top += top\n    }\n    return layoutModel;\n}\n\nfunction createTree(model, path='0'){\n    return {\n        ...model,\n        $path: path,\n        // TODO normalize style\n        style: normalizeLayoutStyles(model.style),\n        // style: expandStyle(model.style),\n        children: expandChildren(model, path)\n    }\n}\n\nfunction expandChildren({type, children}, path){\n    if (children){\n        var splitters = type === FLEXBOX\n            ? getSplitterPositions(children)\n            : NO_CHILDREN;\n\n        return children.reduce((list, child, i) => {\n            if (splitters[i]) {\n                list.push({\n                    type: 'Splitter',\n                    $path: `${path}.${list.length}`,\n                    style: {flex: '0 0 6px', backgroundColor: 'black'}\n                });\n            }\n            list.push(createTree(child, `${path}.${list.length}`));\n            return list;\n        },[])\n    }\n}\n\nconst NO_BORDERS = [0,null];\n// todo cache values\nexport function getCSSBorderProperties(style){\n    if (style && typeof style.border === 'string'){\n        const match = BORDER_REX.exec(style.border);\n        if (match !== null){\n            const [,borderWidth,color] = match;\n            return [parseInt(borderWidth,10),color];\n        }\n    }\n    return NO_BORDERS;\n}\n\n// TODO merge the following two functions\nexport function normalizeLayoutStyles({margin, marginTop, marginRight, marginBottom, marginLeft,\n    padding, paddingTop, paddingRight, paddingBottom, paddingLeft, ...style}=NO_STYLE){\n\n    if (typeof margin === 'number'){\n        style.marginTop = style.marginRight = style.marginBottom = style.marginLeft = margin;\n    } else if (typeof margin === 'string'){\n        const match = CSS_REX.exec(margin);\n        if (match === null){\n            console.error(`Invalid css value for margin '${margin}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                style.marginTop = parseInt(pos1,10);\n                style.marginRight = parseInt(pos2,10);\n                style.marginBottom = parseInt(pos3,10);\n                style.marginLeft = parseInt(pos4,10);\n            } else if (pos123){\n                style.marginTop = parseInt(pos1,10);\n                style.marginRight = style.marginLeft = parseInt(pos2,10);\n                style.marginBottom = parseInt(pos3,10);\n            } else if (pos1 && pos2){\n                style.marginTop = style.marginBottom = parseInt(pos1,10);\n                style.marginRight = style.marginLeft =parseInt(pos2,10);\n            } else {\n                style.marginTop = style.marginRight = style.marginBottom = style.marginLeft = parseInt(pos1,10);\n            }\n        }\n    }\n    if (typeof marginTop === 'number') style.marginTop = marginTop;\n    if (typeof marginRight === 'number') style.marginRight = marginRight;\n    if (typeof marginBottom === 'number') style.marginBottom = marginBottom;\n    if (typeof marginLeft === 'number') style.marginLeft = marginLeft;\n\n    if (typeof padding === 'number'){\n        style.paddingTop = style.paddingRight = style.paddingBottom = style.paddingLeft = padding;\n    } else if (typeof padding === 'string'){\n        const match = CSS_REX.exec(padding);\n        if (match === null){\n            console.error(`Invalid css value for padding '${padding}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                style.paddingTop = parseInt(pos1,10);\n                style.paddingRight = parseInt(pos2,10);\n                style.paddingBottom = parseInt(pos3,10);\n                style.paddingLeft = parseInt(pos4,10);\n            } else if (pos123){\n                style.paddingTop = parseInt(pos1,10);\n                style.paddingRight = style.paddingLeft = parseInt(pos2,10);\n                style.paddingBottom = parseInt(pos3,10);\n            } else if (pos1 && pos2){\n                style.paddingTop = style.paddingBottom = parseInt(pos1,10);\n                style.paddingRight = style.paddingLeft =parseInt(pos2,10);\n            } else {\n                style.paddingTop = style.paddingRight = style.paddingBottom = style.paddinggLeft = parseInt(pos1,10);\n            }\n        }\n    }\n    if (typeof paddingTop === 'number') style.paddingTop = paddingTop;\n    if (typeof paddingRight === 'number') style.paddingRight = paddingRight;\n    if (typeof paddingBottom === 'number') style.paddingBottom = paddingBottom;\n    if (typeof paddingLeft === 'number') style.paddingLeft = paddingLeft;\n\n    return normalizeBorderStyle(style);\n}\n\nfunction normalizeBorderStyle(style=NO_STYLE){\n\n    if (BORDER_LIST.some(bs => style[bs])){\n        let match;\n\n        let {border, borderWidth, borderTopWidth, borderRightWidth, borderBottomWidth, borderLeftWidth, borderColor, ...rest} = style;\n\n        if (border || borderWidth || borderTopWidth || borderRightWidth || borderBottomWidth || borderLeftWidth){\n            if (typeof border === 'string' && (match = BORDER_REX.exec(border))){\n                // what if both border and borderWidth are specified ?\n                ([,borderWidth,borderColor] = match);\n            }\n\n            if (borderWidth){\n                borderTopWidth = borderTopWidth === undefined ? borderWidth : borderTopWidth;\n                borderRightWidth = borderRightWidth === undefined ? borderWidth : borderRightWidth;\n                borderBottomWidth = borderBottomWidth === undefined ? borderWidth : borderBottomWidth;\n                borderLeftWidth = borderLeftWidth === undefined ? borderWidth : borderLeftWidth;\n            }\n\n            borderColor = borderColor || 'black';\n            const boxShadow = `\n                ${borderColor} ${borderLeftWidth || 0}px ${borderTopWidth || 0}px 0 0 inset, \n                ${borderColor} ${-borderRightWidth || 0}px ${-borderBottomWidth || 0}px 0 0 inset`;\n\n            return {\n                ...rest,\n                boxShadow,\n                borderColor,\n                borderStyle: 'solid',\n                borderTopWidth,\n                borderRightWidth,\n                borderBottomWidth,\n                borderLeftWidth\n            }\n\n        } else {\n            return style\n        }\n    } else {\n        return style;\n    }\n}\n\nconst DEFAULT_HEADER = {height: 32, style: {backgroundColor: 'brown'}}\n// we may mutate the tree in here\nfunction createYogaTree(model, parent, idx){\n\n    let {style=NO_STYLE, children=NO_CHILDREN} = model;\n    const {type, layout=null} = model;\n    const {flexDirection=null, left=null, top=null, width=null, height=null, flex=null} = style;\n    const parentIsTabbedContainer = parent && parent.type === TABBED_CONTAINER;\n    const parentIsSurface = parent && parent.type === SURFACE;\n    const header = model.header === true\n        ? DEFAULT_HEADER\n        : typeof model.header === 'object'\n            ? {...DEFAULT_HEADER, ...model.header}\n            : null\n\n    if (type !== LAYOUT && type !== SPLITTER && children.length === 0 && !isContainer(type)){\n        style = {\n            ...style,\n            display: 'flex',\n            flexDirection: 'column'\n        }\n        // children has to be created inline as it will be mutated by yoga\n        model.children = children = [{type: LAYOUT, style: {flex: 1}}]\n    } else if (children.length === 1 && children[0].type === LAYOUT){\n        style = {\n            ...style,\n            display: 'flex',\n            flexDirection: 'column'\n        }\n        // children has to be created inline as it will be mutated by yoga\n        model.children = children = [{type: LAYOUT, style: {flex: 1}}]\n    }\n\n    let node = Node.create();\n\n    if (header){\n        //TODO we need to have normalized the css before we do this, otw a padding string value will ignore the paddingtop\n        style = increaseCSSMeasure(style, 'padding', header.height, 'top');\n    }\n\n    setCSSMeasure(node, style, 'margin');\n    setCSSMeasure(node, style, 'border');\n    setCSSMeasure(node, style, 'padding');\n\n    if (flexDirection !== null){\n        node.setDisplay(yoga.DISPLAY_FLEX);\n        node.setFlexDirection(FLEX_DIRECTION[flexDirection]);\n        node.setAlignItems(yoga.ALIGN_STRETCH); //TODO allow this to be overridden\n    } else if (type === TABBED_CONTAINER){\n        node.setDisplay(yoga.DISPLAY_FLEX);\n        node.setFlexDirection(yoga.FLEX_DIRECTION_ROW);\n        node.setAlignItems(yoga.ALIGN_STRETCH);\n    }\n\n    if (parentIsTabbedContainer){\n        const {active=0} = parent;\n        if (idx !== active){\n            node.setDisplay(yoga.DISPLAY_NONE);\n        } else {\n            node.setFlexGrow(1);\n            node.setFlexShrink(1);\n            node.setFlexBasis(0);\n            node.setMargin(yoga.EDGE_TOP,34)\n        }\n    } /*else if (parentHasHeader){\n        node.setMargin(yoga.EDGE_TOP,32); // how do we determine the header height\n    }*/\n\n    if (layout !== null && !parentIsSurface){\n        // if we already have a layout, we reapply it, by transforming it into a style specification. This allows us to\n        // manipulate the layout outside and preserve changes when we resize. If size has not changed, there is no need\n        // to re-compute layout\n        const {width: w, height: h} = layout;\n        if (model.type === 'Splitter'){\n            node.setFlexGrow(0);\n            node.setFlexShrink(0);\n            node.setFlexBasis(6);\n        } else {\n            node.setFlexGrow(1);\n            node.setFlexShrink(1);\n            node.setFlexBasis(getFlexDirection(parent) === ROW ? w : h); // need to know parent orientation\n        }\n    } else if (flex !== null){\n        // TODO how do we default the flex values\n        if (typeof flex === 'string'){\n            const [flexGrow, flexShrink, flexBasis] = flex.split(' ');\n            node.setFlexGrow(parseInt(flexGrow,0));\n            node.setFlexShrink(parseInt(flexShrink,0));\n            node.setFlexBasis(parseInt(flexBasis,0));\n        } else if (typeof flex === 'number'){\n            node.setFlexGrow(flex);\n            node.setFlexShrink(flex);\n            node.setFlexBasis(0);\n        }\n    } else {\n        if (parentIsSurface){\n            node.setPositionType(yoga.POSITION_TYPE_ABSOLUTE);\n        }\n        if (top !== null && left !== null){\n            node.setPosition(yoga.EDGE_TOP, top);\n        }\n        if (left !== null){\n            node.setPosition(yoga.EDGE_START, left);\n        }\n        if (width !== null){\n            node.setWidth(width)\n        }\n        if (height !== null){\n            node.setHeight(height)\n        }\n    }\n\n    children.forEach((child,i) => {\n        const expandedChild = createYogaTree(child, model, i);\n        node.insertChild(expandedChild.node,i);\n    })\n\n    model.node = node\n    return model;\n}\n\nfunction getFlexDirection(model){\n    const style = (model && model.style) || NO_STYLE;\n    return style.flexDirection || ROW;\n}\n\nfunction getSplitterPositions(children) {\n\n    var ret = [];\n\n    for (var i = 1; i < children.length; i++) {\n\n        var thisFlexible = isFlexible(children[i]);\n        var lastFlexible = isFlexible(children[i - 1]);\n\n        if (isSplitter(children[i]) || isSplitter(children[i - 1])) {\n            ret[i] = false;\n        } else if (thisFlexible && lastFlexible) {\n            ret[i] = true;\n        } else if (!(thisFlexible || lastFlexible)) {\n            ret[i] = false;\n        } else if (lastFlexible && children.slice(i + 1).some(isFlexible)) {\n            ret[i] = true;\n        } else if (thisFlexible && children.slice(0, i).some(isFlexible)) {\n            ret[i] = true;\n        } else {\n            ret[i] = false;\n        }\n\n    }\n\n    return ret;\n\n}\n\nfunction isSplitter(model){\n    return model.type === 'Splitter';\n}\n\nfunction isFlexible(model){\n    return model.resizeable;\n}\n\nexport function elementsFromLayout(model){\n    const {style: {backgroundColor}=NO_STYLE, layout: {top,left,width,height},children=NO_CHILDREN} = model;\n    const style = {position: 'absolute', backgroundColor, top, left, width, height};\n    return React.createElement('div', {key: model.$path,style,onClick: model.onClick}, children.map(elementsFromLayout));\n}\n\nexport function setLayout(model){\n    model.layout = model.node.getComputedLayout();\n    model.children && model.children.forEach(child => setLayout(child))\n}\n\nconst CSS_MEASURE_SETTERS = {\n    'margin': 'setMargin',\n    'padding': 'setPadding',\n    'border': 'setBorder'\n}\nconst CSS_MEASURES = {\n    border: {measureTop: 'borderTopWidth', measureRight: 'borderRightWidth', measureBottom: 'borderBottomWidth', measureLeft: 'borderLeftWidth'},\n    margin: {measureTop: 'marginTop', measureRight: 'marginRight', measureBottom: 'marginBottom', measureLeft: 'marginLeft'},\n    padding: {measureTop: 'paddingTop', measureRight: 'paddingRight', measureBottom: 'paddingBottom', measureLeft: 'paddingLeft'}\n}\n\nfunction increaseCSSMeasure(style, measure, value, edge){\n    if (measure === 'padding'){\n        if (edge === 'top'){\n            if (style.paddingTop){\n                style = {...style, paddingTop: style.paddingTop + value}\n            } else if (typeof style.padding === 'number'){\n                const {padding, ...rest} = style;\n                style = {\n                    ...rest,\n                    paddingTop: padding + value,\n                    paddingRight: padding,\n                    paddingBottom: padding,\n                    paddingLeft: padding\n                }\n            } else {\n                style = {...style, paddingTop: value}\n            }\n        }\n    }\n    return style;\n}\nfunction setCSSMeasure(node, style, measure){\n\n    const setMeasure = CSS_MEASURE_SETTERS[measure];\n    const value = style[measure];\n\n    if (typeof value === 'number'){\n        node[setMeasure](yoga.EDGE_ALL, value);\n    } else if (typeof value === 'string'){\n        const match = CSS_REX.exec(value)\n        if (match === null){\n            console.error(`Invalid css value for ${measure} '${value}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos3,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos4,10));\n            } else if (pos123){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos3,10));\n            } else if (pos1 && pos2){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n            } else {\n                node[setMeasure](yoga.EDGE_ALL, parseInt(pos1,10));\n            }\n        }\n    } else {\n        const {measureTop, measureRight, measureBottom, measureLeft} = CSS_MEASURES[measure];\n        if (style[measureTop]) node[setMeasure](yoga.EDGE_TOP, style[measureTop]);\n        if (style[measureRight]) node[setMeasure](yoga.EDGE_END, style[measureRight]);\n        if (style[measureBottom]) node[setMeasure](yoga.EDGE_BOTTOM, style[measureBottom]);\n        if (style[measureLeft]) node[setMeasure](yoga.EDGE_START, style[measureLeft]);\n\n    }\n\n}\n","\nimport {uuid} from '@heswell/utils';\nimport { followPath, followPathToParent, nextStep } from './pathUtils';\nimport { computeLayout as computeLayoutYoga } from './layoutUtils';\n\nconst EMPTY_OBJECT = {};\n\nexport function containerOf(layout, target) {\n\n    if (target === layout) {\n        return null;\n    } else {\n\n        let { idx, finalStep } = nextStep(layout.$path, target.$path);\n        if (finalStep) {\n            return layout;\n        } else if (layout.children === undefined || layout.children[idx] === undefined) {\n            return null;\n        } else {\n            return containerOf(layout.children[idx], target);\n        }\n    }\n}\n\nexport function handleLayout(model, command, options) {\n\n    // This is called during splitter resize to resize children of model\n    if (command === 'resize') {\n        return resizeLayout(model, options);\n    } else if (command === 'replace') {\n        return replaceChild(model, options.targetNode, options.replacementNode);\n    } else if (command === 'remove') {\n        const result = removeChild(model, options.targetNode);\n        return result;\n    }\n    // else if (command === 'config-change'){\n    //     return Layout.config(layout, options);\n    // }\n    else if (command === 'switch-tab') {\n        return switchTab(model, options);\n    }\n    // else if (command === 'minimize'){\n    //     return Layout.minimize(layout, options);\n    // }\n    // else if (command === 'maximize'){\n    //     return Layout.maximize(layout, options);\n    // }\n    // else if (command === 'restore'){\n    //     return Layout.restore(layout, options);\n    //}\n    else if (command === 'drop') {\n        return drop(model, options);\n    }\n\n}\n\nexport function layout(model, position = {}, path = '0', visibility = 'visible', force = false, active) {\n\n    function firstNumber(n1, n2, n3) {\n        return typeof n1 === 'number' ? Math.round(n1) : typeof n2 === 'number' ? n2 : n3;\n    }\n\n    function firstDefined(n1, n2, n3) {\n        return n1 !== undefined\n            ? (typeof n1 === 'number' ? Math.round(n1) : n1)\n            : n2 !== undefined ? n2 : n3;\n    }\n\n    var style = model.style || {};\n    var top = firstNumber(position.top, style.top, 0);\n    var left = firstNumber(position.left, style.left, 0);\n    var width = firstDefined(position.width, style.width, 0);\n    var height = firstDefined(position.height, style.height, 0);\n\n    var { layout, ...m } = model;\n\n    if (layout && force !== true) {\n        if (path === model.$path &&\n            width === layout.width &&\n            height === layout.height &&\n            top === layout.top &&\n            left === layout.left &&\n            (visibility === undefined || visibility === model.style.visibility) &&\n            (active === undefined || active === model.active)) {\n\n            return model;\n        }\n    }\n\n    //TODO how do we make this model pluggable\n\n    switch (model.type) {\n    case 'FlexBox': return flexLayout(m, path, top, left, width, height, visibility, active);\n    case 'TabbedContainer': return flexLayout(m, path, top, left, width, height, visibility, active);\n    case 'Surface': return flexLayout(m, path, top, left, width, height, visibility, active);\n    default: return flexLayout(m, path, top, left, width, height, visibility, active);\n    }\n\n}\n\nfunction flexLayout(model, path, top, left, width, height, visibility, active) {\n\n    if (typeof active === 'number' && active !== model.isActive){\n        model = {\n            ...model,\n            active\n        }\n    }\n    return computeLayoutYoga(model, width, height, top, left, path);\n}\n\nfunction switchTab(layoutModel, { path, nextIdx }) {\n\n    var container = followPath(layoutModel, path);\n    // var content = container.children.slice();\n    // we need to set height of selected child, even if it is not needed for \n    // rendering - children will inherit the value;\n    // content[nextIdx] = content[nextIdx].set({height: content[idx].height});\n    // content[idx] = content[idx].set({height:0});\n    var { $path, visibility='visible' } = container;\n    var newContainer = layout(container, container.layout, $path, visibility, false, nextIdx);\n\n    return replaceChild(layoutModel, container, newContainer)\n\n}\n\nfunction drop(layoutModel, options) {\n\n    var { draggedComponent: source, dropTarget: { component: target, pos, tabIndex = -1 } } = options;\n\n    if (pos.position.Header) {\n        if (target.type === 'TabbedContainer') { //onsole.log('CASE 2 Works)');\n            let before, after;\n            if (tabIndex === -1 || tabIndex >= target.children.length) {\n                after = target.children[target.children.length - 1];\n            } else {\n                before = target.children[tabIndex];\n            }\n            return transform(layoutModel, { insert: { source, before, after } });\n        } else { //onsole.log('CASE 2B Works)'); \n            return transform(layoutModel, { wrap: { target, source, pos } });\n        }\n    } else if (pos.position.Centre) {\n        //onsole.log(JSON.stringify(source,null,2))\n        // source = clone(source, {style:{position:null,transform:null,transformOrigin:null}});\n        return replaceChild(layoutModel, followPath(layoutModel, target.$path), source);\n    } else {\n        return dropLayoutIntoContainer(layoutModel, pos, source, target);\n    }\n\n}\n\nfunction dropLayoutIntoContainer(layoutModel, pos, source, target) {\n\n    var targetContainer = followPathToParent(layoutModel, target.$path);\n\n    if (absoluteDrop(target, pos.position)) {\n        return transform(layoutModel, { insert: { source, target, pos } });\n    } else if (target === layoutModel || isDraggableRoot(layoutModel, target)) {\n        // Can only be against the grain...\n        if (withTheGrain(pos, target)) {\n            throw Error('How the hell did we do this');\n        } else { //onsole.log('CASE 4A) Works');\n            //return transform(layout, { wrap: {target, source, pos }, releaseSpace}); \n        }\n    } else if (withTheGrain(pos, targetContainer)) {\n        if (pos.position.SouthOrEast) { //onsole.log(`CASE 4B) Works. Insert into container 'with the grain'`);\n            return transform(layoutModel, { insert: { source, after: target, pos } });\n        } else { //onsole.log('CASE 4C) Works');\n            return transform(layoutModel, { insert: { source, before: target, pos } });\n        }\n    } else if (againstTheGrain(pos, targetContainer)) { //onsole.log('CASE 4D) Works.');\n        return transform(layoutModel, { wrap: { target, source, pos } });\n    } else if (isContainer(targetContainer)) {\n        return transform(layoutModel, { wrap: { target, source, pos } });\n    } else {\n        console.log('no support right now for position = ' + pos.position);\n    }\n    return layoutModel;\n\n}\n\nfunction transform(layoutModel, options) {\n\n    var nodeToBeInserted;\n    var nodeAfterWhichToInsert;\n    var nodeBeforeWhichToInsert;\n    var targetContainer;\n    var nodeSize;\n\n    for (var op in options) {\n        var opts = options[op];\n        switch (op) {\n\n        case 'insert':\n\n            nodeToBeInserted = opts.source;\n\n            nodeSize = opts.pos ? (opts.pos.width || opts.pos.height) : undefined;\n\n            if (opts.before) {\n                //onsole.log(`transform: insert before ` + opts.before.$path);\n                nodeBeforeWhichToInsert = opts.before.$path;\n            } else if (opts.after) {\n                //onsole.log(`transform: insert after ` + opts.after.$path);\n                nodeAfterWhichToInsert = opts.after.$path;\n            } else {\n                targetContainer = opts.target.$path;\n            }\n\n            break;\n\n        case 'wrap':\n\n            layoutModel = wrap(layoutModel, opts.source, opts.target, opts.pos);\n\n            break;\n        default:\n\n        }\n    }\n\n    if (nodeToBeInserted) {\n        layoutModel = insert(layoutModel, nodeToBeInserted, targetContainer, nodeBeforeWhichToInsert, nodeAfterWhichToInsert, nodeSize);\n    }\n\n    return layoutModel;\n\n}\n\nfunction insert(model, source, into, before, after, size) {\n    const target = before || after || into;\n    let { $path, /*active,*/ type, style, children } = model;\n    let { idx, finalStep } = nextStep($path, target);\n\n    // One more step needed when we're inserting 'into' a container\n    var oneMoreStepNeeded = finalStep && into && idx !== -1;\n\n    if (finalStep && !oneMoreStepNeeded) {\n\n        const flexBox = type === 'FlexBox';\n        const dim = flexBox && (style.flexDirection === 'row' ? 'width' : 'height');\n\n        if (type === 'Surface' && idx === -1) {\n            children = children.concat(source);\n        } else {\n\n            children = children.reduce((arr, child, i/*, all*/) => {\n                // idx of -1 means we just insert into end \n                if (idx === i) {\n                    if (flexBox) {\n                        var size = (child.layout[dim] - 6) / 2;\n                        child = {\n                            ...child,\n                            layout: {...child.layout, [dim]: size}};\n                        const flex = source.style.flex === undefined ? 1 : source.style.flex;\n                        source = {\n                            ...source,\n                            layout: {...source.layout, [dim]: size},\n                            style: {...source.style, flex, position: null, transform: null, transformOrigin: null}\n                        };\n                    } else {\n                        source = {...source, style: {...source.style, position: null, transform: null, transformOrigin: null}};\n                    }\n                    if (before) {\n                        arr.push(source, child);\n                    } else {\n                        arr.push(child, source);\n                    }\n                } else {\n                    arr.push(child);\n                }\n                return arr;\n            }, []);\n        }\n    } else {\n        children = model.children.slice();\n        children[idx] = insert(children[idx], source, into, before, after, size);\n    }\n\n    const {layout: modelLayout} = model;\n    return layout({...model, children}, modelLayout, model.$path)\n\n}\n\n// this is replaceChild with extras\nfunction wrap(model, source, target, pos) {\n\n    var { idx, finalStep } = nextStep(model.$path, target.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n        var { type, flexDirection } = getLayoutSpec(pos); // roll dim into this\n        var dim = flexDirection === 'row' ? 'width' : 'height';\n\n        var active = type === 'TabbedContainer' || pos.position.SouthOrEast ? 1 : 0;\n        var $path = `${model.$path}.${idx}`;\n        target = children[idx];\n        var style = { position: null, transform: null, transformOrigin: null, flex: 1 };\n        var size = (target.layout[dim] - 6) / 2;\n        var childLayout = { [dim]: size };\n        var wrapperStyle = { flexDirection };\n        if (target.style.flex) {\n            wrapperStyle.flex = target.style.flex;\n        }\n\n        // need to roll resizeable into the layoutModel. else we lose it here\n        var wrapper = layout({\n            type,\n            $path,\n            active,\n            $id: uuid(),\n            style: wrapperStyle,\n            layout: target.layout,\n            resizeable: target.resizeable,\n            children: (pos.position.SouthOrEast || pos.position.Header)\n                ? [{...target, $path: `${$path}.0`, style: {...target.style, ...style}, layout: childLayout},\n                    {...source, $path: `${$path}.1`, style: {...source.style, ...style}, layout: childLayout}]\n                : [{...source, $path: `${$path}.0`, style: {...source.style, ...style}, layout: childLayout},\n                    {...target, $path: `${$path}.1`, style: {...target.style, ...style}, layout: childLayout}]\n        },\n        target.layout,\n        $path,\n        'visible',\n        true);\n\n        children.splice(idx, 1, wrapper);\n\n    } else {\n        children[idx] = wrap(children[idx], source, target, pos);\n    }\n\n    const {layout: modelLayout} = model;\n    // we call layout too many times by invoking it at this level\n    return layout({...model, children}, modelLayout, model.$path)\n\n}\n\nfunction resizeLayout(model, { path, measurements, dimension }) {\n\n    const target = followPath(model, path);\n    const position = dimension === 'width' ? 'left' : 'top';\n    let shift = 0;\n\n    const resizedTarget = layout({\n        ...model,\n        children: model.children.map((child,i) => {\n            const {layout} = child;\n            const measurement = measurements[i];\n            const { [dimension]: dim } = layout;\n            if (dim === measurement && shift === 0) {\n                return child;\n            } else {\n                const newLayout = { ...layout, [dimension]: measurement, [position]: layout[position] + shift };\n                shift += (measurement - dim);\n                return {\n                    ...child,\n                    layout: newLayout\n                };\n            }\n        })\n    }, model.layout, model.$path);\n\n    return replaceChild(model, target, resizedTarget);\n\n}\n\nfunction simpleClone(o1, o2, unversioned) {\n\n    if (o2 === undefined) {\n        return o1;\n    }\n\n    var result = {};\n    var value1;\n    var value2;\n    var property;\n    var versionIncrement = unversioned === true ? 0 : 1;\n\n    // copy forward existing properties, making replacements and deletions...\n    for (property in o1) {\n\n        value1 = o1[property];\n        value2 = o2[property];\n\n\n        if (property === '$version') {\n            result.$version = value1 + versionIncrement;\n        } else if (property === 'style') {\n            result.style = simpleClone(value1, value2);\n        } else if (value2 !== null) {\n            if (typeof value2 !== 'undefined') {\n                result[property] = value2;\n            } else {\n                result[property] = o1[property];\n            }\n        }\n    }\n\n    /// ...then add new properties \n    for (property in o2) {\n        if (o2[property] !== null && (typeof result[property] === 'undefined')) {\n            result[property] = o2[property];\n        }\n    }\n\n    return result;\n\n}\n\nfunction clone(model, overrides, unversioned) {\n\n    var { /*type, $version,*/ style: s1, ...rest1 } = model;\n    var { style: s2 = EMPTY_OBJECT, ...rest2 } = overrides;\n\n    if (noEffectiveOverrides(s1, s2) && noEffectiveOverrides(rest1, rest2)) {\n        return model;\n    }\n\n    return simpleClone(model, overrides, unversioned);\n\n}\n\nfunction noEffectiveOverrides(source, overrides) {\n    var properties = Object.getOwnPropertyNames(overrides);\n    for (var i = 0; i < properties.length; i++) {\n        if (overrides[properties[i]] !== source[properties[i]]) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction removeChild(model, child) {\n\n    var { idx, finalStep } = nextStep(model.$path, child.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n\n        if (idx > 0 && isSplitter(children[idx - 1])) {\n            children.splice(idx - 1, 2);\n        } else if (idx === 0 && isSplitter(children[1])) {\n            children.splice(0, 2);\n        } else {\n            children.splice(idx, 1);\n        }\n\n        var { layout: modelLayout, $path/*, active */} = model;\n\n        if (children.length === 1 && model.type.match(/FlexBox|TabbedContainer/)) {\n            // certain style attributes from the parent must be passed down to the \n            // replacement child, eg flex - are there others ?\n            const { flex } = model.style;\n            return layout(clone(children[0], { style: { flex } }, true), modelLayout, $path);\n        } else {\n            var { top, left, width, height } = modelLayout;\n            // var props = {};\n            //var nowActive = active;\n            // if (active === children.length) {\n            //     nowActive = props.active = active - 1;\n            // }\n            const result = layout({\n                ...model,\n                children\n            }, {top, left, width, height}, model.$path);\n            return result;\n\n        }\n    } else {\n        children[idx] = removeChild(children[idx], child);\n    }\n\n    children = children.map((child, i) => {\n        var $path = `${model.$path}.${i}`;\n        return child.$path === $path ? child : clone(child, { $path });\n    })\n\n    return clone(model, { children })\n\n}\n\nfunction replaceChild(model, child, replacement) {\n\n    if (replacement.$path === model.$path) {\n        return replacement;\n    }\n\n    var { idx, finalStep } = nextStep(model.$path, child.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n\n        if (Array.isArray(replacement)) {\n            //TODO - make this right\n            // var dim = model.style.flexDirection === 'row' ? 'width' : 'height';\n            // var dim1 = child.layout[dim];\n            // replacement = replacement.map((l, i) => {\n            //     opts[dim] = dim1 / replacement.length;\n            //     return clone(l, { $path: `${model.$path}.${idx + i}` })\n            // });\n            // [].splice.apply(children, [idx, 1].concat(replacement));\n\n        } else {\n            children[idx] = {\n                ...replacement,\n                layout: {...child.layout}\n            };\n        }\n\n    } else {\n        children[idx] = replaceChild(children[idx], child, replacement);\n    }\n\n    return layout({...model, children}, model.layout, model.$path)\n}\n\n// Note: withTheGrain is not the negative of againstTheGrain - the difference lies in the \n// handling of non-Flexible containers, the response for which is always false;\nfunction withTheGrain(pos, container) {\n\n    return pos.position.NorthOrSouth ? isTower(container)\n        : pos.position.EastOrWest ? isTerrace(container)\n            : false;\n}\n\nfunction againstTheGrain(pos, layout) {\n\n    return pos.position.EastOrWest ? isTower(layout) || isTabset(layout)\n        : pos.position.NorthOrSouth ? isTerrace(layout) || isTabset(layout)\n            : false;\n\n}\n\nfunction absoluteDrop(target, position) {\n    return target.type === 'Surface' && position.Absolute;\n}\n\nfunction isSplitter(model) {\n    return model && model.type === 'Splitter';\n}\n\nfunction isContainer(model) {\n    return model.type === 'Container' || model.type === 'DynamicContainer';\n}\n\nfunction isTabset(model) {\n    return model.type === 'TabbedContainer';\n}\n\nfunction isTower(model) {\n    return model.type === 'FlexBox' && model.style.flexDirection === 'column';\n}\n\nfunction isTerrace(model) {\n    return model.type === 'FlexBox' && model.style.flexDirection === 'row';\n}\n\nfunction isDraggableRoot(layout, component) {\n\n    if (component.$path === '0') {\n        return true;\n    }\n\n    var container = containerOf(layout, component);\n    if (container) {\n        return container.type === 'App';\n    } else {\n        debugger;\n    }\n}\n\nfunction getLayoutSpec(pos) {\n    var type, flexDirection;\n\n    if (pos.position.Header) {\n        type = 'TabbedContainer';\n        flexDirection = 'column';\n    } else {\n        type = 'FlexBox';\n        if (pos.position.EastOrWest) {\n            flexDirection = 'row';\n        } else {\n            flexDirection = 'column';\n        }\n    }\n\n    return { type, flexDirection };\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport { PopupService } from '@heswell/ui-controls';\nimport ComponentHeader from '../component/component-header';\nimport ComponentContextMenu from '../componentContextMenu';\nimport { remove as removeFromLayout } from '../redux/actions';\nimport {\n    layout as applyLayout,\n    layoutStyleDiff\n} from '../model/index';\nimport {getLayoutModel} from '../util/component-utils';\n\nimport './layout-item.css';\n\nconst DEFAULT_HEADER_SPEC = {\n    height: 32,\n    menu: true\n}\n\nexport default class LayoutItem extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            layoutModel: props.layoutModel ||\n                applyLayout(getLayoutModel(this),{width: props.style.width, height: props.style.height})\n        };\n\n        this.handleLayout = this.handleLayout.bind(this);\n    }\n\n    render() {\n\n        const {\n            children,\n            title = '',\n            state,\n            dragging,\n            header: _,\n            ...props } = this.props;\n\n        const {layoutModel} = this.state;\n        const [{layout: childLayout}] = layoutModel.children;\n\n        var { $path, layout } = layoutModel;\n        var isSelected = this.props.isSelected;\n\n        var className = cx(\n            'LayoutItem', {\n                'minimized': state === 1,\n                'maximized': state === 2,\n                'active': isSelected,\n                'dragging': dragging\n            }\n        );\n\n        const header = !layoutModel.header\n            ? false\n            : layoutModel.header === true\n                ? DEFAULT_HEADER_SPEC\n                : { ...DEFAULT_HEADER_SPEC, ...layoutModel.header };\n\n        var headerHeight = header ? header.height : 0;\n\n        const style = {\n            backgroundColor: layoutModel.style.backgroundColor,\n            boxShadow: layoutModel.style.boxShadow\n        }\n\n        const componentStyle = {\n            // backgroundColor: props.style.backgroundColor,\n            position: 'absolute',\n            top: headerHeight,\n            border: 0,\n            padding: 0,\n            margin: 0,\n            // ...childStyle,\n            ...childLayout\n        };\n\n        return (\n            <div id={$path} className={className} style={{ position: 'absolute', ...style, ...layout }}>\n                {header &&\n                    <ComponentHeader ref='header'\n                        title={`${title}`}\n                        style={{ height: header.height }}\n                        menu={header.menu}\n                        onMouseDown={e => this.handleMousedown(e)}\n                        onAction={(key, opts) => this.handleAction(key, opts)}\n                        state={state} />\n                }\n\n                {children.type === 'div'\n                    ? React.cloneElement(children, {\n                        style: {...componentStyle, ...childLayout}\n                    })\n\n                    : React.cloneElement(children, {\n                        ...props,\n                        style: componentStyle, // we may need to merge style attributes from props\n                        width: childLayout.width,\n                        height: childLayout.height,\n                        onLayout: this.handleLayout\n                    })\n                }\n            </div>\n        );\n    }\n\n    componentDidMount() {\n\n        const self = this;\n        if (this.context && this.context.store) {\n            const { store } = this.context;\n            //TODO sort out this mess\n            // be careful the context of store change notification is not 'this'\n            this.unsubscribe = store.subscribe(() => {\n                const myState = self.getState();\n                if (myState && myState !== self.state.c) {\n                    // console.log(`LayoutItem receives store change notification - ITS FOR ME and it has changed \n                    // ${JSON.stringify(myState)}\n                    //${JSON.stringify(self.state.c)}`);\n                    self.setState({ c: myState });\n                }\n\n                // else if (myState && myState === self.state.c){\n                // console.log(`LayoutItem receives store change notification - it's for me BUT it hasn't changed`);\n                // }\n                // else {\n                // console.log(`LayoutItem receives store change notification - it's Not for me :-(`);\n                // }\n            });\n\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.unsubscribe) {\n            this.unsubscribe();\n            this.unsubscribe = null;\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        const { layoutModel, style } = nextProps;\n        // look out for a style change that will require a layout, we will reset layout in state and call\n        // onLayout prop to pass this up chain of command\n\n        if (style && style.flexGrow !== this.props.style.flexGrow) {\n            var fixed = style.flexGrow === 0;\n            this.setState({\n                fixed,\n                header: { title: this.props.title, fixed }\n            });\n        }\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (layoutStyleDiff(this.props.style, style)) {\n            // TODO test this code\n            const {$path, layout} = this.state.layoutModel;\n            const {marginTop=0,marginRight=0,marginBottom=0,marginLeft=0} = this.props.style;\n            const {top, left,width, height} = layout;\n            this.setState({\n                layoutModel: applyLayout(\n                    {\n                        ...this.state.layoutModel,\n                        style\n                    },\n                    { top, left, width: width + marginLeft + marginRight, height: height + marginTop + marginBottom },\n                    $path,\n                    true // FORCE_LAYOUT\n                )\n            }, () => {\n                this.props.onLayout('replace', { model: this.state.layoutModel });\n            });\n\n        }\n    }\n\n    dispatch(action){\n\n        if (typeof action === 'function') {\n            return this.context.store.dispatch(action);\n        }\n        else {\n            const { id, componentId, ...options } = action;\n            if (id && action.type === 'SAVE_CONFIG') {\n                this.context.store.dispatch({ type: 'SAVE_CONFIG', config: { ...options.config, targetId: this.props.layoutModel.$id }, componentId: id });\n            }\n            else if (componentId) {\n                this.context.store.dispatch({ ...options, componentId })\n            }\n            else {\n                this.context.store.dispatch({ ...options, componentId: this.props.layoutModel.$id });\n            }\n        }\n\n    }\n\n    handleLayout(command, options){\n\n        if (command === 'remove' && options === undefined) {\n            // TODO call onLayout\n            this.dispatch(removeFromLayout(this.props.layoutModel));\n        }\n        else {\n            this.props.onLayout(command, options);\n        }\n\n    };\n\n    handleAction(key, opts){\n\n        if (key === 'menu') {\n\n            var { left, top } = opts;\n\n            // the ComponentContextMenu will reach into the hostedComponent to get MenuItems, we should do that here\n            var contextMenu = <ComponentContextMenu component={this} doAction={action => this.handleContextMenuAction(action)} />;\n\n            PopupService.showPopup({ left, top, component: contextMenu });\n        }\n\n        else if (key === 'pin') {\n            var fixed = this.state.fixed;\n            this.setState({ fixed: !fixed });\n            this.props.onConfigChange(this, { fixed: !fixed })\n        }\n    }\n\n    handleMousedown(e){\n        if (this.props.onMouseDown) {\n            this.props.onMouseDown({\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n        else {\n            this.props.onLayout('drag-start', {\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n    }\n\n    handleContextMenuAction(action/*, data*/){\n\n        if (action === 'pin') {\n            var fixed = this.state.fixed;\n            this.setState({ fixed: !fixed });\n            this.props.onConfigChange(this, { fixed: !fixed })\n        }\n        else if (action === 'remove') {\n            this.dispatch(removeFromLayout(this.props.layoutModel));\n            // this.props.onLayout('remove', {model:this.props.layoutModel});\n        }\n        else if (action === 'minimize') {\n            this.props.onLayout('minimize', {/*path*/});\n        }\n        else if (action === 'maximize') {\n            this.props.onLayout('maximize', { /*path*/ });\n        }\n        else if (action === 'restore') {\n            this.props.onLayout('restore', { /*path*/ });\n        }\n        else if (action === 'settings') {\n\n            // const dialog = this._component && this._component.getSettingsEditor\n            //     ? this._component.getSettingsEditor()\n            //     : <div style={{\n            //                 width: 300,\n            //                 height: 200,\n            //                 backgroundColor: 'yellow',\n            //                 borderColor: 'red',\n            //                 borderWidth: 5,\n            //                 borderStyle: 'solid'}} />\n\n\n            // this.props.onLayout('dialog',{\n            //     component : dialog \n            // });\n        }\n        else if (typeof action === 'object') {\n            this.dispatch(action);\n        }\n        else {\n            console.log(`LayoutItem.handleContextMenuAction unknown action ${action}`);\n\n        }\n\n    }\n\n}\n\nLayoutItem.displayName = 'LayoutItem';\n\nLayoutItem.defaultProps = {\n    onConfigChange: () => { },\n    style: {},\n    visibility: 'visible'\n};\n","import React from 'react';\n\nimport './drop-menu.css';\n\nexport function computeMenuPosition(dropTarget, offsetTop = 0, offsetLeft = 0) {\n\n  const { pos, clientRect: box } = dropTarget;\n\n  // const dropTargets = dropTarget.toArray()\n  return menuPosition(pos, box, offsetTop, offsetLeft);\n\n  // this._group.position({ x, y });\n\n  // const paths = dropTargets.map((dropTarget, i) => ({\n  //     path: new Konva.Path({\n  //         strokeWidth: 0,\n  //         fill: COLOURS[i],\n  //         data: pathPosition(pos, i)\n  //     }),\n  //     dropTarget\n  // }));\n\n  // do we have to care about removing eventlisteners ? Probably not\n  // this._group.removeChildren();\n\n  // this.addPaths(paths);\n}\n\nfunction menuPosition(pos, box, offsetTop, offsetLeft) {\n\n  return pos.position.West ? [box.left - offsetLeft + 26, pos.y - offsetTop]\n      : pos.position.South ? [pos.x - offsetLeft, box.bottom - offsetTop - 26]\n      : pos.position.East ? [box.right - offsetLeft - 26, pos.y - offsetTop]\n      /* North | Header*/ : [pos.x - offsetLeft, box.top - offsetTop + 26];\n\n}\n\n// function pathPosition(pos, idx) {\n\n//   const unit = 30;\n//   const depth = 32;\n\n//   const lo = i => i === 0 ? -unit / 2\n//       : i > 0 ? -1 * (unit / 2 + (idx * unit))\n//           : unit / 2 + ((-idx - 1) * unit);\n\n//   const [top, left, width, height] =\n//       pos.position.West ? [lo(idx), 0, depth, unit] :\n//           pos.position.East ? [lo(idx), -depth, depth, unit] :\n//               pos.position.South ? [-depth, lo(idx), unit, depth] :\n//     /* North | Header */[0, lo(idx), unit, depth];\n\n//   // For pos 0 we draw just one item (the central item), for others we double up\t\n//   return `M${left},${top}h${width}v${height}h-${width}v-${height}${idx > 0 ? pathPosition(pos, -idx) : ''}`;\n\n// }\n\n\nconst DropMenu = () => {\n  return (\n    <div className=\"drop-menu\" />\n  )\n}\n\nexport default DropMenu;","import Konva from 'konva';\nimport './drop-menu.css';\n\nconst COLOURS = ['red', 'green', 'blue', 'yellow'];\n\n// Konva properties\nconst PATH_SETTINGS = {\n    fill: '#00D2FF',\n    strokeWidth: 0\n}\n\nexport default class DropMenu {\n\n    constructor({ layer, hover }) {\n\n        this._group = new Konva.Group();\n\n        this._group.on('mouseleave', () => hover(null));\n\n        layer.add(this._group);\n        \n        this.visible = isVisible => this._group.visible(isVisible)\n\n        this.addPaths = paths => {\n\n            paths.forEach(({ path, dropTarget }) => {\n                this._group.add(path);\n                path.on('mouseenter', () => hover(dropTarget));\n            })\n        }\n\n    }\n\n    computeMenuPosition(dropTarget, offsetTop = 0, offsetLeft = 0) {\n\n        const { component, pos } = dropTarget;\n        const box = dropTarget.clientRect;\n\n        const dropTargets = dropTarget.toArray()\n        const [x, y] = menuPosition(pos, box, dropTargets.length, offsetTop, offsetLeft);\n\n        this._group.position({ x, y });\n\n        const paths = dropTargets.map((dropTarget, i) => ({\n            path: new Konva.Path({\n                strokeWidth: 0,\n                fill: COLOURS[i],\n                data: pathPosition(pos, i)\n            }),\n            dropTarget\n        }));\n\n        // do we have to care about removing eventlisteners ? Probably not\n        this._group.removeChildren();\n\n        this.addPaths(paths);\n    }\n\n}\n\nfunction pathPosition(pos, idx) {\n\n    const unit = 30;\n    const depth = 32;\n\n    const lo = i => i === 0 ? -unit / 2\n        : i > 0 ? -1 * (unit / 2 + (idx * unit))\n            : unit / 2 + ((-idx - 1) * unit);\n\n    const [top, left, width, height] =\n        pos.position.West ? [lo(idx), 0, depth, unit] :\n            pos.position.East ? [lo(idx), -depth, depth, unit] :\n                pos.position.South ? [-depth, lo(idx), unit, depth] :\n    \t/* North | Header */[0, lo(idx), unit, depth];\n\n    // For pos 0 we draw just one item (the central item), for others we double up\t\n    return `M${left},${top}h${width}v${height}h-${width}v-${height}${idx > 0 ? pathPosition(pos, -idx) : ''}`;\n\n}\n\nfunction menuPosition(pos, box, count, offsetTop, offsetLeft) {\n\n    return pos.position.West ? [box.left - offsetLeft + 26, pos.y - offsetTop]\n        : pos.position.South ? [pos.x - offsetLeft, box.bottom - offsetTop - 26]\n            : pos.position.East ? [box.right - offsetLeft - 26, pos.y - offsetTop]\n        /* North | Header*/ : [pos.x - offsetLeft, box.top - offsetTop + 26];\n\n}\n\n\n\n\n","import React from 'react';\nimport { PopupService, PopupPosition } from '@heswell/ui-controls';\nimport DropMenu2, {computeMenuPosition} from './components/drop-menu/drop-menu.jsx'\nimport DropMenu from './drop-menu';\n\nimport Konva from 'konva';\nimport {select} from 'd3-selection';\nimport 'd3-transition';\n\nimport './drop-target-canvas.css';\n\nconst TheCanvas = 'thecanvas';\nconst SketchPad = 'sketchpad';\n\nlet _dropTarget = null;\nlet _multiDropOptions = false;\nlet _stage;\nlet _layer;\nlet _konvaDropMenu;\nlet _hoverDropTarget = null;\nlet _dropTargetIsTabstrip = false;\nlet _currentTabIndex = -1;\nlet _shiftedTab = null;\n\nfunction insertIntoRoot(id){\n    const root = document.getElementById('root');\n    const container = document.createElement('div');\n    container.id = id;\n    document.body.insertBefore(container, root);\n    return container;\n}\n\nfunction insertSVGRoot(){\n    const root = document.getElementById('root');\n    const container = document.createElement('div');\n    container.id = 'drag-canvas';\n    container.innerHTML = '<svg width=\"100%\" height=\"100%\"></svg>';\n    document.body.insertBefore(container, root);\n}\n\nconst drawTabPath = ([l,t,w,h,tl=0,tw=0,th=0]) =>\n    `M${l},${t+th}l${tl},0l0,-${th}l${tw},0l0,${th}l${w-(tl+tw)},0l0,${h-th}l-${w},0l0,-${h-th}`;\n\nexport default class DropTargetCanvas {\n\n    constructor() {\n        let container = document.getElementById(TheCanvas);\n\n        if (!container) {\n            this.sketchpad = insertIntoRoot(SketchPad);\n            insertSVGRoot();\n        }\n\n        this.t = 0;\n        this.l = 0;\n        this.w = document.body.clientWidth;\n        this.h = document.body.clientHeight;\n\n        window.addEventListener('resize', () => {\n            this.w = document.body.clientWidth;\n            this.h = document.body.clientHeight;\n        });\n\n        _stage = new Konva.Stage({\n            container: SketchPad,   // id of container <div>\n            width: this.w,\n            height: this.h\n        });\n        //then create layer\n        _layer = new Konva.Layer();\n\n        _konvaDropMenu = new DropMenu({\n            layer: _layer,\n            hover: dropTarget => _hoverDropTarget = dropTarget\n        });\n\n        _stage.add(_layer);\n\n    }\n\n    prepare(position) {\n        if (position) {\n            const { left: l, top: t, right: r, bottom: b } = position;\n            const w = r - l;\n            const h = b - t;\n            this.t = t;\n            this.l = l;\n            this.w = w;\n            this.h = h;\n            const cssText = `top:${t}px;left:${l}px;width:${w}px;height:${h}px;z-index:100`;\n            this.sketchpad.style.cssText = cssText;\n\n            _stage.setWidth(w);\n            _stage.setHeight(h);\n\n        }\n        // don't do this on body\n        document.body.classList.add(\"drawing\");\n\n    };\n\n\n    clear() {\n        // don't do this on body\n        document.body.classList.remove(\"drawing\");\n        //PopupService.hidePopup();\n    }\n\n    get hoverDropTarget() {\n        return _hoverDropTarget;\n    }\n\n    get dropTargetIsTabstrip() {\n        return _dropTargetIsTabstrip;\n    }\n\n    get currentTabIndex() {\n        return _currentTabIndex;\n    }\n\n    draw(dropTarget, x, y) {\n        const SameDropTarget = _dropTarget !== null &&\n            // !_dropTargetIsTabstrip &&\n            _dropTarget.component === dropTarget.component &&\n            _dropTarget.pos.position === dropTarget.pos.position &&\n            _dropTarget.pos.closeToTheEdge === dropTarget.pos.closeToTheEdge;\n\n        const wasMultiDrop = _multiDropOptions;\n\n        if (_hoverDropTarget !== null) {\n            this.drawTargetSVG(_hoverDropTarget);\n        }\n        else if (SameDropTarget === false) {\n            _dropTarget = dropTarget;\n            _multiDropOptions = dropTarget.nextDropTarget != null;\n            this.drawTargetSVG(dropTarget);\n        }\n\n        if (_hoverDropTarget !== null) {\n\n\n        }\n        else if (_multiDropOptions) {\n            // compute menu position\n            const [left,top] = computeMenuPosition(dropTarget);\n\n            if (!wasMultiDrop) {\n                // onsole.log('show the drop menu');\n                const component = <DropMenu2 />;\n                PopupService.showPopup({\n                    left, \n                    top, \n                    position: PopupPosition.CenteredOnPosition, \n                    component\n                });\n\n                _konvaDropMenu.visible(true);\n            } else {\n                PopupService.movePopupTo(left,top);\n\n            }\n        }\n        else if (_konvaDropMenu.visible()) {\n            // onsole.log('clear the drop menu');\n            _konvaDropMenu.visible(false);\n            _layer.draw();\n        }\n\n    }\n\n    drawTargetSVG(dropTarget, offsetTop = 0, offsetLeft = 0) {\n\n        const lineWidth = 6;\n\n        const targetRect =  dropTarget.pos.tab\n            ? dropTarget.targetTabRect(lineWidth, offsetTop, offsetLeft)\n            : dropTarget.targetRect(lineWidth, offsetTop, offsetLeft);\n        \n        console.log(`targetRect ${targetRect}`);\n\n        if (targetRect){\n            const [l,t,r,b, tl=0, tw=0, th=0] = targetRect\n            const w = r - l;\n            const h = b - t;\n            const tabLeftOffset = tl === 0\n                ? 0 \n                : tl - l;\n            const data = [l,t,w,h,tabLeftOffset,tw,th]  \n    \n            const svg = select('#drag-canvas > svg')\n            const path = svg.selectAll(\"path.drop-target\")\n                .data([data])\n    \n            const d = drawTabPath(data);\n    \n            path.transition().duration(200)\n                .attr('d', d)\n    \n            const p = path.enter().append(\"path\")\n                .attr(\"class\", \"drop-target\")\n                .style(\"stroke\", \"blue\")\n                .style(\"fill\", \"transparent\")\n                .style(\"stroke-width\", 4)\n                .attr('d', d)\n    \n        }\n    \n    }\n    \n}\n\n\nfunction drawTabbedOutline(ctx, dropTarget, offsetTop, offsetLeft) {\n\n    console.log(`drawTabbedOutline ${JSON.stringify(dropTarget.pos.tab)}`)\n\n    const rect = dropTarget.clientRect;\n    const { tabs } = rect;\n    const tabCount = tabs ? tabs.length : 0;\n    _currentTabIndex = dropTarget.pos.tab.index;\n\n    //======================================  START EXPERIMENT\n    if (_currentTabIndex > -1 && _currentTabIndex < tabCount) {\n        const $id = dropTarget.component.$path;\n        const selector = `:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab:nth-child(${_currentTabIndex + 1})`;\n        const tabEl = document.getElementById($id).querySelector(selector);\n        if (tabEl && tabEl !== _shiftedTab) {\n            if (_shiftedTab) {\n                _shiftedTab.style.cssText = '';\n            }\n            tabEl.style.cssText = 'transition:margin-left .4s ease-out;margin-left: 80px';\n            _shiftedTab = tabEl;\n        }\n    } else if (_shiftedTab) {\n        _shiftedTab.style.cssText = '';\n        _shiftedTab = null;\n    }\n    //====================================== END EXPERIMENT\n\n    // add a flag to dropTarget\n    _dropTargetIsTabstrip = rect.tabs && rect.tabs.length;\n\n    ctx.beginPath();\n    var lineWidth = 6;\n    setCanvasStyles(ctx, { lineWidth, strokeStyle: 'yellow' });\n    const targetTabRect = dropTarget.targetTabRect(lineWidth, offsetTop, offsetLeft);\n    drawTab(ctx, ...targetTabRect);\n    ctx.stroke();\n\n}\n","\n\nimport {BoxModel, positionValues, pointPositionWithinRect} from './model/boxModel';\nimport {containerOf} from './model/layoutModel';\nimport { Position } from './model/index';\n\nexport class DropTarget {\n\n\tconstructor({component, pos, clientRect/*, closeToTheEdge*/, nextDropTarget}){\n\t    this.component = component; \n        this.pos = pos;\n        this.clientRect = clientRect;\n\t    this.nextDropTarget = nextDropTarget;\n\t    this.active = false;       \n    }\n\n    targetTabRect(lineWidth, offsetTop = 0, offsetLeft = 0) {\n\n        const {clientRect: {top,left,right,bottom,header}, pos: {tab}} = this; \n        const inset = 0;\n        const gap = Math.round(lineWidth / 2) + inset;\n\n        const t = Math.round(top - offsetTop);\n        const l = Math.round(left - offsetLeft + gap);\n        const r = Math.round(right - offsetLeft - gap);\n        const b = Math.round(bottom - offsetTop - gap);\n        const tabLeft = Math.round(tab.left - offsetLeft + gap);\n        const tabWidth = 60;\n        const tabHeight = header.bottom - header.top;\n        return [l,t, r,b,tabLeft, tabWidth, tabHeight];\n    }\n    \n    targetRect(lineWidth, offsetTop = 0, offsetLeft = 0){\n\n        const {pos: {width, height, position}, clientRect: rect} = this;\n        let size = null;\n\n        if (width) {\n            size = { width }\n        }\n        else if (height) {\n            size = { height }\n        }\n \n        const t = Math.round(rect.top - offsetTop);\n        const l = Math.round(rect.left - offsetLeft);\n        const r = Math.round(rect.right - offsetLeft);\n        const b = Math.round(rect.bottom - offsetTop);\n\n        const inset = 0;\n        const gap = Math.round(lineWidth / 2) + inset;\n    \n        switch (position){\n            case Position.North:\n            case Position.Header: {\n                const halfHeight = Math.round((b - t) / 2);\n                const sizeHeight = (size && size.height) ? size.height : 0;\n                const height = sizeHeight ? Math.min(halfHeight, Math.round(sizeHeight)) : halfHeight;\n                return  [l+gap, t+gap, r-gap, t+gap+height];\n            }                                    \n            case Position.West: {\n                const halfWidth = Math.round((r - l) / 2);\n                const sizeWidth = (size && size.width) ? size.width : 0;\n                const width = sizeWidth ? Math.min(halfWidth, Math.round(sizeWidth)) : halfWidth;\n                return [l+gap, t+gap, l+gap+width, b-gap];\n            }\n            case Position.East: {\n                const halfWidth = Math.round((r - l) / 2);\n                const sizeWidth = (size && size.width) ? size.width : 0;\n                const width = sizeWidth ? Math.min(halfWidth, Math.round(sizeWidth)) : halfWidth;\n                return [(r-gap)-width, t+gap, r-gap, b-gap];\n            }\n            case Position.South: {\n                const halfHeight = Math.round((b - t) / 2);\n                const sizeHeight = (size && size.height) ? size.height : 0;\n                const height = sizeHeight ? Math.min(halfHeight, Math.round(sizeHeight)) : halfHeight;\n                return [l+gap, (b-gap)-height, r-gap, b-gap];\n                    \n            }\n            default:\n                console.warn(`DropTarget does not recognize position ${position}`);\n                return null;\n        }\n    }\n\n\tactivate(){\n\t    this.active=true;\n\t    return this;\n    }\n    \n    toArray(){\n        let dropTarget = this;\n        const dropTargets = [dropTarget];\n        while (dropTarget = dropTarget.nextDropTarget) {\n            dropTargets.push(dropTarget);\n        }\n        return dropTargets;\n    }\n\n\tstatic getActiveDropTarget(dropTarget){\n\t    return dropTarget.active ? dropTarget : DropTarget.getActiveDropTarget(dropTarget.nextDropTarget);\n\t}\n\n}\n\n\t    // Initial entry to this method is always via the app (may be it should be *on* the app)\nexport function identifyDropTarget(x, y, model, measurements){\n\n    let dropTarget = null;\n    \n    //onsole.log('Draggable.identifyDropTarget for component  ' + box.name + ' (' + box.nestedBoxes.length + ' children)') ;\n    // this could return all boxes containing point, which would make getNextDropTarget almost free\n    // Also, if we are over  atabstrip, it could include the actual tab\n    var component = BoxModel.smallestBoxContainingPoint(model, measurements, x, y);\n    \n    if (component){\n        // onsole.log(`%cidentifyDropTarget target path ${component.$path}\n        //     position: ${JSON.stringify(component.$position)}\n        //     measurements : ${JSON.stringify(_measurements[component.$path])}\n        //     `,'color:cornflowerblue;font-weight:bold;');\n        const clientRect = measurements[component.$path];\n        const pos = pointPositionWithinRect(x,y,clientRect);\n        const nextDropTarget = getNextDropTarget(model, component, pos, measurements, x, y);\n        dropTarget = new DropTarget({component, pos, clientRect, nextDropTarget}).activate()\n    \n        // onsole.log('%c'+printDropTarget(dropTarget),'color:green');\n\n    }\n\n    //onsole.log(`\\n${printDropTarget(dropTarget)}`);\n\n    return dropTarget;\n}\n   \n// must be cleared when we end the drag\n// layout never changes\n// component never changes\n// pos neve changes\n// zone never changes\n// measurements never change\nexport function getNextDropTarget(layout, component, pos, measurements, x, y){\n\n\tconst {north, south, east, west} = positionValues;\n\tconst eastwest = east+west;\n\tconst northsouth = north+south;\n\n    return next();\n\n    function next(container=containerOf(layout, component)){\n\n        if (pos.position.Header || pos.closeToTheEdge){\n\n            let nextDropTarget = false;\n\n            // experiment...\n            const clientRect = measurements[container.$path];\n            let containerPos = pointPositionWithinRect(x,y,clientRect);\n\n            while (container && positionedAtOuterContainerEdge(container, pos, component, measurements)){               \n                //onsole.log(`${component.type} positioned at outer edge of container ${container.type}`);\n                // if its a VBox and we're close to left or right ...\n                if ((isVBox(container) || isTabbedContainer(container)) && (pos.closeToTheEdge & eastwest)){\n                    nextDropTarget = true;\n                    containerPos.width = 120;\n                }\n                // if it's a HBox and we're close to top or bottom ...\n                else if ((isHBox(container) || isTabbedContainer(container)) && (pos.position.Header || (pos.closeToTheEdge & northsouth))){\n                    nextDropTarget = true;\n                    containerPos.height = 120;\n                }\n                if (nextDropTarget){\n                    if (containerPos.position.Header){\n                        containerPos = {...containerPos, position:north};    \n                    }\n                    // For each DropTarget, specify which drop operations are appropriate\n                    return new DropTarget({\n                        component:container,\n                        pos: containerPos, // <<<<  a local pos for each container\n                        clientRect,\n                        nextDropTarget: next(containerOf(layout, container))\n                    });\n                }\n\n                container = containerOf(layout, container);\n            }\n        } \n    }\n}\n\nfunction positionedAtOuterContainerEdge(containingComponent, {closeToTheEdge,position}, component, measurements){\n    \n    const containingBox = measurements[containingComponent.$path]; \n    const box = measurements[component.$path];\n\n    const closeToTop = closeToTheEdge & positionValues.north;\n    const closeToRight = closeToTheEdge & positionValues.east;\n    const closeToBottom = closeToTheEdge & positionValues.south;\n    const closeToLeft = closeToTheEdge & positionValues.west;\n\n    if ((closeToTop || position.Header) && box.top === containingBox.top) return true;\n    if (closeToRight && box.right === containingBox.right) return true;\n    if (closeToBottom && box.bottom === containingBox.bottom) return true;\n    if (closeToLeft && box.left === containingBox.left) return true;\n\n    return false\n}\n\nfunction isTabbedContainer({type}){\n    return type === 'TabbedContainer';\n}\n\nfunction isVBox({type,style:{flexDirection}}){\n    return type === 'FlexBox' &&  flexDirection === \"column\";\n}\n\nfunction isHBox({type, style:{flexDirection}}){\n    return type === 'FlexBox' &&  flexDirection === \"row\";\n}\n\n\n// const w = '  ';\n\n// function printDropTarget(dropTarget, s=w){\n\n// \tconst {pos} = dropTarget;\n// \tconst ctte = pos.closeToTheEdge ? `=>${printClose(pos.closeToTheEdge)}<=` : '';\n//     const size = pos.width ? ` width:${pos.width} ` : pos.height ? ` height:${pos.height} ` : '';\n\n//     var str = `<${dropTarget.component.type}> ${ctte} ${size} $${dropTarget.component.$path}`;\n//     if (dropTarget.nextDropTarget != null){\n//         str += `\\n${s} ${printDropTarget(dropTarget.nextDropTarget,s+w)}` \n//     }\n//     return str;\n// }\n\n// function printClose(val){\n// \tvar s = '';\n// \tif (val & 1) s+= 'N';\n// \tif (val & 4) s+= 'S';\n// \tif (val & 2) s+= 'E';\n// \tif (val & 8) s += 'W';\n// \treturn s;\n// }\n\n","\nimport {pointPositionWithinRect} from './model/index';\n\nvar SCALE_FACTOR = 0.4;\n\nexport default class DragState {\n\n    constructor(zone, mouseX, mouseY, measurements){\n        this.init(zone, mouseX, mouseY, measurements);\n    }\n\n    init(zone, mouseX, mouseY, rect){\n        \n        var {left: x, top: y} = rect;\n\n        var mousePosition = pointPositionWithinRect(mouseX,mouseY,rect);\n\n        // We are applying a scale factor of 0.4 to the draggee. This is purely a visual\n        // effect - the actual box size remains the original size. The 'leading' values \n        // represent the difference between the visual scaled down box and the actual box.\n\n        var scaleFactor = SCALE_FACTOR;\n\n        var leadX = mousePosition.pctX * rect.width;\n        var trailX = rect.width - leadX;\n        var leadY = mousePosition.pctY * rect.height;\n        var trailY = rect.height - leadY;\n\n        // When we assign position to rect using css. positioning units are applied to the \n        // unscaled shape, so we have to adjust values to take scaling into account.\n        var scaledWidth = rect.width * scaleFactor,\n            scaledHeight = rect.height * scaleFactor;\n\n        var scaleDiff = 1 - scaleFactor;\n        var leadXScaleDiff = leadX * scaleDiff; \n        var leadYScaleDiff = leadY * scaleDiff; \n        var trailXScaleDiff = trailX * scaleDiff; \n        var trailYScaleDiff = trailY * scaleDiff; \n\n        this.constraint = {\n            zone : {\n                x : {\n                    lo: zone.left,\n                    hi: zone.right\n                },\n                y : {\n                    lo: zone.top,\n                    hi: zone.bottom\n                }\n            },\n\n            pos : {\n                x : {\n                    lo: /* left */ zone.left - leadXScaleDiff,\n                    hi: /* right */ zone.right - rect.width + trailXScaleDiff\n                },\n                y : {\n                    lo: /* top */ zone.top - leadYScaleDiff,\n                    hi: /* bottom */ zone.bottom - rect.height + trailYScaleDiff\n                }\n            },\n            mouse :{\n                x : {\n                    lo: /* left */ zone.left + scaledWidth * mousePosition.pctX,\n                    hi: /* right */ zone.right - scaledWidth * (1-mousePosition.pctX)\n                },\n                y: {\n                    lo: /* top */ zone.top + scaledHeight * mousePosition.pctY,\n                    hi: /* bottom */ zone.bottom - scaledHeight * (1-mousePosition.pctY)\n                }\n            }\n        };\n\n        //onsole.log(JSON.stringify(this.constraint,null,2));\n\n        this.x = {pos:x, lo: false, hi: false, mousePos: mouseX, mousePct: mousePosition.pctX};\n        this.y = {pos:y, lo: false, hi: false, mousePos: mouseY, mousePct: mousePosition.pctY};\n\n    }\n\n    outOfBounds(){\n        return this.x.lo || this.x.hi || this.y.lo || this.y.hi;\n    }\n\n    inBounds(){\n        return !this.outOfBounds();\n    }\n\n    dropX(){\n        return dropXY.call(this,'x');\n    }\n\n    dropY(){\n        return dropXY.call(this,'y');\n    }\n\n\n    /*\n     *  diff = mouse movement, signed int\n     *  xy = 'x' or 'y'\n     */\n     //todo, diff can be calculated in here\n    update(xy, mousePos){\n\n        var state = this[xy],\n            mouseConstraint = this.constraint.mouse[xy],\n            posConstraint = this.constraint.pos[xy],\n            previousPos = state.pos;\n\n       var diff = mousePos - state.mousePos;\n\n       //xy==='x' && console.log(`update: state.lo=${state.lo}, mPos=${mousePos}, mC.lo=${mouseConstraint.lo}, prevPos=${previousPos}, diff=${diff} `  );\n\n        if (diff < 0){\n            if (state.lo) {/* do nothing */}\n\n            else if (mousePos < mouseConstraint.lo){\n                state.lo = true;\n                state.pos =  posConstraint.lo;\n            }\n            else if (state.hi){\n                if (mousePos < mouseConstraint.hi){\n                    state.hi = false;\n                    state.pos += diff;\n                }\n            }\n            else {\n                state.pos += diff;\n            }\n        }\n        else if (diff > 0){\n            if (state.hi){/* do nothing */}\n\n            else if (mousePos > mouseConstraint.hi){\n                state.hi = true;\n                state.pos =  posConstraint.hi;\n            }\n            else if (state.lo){\n                if (mousePos > mouseConstraint.lo){\n                    state.lo = false;\n                    state.pos += diff;\n                }\n            }\n            else {\n                state.pos += diff;\n            }\n        }\n\n        state.mousePos = mousePos;\n\n        return previousPos !== state.pos;\n\n    }\n\n}\n\nfunction dropXY(dir){\n\n    var pos = this[dir],\n        rect = this.constraint.zone[dir];\n        // why not do the rounding +/- 1 on the rect initially - this is all it is usef for\n    return pos.lo ? Math.max(rect.lo,pos.mousePos) : pos.hi ? Math.min(pos.mousePos, Math.round(rect.hi) -1) : pos.mousePos;\n\n}\n\n","\nimport ReactDOM from 'react-dom';\nimport DropTargetCanvas from './drop-target-canvas';\nimport {DropTarget, identifyDropTarget} from './drop-target';\nimport DragState from './drag-state';\nimport { followPath, BoxModel, Position } from './model/index';\n\nvar _dragCallback;\nvar _dragStartX;\nvar _dragStartY;\nvar _dragContainer;\nvar _dragState;\nvar _dragThreshold = 5;\nvar _dropTarget = null;\nvar _measurements;\nvar _simpleDrag;\nvar _dropTargetCanvas = new DropTargetCanvas();\nvar _dragContainers = [];\nvar SCALE_FACTOR = 0.4;\n\nexport class DragContainer {\n\n    static register(path) {\n        // need to decide how to store these\n        _dragContainers.push(path);\n    }\n\n    static unregister(/*path*/) {\n\n    }\n}\n\nfunction getDraggable(component) {\n    var target;\n\n    var header = component.refs.header || component.tabstrip;\n    if (header && header.props.draggable) {\n        target = header;\n    } else if (component.props.draggable) {\n        target = component;\n    }\n    return target;\n}\n\nexport var Draggable = {\n\n    // bound to target components when called\n    componentDidMount() {\n\n        // // can we always rely on dragContainer being available at this point ?\n        // // Might we have to wait for layout ?\n        // if (this.props.dragContainer === true){\n        //     DragContainer.register(this);\n        // }\n\n        var draggable = getDraggable(this);\n        if (draggable) {\n            this.mouseDownHandler = Draggable.handleMousedown.bind(this);\n            ReactDOM.findDOMNode(draggable).addEventListener('mousedown', this.mouseDownHandler, false);\n        }\n    },\n\n    componentWillUnmount() {\n\n        var draggable = getDraggable(this);\n        if (draggable) {\n            ReactDOM.findDOMNode(draggable).removeEventListener('mousedown', this.mouseDownHandler, false);\n            this.mouseDownHandler = null;\n        }\n    },\n\n    // bound to Draggable Component\n    handleMousedown(e, dragStartCallback) {\n\n        _dragCallback = dragStartCallback;\n\n        _dragStartX = e.clientX;\n        _dragStartY = e.clientY;\n\n        window.addEventListener('mousemove', preDragMousemoveHandler, false);\n        window.addEventListener('mouseup', preDragMouseupHandler, false);\n\n        e.preventDefault();\n    },\n\n    initDrag(e, layoutModel, path, { top, left, right, bottom }, dragHandler) {\n\n        _dragCallback = dragHandler;\n\n        return initDrag(e, layoutModel, path, { top, left, right, bottom });\n\n    }\n};\n\nfunction preDragMousemoveHandler(e) {\n\n    var x = true;\n    var y = true;\n\n    let x_diff = x ? e.clientX - _dragStartX : 0;\n    let y_diff = y ? e.clientY - _dragStartY : 0;\n    let mouseMoveDistance = Math.max(Math.abs(x_diff), Math.abs(y_diff));\n\n    // when we do finally move the draggee, we are going to 'jump' by the amount of the drag threshold, should we\n    // attempt to animate this ?    \n    if (mouseMoveDistance > _dragThreshold) {\n\n        window.removeEventListener('mousemove', preDragMousemoveHandler, false);\n        window.removeEventListener('mouseup', preDragMouseupHandler, false);\n\n        if (_dragCallback(e, x_diff, y_diff) !== false) {\n            window.addEventListener('mousemove', dragMousemoveHandler, false);\n            window.addEventListener('mouseup', dragMouseupHandler, false);\n        }\n    }\n}\n\nfunction preDragMouseupHandler() {\n\n    window.removeEventListener('mousemove', preDragMousemoveHandler, false);\n    window.removeEventListener('mouseup', preDragMouseupHandler, false);\n\n}\n\nfunction getDragContainer(layoutModel, path) {\n\n    var pathToContainer = '';\n    var maxSteps = 0;\n\n    // If the model has no path (i.e. it hasn't been dragged out of the existing layout)\n    // hiow do we decide the dragContainer to use (assuming there may be more than 1)\n    if (path === undefined) {\n        pathToContainer = _dragContainers[0];\n    }\n    else {\n        // find the longest container path that matches path (ie the smallest enclosing container); \n        for (var i = 0; i < _dragContainers.length; i++) {\n            if (path.indexOf(_dragContainers[i]) === 0) {\n                var steps = _dragContainers[i].split('.').length;\n                if (steps > maxSteps) {\n                    maxSteps = steps;\n                    pathToContainer = _dragContainers[i];\n                }\n            }\n        }\n    }\n\n    return followPath(layoutModel, pathToContainer);\n\n}\n\nfunction initDrag(evt, layoutModel, path, dragRect) {\n\n    _dragContainer = getDragContainer(layoutModel, path);\n\n    var start = window.performance.now();\n\n    // translate the layout $position to drag-oriented co-ordinates, ignoring splitters\n    _measurements = BoxModel.measure(layoutModel);\n    var end = window.performance.now();\n\n    console.log(`initDrag taking measurements took ${end - start} ms dragContainer version ${_dragContainer.$version}`);\n\n    var { type, $path } = _dragContainer;\n\n    var dragZone = _measurements[$path];\n\n    _dragState = new DragState(dragZone, evt.clientX, evt.clientY, dragRect);\n\n    var pctX = Math.round(_dragState.x.mousePct * 100);\n    var pctY = Math.round(_dragState.y.mousePct * 100);\n\n    if (type === 'Surface') {\n\n        _simpleDrag = true;\n\n        return {};\n\n    } else {\n\n        _simpleDrag = false;\n\n        _dropTargetCanvas.prepare(dragZone);\n\n        return {\n            draggableWidth: dragRect.right - dragRect.left,\n            draggableHeight: dragRect.bottom - dragRect.top,\n            transform: `scale(${SCALE_FACTOR},${SCALE_FACTOR})`,\n            transformOrigin: pctX + \"% \" + pctY + \"%\"\n        };\n    }\n}\n\nfunction dragMousemoveHandler(evt) {\n\n    const x = evt.clientX;\n    const y = evt.clientY;\n    const dragState = _dragState;\n    var currentDropTarget = _dropTarget;\n    var dropTarget;\n\n    var newX, newY;\n\n    if (dragState.update('x', x)) {\n        newX = dragState.x.pos;\n    }\n\n    if (dragState.update('y', y)) {\n        newY = dragState.y.pos;\n    }\n\n    if ((newX === undefined) && (newY === undefined)) {\n        //onsole.log('both x and y are unchanged');\n    } else {\n        _dragCallback.drag(newX, newY);\n    }\n\n    if (_simpleDrag) {\n        return;\n    }\n\n    if (dragState.inBounds()) {\n        dropTarget = identifyDropTarget(x, y, _dragContainer, _measurements);\n    } else {\n        dropTarget = identifyDropTarget(dragState.dropX(), dragState.dropY(), _dragContainer, _measurements);\n    }\n\n    // did we have an existing droptarget which is no longer such ...\n    if (currentDropTarget) {\n        if (dropTarget == null || dropTarget.box !== currentDropTarget.box) {\n            _dropTarget = null;\n        }\n    }\n\n    if (dropTarget) {\n\n        const sameDropTarget = currentDropTarget && \n            currentDropTarget.component === dropTarget.component &&\n            currentDropTarget.pos.position === dropTarget.pos.position &&\n            currentDropTarget.pos.closeToTheEdge === dropTarget.pos.closeToTheEdge;\n\n        _dropTargetCanvas.draw(dropTarget, x, y);\n\n        _dropTarget = dropTarget;\n    \n\n        // if (currentDropTarget && \n        //     currentDropTarget.component === dropTarget.component &&\n        //     currentDropTarget.pos.position === dropTarget.pos.position &&\n        //     // experiment...\n        //     currentDropTarget.pos.closeToTheEdge === dropTarget.pos.closeToTheEdge){\n        //     // no change from last turn, don't assign to _dropTarget, we might lose settings\n\n        //     //onsole.log('%cSame Drop Target/Position','color:green');\n\n        //     // BUT, we are going to want to reposition the dropmenu ... \n\n        // }\n        // else {\n\n        //     // redraw position marker\n        //     //onsole.log('%cNew Drop Target/Position','color:red;font-weight:bold;');\n        //     _dropTargetCanvas.draw(dropTarget, _measurements);\n\n        //     _dropTarget = dropTarget;\n\n        // }\n\n    }\n}\n\nfunction dragMouseupHandler(evt) {\n    onDragEnd(evt);\n}\n\nfunction onDragEnd() {\n\n    if (_dropTarget) {\n        // why wouldn't the active dropTarget be the hover target\n        const dropTarget = _dropTargetCanvas.hoverDropTarget || DropTarget.getActiveDropTarget(_dropTarget);\n        if (_dropTargetCanvas.dropTargetIsTabstrip) {\n            dropTarget.tabIndex = _dropTargetCanvas.currentTabIndex;\n\n            // EXPERIMENT ----------- What is this trying to do ? (cos it's not working)\n            const selector = `:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab:nth-child(${dropTarget.tabIndex + 1})`;\n            const tabstrip = document.getElementById(dropTarget.component.$path);\n            if (tabstrip){\n                const tab = tabstrip.querySelector(selector);\n                if (tab){\n                    tab.style.cssText = '';\n                }\n            } else {\n                console.log(`dropTarget indicated to be Tabstrip, but is not`);\n            }\n            //----------------------\n\n        }\n\n        // looking into eliminating this call altogether. We don't need it if we set the dragging index via\n        // top-level layout state\n\n        _dragCallback.drop(dropTarget, _measurements);\n\n        _dropTarget = null;\n    }\n    else {\n        _dragCallback.drop({ component: _dragContainer, pos: { position: Position.Absolute } });\n    }\n\n    _dragCallback = null;\n    _dragContainer = null;\n    _dropTargetCanvas.clear();\n\n    window.removeEventListener('mousemove', dragMousemoveHandler, false);\n    window.removeEventListener('mouseup', dragMouseupHandler, false);\n\n}","import React from 'react';\nimport {registerClass} from '../componentRegistry';\nimport {getLayoutModel} from '../util/component-utils';\nimport LayoutItem from './layout-item';\nimport {Draggable} from '../draggable';\nimport {layout as applyLayout, handleLayout,followPath} from '../model/index';\n\nexport default class Container extends React.Component {\n\n   constructor(props){\n        super(props);\n        const layoutModel = this.getLayoutModel();\n        this.state = {\n            layoutModel,\n            ...this.getState()\n        }\n\n        this.handleLayout = this.handleLayout.bind(this);\n    }\n\n    getState(){\n        return {};\n    }\n\n    isLayoutRoot(){\n        return this.props.layoutModel === undefined;\n    }\n\n    render(){\n        var {style} = this.props;\n        var layoutModel = this.getLayoutModel();\n        var {layout, $position=layout} = layoutModel;\n\n        return (\n            <div className={layoutModel.type} style={{...style, position: 'absolute', ...$position}}>\n                {layoutModel.children.map((child,idx) => this.renderChild(child,idx))}\n            </div>\n        );\n    }\n\n    renderChild(layoutModel){\n\n        const {children: child , onLayout} = this.props;\n        const {style} = child.props;\n\n        let props = {\n            layoutModel,\n            onLayout\n        };\n\n        const id = props.layoutModel.$id;\n\n        props.id = id;\n        props.key = id;\n        props.style = {...style, ...props.style};\n\n        if (isLayout(layoutModel.type)){\n            return React.cloneElement(child, props);\n        } else {\n            return <LayoutItem {...child.props} {...props}>{child}</LayoutItem>;\n        }\n\n    }\n\n    componentDidMount(){\n        const {layoutModel=null, onLayoutModel} = this.props;\n        if (layoutModel === null && onLayoutModel){\n            onLayoutModel(this.state.layoutModel);\n        }\n    }\n\n    shouldComponentUpdate(nextProps){\n        // if the Application passes down the dragging flag, do not render, the only rendering\n        // to take place happens on the DragSurface.\n        // if (nextProps.dragging){\n        // onsole.log(`Container ${this.props.layoutModel.type} dragging  so don't update`);\n        // }\n        return nextProps.dragging !== true;\n    }\n\n    getLayoutModel(){\n\n        if (this.isLayoutRoot()){\n            return applyLayout(getLayoutModel(this));\n        } else {\n            return this.props.layoutModel;\n        }\n        \n        // let {layoutModel/*,style*/} = this.props;\n\n        // if (layoutModel === undefined){\n        //     // console.log(`getRootLayoutModel for ${typeOf(this)}`);\n        //     return applyLayout(getLayoutModel(this));\n        // } /*else if (layoutModel.children && layoutModel.children.length === 0){\n        //     alert('it happens')\n        //     console.log(`mutating (appending) layoutModel children. Can this be avoided ?`)\n        //     var children = getLayoutModelChildren(this);\n\n        //     [].push.apply(layoutModel.children, children);\n\n        //     var VISIBLE = style.visibility || 'visible';\n        //     var FORCE_LAYOUT = true;\n\n        //     var width;\n        //     var height;\n        //     var $position = layoutModel.$position;\n\n        //     if (typeof style.width === 'number' && typeof style.height === 'number'){\n        //         width = style.width;\n        //         height = style.height;\n        //     } else if ($position && $position.width !== undefined && $position.height !== undefined){\n        //         width = $position.width;\n        //         height = $position.height;\n        //     } else {\n        //         console.error(`Container.getLayoutModel attempting to initialize a ${layoutModel.type} layoutModel with no sizing attributes`)\n        //     }\n        //     console.log(`apply layout, WITH CHILDREN`)\n        //     var layoutModel2 = applyLayout(layoutModel, {width,height}, layoutModel.$path, VISIBLE, FORCE_LAYOUT);\n\n        //     layoutModel.children = layoutModel2.children;\n\n        // } */\n\n        // return layoutModel;\n\n    }\n\n    getManagedDimension(){\n        return null;\n    }\n\n    handleLayout(command, options){\n\n        // is there some other way we can nominate the layout as a root, other than $path === '0'\n        if (this.state.layoutModel && this.state.layoutModel.$path === '0' /*&& !this.props.layoutModel*/){\n            // This is a top=level layout and the owner has not taken responsibility for layout, so we need to\n            // Note: this will currently work only when the top-level container maintains its layoutModel in \n            // state (FlexBox and TabbedContainer)- other containers CAN be nested. \n            if (command === 'drag-start'){\n                if (this.handleDragStart){\n                    Draggable.handleMousedown(options.evt, this.handleDragStart.bind(this, options));\n                }\n            } else {\n                let layoutModel;\n\n                if (command === 'replace'){\n                    const {model: replacementNode} = options;\n                    const targetNode = followPath(this.state.layoutModel, replacementNode.$path);\n                    layoutModel = handleLayout(this.state.layoutModel, command, {targetNode, replacementNode});\n                } else if (command === 'switch-tab'){\n                    layoutModel = handleLayout(this.state.layoutModel, 'switch-tab', options);\n                } else if (command === 'drop'){\n                    layoutModel = handleLayout(this.state.layoutModel, 'drop', options);\n                } else {\n                    throw Error(`Container: don't know how to handle command ${command}`);\n                }\n                if (layoutModel !== this.state.layoutModel){\n                    this.setState({layoutModel});\n                    if (this.props.onLayoutModel){\n                        this.props.onLayoutModel(layoutModel);\n                    }\n                }\n            }\n        } else if (this.props.onLayout){\n            this.props.onLayout(command, options);\n        }\n    }\n\n}\n\nContainer.defaultProps = {\n    style: {flex: 1}\n}\n\nregisterClass('Container', Container, true);\n","\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\n\nvar _splitter,\n    _mousedown = false,\n    _direction,\n    _diff = 0;\n\n\nexport default class Splitter extends React.Component {\n\n    render() {\n\n        const { layout } = this.props.layoutModel\n        var { top, left, width, height } = layout;\n\n        // onsole.log(`%c     Splitter ${top},${left},${width},${height}`,`background-color:brown;color:lime;`);\n\n        var className = cx(\n            'Splitter',\n            this.props.className\n        );\n\n        var style = { position: 'absolute', top, left, width, height, cursor: this.props.cursor };\n\n        return <div className={className} style={style} />\n    }\n\n    componentDidMount() {\n        this._mouseDownHandler = this.handleMousedown.bind(this);\n        ReactDOM.findDOMNode(this).addEventListener('mousedown', this._mouseDownHandler, false);\n    }\n\n    componentWillUnmount() {\n        ReactDOM.findDOMNode(this).removeEventListener('mousedown', this._mouseDownHandler, false);\n        this._mouseDownHandler = null;\n    }\n\n    handleMousedown(e) {\n\n        _splitter = this;\n        _mousedown = true;\n        _diff = 0;\n\n        initDrag.call(this, e);\n\n        window.addEventListener(\"mousemove\", mouseMoved, false);\n        window.addEventListener(\"mouseup\", mouseUp, false);\n\n        e.preventDefault();\n    }\n\n}\n\nSplitter.defaultProps = {\n    style: {}\n};\n\nfunction mouseMoved(evt) {\n    return onDrag.call(_splitter, evt)\n}\n\nfunction mouseUp(evt) {\n    return onDragEnd.call(_splitter, evt)\n}\n\nfunction initDrag(e) {\n\n    _direction = this.props.direction;\n\n    var vertical = _direction === \"vertical\";\n    // var dim = vertical ? \"height\" : \"width\";\n\n    this.lastPos = (vertical ? e.clientY : e.clientX);\n\n    this.props.onDragStart(this.props.absIdx);\n\n}\n\nfunction onDrag(evt) {\n\n    var clientPos/*,\n        dimension*/;\n\n    if (_direction === 'vertical') {\n        clientPos = \"clientY\";\n        // dimension = \"height\";\n    }\n    else {\n        clientPos = \"clientX\";\n        // dimension = \"width\";\n    }\n\n    var pos = evt[clientPos],\n        diff = pos - this.lastPos;\n\n\n    // we seem to get a final value of zero\n    if (pos && (pos !== this.lastPos)) {\n        this.props.onDrag(diff);\n    }\n\n    this.lastPos = pos;\n\n}\n\nfunction onDragEnd() {\n\n    _mousedown = false;\n    _splitter = null;\n\n    window.removeEventListener(\"mousemove\", mouseMoved, false);\n    window.removeEventListener(\"mouseup\", mouseUp, false);\n\n    this.props.onDragEnd();\n\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport Splitter from '../splitter';\nimport LayoutItem from './layout-item';\nimport ComponentHeader from '../component/component-header';\nimport Container from './container';\nimport {isLayout} from '../util/component-utils'\nimport { registerClass } from '../componentRegistry';\nimport {\n    handleLayout as handleModelLayout,\n    layout as applyLayout,\n    layoutStyleDiff\n} from '../model/index';\n\nconst NO_STYLE = {}\n\nexport default class FlexBox extends Container {\n\n    render() {\n\n        var { style=NO_STYLE, isSelected, title } = this.props;\n        var { layout, header, style: {boxShadow} } = this.state.layoutModel;\n        if (this.state.layoutModel.$id === 'col-picker'){\n            console.log(`FlexBox.render layout ${JSON.stringify(this.state.layoutModel,null,2)}`);\n        }\n        const {backgroundColor, visibility} = style\n        var className = cx(\n            style.flexDirection === 'row' ? 'Terrace' : 'Tower',\n            this.props.className,\n            isSelected ? 'active' : null\n        );\n\n        if (visibility === 'hidden') {\n            return null;\n        }\n        const position = this.isLayoutRoot()\n            ? 'relative'\n            : 'absolute'; \n\n        return (\n            <div className={className} style={{ position, ...layout, backgroundColor, boxShadow }}>\n                {header &&\n                     <ComponentHeader\n                         title={`${title}`}\n                         onMouseDown={e => this.handleMouseDown(e)}\n                         style={{height: header.height}}\n                         menu={header.menu} />\n                }\n            \n                {this.renderFlexibleChildren()}\n            </div>\n        );\n    }\n\n    renderFlexibleChildren() {\n\n        var { style: { flexDirection }, visibility } = this.props;\n        var cursor = flexDirection === 'column' ? 'ns-resize' : 'ew-resize';\n        var splitterIdx = 0;\n        var {children: layoutChildren} = this.state.layoutModel;\n        const propChildren = Array.isArray(this.props.children)\n            ? this.props.children.filter(child => child)\n            : [this.props.children];\n\n        var results = [];\n\n        for (var idx = 0, childIdx = 0; idx < layoutChildren.length; idx++) {\n\n            var childLayoutModel = layoutChildren[idx];\n\n            if (childLayoutModel.type === 'Splitter') {\n\n                //TODO do we still need the refs ?\n                results.push(\n                    <Splitter ref={'splitter-' + splitterIdx}\n                        key={'splitter-' + childIdx}\n                        idx={childIdx}\n                        absIdx={idx}\n                        direction={flexDirection === 'column' ? 'vertical' : 'horizontal'}\n                        cursor={cursor}\n                        onDragStart={this.splitterDragStart.bind(this)}\n                        onDrag={this.splitterMoved.bind(this)}\n                        onDragEnd={() => this.handleSplitterDragEnd()}\n                        onLayout={this.handleLayout}\n                        layoutModel={childLayoutModel} />\n                );\n\n                splitterIdx += 1;\n\n            } else {\n\n                var child = propChildren[childIdx];\n                var { style = {}, ...childProps } = child.props;\n                var id = childLayoutModel.$id;\n\n                var props = {\n                    id,\n                    key: id,\n                    idx: childIdx,\n                    absIdx: idx,\n                    onLayout: this.handleLayout,\n                    onConfigChange: this.handleConfigChange.bind(this),\n                    layoutModel: childLayoutModel\n                };\n\n                style = { ...style, visibility };\n\n                if (props.dragContainer === true && child.type.displayName !== 'Container') {\n                    //onsole.log(`FlexBox wrapping ${child.type.displayName} with Container `);\n                    const { width, height } = props.layoutModel.$position; // IS HTIS RIGHT ?\n                    results.push(<Container {...childProps} {...props} style={{ flex: style.flex, width, height, visibility }} >{child}</Container>);\n                } else if (isLayout(child)) {\n                    results.push(React.cloneElement(child, { ...props, style }));\n                } else {\n                    results.push(<LayoutItem {...childProps} {...props} style={style}>{child}</LayoutItem>);\n                }\n\n                childIdx += 1;\n\n            }\n        }\n\n        return results;\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n        var { layoutModel } = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (this.state.layoutModel.$path === '0') {\n            // detact changes to style that will affect layout\n            if (layoutStyleDiff(this.props.style, nextProps.style)) {\n                const {width, height} = nextProps.style\n                const VISIBLE = nextProps.style.visibility || 'visible';\n                const FORCE_LAYOUT = true;\n                this.setState({\n                    layoutModel: applyLayout(\n                        {\n                            ...this.state.layoutModel,\n                            style: nextProps.style\n                        },\n                        { width, height },\n                        this.state.layoutModel.$path,\n                        VISIBLE,\n                        FORCE_LAYOUT)\n                });\n            }\n\n        }\n    }\n\n    getManagedDimension() {\n        var { style: { flexDirection } } = this.state.layoutModel;\n        return flexDirection === 'row' ? 'width' : 'height';\n    }\n\n    getDragPermission(component) {\n        if (component.constructor.displayName === 'Splitter') {\n            return this.props.style.flexDirection === 'row' ? { y: false, x: true } : { x: false, y: true };\n        } else {\n            return { x: true, y: true };\n        }\n    }\n\n    // copied from layoutItem\n    handleMouseDown(e){\n        if (this.props.onMouseDown) {\n            this.props.onMouseDown({\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        } else {\n            this.props.onLayout('drag-start', {\n                model: this.state.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n    }\n\n    splitterDragStart(idx) {\n        this.splitChildren = this.identifySplitChildren(idx);\n    }\n\n    splitterMoved(distance) {\n        const [idx1, , idx2] = this.splitChildren;\n        const dim = this.getManagedDimension();\n        let layoutModel = this.state.layoutModel;\n        const measurements = layoutModel.children.map(child => child.layout[dim]);\n        measurements[idx1] += distance;\n        measurements[idx2] -= distance;\n        const RESIZE = 'resize';\n        var options = {\n            path: layoutModel.$path,\n            measurements,\n            dimension: dim\n        };\n        layoutModel = handleModelLayout(layoutModel, RESIZE, options);\n        this.setState({ layoutModel });\n    }\n\n    identifySplitChildren(splitterIdx){\n        const children = this.state.layoutModel.children;\n        let idx1 = splitterIdx - 1;\n        let idx2 = splitterIdx + 1;\n        let child;\n        while ((child = children[idx1]) && !child.resizeable) idx1--;\n        while ((child = children[idx2]) && !child.resizeable) idx2++;\n        return [idx1, splitterIdx, idx2];\n    }\n\n    handleSplitterDragEnd(){\n        this.handleLayout('replace', { model: this.state.layoutModel });\n        this.splitChildren = null;\n    }\n\n    handleConfigChange(component, { fixed }) {\n        if (fixed !== 'undefined') {\n            //TODO we don't need to do this if it has been done already\n            this.props.onLayout('config-change', {\n                dimensions: this.assignExplicitSizeToFlexElements(),\n                fixed,\n                component: component.props.json,\n                container: this.props.json\n            });\n        }\n    }\n\n}\n\nFlexBox.displayName = 'FlexBox';\nFlexBox.defaultProps = {\n    style: { flexDirection: 'column' }\n};\n\n\nregisterClass('FlexBox', FlexBox, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport { PopupService, ContextMenu, MenuItem } from '@heswell/ui-controls';\nimport './tabstrip.css';\n\nconst OVERFLOW_WIDTH = 24;\n\nfunction handleClick(e,idx, onClick){\n    e.preventDefault();\n    onClick(idx);\n}\n\nexport const Tab = ({idx, text, isSelected, onClick, onMouseDown}) =>\n    <li className={cx('Tab', {'active': isSelected})}\n        onClick={e => handleClick(e, idx, onClick)}\n        onMouseDown={onMouseDown}>\n        <a href=\"#\" className=\"tab-caption\" data-idx={idx}>{text}</a>\n    </li>\n\nconst TabstripOverflow = ({onClick}) =>\n    <div className='TabstripOverflow' onClick={onClick} />;\n\nexport default class Tabstrip extends React.Component {\n\n    constructor(props){\n        super(props);\n        this.state = {\n            overflowing: false\n        };\n        this.el = null;\n    }\n\n\n    render() {\n\n        const { style, children, onMouseDown, selected=0 } = this.props;\n        const {overflowing} = this.state;\n        const className = cx('Tabstrip', this.props.className, {overflowing});\n\n        const tabs = children.map((child, idx) => {\n            return (\n                React.cloneElement(child, {\n                    idx,\n                    isSelected: selected === idx,\n                    onClick: i => this.handleTabClick(i)\n                }));\n        });\n\n        return (\n            <div className={className} style={style} onMouseDown={onMouseDown} ref={el => this.el = el}>\n                <div className=\"tabstrip-inner-sleeve\">\n                    <ul className=\"tabstrip-inner\">{tabs}</ul>\n                </div>\n                {overflowing && <TabstripOverflow onClick={() => this.showOverflow()} />}\n            </div>\n        );\n    }\n\n    componentDidMount() {\n        this.checkOverflowState();\n    }\n\n    componentDidUpdate() {\n        this.checkOverflowState();\n        // only necesary if selection has changed or tabstrip has resized\n        // make sure selected tab is in view \n        this.ensureSelectedTabisVisible();\n\n    }\n\n    checkOverflowState() {\n        const freeSpace = this.measureFreeSpace();\n        const {overflowing} = this.state;\n        if (freeSpace < 0 && overflowing === false) {\n            this.setState({ overflowing: true });\n        } else if (freeSpace >= 0 && overflowing === true) {\n            this.setState({ overflowing: false });\n        }\n    }\n\n     handleTabClick(selectedIdx){\n        if (selectedIdx !== this.props.selected) {\n            this.props.onSelectionChange(this.props.selected, selectedIdx);\n        }\n    }\n\n    ensureSelectedTabisVisible() {\n\n        const tabstripInner = this.el.querySelector('.tabstrip-inner');\n        const activeTab = tabstripInner.querySelector('.active.Tab');\n        if (!activeTab) {\n            // eg if dragging;\n            return;\n        }\n\n        const tsBox = this.el.getBoundingClientRect();\n        const tbBox = activeTab.getBoundingClientRect();\n        const ulBox = tabstripInner.getBoundingClientRect();\n\n        const tbOffStageRight = Math.floor(tsBox.right - tbBox.right);\n        const ulOffStageLeft = Math.floor(ulBox.left - tsBox.left);\n        const overflowing = ulBox.right > tbBox.right;\n        let translateX;\n\n        if (ulOffStageLeft === 0 && tbOffStageRight < 0) {\n            translateX = ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (ulOffStageLeft < 0 && tbOffStageRight === OVERFLOW_WIDTH) {\n            // no action necessary\n        } else if (ulOffStageLeft < 0 && tbOffStageRight < OVERFLOW_WIDTH) {\n            translateX = ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (overflowing && tbOffStageRight < OVERFLOW_WIDTH) {\n            translateX = tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (ulOffStageLeft < 0) {\n            translateX = Math.min(0, ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH);\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        }\n    }\n\n    measureFreeSpace() {\n        const tabstripInner = this.el.querySelector('.tabstrip-inner');\n        return this.el.clientWidth - tabstripInner.clientWidth;\n    }\n\n    showOverflow(){\n        const overflow = this.el.querySelector('.TabstripOverflow')\n        const { right, bottom } = overflow.getBoundingClientRect();\n        const {children: tabs} = this.props;\n        const menuItems = tabs.map(({props: {text}}) =>\n            <MenuItem key={text} action='setActiveTab' label={text} data={text} />);\n\n        PopupService.showPopup({\n            left: right,\n            top: bottom,\n            position: 'top-bottom-right-right',\n            component: (\n                <ContextMenu component={this} doAction={(action, data) => this.handleContextMenuAction(action, data)}\n                    left='auto' bottom='auto' right={0} top={0}>\n                    {menuItems}\n                </ContextMenu>\n            )\n        });\n    }\n\n    handleContextMenuAction(action, data){\n        if (action === 'setActiveTab'){\n            const idx = this.props.children.findIndex(tab => tab.props.text === data);\n            if (idx !== -1) {\n                this.handleTabClick(idx);\n            }\n        }\n    }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport Tabstrip, {Tab} from '../tabstrip';\nimport LayoutItem from './layout-item';\nimport Container from './container';\nimport {registerClass} from '../componentRegistry';\nimport {layout as applyLayout} from '../model/index';\n\nconst DEFAULT_TABSTRIP_HEIGHT = 34;\n\nexport default class TabbedContainer extends Container {\n\n    constructor(props){\n        super(props);\n        this.tabstrip = null;\n    }\n\n    render(){\n        var {style, tabstripHeight, children} = this.props;\n        const {layoutModel} = this.state;\n        var {$path, layout, $position=layout, active} = layoutModel;\n\n        // Don't allow either the tabs or the tabstrip itself to be dragged unless it is inside\n        // the DragZone. We might further config-enable this eg. allow tabs but not the tabstrip\n        // to be dragged when the TabbedContainer IS the DragZOne.\n        var isDraggable = true;\n\n        // Note: if key is not assigned here, we will get a React warning, even though it is assigned in Tabstrip !\n        var tabs = children.map((child,idx) => {\n            return <Tab key={idx} text={titleFor(child)} onMouseDown={e => this.handleMouseDown(e,layoutModel.children[idx])} />\n        });\n\n        var className = cx(\n            'TabbedContainer',\n            this.props.className\n        );\n\n        return (\n            <div id={$path} className={className} style={{...style,position: 'absolute',...$position}}>\n                <Tabstrip className='header'\n                    ref={component => this.tabstrip = component}\n                    style={{position: 'absolute',top: 0,left: 0, width: $position.width, height: tabstripHeight}}\n                    draggable={isDraggable}\n                    selected={active}\n                    dragging={this.state.dragging}\n                    onMouseDown={e => this.handleMouseDown(e)}\n                    onSelectionChange={(selected, idx) => this.handleTabSelection(selected, idx)}>{tabs}</Tabstrip>\n                {this.renderChildren()}\n            </div>\n        );\n    }\n\n    renderChildren(){\n\n        const {children, onLayout} = this.props;\n        const {layoutModel: {active=0, children: layoutChildren}} = this.state;\n        const child = children[active]\n\n        var childLayoutModel = layoutChildren[active];\n\n        var {title, style={}, ...childProps} = child.props;\n\n        var id = childLayoutModel.$id;\n\n        style={...style, ...childLayoutModel.style}; // TODO shouldn't layoutModel be the sole source of tryth for style ?\n\n        var props = {\n            id,\n            key: id,\n            container: this,\n            onLayout,\n            onConfigChange: this.handleConfigChange,\n            title: title,\n            layoutModel: childLayoutModel\n        };\n\n        if (isLayout(child)){\n            return React.cloneElement(child, {...props,style});\n        } else {\n            return <LayoutItem {...childProps} {...props} style={style}>{child}</LayoutItem>;\n        }\n    }\n\n    // duplicated from flexBox as an experiment, wh can't this be moved entirely to Container\n    componentWillReceiveProps(nextProps) {\n        var { layoutModel } = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (this.state.layoutModel.$path === '0') {\n        // special handling if we are at the root of a layout\n        // should handle this in Container\n            const {style: {width, height, visibility}} = nextProps;\n            const {style} = this.props;\n            if (width !== style.width || height !== style.height || visibility !== style.visibility) {\n                const VISIBLE = visibility || 'visible';\n                const FORCE_LAYOUT = true;\n                this.setState({\n                    layoutModel: applyLayout(\n                        this.state.layoutModel,\n                        { width, height },\n                        this.state.layoutModel.$path,\n                        VISIBLE,\n                        FORCE_LAYOUT)\n                });\n            }\n\n        }\n    }\n\n    getDragPermission(/* component */){\n        return {x: true,y: true};\n    }\n\n    // getDragBoundingRect(){\n    //     debugger;\n    //     var {top, left, width, height,right, bottom} = ReactDOM.findDOMNode(this).getBoundingClientRect();\n\n    //     var tabstripHeight = this.tabstrip.getDOMNode().clientHeight;\n\n    //     if (this.props.dragContainer === true){\n    //         return {top: top+tabstripHeight, left, width, height: height-tabstripHeight, right, bottom};\n    //     } else {\n    //         return {top, left, width, height, right, bottom};\n    //     }\n    // }\n\n    handleTabSelection(selected, idx){\n        const {onLayout=this.handleLayout} = this.props;\n        const {layoutModel} = this.state;\n        onLayout('switch-tab', {\n            path: layoutModel.$path,\n            idx: this.props.active,\n            nextIdx: idx\n        });\n\n        if (this.props.onTabSelectionChanged){\n            this.props.onTabSelectionChanged(idx);\n        }\n    }\n\n    handleMouseDown(e, model=this.state.layoutModel){\n        e.stopPropagation();\n        const {onLayout=this.handleLayout} = this.props;\n        onLayout('drag-start',{\n            model,\n            evt: e,\n            position: ReactDOM.findDOMNode(this).getBoundingClientRect()});\n    }\n\n}\n\nTabbedContainer.displayName = 'TabbedContainer';\nTabbedContainer.defaultProps = {\n    tabstripHeight: DEFAULT_TABSTRIP_HEIGHT\n}\n\nregisterClass('TabbedContainer', TabbedContainer, true);\n\nfunction titleFor(component){\n\n    var {title, config} = component.props;\n\n    return title || (config && config.title) || 'Tab X';\n\n}\n\nfunction isLayout(element){\n    return element.type.displayName === 'FlexBox' ||\n            element.type.displayName === 'TabbedContainer' ||\n            element.type.displayName === 'DynamicContainer';\n}\n","import React from 'react';\nimport cx from 'classnames';\n\nimport './component.css';\n\n// need a layout prop and layout state. That way we can accept layout data both via json\n// and vis managing Flexible container\nexport default class Component extends React.Component {\n\n    render() {\n        const className = cx('Component');\n        const {children, id, flexible, onLayout, position, _style, onClick, ...props} = this.props;\n        return (\n            <div className={className} style={this.props.style} onClick={onClick}>\n                {children &&\n                    React.isValidElement(children) && !isHtmlType(children)\n                    ? React.cloneElement(children, { ...props })\n                    : children\n                }\n            </div>\n\n        );\n    }\n}\n\nComponent.defaultProps = {\n    style: {},\n    position: {},\n    _style: {},\n    onClick: () => {}\n}\n\n\nfunction isHtmlType(element){\n    const {type} = element;\n    return typeof type === 'string' && type[0] === type[0].toLowerCase();\n}\n","\nimport React from 'react';\nimport cx from 'classnames';\n\nimport './placeHolder.css';\n\n// Maybe should share a common base with LayoutItem\nexport default class PlaceHolder extends React.Component {\n\n\n    render() {\n\n        var className = cx(\n            \"PlaceHolder\",\n            this.props.className\n        );\n\n        var style = {\n            ...this.props.style,\n            backgroundColor: 'rgb(60,60,60)'\n        }\n\n\n        return (\n            <div className={className} style={style}>\n                <div className=\"close icon-arrow\" onClick={this.handleClose.bind(this)}>\n                    <span>Close</span>\n                </div>\n            </div>\n        );\n    }\n\n    handleClose() {\n        this.props.onLayout('remove');\n    }\n\n\n}\n\nPlaceHolder.defaultProps = {\n    layout: { ready: false }\n};\n","import React from 'react';\nimport Component from '../component/component';\nimport LayoutItem from '../containers/layout-item';\nimport PlaceHolder from '../placeHolder';\n\nimport { registerClass, ComponentRegistry } from '../componentRegistry';\n\nregisterClass('PlaceHolder', PlaceHolder);\nregisterClass('LayoutItem', LayoutItem);\nregisterClass('Component', Component);\n\nexport function renderDynamicLayout(container, props, layoutModel) {\n\n    var { children, dragContainer, ...remainingProps } = container.props;\n    var { style: propStyle, ...rest } = props;\n    var { active, style: layoutStyle = {} } = layoutModel;\n\n    var finalProps = {\n        ...remainingProps,\n        active,\n        ...rest,\n        layoutModel,\n        style: { ...layoutStyle, ...propStyle }\n    };\n\n    //onsole.log('renderDynamicContainer about to create a new component (fom json) which will be cloned)',layout,finalProps);\n\n    return React.cloneElement(componentFromLayout(layoutModel), finalProps);\n\n}\n\nexport function componentFromLayout(layout) {\n    //onsole.log(`%ccomponentFromLayout\\n${JSON.stringify(json,null,2)}`,'background-color:ivory;color:brown;')\n    return _componentFromLayout(layout);\n}\n\nfunction notSplitterOrLayout(model) {\n    return model.type !== 'Splitter' && model.type !== 'layout';\n}\n\nfunction _componentFromLayout(layoutModel) {\n\n    if (Array.isArray(layoutModel)) {\n        return layoutModel.map(_componentFromLayout);\n    } else if (layoutModel == null) {\n        return null\n    }\n\n    const { $id, $path, type, ...props } = layoutModel;\n    const [ReactType, reactBuiltIn] = getComponentType(type);\n\n    let children;\n\n    if (type === 'Container') {\n        children = null;\n    } else {\n        children = layoutModel.children && layoutModel.children.length\n            ? layoutModel.children.filter(notSplitterOrLayout).map(_componentFromLayout)\n            : null;\n        if (children && children.length === 1) children = children[0];\n    }\n\n    return reactBuiltIn\n        ? <ReactType {...props} key={$id}>{children}</ReactType>\n        : <ReactType {...props} key={$id} layoutModel={layoutModel}>{children}</ReactType>;\n}\n\nfunction getComponentType(type){\n    if (ComponentRegistry[type]){\n        return [ComponentRegistry[type], false];\n    } else if (type === type.toLowerCase()){\n        return [type, true];\n    }\n    throw Error('componentFromLayout: unknown component type: ' + type)\n}\n","import React from 'react';\nimport Container from './container';\nimport LayoutItem from './layout-item';\nimport { DragContainer } from '../draggable';\nimport { renderDynamicLayout } from '../util/componentFromLayout';\nimport {isLayout} from '../util/component-utils'\nimport { registerClass } from '../componentRegistry';\n\nexport default class DynamicContainer extends Container {\n\n    componentDidMount(){\n        super.componentDidMount();\n        DragContainer.register(this.state.layoutModel.$path);\n    }\n\n    renderChild(layoutModel, idx) {\n\n        var { layoutModel: { $version }, onLayout } = this.props;\n\n        if ($version === 1 && this.props.children) {\n            // WHAT wa sthis for ?\n            return super.renderChild(layoutModel, idx);\n        }\n\n        var props = {\n            layoutModel,\n            onLayout\n        }\n\n        props.key = props.id = layoutModel.$id;\n\n        if (isLayout(layoutModel.type)) {\n            return this.renderFromLayout(this, props, layoutModel);\n        } else {\n            return <LayoutItem {...props} layout={layoutModel}>{this.renderFromLayout(this, props, layoutModel)}</LayoutItem>;\n        }\n    }\n\n    getState() {\n        return {\n            dragging: -1\n        };\n    }\n\n    // not currently called from FlexBox, but might need to be\n    // routinely called by top-level Container of Application\n    renderFromLayout(element, props, layout) {\n        return renderDynamicLayout(element, props, layout);\n    }\n\n    getLayoutModelChildren() {\n        if (this.props.contentModel) {\n            return [this.props.contentModel];\n        } else {\n            return super.getLayoutModelChildren();\n        }\n    }\n\n    drop(component, dropTarget) {\n\n        this.setState({\n            dragging: -1,\n            tempDimensions: undefined\n        });\n    }\n}\n\nDynamicContainer.displayName = 'DynamicContainer';\nDynamicContainer.defaultProps = {\n    style: { flex: 1 },\n    config: {}\n};\n\n\nregisterClass('DynamicContainer', DynamicContainer, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport {uuid} from '@heswell/utils';\nimport LayoutItem from './layout-item';\nimport DynamicContainer from './dynamic-container';\nimport {isLayout} from '../util/component-utils';\nimport { handleLayout } from '../model/index';\nimport {componentFromLayout} from '../util/componentFromLayout';\nimport { registerClass } from '../componentRegistry';\nimport { Draggable } from '../draggable';\n\n\nconst NO_CHILDREN = [];\nconst EMPTY_OBJECT = {};\n\nexport default class Surface extends DynamicContainer {\n\n    constructor(props){\n        super(props);\n        this.handleDragStart = this.handleDragStart.bind(this);\n        this.handleDrag = this.handleDrag.bind(this);\n        this.handleDrop = this.handleDrop.bind(this);\n    }\n\n    getState() {\n        return {\n            dragging: false,\n            draggedIcon: null,\n            draggedComponent: null\n        };\n    }\n\n    render() {\n        var className = cx(\n            this.props.className,\n            'rect-layout',\n            'rect-container',\n            'Surface'\n        );\n\n        const {layoutModel: {children=NO_CHILDREN}, draggedComponent} = this.state;\n        const childrenToRender = draggedComponent\n            ? [...children, draggedComponent]\n            : children\n        \n        return (\n            <div id={this.state.id} className={className} style={this.props.style}>\n                {\n                    childrenToRender.map(\n                        (child, idx) => this.renderChild(child, idx)\n                    )\n                }\n            </div>\n        );\n    }\n\n    renderChild(layoutModel, idx) {\n\n        const { children } = this.props;\n        const child = React.isValidElement(children) && idx === 0\n            ? children\n            : Array.isArray(children) && children[idx]\n                ? children[idx]\n                : componentFromLayout(layoutModel)\n\n        const props = {\n            key: layoutModel.$id,\n            onLayout: this.handleLayout,\n            layoutModel\n        };\n        const dragging = layoutModel === this.state.draggedComponent;\n\n        const style = {\n            ...child.props.style,\n            boxSizing: 'content-box'\n        };\n\n        if (isLayout(child)) {\n            return React.cloneElement(child, { ...props, style });\n        } else {\n            return (\n                <LayoutItem dragging={dragging} {...props} style={style}>{child}</LayoutItem>)\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        const {layoutModel} = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({layoutModel});\n        } else {\n        // QUESTION: is this reliable ? WOn't the children be different array/\n        // instances, even though nothing has changed ?\n        // how do we update the layoutModel if we aquire/lose children in mid-flight ?\n            // const { children } = nextProps;\n\n            // if (differentChildren(children, this.props.children) && Array.isArray(children)) {\n\n            //     const { layoutModel } = this.state;\n\n            //     // temp hardcoding to test the principal - we need to be able to map \n            //     // children to layoutModel.children\n            //     // this works because sample surface gives ID to all children\n            //     // and new child is aways last\n\n            //     const idx = children.length - 1;\n            //     const lastChild = children[idx];\n\n            //     this.setState({\n            //         layoutModel: {\n            //             ...layoutModel,\n            //             children: [\n            //                 ...layoutModel.children,\n            //                 layout(this.getLayoutModelChild(lastChild), {}, `${layoutModel.$path}.${idx}`)\n            //             ]\n            //         }\n\n            //     });\n            // }\n\n        }\n\n    }\n\n    renderChildren() {\n        return null;\n    }\n\n    getDragPermission(/*component*/) {\n        return { x: true, y: true }\n    }\n\n    handleDragStart({model, position, instructions=EMPTY_OBJECT}, e){\n        var {top,left} = position;\n\n        // Can we find a better way than these clumsy instructions\n\n        const layoutModel = !instructions.DoNotRemove\n            ? handleLayout(this.state.layoutModel,'remove', {targetNode: model})\n            : this.state.layoutModel;\n\n        const {draggableWidth: width,\n            draggableHeight: height,\n            ...dragTransform} = Draggable.initDrag(e, layoutModel, model.$path, position, {\n            drag: this.handleDrag,\n            drop: this.handleDrop\n        });\n\n        var {$path, layout: modelLayout, style, dragAsIcon, ...rest} = model;\n        const layout = modelLayout\n            ? {width, height, ...modelLayout, top, left}\n            : {top, left, width, height}\n\n\n        var draggedIcon = dragAsIcon\n            ? componentFromLayout({\n                type: 'ComponentIcon',\n                color: 'red',\n                style: {...style, position: 'absolute', width: 120, height: 45, visibility: 'visible'},\n                layout\n            })\n            : undefined;\n\n        // what if draggedComponent is a Layout ?    \n        var draggedComponent = dragAsIcon\n            ? {$id: uuid(), $path, layout, style, ...rest}\n            : {\n                ...rest,\n                style: {\n                    ...style,\n                    position: 'absolute',\n                    ...(!instructions.DoNotTransform && dragTransform),\n                    visibility: 'visible'\n                },\n                layout,\n                children: [{\n                    type: 'layout', style: {}, layout: {...layout, top: 0, left: 0}\n                }]\n            };\n\n            // don't set dragging yet, it will suppress the final render of app with draggedComonent\n        // removed.\n        this.setState({\n            dragX: left,\n            dragY: top,\n            draggedIcon,\n            draggedComponent,\n            layoutModel\n        });\n\n        return true;\n\n    }\n\n    handleDrag(x,y){\n\n        const {draggedComponent} = this.state;\n        let {layout, style} = draggedComponent;\n\n        if (typeof x === 'number' && x !== layout.left){\n            layout = {...layout, left: x}\n            style = {...style, left: x}\n        }\n\n        if (typeof y === 'number' && y !== layout.top){\n            layout = {...layout, top: y}\n            style = {...style, top: y}\n        }\n\n        if (layout !== draggedComponent.layout){\n            this.setState({\n                dragging: true,\n                draggedComponent: {\n                    ...draggedComponent,\n                    style,\n                    layout\n                }\n            });\n        }\n    }\n\n    handleDrop(dropTarget){\n        const {draggedComponent} = this.state;\n        this.setState({draggedComponent: undefined, draggedIcon: undefined, dragging: false});\n        // TODO need somehow to animate dropped component to final resting place\n        /* \n            perhaps rerender new layout, bt mke new component a placeholder\n            measure new position\n            animate dragged component to new location\n            show new component & hide draggee\n            -- becomes a lot more efficient if we render all to a flat plane\n        */\n        this.handleLayout('drop', {draggedComponent, dropTarget});\n    }\n\n}\nSurface.displayName = 'Surface';\nregisterClass('Surface', Surface, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport LayoutItem from './layout-item';\n\nexport default function DragSurface(props) {\n\n    var { style, children: child, x, y } = props;\n\n    var draggedComponent = null;\n    var visibility = child ? 'visible' : 'hidden';\n\n    if (child) {\n\n        let { style: childStyle/*, ...rest */} = child.props;\n\n        var layoutModel = child.props.layoutModel;\n\n        let childProps = {\n            key: layoutModel.$id,\n            layoutModel\n        };\n\n        childStyle = { // ...rest ?\n            ...childStyle,\n            borderWidth: 3,\n            borderStyle: 'solid',\n            borderColor: '#ccc',\n            boxSizing: 'content-box'\n        };\n\n        if (y !== undefined && x !== undefined) {\n\n            childProps.layoutModel = {\n                ...layoutModel,\n                layout: { ...layoutModel.layout, top: y, left: x }\n            }\n        }\n\n        draggedComponent =\n            <LayoutItem {...childProps} style={childStyle}>\n                {child}\n            </LayoutItem>;\n\n    }\n\n    var className = cx(\n        'DragSurface',\n        'rect-layout',\n        'rect-container',\n        'Surface',\n        props.className);\n\n    return (\n        <div className={className} style={{ ...style, visibility }}>\n            {draggedComponent}\n        </div>\n    );\n\n}\n","import React, {Component} from 'react'\nimport cx from 'classnames';\nimport {registerClass} from '../componentRegistry';\n\nexport default class ComponentIcon extends Component {\n\n\trender(){\n\t\tconst {color, text, style} = this.props;\n\t\tconst className = cx('ComponentIcon', this.props.className);\n\t\tconsole.log(`ComponentIcon color=${color}`);\n\n\t\treturn (\n\t\t\t<div className={className}\n\t\t\t\tstyle={{...style,backgroundColor:color}}>\n\t\t\t\t<span>{text}</span>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nregisterClass('ComponentIcon', ComponentIcon);\n","import {LAYOUT_MODEL, DROP, LAYOUT_REMOVE, LAYOUT_SWITCH_TAB, LAYOUT_REPLACE} from './actions';\n\nimport {handleLayout} from '../model/index';\n\n// Make sure we don't handle any layout actions before the layoutModel has\n// been initialized\n\nexport default function layoutReducer(state=null, {type, ...action}){\n\t\n\t//onsole.log(`%clayoutReducer ${type} ${JSON.stringify(action)}` ,'color:white;background-color:green;font-weight:bold;');\n\n    switch (type){\n\n    case LAYOUT_MODEL: \treturn action.layoutModel;\n    \n    case LAYOUT_REMOVE: return handleLayout(state, 'remove', action);\n\n    case LAYOUT_REPLACE : return handleLayout(state, 'replace', action);\n    \n    case LAYOUT_SWITCH_TAB : return handleLayout(state, 'switch-tab', action);\n\n    case DROP : return handleLayout(state, 'drop', action); \t\n       \n    default:  return state;\n\n}\n\n\n}\n\nexport const getLayoutModel = state => state.layoutModel;","\nimport React from 'react';\nimport cx from 'classnames';\nimport {uuid} from '@heswell/utils';\n\nimport {Surface} from '../layoutContainers';\nimport '../components/ComponentIcon';\nimport {followPath} from '../model/index';\nimport {\n    switchTab,\n    replace as replaceInLayout\n} from '../redux/actions';\nimport {getLayoutModel} from '../redux/layoutReducer';\nimport './application.css';\n\nconst NO_STYLE = {}\n\nexport default class Application extends React.Component {\n\n    constructor(props){\n        super(props);\n\n        var {width: appWidth, height: appHeight, dialogs=[], style: {width=appWidth, height=appHeight, backgroundColor}=NO_STYLE} = props;\n\n        this.resizeListener = this.resizeListener.bind(this);\n\n        this.el = React.createRef();\n\n        this.state = {\n            height,\n            width,\n            backgroundColor,\n            content: this.props.layout, // REALLY ???\n            draggedComponent: null,\n            dialogs,\n            hasError: false\n        };\n\n    }\n\n    componentDidCatch(error, info){\n        console.log(`error`,error)\n        this.setState({hasError: true})\n    }\n\n    componentDidMount(){\n\n        let {width, height} = this.state;\n        \n        if (width === undefined || height === undefined){\n            const {height: clientHeight, width: clientWidth} = this.el.current.getBoundingClientRect();\n            if (height === undefined){\n                height = clientHeight;\n            }\n            if (width === undefined){\n                width = clientWidth;\n            }\n            this.setState({height, width})\n        }\n\n        window.addEventListener('resize', this.resizeListener, false);\n        // this.store.dispatch(initializeLayoutModel(this.state.layoutModel));\n    }\n\n    componentWillUnmount(){\n        window.removeEventListener('resize', this.resizeListener, false);\n    }\n\n    render(){\n\n        const {width, height, backgroundColor, dragging, hasError} = this.state;\n        const style = {position: 'absolute', top: 0, left: 0,width,height, backgroundColor};\n        const className = cx('Application', this.props.className);\n\n        if (width === undefined || height === undefined){\n            return <div style={{height: '100%'}} ref={this.el}/>;\n        }\n        else if (hasError){\n            return <div style={style} className={className}>Error</div>\n        }\n\n        return (\n            <div style={style} className={className} ref={this.el}>\n                <Surface layoutModel={this.props.layoutModel}\n                    style={{width,height}}\n                    dragging={dragging}\n                    onLayout={(command, options) => this.handleLayout(command, options)}\n                    onLayoutModel={this.props.onLayoutModel}>\n                    {this.getContent()}\n                </Surface>\n            </div>\n        );\n    }\n\n    getContent(){\n\n        var {children} = this.props;\n        var {dialogs} = this.state;\n\n        if (React.isValidElement(children)){\n            if (dialogs.length === 0){\n                return children;\n            }\n            else {\n                children = [children];\n            }\n        }\n\n        return children.concat(dialogs);\n\n    }\n\n    getLayoutModel(width, height, id=uuid()){\n\n        console.log(`%cApplication.getLayoutModel width ${width} height ${height} id ${id}`,'color:blue;font-weight:bold');\n        return {\n            type: 'Surface', // Should it be 'Application' ?\n            $id: id,\n            $path: '0',\n            $version: 1,\n            style: {position: 'absolute', width, height},\n            layout: {top: 0,left: 0, width, height},\n            children: []\n        };\n\n    }\n\n    componentWillReceiveProps(nextProps){\n        const {dialogs} = nextProps;\n        if (dialogs !== this.props.dialogs){\n            // could this mess with dialogs already in state ?\n            this.setState({dialogs});\n        }\n    }\n\n    shouldComponentUpdate(nextProps, nextState){\n        var {width, height} = this.state;\n\n        return  nextState.width !== width || \n                nextState.height !== height ||\n                nextState.draggedComponent !== undefined ||\n                nextState.dialogs !== this.state.dialogs ||\n                nextState.layoutModel !== this.state.layoutModel;\n    }\n\n    resizeListener(){\n        // var {width, height} = document.body.getBoundingClientRect();\n\n        // if (width !== this.state.width || height !== this.state.height){\n\n        //     const {layoutModel} = this.state;\n\n        //     this.store.dispatch(initializeLayoutModel(layout(layoutModel, {top:0,left:0,width,height}, layoutModel.$path, 'visible', true)));\n\n        //     this.setState({\twidth, height });\n        // }\n\n    }\n\n    handleLayout(command, options) {\n\n        if (command === 'dialog'){\n            // const dialog = componentFromLayout(layout(options.component));\n            const {dialogs} = this.state;\t\n            this.setState({\n                dialogs: dialogs.concat(options.component)\n            });\n        } else {\n            var layoutModel = getLayoutModel(this.store.getState());\n\n            if (command === 'replace'){\n                this.store.dispatch(replaceInLayout(followPath(layoutModel, options.model.$path), options.model));\n            } else if (command === 'switch-tab'){\n                const {path, idx, nextIdx} = options;\n                this.store.dispatch(switchTab(path, idx, nextIdx));\n            } else {\n                console.error(`Application.handleLayout dont't know what to do with ${command}`);\n            }\n\n        }\n\n    }\n\n\t// TODO where does this belong\n    getComponentState(componentId){\n\n        const {componentState} = this.store.getState();\n        return componentState[componentId];\n\n    }\n\n}\n\nApplication.defaultProps = {\n    reducers: {},\n    bootstrap: () => {}\n};\n"],"names":["_containers","ComponentRegistry","isContainer","className","registerClass","component","typeOf","element","type","displayName","name","constructor","LayoutProps","resizeable","header","title","active","tabstripHeight","dragStyle","layoutProps","props","results","Object","entries","forEach","key","value","getLayoutModel","$id","id","uuid","style","children","isLayout","getLayoutModelChildren","contentModel","React","isValidElement","Array","isArray","filter","child","map","ComponentHeader","Component","render","fixed","minimized","onMouseDown","menu","e","handleMenuClick","onAction","left","clientX","top","clientY","ComponentContextMenu","doAction","menuItems","state","targetComponent","maximized","normal","console","log","push","contextMenuItems","componentMenuItems","text","action","length","LAYOUT_REMOVE","LAYOUT_REPLACE","LAYOUT_SWITCH_TAB","remove","targetNode","replace","replacementNode","switchTab","path","idx","nextIdx","positionValues","Position","freeze","_position","str","offset","NaN","valueOf","toString","North","South","East","West","Header","Centre","NorthOrSouth","EastOrWest","NorthOrWest","SouthOrEast","Absolute","NORTH","SOUTH","EAST","WEST","HEADER","CENTRE","BoxModel","measure","model","measurements","addMeasurements","smallestBoxContainingPoint","layout","x","y","pointPositionWithinRect","rect","width","right","height","bottom","posX","posY","pctX","pctY","closeToTheEdge","position","tab","borderZone","containsPoint","tabs","tabCount","targetTab","find","index","indexOf","lastTab","w","h","centerBox","quadrant","preX","preY","componentMeasurements","addClientMeasurements","collectChildMeasurements","$path","start","performance","now","tabMeasurements","measureTabs","end","isSplitter","components","reduce","arr","all","localPreX","localPosX","localPreY","localPosY","flexDirection","prev","next","n","c","subLayout","i","from","document","getElementById","querySelectorAll","getBoundingClientRect","followPath","Error","route","slice","paths","split","undefined","join","followPathToParent","nextStep","pathSoFar","targetPath","finalStep","regex","RegExp","parseInt","SURFACE","TABBED_CONTAINER","NO_CHILDREN","NO_STYLE","CSS_DIGIT","CSS_MEASURE","CSS_REX","BORDER_REX","ROW","COLUMN","FLEX_DIRECTION","yoga","FLEX_DIRECTION_ROW","FLEX_DIRECTION_COLUMN","LAYOUT","FLEXBOX","SPLITTER","BORDER_STYLES","border","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","BORDER_LIST","keys","LAYOUT_STYLES","margin","marginTop","marginRight","marginBottom","marginLeft","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","LAYOUT_LIST","layoutStyleDiff","style1","style2","some","computeLayout","tree","createTree","layoutModel","createYogaTree","node","calculateLayout","DIRECTION_LTR","setLayout","freeRecursive","normalizeLayoutStyles","expandChildren","splitters","getSplitterPositions","list","flex","backgroundColor","match","exec","error","pos1","pos2","pos3","pos4","pos123","paddinggLeft","normalizeBorderStyle","bs","borderColor","rest","boxShadow","borderStyle","DEFAULT_HEADER","parent","parentIsTabbedContainer","parentIsSurface","display","Node","create","increaseCSSMeasure","setCSSMeasure","setDisplay","DISPLAY_FLEX","setFlexDirection","setAlignItems","ALIGN_STRETCH","DISPLAY_NONE","setFlexGrow","setFlexShrink","setFlexBasis","setMargin","EDGE_TOP","getFlexDirection","flexGrow","flexShrink","flexBasis","setPositionType","POSITION_TYPE_ABSOLUTE","setPosition","EDGE_START","setWidth","setHeight","expandedChild","insertChild","ret","thisFlexible","isFlexible","lastFlexible","getComputedLayout","CSS_MEASURE_SETTERS","CSS_MEASURES","measureTop","measureRight","measureBottom","measureLeft","edge","setMeasure","EDGE_ALL","EDGE_END","EDGE_BOTTOM","EMPTY_OBJECT","containerOf","target","handleLayout","command","options","resizeLayout","replaceChild","result","removeChild","drop","visibility","force","firstNumber","n1","n2","n3","Math","round","firstDefined","m","flexLayout","isActive","computeLayoutYoga","container","newContainer","draggedComponent","source","dropTarget","pos","tabIndex","before","after","transform","insert","wrap","dropLayoutIntoContainer","targetContainer","absoluteDrop","isDraggableRoot","withTheGrain","againstTheGrain","nodeToBeInserted","nodeAfterWhichToInsert","nodeBeforeWhichToInsert","nodeSize","op","opts","into","size","oneMoreStepNeeded","flexBox","dim","concat","transformOrigin","modelLayout","getLayoutSpec","childLayout","wrapperStyle","wrapper","splice","dimension","shift","resizedTarget","measurement","newLayout","simpleClone","o1","o2","unversioned","value1","value2","property","versionIncrement","$version","clone","overrides","s1","rest1","s2","rest2","noEffectiveOverrides","properties","getOwnPropertyNames","replacement","isTower","isTerrace","isTabset","DEFAULT_HEADER_SPEC","LayoutItem","applyLayout","bind","dragging","_","isSelected","cx","headerHeight","componentStyle","handleMousedown","handleAction","cloneElement","onLayout","componentDidMount","self","context","store","unsubscribe","subscribe","myState","getState","setState","componentWillUnmount","componentWillReceiveProps","nextProps","dispatch","componentId","config","targetId","removeFromLayout","contextMenu","handleContextMenuAction","PopupService","showPopup","onConfigChange","evt","ReactDOM","findDOMNode","defaultProps","computeMenuPosition","offsetTop","offsetLeft","clientRect","box","menuPosition","DropMenu","COLOURS","layer","hover","_group","Konva","Group","on","add","visible","isVisible","addPaths","dropTargets","toArray","Path","strokeWidth","fill","data","pathPosition","removeChildren","unit","depth","lo","count","TheCanvas","SketchPad","_dropTarget","_multiDropOptions","_stage","_layer","_konvaDropMenu","_hoverDropTarget","_dropTargetIsTabstrip","_currentTabIndex","insertIntoRoot","root","createElement","body","insertBefore","insertSVGRoot","innerHTML","drawTabPath","l","t","tl","tw","th","DropTargetCanvas","sketchpad","clientWidth","clientHeight","window","addEventListener","Stage","Layer","prepare","r","b","cssText","classList","clear","hoverDropTarget","dropTargetIsTabstrip","currentTabIndex","draw","SameDropTarget","wasMultiDrop","drawTargetSVG","nextDropTarget","DropMenu2","PopupPosition","CenteredOnPosition","movePopupTo","lineWidth","targetRect","targetTabRect","tabLeftOffset","svg","select","selectAll","d","transition","duration","attr","p","enter","append","DropTarget","inset","gap","tabLeft","tabWidth","tabHeight","halfHeight","sizeHeight","min","halfWidth","sizeWidth","warn","activate","getActiveDropTarget","identifyDropTarget","getNextDropTarget","north","south","east","west","eastwest","northsouth","containerPos","positionedAtOuterContainerEdge","isVBox","isTabbedContainer","isHBox","containingComponent","containingBox","closeToTop","closeToRight","closeToBottom","closeToLeft","SCALE_FACTOR","DragState","zone","mouseX","mouseY","init","mousePosition","scaleFactor","leadX","trailX","leadY","trailY","scaledWidth","scaledHeight","scaleDiff","leadXScaleDiff","leadYScaleDiff","trailXScaleDiff","trailYScaleDiff","constraint","hi","mouse","mousePos","mousePct","outOfBounds","inBounds","dropX","dropXY","call","dropY","update","xy","mouseConstraint","posConstraint","previousPos","diff","dir","max","_dragCallback","_dragStartX","_dragStartY","_dragContainer","_dragState","_dragThreshold","_measurements","_simpleDrag","_dropTargetCanvas","_dragContainers","DragContainer","register","unregister","getDraggable","refs","tabstrip","draggable","Draggable","mouseDownHandler","removeEventListener","dragStartCallback","preDragMousemoveHandler","preDragMouseupHandler","preventDefault","initDrag","dragHandler","x_diff","y_diff","mouseMoveDistance","abs","dragMousemoveHandler","dragMouseupHandler","getDragContainer","pathToContainer","maxSteps","steps","dragRect","dragZone","draggableWidth","draggableHeight","dragState","currentDropTarget","newX","newY","drag","sameDropTarget","onDragEnd","selector","querySelector","Container","isLayoutRoot","$position","renderChild","onLayoutModel","shouldComponentUpdate","getManagedDimension","handleDragStart","_splitter","_mousedown","_direction","Splitter","cursor","_mouseDownHandler","mouseMoved","mouseUp","onDrag","direction","vertical","lastPos","onDragStart","absIdx","clientPos","FlexBox","JSON","stringify","handleMouseDown","renderFlexibleChildren","splitterIdx","layoutChildren","propChildren","childIdx","childLayoutModel","splitterDragStart","splitterMoved","handleSplitterDragEnd","childProps","handleConfigChange","dragContainer","VISIBLE","FORCE_LAYOUT","getDragPermission","splitChildren","identifySplitChildren","distance","idx1","idx2","RESIZE","handleModelLayout","dimensions","assignExplicitSizeToFlexElements","json","OVERFLOW_WIDTH","handleClick","onClick","Tab","TabstripOverflow","Tabstrip","overflowing","el","selected","handleTabClick","showOverflow","checkOverflowState","componentDidUpdate","ensureSelectedTabisVisible","freeSpace","measureFreeSpace","selectedIdx","onSelectionChange","tabstripInner","activeTab","tsBox","tbBox","ulBox","tbOffStageRight","floor","ulOffStageLeft","translateX","overflow","findIndex","DEFAULT_TABSTRIP_HEIGHT","TabbedContainer","isDraggable","titleFor","handleTabSelection","renderChildren","onTabSelectionChanged","stopPropagation","flexible","_style","isHtmlType","toLowerCase","PlaceHolder","handleClose","ready","renderDynamicLayout","remainingProps","propStyle","layoutStyle","finalProps","componentFromLayout","_componentFromLayout","notSplitterOrLayout","ReactType","reactBuiltIn","getComponentType","DynamicContainer","renderFromLayout","tempDimensions","Surface","handleDrag","handleDrop","draggedIcon","childrenToRender","boxSizing","instructions","DoNotRemove","dragTransform","dragAsIcon","color","DoNotTransform","dragX","dragY","DragSurface","childStyle","ComponentIcon","Application","appWidth","appHeight","dialogs","resizeListener","createRef","content","hasError","componentDidCatch","info","current","getContent","nextState","replaceInLayout","getComponentState","componentState","reducers","bootstrap"],"mappings":"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"}