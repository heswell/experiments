{"version":3,"file":"index.js","sources":["../src/componentRegistry.js","../src/util/component-utils.js","../src/component-header.js","../src/componentContextMenu.js","../src/redux/actions.js","../src/model/boxModel.js","../src/model/pathUtils.js","../src/model/layoutTypes.js","../src/model/layoutUtils.js","../src/model/layoutModel.js","../src/layout-item.js","../src/drop-menu.js","../src/drop-target-canvas.js","../src/drop-target.js","../src/drag-state.js","../src/draggable.js","../src/container.js","../src/splitter.js","../src/flexbox.js","../src/tabstrip.js","../src/tabbed-container.js","../src/component.js","../src/placeHolder.js","../src/util/componentFromLayout.js","../src/dynamic-container.js","../src/surface.js","../src/dragSurface.js","../src/components/ComponentIcon.js","../src/redux/layoutReducer.js","../src/application.js"],"sourcesContent":["const _containers = {};\n\nexport const ComponentRegistry = {};\n\nexport function isContainer(className){\n    return _containers[className] === true;\n}\n\nexport function registerClass(className, component, isContainer){\n    ComponentRegistry[className] = component;\n\n    if (isContainer){\n        _containers[className] = true;\n    }\n}\n","import React from 'react';\n\nimport shallowCloneObject from './shallowCloneObject';\nconst UUID = require('pure-uuid');\nimport {isContainer} from '../componentRegistry';\n\nexport function typeOf(element){\n\n\tvar type;\n\n\n\n\tif (typeof element.type === 'function'){\n\t\ttype = element.type.displayName || element.type.name; \n\t}  \n\telse if (typeof element.type === 'string'){\n\t\ttype = element.type;\n\t}\n\telse if (element.constructor){\n\t\ttype = element.constructor.displayName; \n\t}\n\telse {\n\t\tdebugger;\n\t}\n\n\treturn type;\n\n}\n\n//TODO components should be able to register props here\nconst LayoutProps = {\n\tresizeable: true,\n\theader: true,\n\ttitle: true,\n\tactive: true,\n\ttabstripHeight: true,\n\tdragStyle: true\n}\n\nfunction layoutProps({props}){\n\tconst results = {};\n\tObject.entries(props).forEach(([key, value]) => {\n\t\t\tif (LayoutProps[key]){\n\t\t\t\t\tresults[key] = value;\n\t\t\t}\n\t})\n\treturn results;\n}\n\n\nexport const getLayoutModel = (component) => ({\n\ttype: typeOf(component),\n\t$id: component.props.id || new UUID(1),\n\t...layoutProps(component),\n\tstyle: component.props.style,\n\tchildren: isLayout(component) ? getLayoutModelChildren(component) : []\n})\n\nfunction getLayoutModelChildren(component){\n\tvar {children, contentModel=null} = component.props;\n\t// TODO don't recurse into children of non-layout\n\tif (React.isValidElement(children)){\n\t\t\treturn [getLayoutModel(children)];\n\t} else if (Array.isArray(children)){\n\t\t\treturn children.filter(child => child).map(child => getLayoutModel(child));\n\t} else if (contentModel !== null){\n\t\t\treturn [contentModel];\n\t} else {\n\t\t\treturn []; // is this safe ?\n\t}\n}\n\nexport function isLayout(element){\n\tif (typeof element !== 'string'){\n\t\t\telement = (element.type && element.type.displayName) ||\n\t\t\t\t\t(element.constructor && element.constructor.displayName);\n\t}\n\treturn isContainer(element);\n}\n\n\nexport function JSONfromComponent(component, parent, ignoreChildren){\n\n\tvar props = component.props;\n\tvar type;\n\tvar flexDirection;\n\n\tif (parent != null){\n\t\n\t\t// var parentType = (parent.type || parent.constructor).displayName;\n\t\t\n\t\t// var flexDirection = parent.props.flexDirection;\n\n\t\t// var dim = flexDirection === 'row' ? 'width' : 'height';\n\n\t}\n\t\n\tif (typeof component.type === 'function'){\n\t\ttype = component.type.displayName || component.type.name; \n\t}  \n\telse if (typeof component.type === 'string'){\n\t\ttype = component.type;\n\t}\n\telse if (component.constructor){\n\t\ttype = component.constructor.displayName; \n\t}\n\telse {\n\t\tdebugger;\n\t}\n\n\n\tvar json = { type, id: new UUID(1), flexDirection};\n\n\t// var props = component.props;\n\tvar propertyNames = Object.getOwnPropertyNames(props);\n\n\tpropertyNames.forEach(property => {\n\n\t\tif (property === 'children' && ignoreChildren !== true){\n\t\t\tvar content = json.content = [];\n\t\t\tReact.Children.forEach(props.children, child => \n\t\t\t\tcontent.push(JSONfromComponent(child,component))\n\t\t\t);\n\t\t}\n\t\telse if (property === 'style'){\n\t\t\tjson.style = shallowCloneObject(props.style);\n\t\t}\n\t\telse if (isSimpleType(typeof props[property])){\n\t\t\tjson[property] = props[property];\n\t\t}\n\t\t// EXPERIMENT\n\t\telse if (Array.isArray(props[property])){\n\t\t\tjson[property] = props[property];\n\t\t}\n\t\telse if (typeof props[property] === 'function'){\n\t\t\tconsole.log('How do we deal with function props like ' + property);\n\t\t\tjson[property] = props[property];\n\t\t}\n\t});\n\n\treturn json;\n}\n\nfunction isSimpleType(type){\n\treturn type === 'string' || type === 'number' || type === 'boolean';\n}\n\n// function isLayoutType(type){\n// \treturn type === 'FlexBox' || type === 'TabbedContainer';\n// }\n","import React from 'react';\n// import Icon from 'react-icons/lib/fa/ellipsis-v';\nimport './component-header.css';\n\nexport default class ComponentHeader extends React.Component {\n\n    render() {\n\n        var { style, fixed, minimized, onMouseDown, menu = true } = this.props;\n\n        return (\n            <header className=\"ComponentHeader\" onMouseDown={onMouseDown} style={style}>\n                <span className=\"title\">{this.props.title}</span>\n                {fixed && !minimized ? <span className=\"icon-pushpin\"></span> : null}\n                {menu && <button className=\"icon-menu\" data-key=\"menu\"\n                    onClick={e => this.handleMenuClick(e)}>\n                    {/* <Icon /> */}\n                </button>}\n            </header>\n        );\n    }\n\n    handleMenuClick(e){\n        if (this.props.onAction) {\n            this.props.onAction('menu', { left: e.clientX, top: e.clientY });\n        }\n    }\n\n}\n","import React from 'react';\nimport {ContextMenu, MenuItem, Separator} from '@heswell/ui-controls';\n\nexport default class ComponentContextMenu extends React.Component {\n\n\trender(){\n\n\t\treturn (\n\t\t\t<ContextMenu doAction={this.props.doAction}>\n\t\t\t\t{this.menuItems()}\n\t\t\t</ContextMenu>\n\t\t);\n\n\t}\n\n\tmenuItems(){\n\n\t\tvar {state, children:targetComponent} = this.props.component.props; // state is too vague\n\t\tvar minimized = state === 1;\n\t\tvar maximized = state === 2;;\n\t\tvar normal = !(maximized || minimized);\n\n\t\tconsole.log(`ComponentContextMenu.menuItems minimized=${minimized}`)\n\n\n\t\tvar menuItems = [];\n\n\t\t// menuItems.push(\t<MenuItem action=\"pin\" label=\"Fix Size\"/> );\n\t\tmenuItems.push(\t<MenuItem key=\"remove\" action=\"remove\" label=\"Remove\"/> );\n\t\tif (normal){\n\t\t\tmenuItems.push( \n\t\t\t\t<MenuItem key=\"minimize\" action=\"minimize\" label=\"Minimize\"/> ,\n\t\t\t\t<MenuItem key=\"maximize\" action=\"maximize\" label=\"Maximize\"/> );\n\t\t}\n\t\telse {\n\t\t\tmenuItems.push( <MenuItem key=\"restore\" action=\"restore\" label=\"Restore\"/> );\n\t\t} \t\n\n\t\tvar {contextMenuItems=[]} = targetComponent.props;\n\t\tconst componentMenuItems = contextMenuItems.map(({text, action}) =>\n\t\t\t<MenuItem key={action} action={action} label={text}/>\n\t\t); \n\t\tif (componentMenuItems.length){\n\t\t\tmenuItems.push(\t<Separator key=\"1\"/>, ...componentMenuItems );\n\t\t}\n\n\t\tmenuItems.push(\t\n\t\t\t<Separator key=\"1\"/>, \n\t\t\t<MenuItem key=\"settings\" action=\"settings\" label=\"Settings\"/> );\n\n\t\treturn menuItems;\n\t}\n\n\n}\n\n","export const DROP = 'DROP';\nexport const LAYOUT_REMOVE = 'LAYOUT_REMOVE';\nexport const LAYOUT_REPLACE = 'LAYOUT_REPLACE';\nexport const LAYOUT_SWITCH_TAB = 'LAYOUT_SWITCH_TAB';\nexport const LAYOUT_MODEL = 'LAYOUT_MODEL';\n\nexport const layoutModel = model => ({\n    type : LAYOUT_MODEL,\n    layoutModel: model\n});\n\n\nexport const drop = (draggedComponent, dropTarget) => ({\n    type:DROP,\n    draggedComponent,\n    dropTarget\n});\n\nexport const remove = targetNode => ({\n    type: LAYOUT_REMOVE,\n    targetNode\n});\n\nexport const replace = (targetNode, replacementNode) => ({\n    type:LAYOUT_REPLACE,\n    targetNode,\n    replacementNode\n});\n\nexport const switchTab = (path, idx, nextIdx) => ({\n    type:LAYOUT_SWITCH_TAB,\n    path,\n    idx,\n    nextIdx\n});","\nexport var positionValues = {\n    'north': 1,\n    'east': 2,\n    'south': 4,\n    'west': 8,\n    'header': 16,\n    'centre': 32,\n    'absolute': 64\n};\n\nexport var Position = Object.freeze({\n    'North': _position('north'),\n    'East': _position('east'),\n    'South': _position('south'),\n    'West': _position('west'),\n    'Header': _position('header'),\n    'Centre': _position('centre'),\n    'Absolute': _position('absolute')\n});\n\nfunction _position(str) {\n    return Object.freeze({\n        offset: str === 'north' || str === 'west' ? 0 : str === 'south' || str === 'east' ? 1 : NaN,\n        valueOf: function () { return positionValues[str]; },\n        toString: function () { return str; },\n        North: str === 'north',\n        South: str === 'south',\n        East: str === 'east',\n        West: str === 'west',\n        Header: str === 'header',\n        Centre: str === 'centre',\n        NorthOrSouth: str === 'north' || str === 'south',\n        EastOrWest: str === 'east' || str === 'west',\n        NorthOrWest: str === 'north' || str === 'west',\n        SouthOrEast: str === 'east' || str === 'south',\n        Absolute: str === 'absolute'\n    });\n}\n\nvar NORTH = Position.North,\n    SOUTH = Position.South,\n    EAST = Position.East,\n    WEST = Position.West,\n    HEADER = Position.Header,\n    CENTRE = Position.Centre;\n\nexport class BoxModel {\n\n    //TODO we should accept initial let,top offsets here\n    static measure(model) {\n        var measurements = {};\n        addMeasurements(model, measurements, 0, 0, 0, 0, 0, 0);\n        return measurements;\n    }\n\n    static smallestBoxContainingPoint(layout, measurements, x, y) {\n        return smallestBoxContainingPoint(layout, measurements, x, y);\n    }\n\n    static pointPositionWithinRect(x, y, rect) {\n\n        const width = rect.right - rect.left;\n        const height = rect.bottom - rect.top;\n        const posX = x - rect.left;\n        const posY = y - rect.top;\n        const pctX = posX / width;\n        const pctY = posY / height;\n\n        var closeToTheEdge;\n        var position;\n\n        const borderZone = 30;\n\n        if (rect.header && containsPoint(rect.header, x, y)) {\n            position = HEADER;\n        }\n        else {\n            const w = width * 0.4;\n            const h = height * 0.4;\n            const centerBox = { left: rect.left + w, top: rect.top + h, right: rect.right - w, bottom: rect.bottom - h }\n\n            if (containsPoint(centerBox, x, y)) {\n                position = CENTRE;\n            } else {\n\n                const quadrant = (pctY < 0.5 ? 'north' : 'south') + (pctX < 0.5 ? 'west' : 'east');\n\n                switch (quadrant) {\n                case 'northwest': position = (pctX > pctY) ? NORTH : WEST; break;\n                case 'northeast': position = ((1 - pctX) > pctY) ? NORTH : EAST; break;\n                case 'southeast': position = (pctX > pctY) ? EAST : SOUTH; break;\n                case 'southwest': position = ((1 - pctX) > pctY) ? WEST : SOUTH; break;\n                default:\n                }\n            }\n        }\n\n        // Set closeToTheEdge even when we have already established that we are in a Header.\n        // When we use position to walk the containment hierarchy, building the chain of\n        // dropTargets, the Header loses significance after the first dropTarget, but\n        // closeToTheEdge remains meaningful.\n        if (typeof borderZone === 'number') {\n            // var closeToTheEdge = 0;\n            if (posX < borderZone) closeToTheEdge += 8;\n            if (posX > width - borderZone) closeToTheEdge += 2;\n            if (posY < borderZone) closeToTheEdge += 1;\n            if (posY > height - borderZone) closeToTheEdge += 4;\n        }\n\n        // we might want to also know if we are in the center - this will be used to allow\n        // stack default option\n\n        return { position, x, y, pctX, pctY, closeToTheEdge };\n\n    }\n\n}\n\nfunction addMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    var componentMeasurements;\n\n    if (model) {\n\n        //onsole.log(`\\naddMeasurements\t\t\tx:${x}\ty:${y}\tpreX:${preX}\tposX:${posX}\tpreY:${preY}\tposY:${posY}   ${model.type} ${model.type === 'FlexBox' ? model.style.flexDirection :''} ${model.$path}`);\n\n        componentMeasurements = addClientMeasurements(model, measurements, x, y, preX, posX, preY, posY);\n\n        if (model.children) {\n            collectChildMeasurements(\n                model,\n                measurements,\n                model.layout.left + x,\n                model.layout.top + y,\n                preX, posX, preY, posY);\n        }\n\n    }\n\n    return componentMeasurements;\n\n}\n\nfunction addClientMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    var { $path, header } = model;\n    var { top, left, width, height } = model.layout;\n\n    left = x + left - preX;\n    top = y + top - preY;\n\n    var right = preX + left + width + posX;\n\n    measurements[$path] = {\n        top,\n        left,\n        right,\n        bottom: preY + top + height + posY\n    };\n\n    if (header || model.type === 'TabbedContainer') {\n        //TODO don't assume headerheight = 34\n        measurements[$path].header = { top, left, right, bottom: top + 34 };\n\n        if (model.type === 'TabbedContainer') {\n            console.log(`measuring a tabbedContainer ${$path}`);\n\n            const start = performance.now();\n            const tabMeasurements = measureTabs($path);\n            const end = performance.now();\n            console.log(`took ${end - start}ms to measure tabs`);\n            measurements[$path].tabs = tabMeasurements;\n\n        }\n    }\n\n    return measurements[$path];\n\n}\n\nfunction isSplitter(model) {\n    return model && model.type === 'Splitter';\n}\n\nfunction collectChildMeasurements(model, measurements, x, y, preX, posX, preY, posY) {\n\n    //onsole.log(`   collectChildMeasurements\tx:${x}\ty:${y}\tpreX:${preX}\tposX:${posX}\tpreY:${preY}\tposY:${posY}`);\n\n    var components = model.children\n        .reduce((arr, child, idx, all) => {\n\n            // generate a 'local' splitter adjustment for children adjacent to splitters\n            var localPreX = 0;\n            var localPosX = 0;\n            var localPreY = 0;\n            var localPosY = 0;\n\n            if (child.type !== 'Splitter') {\n\n                if (model.type === 'FlexBox') {\n\n                    var flexDirection = model.style.flexDirection;\n                    var prev = all[idx - 1];\n                    var next = all[idx + 1];\n                    var n = all.length - 1;\n\n                    if (flexDirection === 'row') {\n                        localPreX = idx === 0 ? preX : isSplitter(prev) ? prev.layout.width / 2 : 0;\n                        localPosX = idx === n ? posX : isSplitter(next) ? next.layout.width / 2 : 0;\n                        localPreY = preY;\n                        localPosY = posY;\n                    }\n                    else if (flexDirection === 'column') {\n                        localPreX = preX;\n                        localPosX = posX;\n                        localPreY = idx === 0 ? preY : isSplitter(prev) ? prev.layout.height / 2 : 0;\n                        localPosY = idx === n ? posY : isSplitter(next) ? next.layout.height / 2 : 0;\n                    }\n                }\n                else {\n                    localPreX = preX;\n                    localPosX = posX;\n                    localPreY = preY;\n                    localPosY = posY;\n                }\n\n                arr.push(addMeasurements(child, measurements, x, y, localPreX, localPosX, localPreY, localPosY));\n\n            }\n\n            return arr;\n        }, [])\n        .filter(c => c) // the dragging component will return undefined, unrendered tabbed children\n    // .sort(byPosition);\n\n\n    if (components.length) {\n        measurements[model.$path].children = components;\n    }\n\n}\n\n\nfunction smallestBoxContainingPoint(layout, measurements, x, y) {\n\n    //onsole.log('smallestBoxContainingPoint in ' + component.constructor.displayName);\n\n    var rect = measurements[layout.$path];\n    if (!containsPoint(rect, x, y)) return null;\n\n    if (!layout.children) {\n        return layout;\n    }\n\n\n    if (rect.header && containsPoint(rect.header, x, y)) {\n        return layout;\n    }\n\n    var subLayout;\n    var children = layout.children;\n\n    for (var i = 0; i < children.length; i++) {\n        if (layout.type === 'TabbedContainer' && layout.active !== i) {\n            continue;\n        }\n        if (subLayout = smallestBoxContainingPoint(children[i], measurements, x, y)) {\n            return subLayout;\n        }\n    }\n\n    return layout;\n}\n\n\nfunction containsPoint(rect, x, y) {\n\n    //\tif (component.props.isHidden || component.props.dragging === true) return false;\n    if (rect) {\n        return x >= rect.left && x < rect.right && y >= rect.top && y < rect.bottom;\n    }\n}\n\n// function byPosition(c1, c2) {\n//     if (c1.top < c2.top || c1.left < c2.left) return -1;\n//     if (c1.top > c2.top || c1.left > c2.left) return 1;\n//     return 0;\n// }\n\nfunction measureTabs(id) {\n    // Note the :scope selector is not supported on IE \n    return Array.from(document.getElementById(id).querySelectorAll(`:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab`))\n        .map(tab => tab.getBoundingClientRect())\n        .map(({ left, right }) => ({ left, right }))\n}\n","\nexport function followPath(model, path) {\n\n    if (path.indexOf(model.$path) !== 0) {\n        throw Error(`pathUtils.followPath path ${path} is not within model.path ${model.$path}`);\n    }\n\n    var route = path.slice(model.$path.length + 1);\n    if (route === '') {\n        return model;\n    }\n    var paths = route.split('.');\n\n    for (var i = 0; i < paths.length; i++) {\n\n        if (model.children === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children, so cannot fulfill rest of path ${paths.slice(i).join('.')}`);\n            return;\n        }\n\n        model = (model.children)[paths[i]];\n\n        if (model === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children that fulfill next step of path ${paths.slice(i).join('.')}`);\n            return;\n        }\n    }\n    return model;\n}\n\nexport function followPathToParent(layout, path) {\n\n    if (path === '0') return null;\n    if (path === layout.$path) return null;\n\n    return followPath(layout, path.replace(/.\\d+$/, ''));\n}\n\nexport function breadcrumb(model, path){\n    if (!model){\n        return [];\n    }\n    if (path.indexOf(model.$path) !== 0) {\n        throw Error(`pathUtils.breadcrumb path ${path} is not within model.path ${model.$path}`);\n    }\n\n    const result = [model];\n\n    const route = path.slice(model.$path.length + 1);\n    if (route === '') {\n        return result;\n    }\n\n    const paths = route.split('.');\n    for (var i = 0; i < paths.length; i++) {\n        if (model.children === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children, so cannot fulfill rest of path ${paths.slice(i).join('.')}`);\n            return [];\n        }\n        result.push(model = (model.children)[paths[i]]);\n        if (model === undefined) {\n            console.log(`model at 0.${paths.slice(0, i).join('.')} has no children that fulfill next step of path ${paths.slice(i).join('.')}`);\n            return [];\n        }\n    }\n    return result;\n}\n\nexport function adjustPath(path, removedPath, containerRemoved) {\n\n    var steps = path.split('.');\n    var rem = removedPath.split('.');\n\n    // pos needs to be first point at which paths differ, not necessarily last pos\n    var pos = forkPoint(steps, rem);\n    var remIdx = parseInt(rem[pos]);\n    var stepIdx = parseInt(steps[pos]);\n\n    if (pos === rem.length - 1) {\n\n        if (containerRemoved === 1) {\n            steps.splice(pos, 1);\n            return steps.join('.');\n        }\n        else if (containerRemoved === 2) {\n            steps.splice(pos - 1, 2);\n            var topLevelIdx = parseInt(rem[pos - 1], 10);\n            steps[pos - 1] = parseInt(steps[pos - 1]) + topLevelIdx;\n\n            return steps.join('.');\n        }\n\n        if (remIdx < stepIdx) {\n            steps[pos] = parseInt(steps[pos]) - 1;\n            return steps.join('.')\n        }\n\n    }\n\n    if (containerRemoved && remIdx === stepIdx) {\n        return path.replace(/.\\d+$/, '');\n    } else {\n        return path;\n    }\n}\n\nfunction forkPoint(path1, path2) {\n    var len = Math.min(path1.length, path2.length);\n\n    for (var i = 0; i < len; i++) {\n        if (path1[i] !== path2[i]) {\n            return i;\n        }\n    }\n    return -1;\n}\n\nexport function nextStep(pathSoFar, targetPath) {\n    if (pathSoFar === targetPath) {\n        return { idx: -1, finalStep: true };\n    }\n    var regex = new RegExp(`^${pathSoFar}.`);\n    // check that pathSoFar startsWith targetPath and if not, throw\n    var paths = targetPath.replace(regex, '').split('.').map(n => parseInt(n, 10));\n    return { idx: paths[0], finalStep: paths.length === 1 };\n}\n","export const FLEXBOX = 'FlexBox';\nexport const SURFACE = 'Surface';\nexport const TABBED_CONTAINER = 'TabbedContainer';\n","import React from 'react'\nimport yoga, { Node } from 'yoga-layout';\nimport {TABBED_CONTAINER, SURFACE} from './layoutTypes'\nimport { isContainer } from '../componentRegistry';\n\nconst NO_CHILDREN = [];\nconst NO_STYLE = {}\nconst CSS_DIGIT = '(\\\\d+)(?:px)?';\nconst CSS_MEASURE = `^(?:${CSS_DIGIT}(?:\\\\s${CSS_DIGIT}(?:\\\\s${CSS_DIGIT}(?:\\\\s${CSS_DIGIT})?)?)?)$`\nconst CSS_REX = new RegExp(CSS_MEASURE)\nconst BORDER_REX = /^(?:(\\d+)(?:px)\\ssolid\\s([a-zA-Z,0-9().]+))$/;\nconst ROW = 'row';\nconst COLUMN = 'column';\nconst FLEX_DIRECTION = {\n    [ROW]: yoga.FLEX_DIRECTION_ROW,\n    [COLUMN]: yoga.FLEX_DIRECTION_COLUMN\n}\nconst LAYOUT = 'layout';\nconst FLEXBOX = 'FlexBox';\nconst SPLITTER = 'Splitter';\n\nconst BORDER_STYLES = {\n    border: true,\n    borderWidth: true,\n    borderTopWidth: true,\n    borderRightWidth: true,\n    borderBottomWidth: true,\n    borderLeftWidth: true\n}\nconst BORDER_LIST = Object.keys(BORDER_STYLES);\n\nconst LAYOUT_STYLES = {\n    ...BORDER_STYLES,\n    margin: true,\n    marginTop: true,\n    marginRight: true,\n    marginBottom: true,\n    marginLeft: true,\n    padding: true,\n    paddingTop: true,\n    paddingRight: true,\n    paddingBottom: true,\n    paddingLeft: true\n}\n\nconst LAYOUT_LIST = Object.keys(LAYOUT_STYLES);\n\nexport function layoutStyleDiff(style1, style2){\n    if (!style1 && !style2){\n        return false;\n    } else if (style1 && !style2){\n        return LAYOUT_LIST.some(style => style1[style]);\n    } else if (style2 && !style1){\n        return LAYOUT_LIST.some(style => style2[style]);\n    } else {\n        return LAYOUT_LIST.some(style => style1[style] !== style2[style]);\n    }\n}\n\nexport function stripLayout(model){\n    return {\n        ...model,\n        layout: undefined,\n        children: model.children\n            ? model.children.map(child => stripLayout(child))\n            : undefined\n    }\n}\nexport function computeLayout(model, width, height, top=0, left=0, path){\n    const tree = createTree(model, path || model.$path);\n    const layoutModel = createYogaTree(tree);\n    layoutModel.node.calculateLayout(width, height, yoga.DIRECTION_LTR);\n    setLayout(layoutModel)\n    layoutModel.node.freeRecursive();\n\n    if (left !== 0){\n        layoutModel.layout.left += left\n    }\n    if (top !== 0){\n        layoutModel.layout.top += top\n    }\n    return layoutModel;\n}\n\nfunction createTree(model, path='0'){\n    return {\n        ...model,\n        $path: path,\n        // TODO normalize style\n        style: normalizeLayoutStyles(model.style),\n        // style: expandStyle(model.style),\n        children: expandChildren(model, path)\n    }\n}\n\nfunction expandChildren({type, children}, path){\n    if (children){\n        var splitters = type === FLEXBOX\n            ? getSplitterPositions(children)\n            : NO_CHILDREN;\n\n        return children.reduce((list, child, i) => {\n            if (splitters[i]) {\n                list.push({\n                    type: 'Splitter',\n                    $path: `${path}.${list.length}`,\n                    style: {flex: '0 0 6px', backgroundColor: 'black'}\n                });\n            }\n            list.push(createTree(child, `${path}.${list.length}`));\n            return list;\n        },[])\n    }\n}\n\nconst NO_BORDERS = [0,null];\n// todo cache values\nexport function getCSSBorderProperties(style){\n    if (style && typeof style.border === 'string'){\n        const match = BORDER_REX.exec(style.border);\n        if (match !== null){\n            const [,borderWidth,color] = match;\n            return [parseInt(borderWidth,10),color];\n        }\n    }\n    return NO_BORDERS;\n}\n\n// TODO merge the following two functions\nexport function normalizeLayoutStyles({margin, marginTop, marginRight, marginBottom, marginLeft,\n    padding, paddingTop, paddingRight, paddingBottom, paddingLeft, ...style}=NO_STYLE){\n\n    if (typeof margin === 'number'){\n        style.marginTop = style.marginRight = style.marginBottom = style.marginLeft = margin;\n    } else if (typeof margin === 'string'){\n        const match = CSS_REX.exec(margin);\n        if (match === null){\n            console.error(`Invalid css value for margin '${margin}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                style.marginTop = parseInt(pos1,10);\n                style.marginRight = parseInt(pos2,10);\n                style.marginBottom = parseInt(pos3,10);\n                style.marginLeft = parseInt(pos4,10);\n            } else if (pos123){\n                style.marginTop = parseInt(pos1,10);\n                style.marginRight = style.marginLeft = parseInt(pos2,10);\n                style.marginBottom = parseInt(pos3,10);\n            } else if (pos1 && pos2){\n                style.marginTop = style.marginBottom = parseInt(pos1,10);\n                style.marginRight = style.marginLeft =parseInt(pos2,10);\n            } else {\n                style.marginTop = style.marginRight = style.marginBottom = style.marginLeft = parseInt(pos1,10);\n            }\n        }\n    }\n    if (typeof marginTop === 'number') style.marginTop = marginTop;\n    if (typeof marginRight === 'number') style.marginRight = marginRight;\n    if (typeof marginBottom === 'number') style.marginBottom = marginBottom;\n    if (typeof marginLeft === 'number') style.marginLeft = marginLeft;\n\n    if (typeof padding === 'number'){\n        style.paddingTop = style.paddingRight = style.paddingBottom = style.paddingLeft = padding;\n    } else if (typeof padding === 'string'){\n        const match = CSS_REX.exec(padding);\n        if (match === null){\n            console.error(`Invalid css value for padding '${padding}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                style.paddingTop = parseInt(pos1,10);\n                style.paddingRight = parseInt(pos2,10);\n                style.paddingBottom = parseInt(pos3,10);\n                style.paddingLeft = parseInt(pos4,10);\n            } else if (pos123){\n                style.paddingTop = parseInt(pos1,10);\n                style.paddingRight = style.paddingLeft = parseInt(pos2,10);\n                style.paddingBottom = parseInt(pos3,10);\n            } else if (pos1 && pos2){\n                style.paddingTop = style.paddingBottom = parseInt(pos1,10);\n                style.paddingRight = style.paddingLeft =parseInt(pos2,10);\n            } else {\n                style.paddingTop = style.paddingRight = style.paddingBottom = style.paddinggLeft = parseInt(pos1,10);\n            }\n        }\n    }\n    if (typeof paddingTop === 'number') style.paddingTop = paddingTop;\n    if (typeof paddingRight === 'number') style.paddingRight = paddingRight;\n    if (typeof paddingBottom === 'number') style.paddingBottom = paddingBottom;\n    if (typeof paddingLeft === 'number') style.paddingLeft = paddingLeft;\n\n    return normalizeBorderStyle(style);\n}\n\nfunction normalizeBorderStyle(style=NO_STYLE){\n\n    if (BORDER_LIST.some(bs => style[bs])){\n        let match;\n\n        let {border, borderWidth, borderTopWidth, borderRightWidth, borderBottomWidth, borderLeftWidth, borderColor, ...rest} = style;\n\n        if (border || borderWidth || borderTopWidth || borderRightWidth || borderBottomWidth || borderLeftWidth){\n            if (typeof border === 'string' && (match = BORDER_REX.exec(border))){\n                // what if both border and borderWidth are specified ?\n                ([,borderWidth,borderColor] = match);\n            }\n\n            if (borderWidth){\n                borderTopWidth = borderTopWidth === undefined ? borderWidth : borderTopWidth;\n                borderRightWidth = borderRightWidth === undefined ? borderWidth : borderRightWidth;\n                borderBottomWidth = borderBottomWidth === undefined ? borderWidth : borderBottomWidth;\n                borderLeftWidth = borderLeftWidth === undefined ? borderWidth : borderLeftWidth;\n            }\n\n            borderColor = borderColor || 'black';\n            const boxShadow = `\n                ${borderColor} ${borderLeftWidth || 0}px ${borderTopWidth || 0}px 0 0 inset, \n                ${borderColor} ${-borderRightWidth || 0}px ${-borderBottomWidth || 0}px 0 0 inset`;\n\n            return {\n                ...rest,\n                boxShadow,\n                borderColor,\n                borderStyle: 'solid',\n                borderTopWidth,\n                borderRightWidth,\n                borderBottomWidth,\n                borderLeftWidth\n            }\n\n        } else {\n            return style\n        }\n    } else {\n        return style;\n    }\n}\n\nconst DEFAULT_HEADER = {height: 32, style: {backgroundColor: 'brown'}}\n// we may mutate the tree in here\nfunction createYogaTree(model, parent, idx){\n\n    let {style=NO_STYLE, children=NO_CHILDREN} = model;\n    const {type, layout=null} = model;\n    const {flexDirection=null, left=null, top=null, width=null, height=null, flex=null} = style;\n    const parentIsTabbedContainer = parent && parent.type === TABBED_CONTAINER;\n    const parentIsSurface = parent && parent.type === SURFACE;\n    const header = model.header === true\n        ? DEFAULT_HEADER\n        : typeof model.header === 'object'\n            ? {...DEFAULT_HEADER, ...model.header}\n            : null\n\n    if (type !== LAYOUT && type !== SPLITTER && children.length === 0 && !isContainer(type)){\n        style = {\n            ...style,\n            display: 'flex',\n            flexDirection: 'column'\n        }\n        // children has to be created inline as it will be mutated by yoga\n        model.children = children = [{type: LAYOUT, style: {flex: 1}}]\n    } else if (children.length === 1 && children[0].type === LAYOUT){\n        style = {\n            ...style,\n            display: 'flex',\n            flexDirection: 'column'\n        }\n        // children has to be created inline as it will be mutated by yoga\n        model.children = children = [{type: LAYOUT, style: {flex: 1}}]\n    }\n\n    let node = Node.create();\n\n    if (header){\n        //TODO we need to have normalized the css before we do this, otw a padding string value will ignore the paddingtop\n        style = increaseCSSMeasure(style, 'padding', header.height, 'top');\n    }\n\n    setCSSMeasure(node, style, 'margin');\n    setCSSMeasure(node, style, 'border');\n    setCSSMeasure(node, style, 'padding');\n\n    if (flexDirection !== null){\n        node.setDisplay(yoga.DISPLAY_FLEX);\n        node.setFlexDirection(FLEX_DIRECTION[flexDirection]);\n        node.setAlignItems(yoga.ALIGN_STRETCH); //TODO allow this to be overridden\n    } else if (type === TABBED_CONTAINER){\n        node.setDisplay(yoga.DISPLAY_FLEX);\n        node.setFlexDirection(yoga.FLEX_DIRECTION_ROW);\n        node.setAlignItems(yoga.ALIGN_STRETCH);\n    }\n\n    if (parentIsTabbedContainer){\n        const {active=0} = parent;\n        if (idx !== active){\n            node.setDisplay(yoga.DISPLAY_NONE);\n        } else {\n            node.setFlexGrow(1);\n            node.setFlexShrink(1);\n            node.setFlexBasis(0);\n            node.setMargin(yoga.EDGE_TOP,34)\n        }\n    } /*else if (parentHasHeader){\n        node.setMargin(yoga.EDGE_TOP,32); // how do we determine the header height\n    }*/\n\n    if (layout !== null && !parentIsSurface){\n        // if we already have a layout, we reapply it, by transforming it into a style specification. This allows us to\n        // manipulate the layout outside and preserve changes when we resize. If size has not changed, there is no need\n        // to re-compute layout\n        const {width: w, height: h} = layout;\n        if (model.type === 'Splitter'){\n            node.setFlexGrow(0);\n            node.setFlexShrink(0);\n            node.setFlexBasis(6);\n        } else {\n            node.setFlexGrow(1);\n            node.setFlexShrink(1);\n            node.setFlexBasis(getFlexDirection(parent) === ROW ? w : h); // need to know parent orientation\n        }\n    } else if (flex !== null){\n        // TODO how do we default the flex values\n        if (typeof flex === 'string'){\n            const [flexGrow, flexShrink, flexBasis] = flex.split(' ');\n            node.setFlexGrow(parseInt(flexGrow,0));\n            node.setFlexShrink(parseInt(flexShrink,0));\n            node.setFlexBasis(parseInt(flexBasis,0));\n        } else if (typeof flex === 'number'){\n            node.setFlexGrow(flex);\n            node.setFlexShrink(flex);\n            node.setFlexBasis(0);\n        }\n    } else {\n        if (parentIsSurface){\n            node.setPositionType(yoga.POSITION_TYPE_ABSOLUTE);\n        }\n        if (top !== null && left !== null){\n            node.setPosition(yoga.EDGE_TOP, top);\n        }\n        if (left !== null){\n            node.setPosition(yoga.EDGE_START, left);\n        }\n        if (width !== null){\n            node.setWidth(width)\n        }\n        if (height !== null){\n            node.setHeight(height)\n        }\n    }\n\n    children.forEach((child,i) => {\n        const expandedChild = createYogaTree(child, model, i);\n        node.insertChild(expandedChild.node,i);\n    })\n\n    model.node = node\n    return model;\n}\n\nfunction getFlexDirection(model){\n    const style = (model && model.style) || NO_STYLE;\n    return style.flexDirection || ROW;\n}\n\nfunction getSplitterPositions(children) {\n\n    var ret = [];\n\n    for (var i = 1; i < children.length; i++) {\n\n        var thisFlexible = isFlexible(children[i]);\n        var lastFlexible = isFlexible(children[i - 1]);\n\n        if (isSplitter(children[i]) || isSplitter(children[i - 1])) {\n            ret[i] = false;\n        } else if (thisFlexible && lastFlexible) {\n            ret[i] = true;\n        } else if (!(thisFlexible || lastFlexible)) {\n            ret[i] = false;\n        } else if (lastFlexible && children.slice(i + 1).some(isFlexible)) {\n            ret[i] = true;\n        } else if (thisFlexible && children.slice(0, i).some(isFlexible)) {\n            ret[i] = true;\n        } else {\n            ret[i] = false;\n        }\n\n    }\n\n    return ret;\n\n}\n\nfunction isSplitter(model){\n    return model.type === 'Splitter';\n}\n\nfunction isFlexible(model){\n    return model.resizeable;\n}\n\nexport function elementsFromLayout(model){\n    const {style: {backgroundColor}=NO_STYLE, layout: {top,left,width,height},children=NO_CHILDREN} = model;\n    const style = {position: 'absolute', backgroundColor, top, left, width, height};\n    return React.createElement('div', {key: model.$path,style,onClick: model.onClick}, children.map(elementsFromLayout));\n}\n\nexport function setLayout(model){\n    model.layout = model.node.getComputedLayout();\n    model.children && model.children.forEach(child => setLayout(child))\n}\n\nconst CSS_MEASURE_SETTERS = {\n    'margin': 'setMargin',\n    'padding': 'setPadding',\n    'border': 'setBorder'\n}\nconst CSS_MEASURES = {\n    border: {measureTop: 'borderTopWidth', measureRight: 'borderRightWidth', measureBottom: 'borderBottomWidth', measureLeft: 'borderLeftWidth'},\n    margin: {measureTop: 'marginTop', measureRight: 'marginRight', measureBottom: 'marginBottom', measureLeft: 'marginLeft'},\n    padding: {measureTop: 'paddingTop', measureRight: 'paddingRight', measureBottom: 'paddingBottom', measureLeft: 'paddingLeft'}\n}\n\nfunction increaseCSSMeasure(style, measure, value, edge){\n    if (measure === 'padding'){\n        if (edge === 'top'){\n            if (style.paddingTop){\n                style = {...style, paddingTop: style.paddingTop + value}\n            } else if (typeof style.padding === 'number'){\n                const {padding, ...rest} = style;\n                style = {\n                    ...rest,\n                    paddingTop: padding + value,\n                    paddingRight: padding,\n                    paddingBottom: padding,\n                    paddingLeft: padding\n                }\n            } else {\n                style = {...style, paddingTop: value}\n            }\n        }\n    }\n    return style;\n}\nfunction setCSSMeasure(node, style, measure){\n\n    const setMeasure = CSS_MEASURE_SETTERS[measure];\n    const value = style[measure];\n\n    if (typeof value === 'number'){\n        node[setMeasure](yoga.EDGE_ALL, value);\n    } else if (typeof value === 'string'){\n        const match = CSS_REX.exec(value)\n        if (match === null){\n            console.error(`Invalid css value for ${measure} '${value}'`)\n        } else {\n            const [, pos1, pos2, pos3, pos4] = match;\n            const pos123 = pos1 && pos2 && pos3\n            if (pos123 && pos4){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos3,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos4,10));\n            } else if (pos123){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos3,10));\n            } else if (pos1 && pos2){\n                node[setMeasure](yoga.EDGE_TOP, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_BOTTOM, parseInt(pos1,10));\n                node[setMeasure](yoga.EDGE_START, parseInt(pos2,10));\n                node[setMeasure](yoga.EDGE_END, parseInt(pos2,10));\n            } else {\n                node[setMeasure](yoga.EDGE_ALL, parseInt(pos1,10));\n            }\n        }\n    } else {\n        const {measureTop, measureRight, measureBottom, measureLeft} = CSS_MEASURES[measure];\n        if (style[measureTop]) node[setMeasure](yoga.EDGE_TOP, style[measureTop]);\n        if (style[measureRight]) node[setMeasure](yoga.EDGE_END, style[measureRight]);\n        if (style[measureBottom]) node[setMeasure](yoga.EDGE_BOTTOM, style[measureBottom]);\n        if (style[measureLeft]) node[setMeasure](yoga.EDGE_START, style[measureLeft]);\n\n    }\n\n}\n","\nimport { followPath, followPathToParent, nextStep } from './pathUtils';\nimport { computeLayout as computeLayoutYoga } from './layoutUtils';\nconst UUID = require('pure-uuid');\n\nconst EMPTY_OBJECT = {};\n\nexport function containerOf(layout, target) {\n\n    if (target === layout) {\n        return null;\n    } else {\n\n        let { idx, finalStep } = nextStep(layout.$path, target.$path);\n        if (finalStep) {\n            return layout;\n        } else if (layout.children === undefined || layout.children[idx] === undefined) {\n            return null;\n        } else {\n            return containerOf(layout.children[idx], target);\n        }\n    }\n}\n\nexport function handleLayout(model, command, options) {\n\n    // This is called during splitter resize to resize children of model\n    if (command === 'resize') {\n        return resizeLayout(model, options);\n    } else if (command === 'replace') {\n        return replaceChild(model, options.targetNode, options.replacementNode);\n    } else if (command === 'remove') {\n        const result = removeChild(model, options.targetNode);\n        return result;\n    }\n    // else if (command === 'config-change'){\n    //     return Layout.config(layout, options);\n    // }\n    else if (command === 'switch-tab') {\n        return switchTab(model, options);\n    }\n    // else if (command === 'minimize'){\n    //     return Layout.minimize(layout, options);\n    // }\n    // else if (command === 'maximize'){\n    //     return Layout.maximize(layout, options);\n    // }\n    // else if (command === 'restore'){\n    //     return Layout.restore(layout, options);\n    //}\n    else if (command === 'drop') {\n        return drop(model, options);\n    }\n\n}\n\nexport function layout(model, position = {}, path = '0', visibility = 'visible', force = false, active) {\n\n    function firstNumber(n1, n2, n3) {\n        return typeof n1 === 'number' ? Math.round(n1) : typeof n2 === 'number' ? n2 : n3;\n    }\n\n    function firstDefined(n1, n2, n3) {\n        return n1 !== undefined\n            ? (typeof n1 === 'number' ? Math.round(n1) : n1)\n            : n2 !== undefined ? n2 : n3;\n    }\n\n    var style = model.style || {};\n    var top = firstNumber(position.top, style.top, 0);\n    var left = firstNumber(position.left, style.left, 0);\n    var width = firstDefined(position.width, style.width, 0);\n    var height = firstDefined(position.height, style.height, 0);\n\n    var { layout, ...m } = model;\n\n    if (layout && force !== true) {\n        if (path === model.$path &&\n            width === layout.width &&\n            height === layout.height &&\n            top === layout.top &&\n            left === layout.left &&\n            (visibility === undefined || visibility === model.style.visibility) &&\n            (active === undefined || active === model.active)) {\n\n            return model;\n        }\n    }\n\n    //TODO how do we make this model pluggable\n\n    switch (model.type) {\n    case 'FlexBox': return flexLayout(m, path, top, left, width, height, visibility, active);\n    case 'TabbedContainer': return flexLayout(m, path, top, left, width, height, visibility, active);\n    case 'Surface': return flexLayout(m, path, top, left, width, height, visibility, active);\n    default: return flexLayout(m, path, top, left, width, height, visibility, active);\n    }\n\n}\n\nfunction flexLayout(model, path, top, left, width, height, visibility, active) {\n\n    if (typeof active === 'number' && active !== model.isActive){\n        model = {\n            ...model,\n            active\n        }\n    }\n    return computeLayoutYoga(model, width, height, top, left, path);\n}\n\nfunction switchTab(layoutModel, { path, nextIdx }) {\n\n    var container = followPath(layoutModel, path);\n    // var content = container.children.slice();\n    // we need to set height of selected child, even if it is not needed for \n    // rendering - children will inherit the value;\n    // content[nextIdx] = content[nextIdx].set({height: content[idx].height});\n    // content[idx] = content[idx].set({height:0});\n    var { $path, visibility='visible' } = container;\n    var newContainer = layout(container, container.layout, $path, visibility, false, nextIdx);\n\n    return replaceChild(layoutModel, container, newContainer)\n\n}\n\nfunction drop(layoutModel, options) {\n\n    var { draggedComponent: source, dropTarget: { component: target, pos, tabIndex = -1 } } = options;\n\n    if (pos.position.Header) {\n        if (target.type === 'TabbedContainer') { //onsole.log('CASE 2 Works)');\n            let before, after;\n            if (tabIndex === -1) {\n                after = target.children[target.children.length - 1];\n            } else {\n                before = target.children[tabIndex];\n            }\n            return transform(layoutModel, { insert: { source, before, after } });\n        } else { //onsole.log('CASE 2B Works)'); \n            return transform(layoutModel, { wrap: { target, source, pos } });\n        }\n    } else if (pos.position.Centre) {\n        //onsole.log(JSON.stringify(source,null,2))\n        // source = clone(source, {style:{position:null,transform:null,transformOrigin:null}});\n        return replaceChild(layoutModel, followPath(layoutModel, target.$path), source);\n    } else {\n        return dropLayoutIntoContainer(layoutModel, pos, source, target);\n    }\n\n}\n\nfunction dropLayoutIntoContainer(layoutModel, pos, source, target) {\n\n    var targetContainer = followPathToParent(layoutModel, target.$path);\n\n    if (absoluteDrop(target, pos.position)) {\n        return transform(layoutModel, { insert: { source, target, pos } });\n    } else if (target === layoutModel || isDraggableRoot(layoutModel, target)) {\n        // Can only be against the grain...\n        if (withTheGrain(pos, target)) {\n            throw Error('How the hell did we do this');\n        } else { //onsole.log('CASE 4A) Works');\n            //return transform(layout, { wrap: {target, source, pos }, releaseSpace}); \n        }\n    } else if (withTheGrain(pos, targetContainer)) {\n        if (pos.position.SouthOrEast) { //onsole.log(`CASE 4B) Works. Insert into container 'with the grain'`);\n            return transform(layoutModel, { insert: { source, after: target, pos } });\n        } else { //onsole.log('CASE 4C) Works');\n            return transform(layoutModel, { insert: { source, before: target, pos } });\n        }\n    } else if (againstTheGrain(pos, targetContainer)) { //onsole.log('CASE 4D) Works.');\n        return transform(layoutModel, { wrap: { target, source, pos } });\n    } else if (isContainer(targetContainer)) {\n        return transform(layoutModel, { wrap: { target, source, pos } });\n    } else {\n        console.log('no support right now for position = ' + pos.position);\n    }\n    return layoutModel;\n\n}\n\nfunction transform(layoutModel, options) {\n\n    var nodeToBeInserted;\n    var nodeAfterWhichToInsert;\n    var nodeBeforeWhichToInsert;\n    var targetContainer;\n    var nodeSize;\n\n    for (var op in options) {\n        var opts = options[op];\n        switch (op) {\n\n        case 'insert':\n\n            nodeToBeInserted = opts.source;\n\n            nodeSize = opts.pos ? (opts.pos.width || opts.pos.height) : undefined;\n\n            if (opts.before) {\n                //onsole.log(`transform: insert before ` + opts.before.$path);\n                nodeBeforeWhichToInsert = opts.before.$path;\n            } else if (opts.after) {\n                //onsole.log(`transform: insert after ` + opts.after.$path);\n                nodeAfterWhichToInsert = opts.after.$path;\n            } else {\n                targetContainer = opts.target.$path;\n            }\n\n            break;\n\n        case 'wrap':\n\n            layoutModel = wrap(layoutModel, opts.source, opts.target, opts.pos);\n\n            break;\n        default:\n\n        }\n    }\n\n    if (nodeToBeInserted) {\n        layoutModel = insert(layoutModel, nodeToBeInserted, targetContainer, nodeBeforeWhichToInsert, nodeAfterWhichToInsert, nodeSize);\n    }\n\n    return layoutModel;\n\n}\n\nfunction insert(model, source, into, before, after, size) {\n    const target = before || after || into;\n    let { $path, /*active,*/ type, style, children } = model;\n    let { idx, finalStep } = nextStep($path, target);\n\n    // One more step needed when we're inserting 'into' a container\n    var oneMoreStepNeeded = finalStep && into && idx !== -1;\n\n    if (finalStep && !oneMoreStepNeeded) {\n\n        const flexBox = type === 'FlexBox';\n        const dim = flexBox && (style.flexDirection === 'row' ? 'width' : 'height');\n\n        if (type === 'Surface' && idx === -1) {\n            children = children.concat(source);\n        } else {\n\n            children = children.reduce((arr, child, i/*, all*/) => {\n                // idx of -1 means we just insert into end \n                if (idx === i) {\n                    if (flexBox) {\n                        var size = (child.layout[dim] - 6) / 2;\n                        child = {\n                            ...child,\n                            layout: {...child.layout, [dim]: size}};\n                        const flex = source.style.flex === undefined ? 1 : source.style.flex;\n                        source = {\n                            ...source,\n                            layout: {...source.layout, [dim]: size},\n                            style: {...source.style, flex, position: null, transform: null, transformOrigin: null}\n                        };\n                    } else {\n                        source = {...source, style: {...source.style, position: null, transform: null, transformOrigin: null}};\n                    }\n                    if (before) {\n                        arr.push(source, child);\n                    } else {\n                        arr.push(child, source);\n                    }\n                } else {\n                    arr.push(child);\n                }\n                return arr;\n            }, []);\n        }\n    } else {\n        children = model.children.slice();\n        children[idx] = insert(children[idx], source, into, before, after, size);\n    }\n\n    const {layout: modelLayout} = model;\n    return layout({...model, children}, modelLayout, model.$path)\n\n}\n\n// this is replaceChild with extras\nfunction wrap(model, source, target, pos) {\n\n    var { idx, finalStep } = nextStep(model.$path, target.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n        var { type, flexDirection } = getLayoutSpec(pos); // roll dim into this\n        var dim = flexDirection === 'row' ? 'width' : 'height';\n\n        var active = type === 'TabbedContainer' || pos.position.SouthOrEast ? 1 : 0;\n        var $path = `${model.$path}.${idx}`;\n        target = children[idx];\n        var style = { position: null, transform: null, transformOrigin: null, flex: 1 };\n        var size = (target.layout[dim] - 6) / 2;\n        var childLayout = { [dim]: size };\n        var wrapperStyle = { flexDirection };\n        if (target.style.flex) {\n            wrapperStyle.flex = target.style.flex;\n        }\n\n        // need to roll resizeable into the layoutModel. else we lose it here\n        var wrapper = layout({\n            type,\n            $path,\n            active,\n            $id: new UUID(1),\n            style: wrapperStyle,\n            layout: target.layout,\n            resizeable: target.resizeable,\n            children: (pos.position.SouthOrEast || pos.position.Header)\n                ? [{...target, $path: `${$path}.0`, style: {...target.style, ...style}, layout: childLayout},\n                    {...source, $path: `${$path}.1`, style: {...source.style, ...style}, layout: childLayout}]\n                : [{...source, $path: `${$path}.0`, style: {...source.style, ...style}, layout: childLayout},\n                    {...target, $path: `${$path}.1`, style: {...target.style, ...style}, layout: childLayout}]\n        },\n        target.layout,\n        $path,\n        'visible',\n        true);\n\n        children.splice(idx, 1, wrapper);\n\n    } else {\n        children[idx] = wrap(children[idx], source, target, pos);\n    }\n\n    const {layout: modelLayout} = model;\n    // we call layout too many times by invoking it at this level\n    return layout({...model, children}, modelLayout, model.$path)\n\n}\n\nfunction resizeLayout(model, { path, measurements, dimension }) {\n\n    const target = followPath(model, path);\n    const position = dimension === 'width' ? 'left' : 'top';\n    let shift = 0;\n\n    const resizedTarget = layout({\n        ...model,\n        children: model.children.map((child,i) => {\n            const {layout} = child;\n            const measurement = measurements[i];\n            const { [dimension]: dim } = layout;\n            if (dim === measurement && shift === 0) {\n                return child;\n            } else {\n                const newLayout = { ...layout, [dimension]: measurement, [position]: layout[position] + shift };\n                shift += (measurement - dim);\n                return {\n                    ...child,\n                    layout: newLayout\n                };\n            }\n        })\n    }, model.layout, model.$path);\n\n    return replaceChild(model, target, resizedTarget);\n\n}\n\nfunction simpleClone(o1, o2, unversioned) {\n\n    if (o2 === undefined) {\n        return o1;\n    }\n\n    var result = {};\n    var value1;\n    var value2;\n    var property;\n    var versionIncrement = unversioned === true ? 0 : 1;\n\n    // copy forward existing properties, making replacements and deletions...\n    for (property in o1) {\n\n        value1 = o1[property];\n        value2 = o2[property];\n\n\n        if (property === '$version') {\n            result.$version = value1 + versionIncrement;\n        } else if (property === 'style') {\n            result.style = simpleClone(value1, value2);\n        } else if (value2 !== null) {\n            if (typeof value2 !== 'undefined') {\n                result[property] = value2;\n            } else {\n                result[property] = o1[property];\n            }\n        }\n    }\n\n    /// ...then add new properties \n    for (property in o2) {\n        if (o2[property] !== null && (typeof result[property] === 'undefined')) {\n            result[property] = o2[property];\n        }\n    }\n\n    return result;\n\n}\n\nfunction clone(model, overrides, unversioned) {\n\n    var { /*type, $version,*/ style: s1, ...rest1 } = model;\n    var { style: s2 = EMPTY_OBJECT, ...rest2 } = overrides;\n\n    if (noEffectiveOverrides(s1, s2) && noEffectiveOverrides(rest1, rest2)) {\n        return model;\n    }\n\n    return simpleClone(model, overrides, unversioned);\n\n}\n\nfunction noEffectiveOverrides(source, overrides) {\n    var properties = Object.getOwnPropertyNames(overrides);\n    for (var i = 0; i < properties.length; i++) {\n        if (overrides[properties[i]] !== source[properties[i]]) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction removeChild(model, child) {\n\n    var { idx, finalStep } = nextStep(model.$path, child.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n\n        if (idx > 0 && isSplitter(children[idx - 1])) {\n            children.splice(idx - 1, 2);\n        } else if (idx === 0 && isSplitter(children[1])) {\n            children.splice(0, 2);\n        } else {\n            children.splice(idx, 1);\n        }\n\n        var { layout: modelLayout, $path/*, active */} = model;\n\n        if (children.length === 1 && model.type.match(/FlexBox|TabbedContainer/)) {\n            // certain style attributes from the parent must be passed down to the \n            // replacement child, eg flex - are there others ?\n            const { flex } = model.style;\n            return layout(clone(children[0], { style: { flex } }, true), modelLayout, $path);\n        } else {\n            var { top, left, width, height } = modelLayout;\n            // var props = {};\n            //var nowActive = active;\n            // if (active === children.length) {\n            //     nowActive = props.active = active - 1;\n            // }\n            const result = layout({\n                ...model,\n                children\n            }, {top, left, width, height}, model.$path);\n            return result;\n\n        }\n    } else {\n        children[idx] = removeChild(children[idx], child);\n    }\n\n    children = children.map((child, i) => {\n        var $path = `${model.$path}.${i}`;\n        return child.$path === $path ? child : clone(child, { $path });\n    })\n\n    return clone(model, { children })\n\n}\n\nfunction replaceChild(model, child, replacement) {\n\n    if (replacement.$path === model.$path) {\n        return replacement;\n    }\n\n    var { idx, finalStep } = nextStep(model.$path, child.$path);\n\n    var children = model.children.slice();\n\n    if (finalStep) {\n\n        if (Array.isArray(replacement)) {\n            //TODO - make this right\n            // var dim = model.style.flexDirection === 'row' ? 'width' : 'height';\n            // var dim1 = child.layout[dim];\n            // replacement = replacement.map((l, i) => {\n            //     opts[dim] = dim1 / replacement.length;\n            //     return clone(l, { $path: `${model.$path}.${idx + i}` })\n            // });\n            // [].splice.apply(children, [idx, 1].concat(replacement));\n\n        } else {\n            children[idx] = {\n                ...replacement,\n                layout: {...child.layout}\n            };\n        }\n\n    } else {\n        children[idx] = replaceChild(children[idx], child, replacement);\n    }\n\n    return layout({...model, children}, model.layout, model.$path)\n}\n\n// Note: withTheGrain is not the negative of againstTheGrain - the difference lies in the \n// handling of non-Flexible containers, the response for which is always false;\nfunction withTheGrain(pos, container) {\n\n    return pos.position.NorthOrSouth ? isTower(container)\n        : pos.position.EastOrWest ? isTerrace(container)\n            : false;\n}\n\nfunction againstTheGrain(pos, layout) {\n\n    return pos.position.EastOrWest ? isTower(layout) || isTabset(layout)\n        : pos.position.NorthOrSouth ? isTerrace(layout) || isTabset(layout)\n            : false;\n\n}\n\nfunction absoluteDrop(target, position) {\n    return target.type === 'Surface' && position.Absolute;\n}\n\nfunction isSplitter(model) {\n    return model && model.type === 'Splitter';\n}\n\nfunction isContainer(model) {\n    return model.type === 'Container' || model.type === 'DynamicContainer';\n}\n\nfunction isTabset(model) {\n    return model.type === 'TabbedContainer';\n}\n\nfunction isTower(model) {\n    return model.type === 'FlexBox' && model.style.flexDirection === 'column';\n}\n\nfunction isTerrace(model) {\n    return model.type === 'FlexBox' && model.style.flexDirection === 'row';\n}\n\nfunction isDraggableRoot(layout, component) {\n\n    if (component.$path === '0') {\n        return true;\n    }\n\n    var container = containerOf(layout, component);\n    if (container) {\n        return container.type === 'App';\n    } else {\n        debugger;\n    }\n}\n\nfunction getLayoutSpec(pos) {\n    var type, flexDirection;\n\n    if (pos.position.Header) {\n        type = 'TabbedContainer';\n        flexDirection = 'column';\n    } else {\n        type = 'FlexBox';\n        if (pos.position.EastOrWest) {\n            flexDirection = 'row';\n        } else {\n            flexDirection = 'column';\n        }\n    }\n\n    return { type, flexDirection };\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport { PopupService } from '@heswell/ui-controls';\nimport ComponentHeader from './component-header';\nimport ComponentContextMenu from './componentContextMenu';\nimport { remove as removeFromLayout } from './redux/actions';\nimport {\n    layout as applyLayout,\n    layoutStyleDiff\n} from './model/index';\nimport {getLayoutModel} from './util/component-utils';\nimport './layoutItem.css';\n\nconst DEFAULT_HEADER_SPEC = {\n    height: 32,\n    menu: true\n}\n\nexport default class LayoutItem extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            layoutModel: props.layoutModel ||\n                applyLayout(getLayoutModel(this),{width: props.style.width, height: props.style.height})\n        };\n\n        this.handleLayout = this.handleLayout.bind(this);\n    }\n\n    render() {\n\n        const {\n            children,\n            title = '',\n            state,\n            dragging,\n            header: _,\n            ...props } = this.props;\n\n        const {layoutModel} = this.state;\n        const [{layout: childLayout}] = layoutModel.children;\n\n        var { $path, layout } = layoutModel;\n        var isSelected = this.props.isSelected;\n\n        var className = cx(\n            'LayoutItem', {\n                'minimized': state === 1,\n                'maximized': state === 2,\n                'active': isSelected,\n                'dragging': dragging\n            }\n        );\n\n        const header = !layoutModel.header\n            ? false\n            : layoutModel.header === true\n                ? DEFAULT_HEADER_SPEC\n                : { ...DEFAULT_HEADER_SPEC, ...layoutModel.header };\n\n        var headerHeight = header ? header.height : 0;\n\n        const style = {\n            backgroundColor: layoutModel.style.backgroundColor,\n            boxShadow: layoutModel.style.boxShadow\n        }\n\n        const componentStyle = {\n            // backgroundColor: props.style.backgroundColor,\n            position: 'absolute',\n            top: headerHeight,\n            border: 0,\n            padding: 0,\n            margin: 0,\n            // ...childStyle,\n            ...childLayout\n        };\n\n        return (\n            <div id={$path} className={className} style={{ position: 'absolute', ...style, ...layout }}>\n                {header &&\n                    <ComponentHeader ref='header'\n                        title={`${title}`}\n                        style={{ height: header.height }}\n                        menu={header.menu}\n                        onMouseDown={e => this.handleMousedown(e)}\n                        onAction={(key, opts) => this.handleAction(key, opts)}\n                        state={state} />\n                }\n\n                {children.type === 'div'\n                    ? React.cloneElement(children, {\n                        style: {...componentStyle, ...childLayout}\n                    })\n\n                    : React.cloneElement(children, {\n                        ...props,\n                        style: componentStyle, // we may need to merge style attributes from props\n                        width: childLayout.width,\n                        height: childLayout.height,\n                        onLayout: this.handleLayout\n                    })\n                }\n            </div>\n        );\n    }\n\n    componentDidMount() {\n\n        const self = this;\n        if (this.context && this.context.store) {\n            const { store } = this.context;\n            //TODO sort out this mess\n            // be careful the context of store change notification is not 'this'\n            this.unsubscribe = store.subscribe(() => {\n                const myState = self.getState();\n                if (myState && myState !== self.state.c) {\n                    // console.log(`LayoutItem receives store change notification - ITS FOR ME and it has changed \n                    // ${JSON.stringify(myState)}\n                    //${JSON.stringify(self.state.c)}`);\n                    self.setState({ c: myState });\n                }\n\n                // else if (myState && myState === self.state.c){\n                // console.log(`LayoutItem receives store change notification - it's for me BUT it hasn't changed`);\n                // }\n                // else {\n                // console.log(`LayoutItem receives store change notification - it's Not for me :-(`);\n                // }\n            });\n\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.unsubscribe) {\n            this.unsubscribe();\n            this.unsubscribe = null;\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n\n        const { layoutModel, style } = nextProps;\n        // look out for a style change that will require a layout, we will reset layout in state and call\n        // onLayout prop to pass this up chain of command\n\n        if (style && style.flexGrow !== this.props.style.flexGrow) {\n            var fixed = style.flexGrow === 0;\n            this.setState({\n                fixed,\n                header: { title: this.props.title, fixed }\n            });\n        }\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (layoutStyleDiff(this.props.style, style)) {\n            // TODO test this code\n            const {$path, layout} = this.state.layoutModel;\n            const {marginTop=0,marginRight=0,marginBottom=0,marginLeft=0} = this.props.style;\n            const {top, left,width, height} = layout;\n            this.setState({\n                layoutModel: applyLayout(\n                    {\n                        ...this.state.layoutModel,\n                        style\n                    },\n                    { top, left, width: width + marginLeft + marginRight, height: height + marginTop + marginBottom },\n                    $path,\n                    true // FORCE_LAYOUT\n                )\n            }, () => {\n                this.props.onLayout('replace', { model: this.state.layoutModel });\n            });\n\n        }\n    }\n\n    dispatch(action){\n\n        if (typeof action === 'function') {\n            return this.context.store.dispatch(action);\n        }\n        else {\n            const { id, componentId, ...options } = action;\n            if (id && action.type === 'SAVE_CONFIG') {\n                this.context.store.dispatch({ type: 'SAVE_CONFIG', config: { ...options.config, targetId: this.props.layoutModel.$id }, componentId: id });\n            }\n            else if (componentId) {\n                this.context.store.dispatch({ ...options, componentId })\n            }\n            else {\n                this.context.store.dispatch({ ...options, componentId: this.props.layoutModel.$id });\n            }\n        }\n\n    }\n\n    handleLayout(command, options){\n\n        if (command === 'remove' && options === undefined) {\n            // TODO call onLayout\n            this.dispatch(removeFromLayout(this.props.layoutModel));\n        }\n        else {\n            this.props.onLayout(command, options);\n        }\n\n    };\n\n    handleAction(key, opts){\n\n        if (key === 'menu') {\n\n            var { left, top } = opts;\n\n            // the ComponentContextMenu will reach into the hostedComponent to get MenuItems, we should do that here\n            var contextMenu = <ComponentContextMenu component={this} doAction={action => this.handleContextMenuAction(action)} />;\n\n            PopupService.showPopup({ left, top, component: contextMenu });\n        }\n\n        else if (key === 'pin') {\n            var fixed = this.state.fixed;\n            this.setState({ fixed: !fixed });\n            this.props.onConfigChange(this, { fixed: !fixed })\n        }\n    }\n\n    handleMousedown(e){\n        if (this.props.onMouseDown) {\n            this.props.onMouseDown({\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n        else {\n            this.props.onLayout('drag-start', {\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n    }\n\n    handleContextMenuAction(action/*, data*/){\n\n        if (action === 'pin') {\n            var fixed = this.state.fixed;\n            this.setState({ fixed: !fixed });\n            this.props.onConfigChange(this, { fixed: !fixed })\n        }\n        else if (action === 'remove') {\n            this.dispatch(removeFromLayout(this.props.layoutModel));\n            // this.props.onLayout('remove', {model:this.props.layoutModel});\n        }\n        else if (action === 'minimize') {\n            this.props.onLayout('minimize', {/*path*/});\n        }\n        else if (action === 'maximize') {\n            this.props.onLayout('maximize', { /*path*/ });\n        }\n        else if (action === 'restore') {\n            this.props.onLayout('restore', { /*path*/ });\n        }\n        else if (action === 'settings') {\n\n            // const dialog = this._component && this._component.getSettingsEditor\n            //     ? this._component.getSettingsEditor()\n            //     : <div style={{\n            //                 width: 300,\n            //                 height: 200,\n            //                 backgroundColor: 'yellow',\n            //                 borderColor: 'red',\n            //                 borderWidth: 5,\n            //                 borderStyle: 'solid'}} />\n\n\n            // this.props.onLayout('dialog',{\n            //     component : dialog \n            // });\n        }\n        else if (typeof action === 'object') {\n            this.dispatch(action);\n        }\n        else {\n            console.log(`LayoutItem.handleContextMenuAction unknown action ${action}`);\n\n        }\n\n    }\n\n}\n\nLayoutItem.displayName = 'LayoutItem';\n\nLayoutItem.defaultProps = {\n    onConfigChange: () => { },\n    style: {},\n    visibility: 'visible'\n};\n","import Konva from 'konva';\nimport './drop-menu.css';\n\nconst COLOURS = ['red', 'green', 'blue', 'yellow'];\n\n// Konva properties\nconst PATH_SETTINGS = {\n    fill: '#00D2FF',\n    strokeWidth: 0\n}\n\nexport default class DropMenu {\n\n    constructor({ layer, hover }) {\n\n        this._group = new Konva.Group();\n\n        this._group.on('mouseleave', () => hover(null));\n\n        layer.add(this._group);\n        \n        this.visible = isVisible => this._group.visible(isVisible)\n\n        this.addPaths = paths => {\n\n            paths.forEach(({ path, dropTarget }) => {\n                this._group.add(path);\n                path.on('mouseenter', () => hover(dropTarget));\n            })\n        }\n\n    }\n\n    computeMenuPosition(dropTarget, measurements, offsetTop = 0, offsetLeft = 0) {\n\n        const { component, pos } = dropTarget;\n        const box = measurements[component.$path];\n\n        const dropTargets = getDropTargets(dropTarget);\n\n        const [x, y] = menuPosition(pos, box, dropTargets.length, offsetTop, offsetLeft);\n\n        this._group.position({ x, y });\n\n        const paths = dropTargets.map((dropTarget, i) => ({\n            path: new Konva.Path({\n                strokeWidth: 0,\n                fill: COLOURS[i],\n                data: pathPosition(pos, i)\n            }),\n            dropTarget\n        }));\n\n        // do we have to care about removing eventlisteners ? Probably not\n        this._group.removeChildren();\n\n        this.addPaths(paths);\n    }\n\n}\n\nfunction pathPosition(pos, idx) {\n\n    const unit = 30;\n    const depth = 32;\n\n    const lo = i => i === 0 ? -unit / 2\n        : i > 0 ? -1 * (unit / 2 + (idx * unit))\n            : unit / 2 + ((-idx - 1) * unit);\n\n    const [top, left, width, height] =\n        pos.position.West ? [lo(idx), 0, depth, unit] :\n            pos.position.East ? [lo(idx), -depth, depth, unit] :\n                pos.position.South ? [-depth, lo(idx), unit, depth] :\n    \t/* North | Header */[0, lo(idx), unit, depth];\n\n    // For pos 0 we draw just one item (the central item), for others we double up\t\n    return `M${left},${top}h${width}v${height}h-${width}v-${height}${idx > 0 ? pathPosition(pos, -idx) : ''}`;\n\n}\n\nfunction menuPosition(pos, box, count, offsetTop, offsetLeft) {\n\n    return pos.position.West ? [box.left - offsetLeft + 26, pos.y - offsetTop]\n        : pos.position.South ? [pos.x - offsetLeft, box.bottom - offsetTop - 26]\n            : pos.position.East ? [box.right - offsetLeft - 26, pos.y - offsetTop]\n        /* North | Header*/ : [pos.x - offsetLeft, box.top - offsetTop + 26];\n\n}\n\n// This might be a method on dropTarget ?\nfunction getDropTargets(dropTarget) {\n\n    const dropTargets = [dropTarget];\n\n    while (dropTarget = dropTarget.nextDropTarget) {\n        dropTargets.push(dropTarget);\n    }\n\n    return dropTargets;\n\n}\n\n\n\n\n","import { Position } from './model/index';\nimport { PopupService } from '@heswell/ui-controls';\nimport DropMenu from './drop-menu';\nimport Konva from 'konva';\n\nimport './drop-target-canvas.css';\n\nconst NORTH = Position.North;\nconst SOUTH = Position.South;\nconst EAST = Position.East;\nconst WEST = Position.West;\nconst HEADER = Position.Header;\n\nlet _dropTarget = null;\nlet _multiDropOptions = false;\nlet _currentDropTarget;\nlet _dropMenu = false;\nlet _stage;\nlet _layer;\nlet _konvaDropMenu;\nlet _hoverDropTarget = null;\nlet _dropTargetIsTabstrip = false;\nlet _currentTabIndex = -1;\nlet _shiftedTab = null;\n\nexport default class DropTargetCanvas {\n\n    constructor() {\n        const canvas = document.createElement('canvas');\n        canvas.className = 'fullscreen';\n        let container = document.getElementById('thecanvas');\n        let sketchpad;\n\n        if (!container) {\n            const root = document.getElementById('root');\n            container = document.createElement('div');\n            container.id = 'thecanvas';\n            document.body.insertBefore(container, root);\n\n            sketchpad = document.createElement('div');\n            sketchpad.id = 'sketchpad';\n            this.sketchpad = sketchpad;\n            document.body.insertBefore(sketchpad, root);\n        }\n\n        container.appendChild(canvas);\n\n        this.canvas = canvas;\n\n        this.t = 0;\n        this.l = 0;\n        this.w = document.body.clientWidth;\n        this.h = document.body.clientHeight;\n\n        window.addEventListener('resize', () => {\n            this.w = document.body.clientWidth;\n            this.h = document.body.clientHeight;\n        });\n\n        _stage = new Konva.Stage({\n            container: 'sketchpad',   // id of container <div>\n            width: this.w,\n            height: this.h\n        });\n        //then create layer\n        _layer = new Konva.Layer();\n\n        _konvaDropMenu = new DropMenu({\n            layer: _layer,\n            hover: dropTarget => _hoverDropTarget = dropTarget\n        });\n\n        _stage.add(_layer);\n\n    }\n\n    prepare(position) {\n        if (position) {\n            const { left: l, top: t, right: r, bottom: b } = position;\n            const w = r - l;\n            const h = b - t;\n            this.t = t;\n            this.l = l;\n            this.w = w;\n            this.h = h;\n            const cssText = `top:${t}px;left:${l}px;width:${w}px;height:${h}px;z-index:100`;\n            this.canvas.style.cssText = cssText;\n            this.sketchpad.style.cssText = cssText;\n\n            _stage.setWidth(w);\n            _stage.setHeight(h);\n\n        }\n        this.canvas.classList.add(\"ready\");\n        document.body.classList.add(\"drawing\");\n        _currentDropTarget = null;\n\n    };\n\n\n    clear() {\n        document.body.classList.remove(\"drawing\");\n        this.canvas.classList.remove(\"ready\");\n        if (_dropMenu) {\n            PopupService.hidePopup();\n            _dropMenu = false;\n        }\n    }\n\n    get hoverDropTarget() {\n        return _hoverDropTarget;\n    }\n\n    get dropTargetIsTabstrip() {\n        return _dropTargetIsTabstrip;\n    }\n\n    get currentTabIndex() {\n        return _currentTabIndex;\n    }\n\n    draw(dropTarget, measurements, x, y) {\n        const SameDropTarget = _dropTarget !== null &&\n            !_dropTargetIsTabstrip &&\n            _dropTarget.component === dropTarget.component &&\n            _dropTarget.pos.position === dropTarget.pos.position &&\n            _dropTarget.pos.closeToTheEdge === dropTarget.pos.closeToTheEdge;\n\n        const wasMultiDrop = _multiDropOptions;\n\n        if (_hoverDropTarget !== null) {\n            this.drawTarget(_hoverDropTarget, measurements, x, y);\n        }\n        else if (SameDropTarget === false) {\n\n            _dropTarget = dropTarget;\n            _currentDropTarget = null;\n            _multiDropOptions = dropTarget.nextDropTarget != null;\n\n            //onsole.log('draw, _multiDropOptions = ' + _multiDropOptions);\n\n            // if (_dropMenu){\n            //     PopupService.hidePopup();\n            //     _dropMenu = false;\n            // }\n\n            this.drawTarget(dropTarget, measurements, x, y);\n\n        }\n\n        if (_hoverDropTarget !== null) {\n\n\n        }\n        else if (_multiDropOptions) {\n\n            if (!wasMultiDrop) {\n                // onsole.log('show the drop menu');\n                _konvaDropMenu.visible(true);\n            }\n\n            drawDropOptions(this.canvas, dropTarget, measurements, this.w, this.h, this.t, this.l);\n        }\n        else if (_konvaDropMenu.visible()) {\n            // onsole.log('clear the drop menu');\n            _konvaDropMenu.visible(false);\n            _layer.draw();\n        }\n\n    }\n\n    drawTarget(dropTarget, measurements, x, y) {\n        const { canvas, w, h, t: offsetTop, l: offsetLeft } = this;\n\n        setWidth(canvas, w, h);\n\n        var ctx = canvas.getContext('2d');\n\n        if (_currentDropTarget) {\n            _currentDropTarget.active = false;\n        }\n\n        //onsole.log('activate drop target',dropTarget);\t    \n        _currentDropTarget = dropTarget;\n        dropTarget.active = true;\n\n        var rect = measurements[dropTarget.component.$path];\n        var header = rect.header || rect.tabstrip;\n        var pos = dropTarget.pos;\n\n        if (pos.position === HEADER && header) {\n            // this is wrong, only needed because we're manipulating the tabs here\n            const $id = dropTarget.component.$path;\n            drawTabbedOutline(ctx, rect, w, h, offsetTop, offsetLeft, x, y, $id);\n        }\n        else {\n            drawOutline(ctx, pos, rect, w, h, offsetTop, offsetLeft);\n        }\n    }\n}\n\nfunction setWidth(canvas, w, h) {\n    canvas.width = w;\n    canvas.height = h;\n}\n\n\nfunction drawTabbedOutline(ctx, rect, w, h, offsetTop, offsetLeft, mouseX, mouseY, $id) {\n\n    // This is completely the wrong place to be identifying the target tab, should be done in\n    // BoxModel.identifyDropTarget\n    const { tabs } = rect;\n    const tabCount = tabs ? tabs.length : 0;\n    let tab = tabs && tabs.find(({ left, right }) => mouseX >= left && mouseX <= right);\n    if (tab) {\n        _currentTabIndex = tabs.indexOf(tab);\n    } else {\n        const lastTab = tabs && tabs[tabs.length - 1];\n        if (lastTab) {\n            tab = { left: lastTab.right }\n            _currentTabIndex = tabs.length;\n        } else {\n            tab = { left: rect.left };\n            _currentTabIndex = -1;\n        }\n    }\n\n    //====================================== EXPERIMENT\n    if (_currentTabIndex > -1 && _currentTabIndex < tabCount) {\n        const selector = `:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab:nth-child(${_currentTabIndex + 1})`;\n        const tab = document.getElementById($id).querySelector(selector);\n        if (tab && tab !== _shiftedTab) {\n            if (_shiftedTab) {\n                _shiftedTab.style.cssText = '';\n            }\n            tab.style.cssText = 'transition:margin-left .4s ease-out;margin-left: 80px';\n            _shiftedTab = tab;\n        }\n    } else if (_shiftedTab) {\n        _shiftedTab.style.cssText = '';\n        _shiftedTab = null;\n\n    }\n\n    //====================================== EXPERIMENT\n\n    _dropTargetIsTabstrip = rect.tabs && rect.tabs.length;\n\n    var header = rect.header;\n\n    var t = Math.round(header.top - offsetTop),\n        l = /*header.name === 'Tabstrip' ? Math.round(header.tabRight) :*/ Math.round(header.left - offsetLeft),\n        r = Math.round(header.right - offsetLeft),\n        b = Math.round(header.bottom - offsetTop),\n        tabLeft = Math.round(tab.left - offsetLeft),\n        tabRight = Math.round(tab.left + 60 - offsetLeft);\n\n    ctx.beginPath();\n\n    var lineWidth = 6;\n    var inset = 0;\n    // var headOffset = (header.top - rect.top) + header.height;\n\n    var gap = Math.round(lineWidth / 2) + inset;\n    var { top, left, right, bottom } = rect;\n\n    setCanvasStyles(ctx, { lineWidth: lineWidth, strokeStyle: 'yellow' });\n    drawTab(ctx, l + gap, t + gap, r, b, top, left - offsetLeft + gap, right - offsetLeft - gap, bottom - offsetTop - gap, tabLeft, tabRight);\n\n    ctx.stroke();\n\n}\n\nfunction drawTab(ctx, l, t, r, b, top, left, right, bottom, tabLeft, tabRight) {\n\n    var radius = 6;\n\n    // var x = l;\n    var y = t + 3;\n    // var width = 100;\n    var height = b - t;\n    var fill = false;\n    var stroke = true;\n\n    ctx.lineJoin = 'round';\n    ctx.beginPath();\n\n    ctx.moveTo(tabLeft + radius, y);\n    ctx.lineTo(tabRight - radius, y);\n    ctx.quadraticCurveTo(tabRight, y, tabRight, y + radius);\n    ctx.lineTo(tabRight, y + height);\n    ctx.lineTo(right, y + height);\n    ctx.lineTo(right, bottom);\n    ctx.lineTo(left, bottom);\n    ctx.lineTo(left, y + height);\n    ctx.lineTo(tabLeft, y + height);\n    ctx.lineTo(tabLeft, y + radius);\n    ctx.quadraticCurveTo(tabLeft, y, tabLeft + radius, y);\n\n\n    //   ctx.moveTo(x, y + height);\n    //   ctx.lineTo(x, y + radius);\n    //   ctx.quadraticCurveTo(x,y,x + radius, y);\n    //   ctx.lineTo(x + width - radius, y);\n    //   ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n    //   ctx.lineTo(x + width, y + height);\n\n    //   ctx.lineTo(right, y + height);\n    //   ctx.lineTo(right, bottom);\n    //   ctx.lineTo(left, bottom);\n    //   ctx.lineTo(left, y+height);\n\n\n    ctx.closePath();\n\n    if (stroke) {\n        ctx.stroke();\n    }\n    if (fill) {\n        ctx.fill();\n    }\n\n}\n\nfunction drawOutline(ctx, pos, rect, w, h, offsetTop = 0, offsetLeft = 0) {\n\n    var targetPosition = pos.position;\n\n    var size = null;\n\n    //onsole.log(`layout=${JSON.stringify(layout)}`);\n\n    if (pos.width) {\n        size = { width: pos.width }\n    }\n    else if (pos.height) {\n        size = { height: pos.height }\n    }\n\n    var t = Math.round(rect.top - offsetTop),\n        l = Math.round(rect.left - offsetLeft),\n        r = Math.round(rect.right - offsetLeft),\n        b = Math.round(rect.bottom - offsetTop);\n\n    var lineWidth = 6;\n\n    setCanvasStyles(ctx, {\n        lineWidth: lineWidth,\n        strokeStyle: 'yellow'\n    });\n\n    ctx.beginPath();\n\n    var inset = 0;\n    var gap = Math.round(lineWidth / 2) + inset;\n\n    switch (targetPosition) {\n\n        case NORTH:\n        case HEADER:\n            var halfHeight = Math.round((b - t) / 2);\n            var sizeHeight = (size && size.height) ? size.height : 0;\n            var height = sizeHeight ? Math.min(halfHeight, Math.round(sizeHeight)) : halfHeight;\n            drawRect(ctx, l + gap, t + gap, r - gap, t + gap + height);\n            break;\n\n        case WEST:\n            var halfWidth = Math.round((r - l) / 2);\n            var sizeWidth = (size && size.width) ? size.width : 0;\n            var width = sizeWidth ? Math.min(halfWidth, Math.round(sizeWidth)) : halfWidth;\n            drawRect(ctx, l + gap, t + gap, l + gap + width, b - gap);\n            break;\n\n        case EAST:\n            // var halfWidth = Math.round((r - l) / 2);\n            // var sizeWidth = (size && size.width) ? size.width : 0;\n            // var width = sizeWidth ? Math.min(halfWidth, Math.round(sizeWidth)) : halfWidth;\n            drawRect(ctx, (r - gap) - width, t + gap, r - gap, b - gap);\n            break;\n\n        case SOUTH:\n            // var halfHeight = Math.round((b - t) / 2);\n            // var sizeHeight = (size && size.height) ? size.height : 0;\n            // var height = sizeHeight ? Math.min(halfHeight, Math.round(sizeHeight)) : halfHeight;\n\n            drawRect(ctx, l + gap, (b - gap) - height, r - gap, b - gap);\n            break;\n\n        default:\n\n            console.log('DropTargetCanvas what are we doing here ?');\n    }\n\n    ctx.closePath();\n    ctx.stroke();\n\n\n    // if (dropTarget.pos.closeToTheEdge == dropTarget.pos.position){\n\n    // \tvar zone = 30;\n\n    //     ctx.beginPath();\n    //     ctx.fillStyle = 'rgba(0,0,0,.25)';\n\n    //     //TODO if op is 'insert' we may not be at the edge - may be \n    //     // somewhere in middle of a tower or terrace - look at index\n    //     var g = 6;\n\n    //     zone = zone - gap;\n\n    //     console.log(_dropTarget.pos.position , dropTarget.pos.position);\n    //     switch (_dropTarget.pos.position ){\n    //         case NORTH: drawRect(ctx,l+g,t+g,r-g,t+g+zone); break;\n    //         case SOUTH: drawRect(ctx,l+g,b-g-zone,r-g,b-g); break;\n    //         case EAST: drawRect(ctx,r-g-zone,t+g,r-g,b-g); break;\n    //         case WEST: drawRect(ctx,l+g,t+g,l+zone,b-g); break;\n    //     }\n\n    //     ctx.closePath();\n    //     ctx.fill();\n\n    // }\n}\n\nfunction drawDropOptions(canvas, dropTarget, measurements, w, h, offsetTop, offsetLeft) {\n\n    // PopupService.showPopup({component : (\n    //         <DropMenu dropTarget={dropTarget} measurements={measurements}\n    //             onMouseOver={handleMouseOver(canvas, measurements, w, h)} /> )});\n\n    // _dropMenu = true;\n\n    _konvaDropMenu.computeMenuPosition(dropTarget, measurements, offsetTop, offsetLeft);\n\n    _layer.draw();\n\n}\n\n\n// function handleMouseOver(canvas, measurements, w, h) {\n//     return function (dropTarget) {\n//         draw(canvas, dropTarget, measurements, w, h, 0, 0, true);\n//     };\n// }\n\n\nfunction setCanvasStyles(ctx, styles) {\n    ctx.strokeStyle = styles.strokeStyle || 'black';\n    ctx.lineWidth = styles.lineWidth || 2;\n    ctx.fillStyle = styles.fillStyle || 'rgba(255,0,0,.5)';\n\n    // if (_multiDropOptions){\n    // \tctx.setLineDash([15,10]);\n    // }\n}\n\nfunction drawRect(ctx, x1, y1, x2, y2) {\n\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y1);\n    ctx.lineTo(x2, y2);\n    ctx.lineTo(x1, y2);\n\n\n}\n\n\n","\n\nimport {BoxModel, positionValues} from './model/boxModel';\nimport {containerOf} from './model/layoutModel';\n\nexport default class DropTarget {\n\n\tconstructor({component, pos/*, closeToTheEdge*/, nextDropTarget}){\n\t    this.component = component; \n\t    this.pos = pos;\n\t    this.nextDropTarget = nextDropTarget;\n\t    this.active = false;       \n\t}\n\n\tactivate(){\n\t    this.active=true;\n\t    return this;\n\t}\n\n\tstatic getActiveDropTarget(dropTarget){\n\t    return dropTarget.active ? dropTarget : DropTarget.getActiveDropTarget(dropTarget.nextDropTarget);\n\t}\n\n\t    // Initial entry to this method is always via the app (may be it should be *on* the app)\n\tstatic identifyDropTarget(x, y, model, dragState, measurements){\n\n\t     let dropTarget = null;\n\t   \n\t    //onsole.log('Draggable.identifyDropTarget for component  ' + box.name + ' (' + box.nestedBoxes.length + ' children)') ;\n        // this could return all boxes containing point, which would make getNextDropTarget almost free\n        // Also, if we are over  atabstrip, it could include the actual tab\n\t    var component = BoxModel.smallestBoxContainingPoint(model, measurements, x, y);\n\t    \n\t    if (component){\n\t        // onsole.log(`%cidentifyDropTarget target path ${component.$path}\n\t        //     position: ${JSON.stringify(component.$position)}\n\t        //     measurements : ${JSON.stringify(_measurements[component.$path])}\n\t        //     `,'color:cornflowerblue;font-weight:bold;');\n\t        const pos = BoxModel.pointPositionWithinRect(x,y,measurements[component.$path]);\n            const nextDropTarget = getNextDropTarget(model, component, pos, dragState.constraint.zone, measurements, x, y);\n\t        dropTarget = new DropTarget({component, pos, nextDropTarget}).activate()\n\t    \n\t        // onsole.log('%c'+printDropTarget(dropTarget),'color:green');\n\n\t    }\n\n\t    //onsole.log(`\\n${printDropTarget(dropTarget)}`);\n\n\t    return dropTarget;\n\t}\n\n}\n\n// must be cleared when we end the drag\n// layout never changes\n// component never changes\n// pos neve changes\n// zone enver changes\n// measurements never change\nexport function getNextDropTarget(layout, component, pos, zone, measurements, x, y){\n\n\tconst {north, south, east, west} = positionValues;\n\tconst eastwest = east+west;\n\tconst northsouth = north+south;\n\n    return next();\n\n    function next(container=containerOf(layout, component)){\n\n        if (pos.position.Header || pos.closeToTheEdge){\n\n            let nextDropTarget = false;\n\n            // experiment...\n            let containerPos = BoxModel.pointPositionWithinRect(x,y,measurements[container.$path]);\n\n            while (container && positionedAtOuterContainerEdge(container, pos, component, measurements)){               \n                //onsole.log(`${component.type} positioned at outer edge of container ${container.type}`);\n                // if its a VBox and we're close to left or right ...\n                if ((isVBox(container) || isTabbedContainer(container)) && (pos.closeToTheEdge & eastwest)){\n                    nextDropTarget = true;\n                    containerPos.width = 120;\n                }\n                // if it's a HBox and we're close to top or bottom ...\n                else if ((isHBox(container) || isTabbedContainer(container)) && (pos.position.Header || (pos.closeToTheEdge & northsouth))){\n                    nextDropTarget = true;\n                    containerPos.height = 120;\n                }\n                if (nextDropTarget){\n                    if (containerPos.position.Header){\n                        containerPos = {...containerPos, position:north};    \n                    }\n                    // For each DropTarget, specify which drop operations are appropriate\n                    return new DropTarget({\n                        component:container, \n                        pos: containerPos, // <<<<  a local pos for each container\n                        nextDropTarget: next(containerOf(layout, container))\n                    });\n                }\n\n                container = containerOf(layout, container);\n            }\n        } \n    }\n}\n\nfunction positionedAtOuterContainerEdge(containingComponent, {closeToTheEdge,position}, component, measurements){\n    \n    const containingBox = measurements[containingComponent.$path]; \n    const box = measurements[component.$path];\n\n    const closeToTop = closeToTheEdge & positionValues.north;\n    const closeToRight = closeToTheEdge & positionValues.east;\n    const closeToBottom = closeToTheEdge & positionValues.south;\n    const closeToLeft = closeToTheEdge & positionValues.west;\n\n    if ((closeToTop || position.Header) && box.top === containingBox.top) return true;\n    if (closeToRight && box.right === containingBox.right) return true;\n    if (closeToBottom && box.bottom === containingBox.bottom) return true;\n    if (closeToLeft && box.left === containingBox.left) return true;\n\n    return false\n}\n\nfunction isTabbedContainer({type}){\n    return type === 'TabbedContainer';\n}\n\nfunction isVBox({type,style:{flexDirection}}){\n    return type === 'FlexBox' &&  flexDirection === \"column\";\n}\n\nfunction isHBox({type, style:{flexDirection}}){\n    return type === 'FlexBox' &&  flexDirection === \"row\";\n}\n\n\n// const w = '  ';\n\n// function printDropTarget(dropTarget, s=w){\n\n// \tconst {pos} = dropTarget;\n// \tconst ctte = pos.closeToTheEdge ? `=>${printClose(pos.closeToTheEdge)}<=` : '';\n//     const size = pos.width ? ` width:${pos.width} ` : pos.height ? ` height:${pos.height} ` : '';\n\n//     var str = `<${dropTarget.component.type}> ${ctte} ${size} $${dropTarget.component.$path}`;\n//     if (dropTarget.nextDropTarget != null){\n//         str += `\\n${s} ${printDropTarget(dropTarget.nextDropTarget,s+w)}` \n//     }\n//     return str;\n// }\n\n// function printClose(val){\n// \tvar s = '';\n// \tif (val & 1) s+= 'N';\n// \tif (val & 4) s+= 'S';\n// \tif (val & 2) s+= 'E';\n// \tif (val & 8) s += 'W';\n// \treturn s;\n// }\n\n","\nimport {BoxModel} from './model/index';\n\nvar SCALE_FACTOR = 0.4;\n\nexport default class DragState {\n\n    constructor(zone, mouseX, mouseY, measurements){\n        this.init(zone, mouseX, mouseY, measurements);\n    }\n\n    init(zone, mouseX, mouseY, rect){\n        \n        var {left: x, top: y} = rect;\n\n        var mousePosition = BoxModel.pointPositionWithinRect(mouseX,mouseY,rect);\n\n        // We are applying a scale factor of 0.4 to the draggee. This is purely a visual\n        // effect - the actual box size remains the original size. The 'leading' values \n        // represent the difference between the visual scaled down box and the actual box.\n\n        var scaleFactor = SCALE_FACTOR;\n\n        var leadX = mousePosition.pctX * rect.width;\n        var trailX = rect.width - leadX;\n        var leadY = mousePosition.pctY * rect.height;\n        var trailY = rect.height - leadY;\n\n        // When we assign position to rect using css. positioning units are applied to the \n        // unscaled shape, so we have to adjust values to take scaling into account.\n        var scaledWidth = rect.width * scaleFactor,\n            scaledHeight = rect.height * scaleFactor;\n\n        var scaleDiff = 1 - scaleFactor;\n        var leadXScaleDiff = leadX * scaleDiff; \n        var leadYScaleDiff = leadY * scaleDiff; \n        var trailXScaleDiff = trailX * scaleDiff; \n        var trailYScaleDiff = trailY * scaleDiff; \n\n        this.constraint = {\n            zone : {\n                x : {\n                    lo: zone.left,\n                    hi: zone.right\n                },\n                y : {\n                    lo: zone.top,\n                    hi: zone.bottom\n                }\n            },\n\n            pos : {\n                x : {\n                    lo: /* left */ zone.left - leadXScaleDiff,\n                    hi: /* right */ zone.right - rect.width + trailXScaleDiff\n                },\n                y : {\n                    lo: /* top */ zone.top - leadYScaleDiff,\n                    hi: /* bottom */ zone.bottom - rect.height + trailYScaleDiff\n                }\n            },\n            mouse :{\n                x : {\n                    lo: /* left */ zone.left + scaledWidth * mousePosition.pctX,\n                    hi: /* right */ zone.right - scaledWidth * (1-mousePosition.pctX)\n                },\n                y: {\n                    lo: /* top */ zone.top + scaledHeight * mousePosition.pctY,\n                    hi: /* bottom */ zone.bottom - scaledHeight * (1-mousePosition.pctY)\n                }\n            }\n        };\n\n        //onsole.log(JSON.stringify(this.constraint,null,2));\n\n        this.x = {pos:x, lo: false, hi: false, mousePos: mouseX, mousePct: mousePosition.pctX};\n        this.y = {pos:y, lo: false, hi: false, mousePos: mouseY, mousePct: mousePosition.pctY};\n\n    }\n\n    outOfBounds(){\n        return this.x.lo || this.x.hi || this.y.lo || this.y.hi;\n    }\n\n    inBounds(){\n        return !this.outOfBounds();\n    }\n\n    dropX(){\n        return dropXY.call(this,'x');\n    }\n\n    dropY(){\n        return dropXY.call(this,'y');\n    }\n\n\n    /*\n     *  diff = mouse movement, signed int\n     *  xy = 'x' or 'y'\n     */\n     //todo, diff can be calculated in here\n    update(xy, mousePos){\n\n        var state = this[xy],\n            mouseConstraint = this.constraint.mouse[xy],\n            posConstraint = this.constraint.pos[xy],\n            previousPos = state.pos;\n\n       var diff = mousePos - state.mousePos;\n\n       //xy==='x' && console.log(`update: state.lo=${state.lo}, mPos=${mousePos}, mC.lo=${mouseConstraint.lo}, prevPos=${previousPos}, diff=${diff} `  );\n\n        if (diff < 0){\n            if (state.lo) {/* do nothing */}\n\n            else if (mousePos < mouseConstraint.lo){\n                state.lo = true;\n                state.pos =  posConstraint.lo;\n            }\n            else if (state.hi){\n                if (mousePos < mouseConstraint.hi){\n                    state.hi = false;\n                    state.pos += diff;\n                }\n            }\n            else {\n                state.pos += diff;\n            }\n        }\n        else if (diff > 0){\n            if (state.hi){/* do nothing */}\n\n            else if (mousePos > mouseConstraint.hi){\n                state.hi = true;\n                state.pos =  posConstraint.hi;\n            }\n            else if (state.lo){\n                if (mousePos > mouseConstraint.lo){\n                    state.lo = false;\n                    state.pos += diff;\n                }\n            }\n            else {\n                state.pos += diff;\n            }\n        }\n\n        state.mousePos = mousePos;\n\n        return previousPos !== state.pos;\n\n    }\n\n}\n\nfunction dropXY(dir){\n\n    var pos = this[dir],\n        rect = this.constraint.zone[dir];\n        // why not do the rounding +/- 1 on the rect initially - this is all it is usef for\n    return pos.lo ? Math.max(rect.lo,pos.mousePos) : pos.hi ? Math.min(pos.mousePos, Math.round(rect.hi) -1) : pos.mousePos;\n\n}\n\n","\nimport ReactDOM from 'react-dom';\nimport DropTargetCanvas from './drop-target-canvas';\nimport DropTarget from './drop-target';\nimport DragState from './drag-state';\nimport { followPath, BoxModel, Position } from './model/index';\n\nvar _dragCallback;\nvar _dragStartX;\nvar _dragStartY;\nvar _dragContainer;\nvar _dragState;\nvar _dragThreshold = 5;\nvar _dropTarget = null;\nvar _measurements;\nvar _simpleDrag;\nvar _dropTargetCanvas = new DropTargetCanvas();\nvar _dragContainers = [];\nvar SCALE_FACTOR = 0.4;\n\nexport class DragContainer {\n\n    static register(path) {\n        // need to decide how to store these\n        _dragContainers.push(path);\n    }\n\n    static unregister(/*path*/) {\n\n    }\n}\n\nfunction getDraggable(component) {\n    var target;\n\n    var header = component.refs.header || component.tabstrip;\n    if (header && header.props.draggable) {\n        target = header;\n    } else if (component.props.draggable) {\n        target = component;\n    }\n    return target;\n}\n\nexport var Draggable = {\n\n    // bound to target components when called\n    componentDidMount() {\n\n        // // can we always rely on dragContainer being available at this point ?\n        // // Might we have to wait for layout ?\n        // if (this.props.dragContainer === true){\n        //     DragContainer.register(this);\n        // }\n\n        var draggable = getDraggable(this);\n        if (draggable) {\n            this.mouseDownHandler = Draggable.handleMousedown.bind(this);\n            ReactDOM.findDOMNode(draggable).addEventListener('mousedown', this.mouseDownHandler, false);\n        }\n    },\n\n    componentWillUnmount() {\n\n        var draggable = getDraggable(this);\n        if (draggable) {\n            ReactDOM.findDOMNode(draggable).removeEventListener('mousedown', this.mouseDownHandler, false);\n            this.mouseDownHandler = null;\n        }\n    },\n\n    // bound to Draggable Component\n    handleMousedown(e, dragStartCallback) {\n\n        _dragCallback = dragStartCallback;\n\n        _dragStartX = e.clientX;\n        _dragStartY = e.clientY;\n\n        window.addEventListener('mousemove', preDragMousemoveHandler, false);\n        window.addEventListener('mouseup', preDragMouseupHandler, false);\n\n        e.preventDefault();\n    },\n\n    initDrag(e, layoutModel, path, { top, left, right, bottom }, dragHandler) {\n\n        _dragCallback = dragHandler;\n\n        return initDrag(e, layoutModel, path, { top, left, right, bottom });\n\n    }\n};\n\nfunction preDragMousemoveHandler(e) {\n\n    var x = true;\n    var y = true;\n\n    let x_diff = x ? e.clientX - _dragStartX : 0;\n    let y_diff = y ? e.clientY - _dragStartY : 0;\n    let mouseMoveDistance = Math.max(Math.abs(x_diff), Math.abs(y_diff));\n\n    // when we do finally move the draggee, we are going to 'jump' by the amount of the drag threshold, should we\n    // attempt to animate this ?    \n    if (mouseMoveDistance > _dragThreshold) {\n\n        window.removeEventListener('mousemove', preDragMousemoveHandler, false);\n        window.removeEventListener('mouseup', preDragMouseupHandler, false);\n\n        if (_dragCallback(e, x_diff, y_diff) !== false) {\n            window.addEventListener('mousemove', dragMousemoveHandler, false);\n            window.addEventListener('mouseup', dragMouseupHandler, false);\n        }\n    }\n}\n\nfunction preDragMouseupHandler() {\n\n    window.removeEventListener('mousemove', preDragMousemoveHandler, false);\n    window.removeEventListener('mouseup', preDragMouseupHandler, false);\n\n}\n\nfunction getDragContainer(layoutModel, path) {\n\n    var pathToContainer = '';\n    var maxSteps = 0;\n\n    // If the model has no path (i.e. it hasn't been dragged out of the existing layout)\n    // hiow do we decide the dragContainer to use (assuming there may be more than 1)\n    if (path === undefined) {\n        pathToContainer = _dragContainers[0];\n    }\n    else {\n        // find the longest container path that matches path (ie the smallest enclosing container); \n        for (var i = 0; i < _dragContainers.length; i++) {\n            if (path.indexOf(_dragContainers[i]) === 0) {\n                var steps = _dragContainers[i].split('.').length;\n                if (steps > maxSteps) {\n                    maxSteps = steps;\n                    pathToContainer = _dragContainers[i];\n                }\n            }\n        }\n    }\n\n    return followPath(layoutModel, pathToContainer);\n\n}\n\nfunction initDrag(evt, layoutModel, path, dragRect) {\n\n    _dragContainer = getDragContainer(layoutModel, path);\n\n    var start = window.performance.now();\n\n    // translate the layout $position to drag-oriented co-ordinates, ignoring splitters\n    _measurements = BoxModel.measure(layoutModel);\n    var end = window.performance.now();\n\n    console.log(`initDrag taking measurements took ${end - start} ms dragContainer version ${_dragContainer.$version}`);\n\n    var { type, $path } = _dragContainer;\n\n    var dragZone = _measurements[$path];\n\n    _dragState = new DragState(dragZone, evt.clientX, evt.clientY, dragRect);\n\n    var pctX = Math.round(_dragState.x.mousePct * 100);\n    var pctY = Math.round(_dragState.y.mousePct * 100);\n\n    if (type === 'Surface') {\n\n        _simpleDrag = true;\n\n        return {};\n\n    } else {\n\n        _simpleDrag = false;\n\n        _dropTargetCanvas.prepare(dragZone);\n\n        return {\n            draggableWidth: dragRect.right - dragRect.left,\n            draggableHeight: dragRect.bottom - dragRect.top,\n            transform: `scale(${SCALE_FACTOR},${SCALE_FACTOR})`,\n            transformOrigin: pctX + \"% \" + pctY + \"%\"\n        };\n    }\n}\n\nfunction dragMousemoveHandler(evt) {\n\n    const x = evt.clientX;\n    const y = evt.clientY;\n    const dragState = _dragState;\n    var currentDropTarget = _dropTarget;\n    var dropTarget;\n\n    var newX, newY;\n\n    if (dragState.update('x', x)) {\n        newX = dragState.x.pos;\n    }\n\n    if (dragState.update('y', y)) {\n        newY = dragState.y.pos;\n    }\n\n    if ((newX === undefined) && (newY === undefined)) {\n        //onsole.log('both x and y are unchanged');\n    } else {\n        _dragCallback.drag(newX, newY);\n    }\n\n    if (_simpleDrag) {\n        return;\n    }\n\n    if (dragState.inBounds()) {\n        dropTarget = DropTarget.identifyDropTarget(x, y, _dragContainer, dragState, _measurements);\n    } else {\n        dropTarget = DropTarget.identifyDropTarget(dragState.dropX(), dragState.dropY(), _dragContainer, dragState, _measurements);\n    }\n\n    // did we have an existing droptarget which is no longer such ...\n    if (currentDropTarget) {\n        if (dropTarget == null || dropTarget.box !== currentDropTarget.box) {\n            _dropTarget = null;\n        }\n    }\n\n    if (dropTarget) {\n\n        _dropTargetCanvas.draw(dropTarget, _measurements, x, y);\n\n        _dropTarget = dropTarget;\n\n        // if (currentDropTarget && \n        //     currentDropTarget.component === dropTarget.component &&\n        //     currentDropTarget.pos.position === dropTarget.pos.position &&\n        //     // experiment...\n        //     currentDropTarget.pos.closeToTheEdge === dropTarget.pos.closeToTheEdge){\n        //     // no change from last turn, don't assign to _dropTarget, we might lose settings\n\n        //     //onsole.log('%cSame Drop Target/Position','color:green');\n\n        //     // BUT, we are going to want to reposition the dropmenu ... \n\n        // }\n        // else {\n\n        //     // redraw position marker\n        //     //onsole.log('%cNew Drop Target/Position','color:red;font-weight:bold;');\n        //     _dropTargetCanvas.draw(dropTarget, _measurements);\n\n        //     _dropTarget = dropTarget;\n\n        // }\n\n    }\n}\n\nfunction dragMouseupHandler(evt) {\n    onDragEnd(evt);\n}\n\nfunction onDragEnd() {\n\n    if (_dropTarget) {\n\n        const dropTarget = _dropTargetCanvas.hoverDropTarget || DropTarget.getActiveDropTarget(_dropTarget);\n        if (_dropTargetCanvas.dropTargetIsTabstrip) {\n            dropTarget.tabIndex = _dropTargetCanvas.currentTabIndex;\n\n            // EXPERIMENT ----------- What is this trying to do ? (cos it's not working)\n            const selector = `:scope > .Tabstrip > .tabstrip-inner-sleeve > .tabstrip-inner > .Tab:nth-child(${dropTarget.tabIndex + 1})`;\n            const tabstrip = document.getElementById(dropTarget.component.$path);\n            if (tabstrip){\n                const tab = tabstrip.querySelector(selector);\n                if (tab){\n                    tab.style.cssText = '';\n                }\n            } else {\n                console.log(`dropTarget indicated to be Tabstrip, but is not`);\n            }\n            //----------------------\n\n        }\n\n        // looking into eliminating this call altogether. We don't need it if we set the dragging index via\n        // top-level layout state\n\n        _dragCallback.drop(dropTarget, _measurements);\n\n        _dropTarget = null;\n    }\n    else {\n        _dragCallback.drop({ component: _dragContainer, pos: { position: Position.Absolute } });\n    }\n\n    _dragCallback = null;\n    _dragContainer = null;\n    _dropTargetCanvas.clear();\n\n    window.removeEventListener('mousemove', dragMousemoveHandler, false);\n    window.removeEventListener('mouseup', dragMouseupHandler, false);\n\n}","import React from 'react';\nimport {registerClass} from './componentRegistry';\nimport {getLayoutModel} from './util/component-utils';\nimport LayoutItem from './layout-item';\nimport {Draggable} from './draggable';\nimport {layout as applyLayout, handleLayout,followPath} from './model/index';\n\nexport default class Container extends React.Component {\n\n   constructor(props){\n        super(props);\n        const layoutModel = this.getLayoutModel();\n        this.state = {\n            layoutModel,\n            ...this.getState()\n        }\n\n        this.handleLayout = this.handleLayout.bind(this);\n    }\n\n    getState(){\n        return {};\n    }\n\n    isLayoutRoot(){\n        return this.props.layoutModel === undefined;\n    }\n\n    render(){\n        var {style} = this.props;\n        var layoutModel = this.getLayoutModel();\n        var {layout, $position=layout} = layoutModel;\n\n        return (\n            <div className={layoutModel.type} style={{...style, position: 'absolute', ...$position}}>\n                {layoutModel.children.map((child,idx) => this.renderChild(child,idx))}\n            </div>\n        );\n    }\n\n    renderChild(layoutModel){\n\n        const {children: child , onLayout} = this.props;\n        const {style} = child.props;\n\n        let props = {\n            layoutModel,\n            onLayout\n        };\n\n        const id = props.layoutModel.$id;\n\n        props.id = id;\n        props.key = id;\n        props.style = {...style, ...props.style};\n\n        if (isLayout(layoutModel.type)){\n            return React.cloneElement(child, props);\n        } else {\n            return <LayoutItem {...child.props} {...props}>{child}</LayoutItem>;\n        }\n\n    }\n\n    componentDidMount(){\n        const {layoutModel=null, onLayoutModel} = this.props;\n        if (layoutModel === null && onLayoutModel){\n            onLayoutModel(this.state.layoutModel);\n        }\n    }\n\n    shouldComponentUpdate(nextProps){\n        // if the Application passes down the dragging flag, do not render, the only rendering\n        // to take place happens on the DragSurface.\n        // if (nextProps.dragging){\n        // onsole.log(`Container ${this.props.layoutModel.type} dragging  so don't update`);\n        // }\n        return nextProps.dragging !== true;\n    }\n\n    getLayoutModel(){\n\n        if (this.isLayoutRoot()){\n            return applyLayout(getLayoutModel(this));\n        } else {\n            return this.props.layoutModel;\n        }\n        \n        // let {layoutModel/*,style*/} = this.props;\n\n        // if (layoutModel === undefined){\n        //     // console.log(`getRootLayoutModel for ${typeOf(this)}`);\n        //     return applyLayout(getLayoutModel(this));\n        // } /*else if (layoutModel.children && layoutModel.children.length === 0){\n        //     alert('it happens')\n        //     console.log(`mutating (appending) layoutModel children. Can this be avoided ?`)\n        //     var children = getLayoutModelChildren(this);\n\n        //     [].push.apply(layoutModel.children, children);\n\n        //     var VISIBLE = style.visibility || 'visible';\n        //     var FORCE_LAYOUT = true;\n\n        //     var width;\n        //     var height;\n        //     var $position = layoutModel.$position;\n\n        //     if (typeof style.width === 'number' && typeof style.height === 'number'){\n        //         width = style.width;\n        //         height = style.height;\n        //     } else if ($position && $position.width !== undefined && $position.height !== undefined){\n        //         width = $position.width;\n        //         height = $position.height;\n        //     } else {\n        //         console.error(`Container.getLayoutModel attempting to initialize a ${layoutModel.type} layoutModel with no sizing attributes`)\n        //     }\n        //     console.log(`apply layout, WITH CHILDREN`)\n        //     var layoutModel2 = applyLayout(layoutModel, {width,height}, layoutModel.$path, VISIBLE, FORCE_LAYOUT);\n\n        //     layoutModel.children = layoutModel2.children;\n\n        // } */\n\n        // return layoutModel;\n\n    }\n\n    getManagedDimension(){\n        return null;\n    }\n\n    handleLayout(command, options){\n\n        // is there some other way we can nominate the layout as a root, other than $path === '0'\n        if (this.state.layoutModel && this.state.layoutModel.$path === '0' /*&& !this.props.layoutModel*/){\n            // This is a top=level layout and the owner has not taken responsibility for layout, so we need to\n            // Note: this will currently work only when the top-level container maintains its layoutModel in \n            // state (FlexBox and TabbedContainer)- other containers CAN be nested. \n            if (command === 'drag-start'){\n                if (this.handleDragStart){\n                    Draggable.handleMousedown(options.evt, this.handleDragStart.bind(this, options));\n                }\n            } else {\n                let layoutModel;\n\n                if (command === 'replace'){\n                    const {model: replacementNode} = options;\n                    const targetNode = followPath(this.state.layoutModel, replacementNode.$path);\n                    layoutModel = handleLayout(this.state.layoutModel, command, {targetNode, replacementNode});\n                } else if (command === 'switch-tab'){\n                    layoutModel = handleLayout(this.state.layoutModel, 'switch-tab', options);\n                } else if (command === 'drop'){\n                    layoutModel = handleLayout(this.state.layoutModel, 'drop', options);\n                } else {\n                    throw Error(`Container: don't know how to handle command ${command}`);\n                }\n                if (layoutModel !== this.state.layoutModel){\n                    this.setState({layoutModel});\n                    if (this.props.onLayoutModel){\n                        this.props.onLayoutModel(layoutModel);\n                    }\n                }\n            }\n        } else if (this.props.onLayout){\n            this.props.onLayout(command, options);\n        }\n    }\n\n}\n\nContainer.defaultProps = {\n    style: {flex: 1}\n}\n\nregisterClass('Container', Container, true);\n","\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\n\nvar _splitter,\n    _mousedown = false,\n    _direction,\n    _diff = 0;\n\n\nexport default class Splitter extends React.Component {\n\n    render() {\n\n        const { layout } = this.props.layoutModel\n        var { top, left, width, height } = layout;\n\n        // onsole.log(`%c     Splitter ${top},${left},${width},${height}`,`background-color:brown;color:lime;`);\n\n        var className = cx(\n            'Splitter',\n            this.props.className\n        );\n\n        var style = { position: 'absolute', top, left, width, height, cursor: this.props.cursor };\n\n        return <div className={className} style={style} />\n    }\n\n    componentDidMount() {\n        this._mouseDownHandler = this.handleMousedown.bind(this);\n        ReactDOM.findDOMNode(this).addEventListener('mousedown', this._mouseDownHandler, false);\n    }\n\n    componentWillUnmount() {\n        ReactDOM.findDOMNode(this).removeEventListener('mousedown', this._mouseDownHandler, false);\n        this._mouseDownHandler = null;\n    }\n\n    handleMousedown(e) {\n\n        _splitter = this;\n        _mousedown = true;\n        _diff = 0;\n\n        initDrag.call(this, e);\n\n        window.addEventListener(\"mousemove\", mouseMoved, false);\n        window.addEventListener(\"mouseup\", mouseUp, false);\n\n        e.preventDefault();\n    }\n\n}\n\nSplitter.defaultProps = {\n    style: {}\n};\n\nfunction mouseMoved(evt) {\n    return onDrag.call(_splitter, evt)\n}\n\nfunction mouseUp(evt) {\n    return onDragEnd.call(_splitter, evt)\n}\n\nfunction initDrag(e) {\n\n    _direction = this.props.direction;\n\n    var vertical = _direction === \"vertical\";\n    // var dim = vertical ? \"height\" : \"width\";\n\n    this.lastPos = (vertical ? e.clientY : e.clientX);\n\n    this.props.onDragStart(this.props.absIdx);\n\n}\n\nfunction onDrag(evt) {\n\n    var clientPos/*,\n        dimension*/;\n\n    if (_direction === 'vertical') {\n        clientPos = \"clientY\";\n        // dimension = \"height\";\n    }\n    else {\n        clientPos = \"clientX\";\n        // dimension = \"width\";\n    }\n\n    var pos = evt[clientPos],\n        diff = pos - this.lastPos;\n\n\n    // we seem to get a final value of zero\n    if (pos && (pos !== this.lastPos)) {\n        this.props.onDrag(diff);\n    }\n\n    this.lastPos = pos;\n\n}\n\nfunction onDragEnd() {\n\n    _mousedown = false;\n    _splitter = null;\n\n    window.removeEventListener(\"mousemove\", mouseMoved, false);\n    window.removeEventListener(\"mouseup\", mouseUp, false);\n\n    this.props.onDragEnd();\n\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport Splitter from './splitter';\nimport LayoutItem from './layout-item';\nimport ComponentHeader from './component-header';\nimport Container from './container';\nimport {isLayout} from './util/component-utils'\nimport { registerClass } from './componentRegistry';\nimport {\n    handleLayout as handleModelLayout,\n    layout as applyLayout,\n    layoutStyleDiff\n} from './model/index';\n\nconst NO_STYLE = {}\n\nexport default class FlexBox extends Container {\n\n    render() {\n\n        var { style=NO_STYLE, isSelected, title } = this.props;\n        var { layout, header, style: {boxShadow} } = this.state.layoutModel;\n        if (this.state.layoutModel.$id === 'col-picker'){\n            console.log(`FlexBox.render layout ${JSON.stringify(this.state.layoutModel,null,2)}`);\n        }\n        const {backgroundColor, visibility} = style\n        var className = cx(\n            style.flexDirection === 'row' ? 'Terrace' : 'Tower',\n            this.props.className,\n            isSelected ? 'active' : null\n        );\n\n        if (visibility === 'hidden') {\n            return null;\n        }\n        const position = this.isLayoutRoot()\n            ? 'relative'\n            : 'absolute'; \n\n        return (\n            <div className={className} style={{ position, ...layout, backgroundColor, boxShadow }}>\n                {header &&\n                     <ComponentHeader\n                         title={`${title}`}\n                         onMouseDown={e => this.handleMouseDown(e)}\n                         style={{height: header.height}}\n                         menu={header.menu} />\n                }\n            \n                {this.renderFlexibleChildren()}\n            </div>\n        );\n    }\n\n    renderFlexibleChildren() {\n\n        var { style: { flexDirection }, visibility } = this.props;\n        var cursor = flexDirection === 'column' ? 'ns-resize' : 'ew-resize';\n        var splitterIdx = 0;\n        var {children: layoutChildren} = this.state.layoutModel;\n        const propChildren = Array.isArray(this.props.children)\n            ? this.props.children.filter(child => child)\n            : [this.props.children];\n\n        var results = [];\n\n        for (var idx = 0, childIdx = 0; idx < layoutChildren.length; idx++) {\n\n            var childLayoutModel = layoutChildren[idx];\n\n            if (childLayoutModel.type === 'Splitter') {\n\n                //TODO do we still need the refs ?\n                results.push(\n                    <Splitter ref={'splitter-' + splitterIdx}\n                        key={'splitter-' + childIdx}\n                        idx={childIdx}\n                        absIdx={idx}\n                        direction={flexDirection === 'column' ? 'vertical' : 'horizontal'}\n                        cursor={cursor}\n                        onDragStart={this.splitterDragStart.bind(this)}\n                        onDrag={this.splitterMoved.bind(this)}\n                        onDragEnd={() => this.handleSplitterDragEnd()}\n                        onLayout={this.handleLayout}\n                        layoutModel={childLayoutModel} />\n                );\n\n                splitterIdx += 1;\n\n            } else {\n\n                var child = propChildren[childIdx];\n                var { style = {}, ...childProps } = child.props;\n                var id = childLayoutModel.$id;\n\n                var props = {\n                    id,\n                    key: id,\n                    idx: childIdx,\n                    absIdx: idx,\n                    onLayout: this.handleLayout,\n                    onConfigChange: this.handleConfigChange.bind(this),\n                    layoutModel: childLayoutModel\n                };\n\n                style = { ...style, visibility };\n\n                if (props.dragContainer === true && child.type.displayName !== 'Container') {\n                    //onsole.log(`FlexBox wrapping ${child.type.displayName} with Container `);\n                    const { width, height } = props.layoutModel.$position; // IS HTIS RIGHT ?\n                    results.push(<Container {...childProps} {...props} style={{ flex: style.flex, width, height, visibility }} >{child}</Container>);\n                } else if (isLayout(child)) {\n                    results.push(React.cloneElement(child, { ...props, style }));\n                } else {\n                    results.push(<LayoutItem {...childProps} {...props} style={style}>{child}</LayoutItem>);\n                }\n\n                childIdx += 1;\n\n            }\n        }\n\n        return results;\n\n    }\n\n    componentWillReceiveProps(nextProps) {\n        var { layoutModel } = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (this.state.layoutModel.$path === '0') {\n            // detact changes to style that will affect layout\n            if (layoutStyleDiff(this.props.style, nextProps.style)) {\n                const {width, height} = nextProps.style\n                const VISIBLE = nextProps.style.visibility || 'visible';\n                const FORCE_LAYOUT = true;\n                this.setState({\n                    layoutModel: applyLayout(\n                        {\n                            ...this.state.layoutModel,\n                            style: nextProps.style\n                        },\n                        { width, height },\n                        this.state.layoutModel.$path,\n                        VISIBLE,\n                        FORCE_LAYOUT)\n                });\n            }\n\n        }\n    }\n\n    getManagedDimension() {\n        var { style: { flexDirection } } = this.state.layoutModel;\n        return flexDirection === 'row' ? 'width' : 'height';\n    }\n\n    getDragPermission(component) {\n        if (component.constructor.displayName === 'Splitter') {\n            return this.props.style.flexDirection === 'row' ? { y: false, x: true } : { x: false, y: true };\n        } else {\n            return { x: true, y: true };\n        }\n    }\n\n    // copied from layoutItem\n    handleMouseDown(e){\n        if (this.props.onMouseDown) {\n            this.props.onMouseDown({\n                model: this.props.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        } else {\n            this.props.onLayout('drag-start', {\n                model: this.state.layoutModel,\n                evt: e,\n                position: ReactDOM.findDOMNode(this).getBoundingClientRect()\n            });\n        }\n    }\n\n    splitterDragStart(idx) {\n        this.splitChildren = this.identifySplitChildren(idx);\n    }\n\n    splitterMoved(distance) {\n        const [idx1, , idx2] = this.splitChildren;\n        const dim = this.getManagedDimension();\n        let layoutModel = this.state.layoutModel;\n        const measurements = layoutModel.children.map(child => child.layout[dim]);\n        measurements[idx1] += distance;\n        measurements[idx2] -= distance;\n        const RESIZE = 'resize';\n        var options = {\n            path: layoutModel.$path,\n            measurements,\n            dimension: dim\n        };\n        layoutModel = handleModelLayout(layoutModel, RESIZE, options);\n        this.setState({ layoutModel });\n    }\n\n    identifySplitChildren(splitterIdx){\n        const children = this.state.layoutModel.children;\n        let idx1 = splitterIdx - 1;\n        let idx2 = splitterIdx + 1;\n        let child;\n        while ((child = children[idx1]) && !child.resizeable) idx1--;\n        while ((child = children[idx2]) && !child.resizeable) idx2++;\n        return [idx1, splitterIdx, idx2];\n    }\n\n    handleSplitterDragEnd(){\n        this.handleLayout('replace', { model: this.state.layoutModel });\n        this.splitChildren = null;\n    }\n\n    handleConfigChange(component, { fixed }) {\n        if (fixed !== 'undefined') {\n            //TODO we don't need to do this if it has been done already\n            this.props.onLayout('config-change', {\n                dimensions: this.assignExplicitSizeToFlexElements(),\n                fixed,\n                component: component.props.json,\n                container: this.props.json\n            });\n        }\n    }\n\n}\n\nFlexBox.displayName = 'FlexBox';\nFlexBox.defaultProps = {\n    style: { flexDirection: 'column' }\n};\n\n\nregisterClass('FlexBox', FlexBox, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport { PopupService, ContextMenu, MenuItem } from '@heswell/ui-controls';\nimport './tabstrip.css';\n\nconst OVERFLOW_WIDTH = 24;\n\nfunction handleClick(e,idx, onClick){\n    e.preventDefault();\n    onClick(idx);\n}\n\nexport const Tab = ({idx, text, isSelected, onClick, onMouseDown}) =>\n    <li className={cx('Tab', {'active': isSelected})}\n        onClick={e => handleClick(e, idx, onClick)}\n        onMouseDown={onMouseDown}>\n        <a href=\"#\" className=\"tab-caption\" data-idx={idx}>{text}</a>\n    </li>\n\nconst TabstripOverflow = ({onClick}) =>\n    <div className='TabstripOverflow' onClick={onClick} />;\n\nexport default class Tabstrip extends React.Component {\n\n    constructor(props){\n        super(props);\n        this.state = {\n            overflowing: false\n        };\n        this.el = null;\n    }\n\n\n    render() {\n\n        const { style, children, onMouseDown, selected=0 } = this.props;\n        const {overflowing} = this.state;\n        const className = cx('Tabstrip', this.props.className, {overflowing});\n\n        const tabs = children.map((child, idx) => {\n            return (\n                React.cloneElement(child, {\n                    idx,\n                    isSelected: selected === idx,\n                    onClick: i => this.handleTabClick(i)\n                }));\n        });\n\n        return (\n            <div className={className} style={style} onMouseDown={onMouseDown} ref={el => this.el = el}>\n                <div className=\"tabstrip-inner-sleeve\">\n                    <ul className=\"tabstrip-inner\">{tabs}</ul>\n                </div>\n                {overflowing && <TabstripOverflow onClick={() => this.showOverflow()} />}\n            </div>\n        );\n    }\n\n    componentDidMount() {\n        this.checkOverflowState();\n    }\n\n    componentDidUpdate() {\n        this.checkOverflowState();\n        // only necesary if selection has changed or tabstrip has resized\n        // make sure selected tab is in view \n        this.ensureSelectedTabisVisible();\n\n    }\n\n    checkOverflowState() {\n        const freeSpace = this.measureFreeSpace();\n        const {overflowing} = this.state;\n        if (freeSpace < 0 && overflowing === false) {\n            this.setState({ overflowing: true });\n        } else if (freeSpace >= 0 && overflowing === true) {\n            this.setState({ overflowing: false });\n        }\n    }\n\n     handleTabClick(selectedIdx){\n        if (selectedIdx !== this.props.selected) {\n            this.props.onSelectionChange(this.props.selected, selectedIdx);\n        }\n    }\n\n    ensureSelectedTabisVisible() {\n\n        const tabstripInner = this.el.querySelector('.tabstrip-inner');\n        const activeTab = tabstripInner.querySelector('.active.Tab');\n        if (!activeTab) {\n            // eg if dragging;\n            return;\n        }\n\n        const tsBox = this.el.getBoundingClientRect();\n        const tbBox = activeTab.getBoundingClientRect();\n        const ulBox = tabstripInner.getBoundingClientRect();\n\n        const tbOffStageRight = Math.floor(tsBox.right - tbBox.right);\n        const ulOffStageLeft = Math.floor(ulBox.left - tsBox.left);\n        const overflowing = ulBox.right > tbBox.right;\n        let translateX;\n\n        if (ulOffStageLeft === 0 && tbOffStageRight < 0) {\n            translateX = ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (ulOffStageLeft < 0 && tbOffStageRight === OVERFLOW_WIDTH) {\n            // no action necessary\n        } else if (ulOffStageLeft < 0 && tbOffStageRight < OVERFLOW_WIDTH) {\n            translateX = ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (overflowing && tbOffStageRight < OVERFLOW_WIDTH) {\n            translateX = tbOffStageRight - OVERFLOW_WIDTH;\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        } else if (ulOffStageLeft < 0) {\n            translateX = Math.min(0, ulOffStageLeft + tbOffStageRight - OVERFLOW_WIDTH);\n            tabstripInner.style.transform = `translate(${translateX}px,0px)`;\n        }\n    }\n\n    measureFreeSpace() {\n        const tabstripInner = this.el.querySelector('.tabstrip-inner');\n        return this.el.clientWidth - tabstripInner.clientWidth;\n    }\n\n    showOverflow(){\n        const overflow = this.el.querySelector('.TabstripOverflow')\n        const { right, bottom } = overflow.getBoundingClientRect();\n        const {children: tabs} = this.props;\n        const menuItems = tabs.map(({props: {text}}) =>\n            <MenuItem key={text} action='setActiveTab' label={text} data={text} />);\n\n        PopupService.showPopup({\n            left: right,\n            top: bottom,\n            position: 'top-bottom-right-right',\n            component: (\n                <ContextMenu component={this} doAction={(action, data) => this.handleContextMenuAction(action, data)}\n                    left='auto' bottom='auto' right={0} top={0}>\n                    {menuItems}\n                </ContextMenu>\n            )\n        });\n    }\n\n    handleContextMenuAction(action, data){\n        if (action === 'setActiveTab'){\n            const idx = this.props.children.findIndex(tab => tab.props.text === data);\n            if (idx !== -1) {\n                this.handleTabClick(idx);\n            }\n        }\n    }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport cx from 'classnames';\nimport Tabstrip, {Tab} from './tabstrip';\nimport LayoutItem from './layout-item';\nimport Container from './container';\nimport {registerClass} from './componentRegistry';\nimport {layout as applyLayout} from './model/index';\n\nconst DEFAULT_TABSTRIP_HEIGHT = 34;\n\nexport default class TabbedContainer extends Container {\n\n    constructor(props){\n        super(props);\n        this.tabstrip = null;\n    }\n\n    render(){\n        var {style, tabstripHeight, children} = this.props;\n        const {layoutModel} = this.state;\n        var {$path, layout, $position=layout, active} = layoutModel;\n\n        // Don't allow either the tabs or the tabstrip itself to be dragged unless it is inside\n        // the DragZone. We might further config-enable this eg. allow tabs but not the tabstrip\n        // to be dragged when the TabbedContainer IS the DragZOne.\n        var isDraggable = true;\n\n        // Note: if key is not assigned here, we will get a React warning, even though it is assigned in Tabstrip !\n        var tabs = children.map((child,idx) => {\n            return <Tab key={idx} text={titleFor(child)} onMouseDown={e => this.handleMouseDown(e,layoutModel.children[idx])} />\n        });\n\n        var className = cx(\n            'TabbedContainer',\n            this.props.className\n        );\n\n        return (\n            <div id={$path} className={className} style={{...style,position: 'absolute',...$position}}>\n                <Tabstrip className='header'\n                    ref={component => this.tabstrip = component}\n                    style={{position: 'absolute',top: 0,left: 0, width: $position.width, height: tabstripHeight}}\n                    draggable={isDraggable}\n                    selected={active}\n                    dragging={this.state.dragging}\n                    onMouseDown={e => this.handleMouseDown(e)}\n                    onSelectionChange={(selected, idx) => this.handleTabSelection(selected, idx)}>{tabs}</Tabstrip>\n                {this.renderChildren()}\n            </div>\n        );\n    }\n\n    renderChildren(){\n\n        const {children, onLayout} = this.props;\n        const {layoutModel: {active=0, children: layoutChildren}} = this.state;\n        const child = children[active]\n\n        var childLayoutModel = layoutChildren[active];\n\n        var {title, style={}, ...childProps} = child.props;\n\n        var id = childLayoutModel.$id;\n\n        style={...style, ...childLayoutModel.style}; // TODO shouldn't layoutModel be the sole source of tryth for style ?\n\n        var props = {\n            id,\n            key: id,\n            container: this,\n            onLayout,\n            onConfigChange: this.handleConfigChange,\n            title: title,\n            layoutModel: childLayoutModel\n        };\n\n        if (isLayout(child)){\n            return React.cloneElement(child, {...props,style});\n        } else {\n            return <LayoutItem {...childProps} {...props} style={style}>{child}</LayoutItem>;\n        }\n    }\n\n    // duplicated from flexBox as an experiment, wh can't this be moved entirely to Container\n    componentWillReceiveProps(nextProps) {\n        var { layoutModel } = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({ layoutModel });\n        } else if (this.state.layoutModel.$path === '0') {\n        // special handling if we are at the root of a layout\n        // should handle this in Container\n            const {style: {width, height, visibility}} = nextProps;\n            const {style} = this.props;\n            if (width !== style.width || height !== style.height || visibility !== style.visibility) {\n                const VISIBLE = visibility || 'visible';\n                const FORCE_LAYOUT = true;\n                this.setState({\n                    layoutModel: applyLayout(\n                        this.state.layoutModel,\n                        { width, height },\n                        this.state.layoutModel.$path,\n                        VISIBLE,\n                        FORCE_LAYOUT)\n                });\n            }\n\n        }\n    }\n\n    getDragPermission(/* component */){\n        return {x: true,y: true};\n    }\n\n    // getDragBoundingRect(){\n    //     debugger;\n    //     var {top, left, width, height,right, bottom} = ReactDOM.findDOMNode(this).getBoundingClientRect();\n\n    //     var tabstripHeight = this.tabstrip.getDOMNode().clientHeight;\n\n    //     if (this.props.dragContainer === true){\n    //         return {top: top+tabstripHeight, left, width, height: height-tabstripHeight, right, bottom};\n    //     } else {\n    //         return {top, left, width, height, right, bottom};\n    //     }\n    // }\n\n    handleTabSelection(selected, idx){\n        const {onLayout=this.handleLayout} = this.props;\n        const {layoutModel} = this.state;\n        onLayout('switch-tab', {\n            path: layoutModel.$path,\n            idx: this.props.active,\n            nextIdx: idx\n        });\n\n        if (this.props.onTabSelectionChanged){\n            this.props.onTabSelectionChanged(idx);\n        }\n    }\n\n    handleMouseDown(e, model=this.state.layoutModel){\n        e.stopPropagation();\n        const {onLayout=this.handleLayout} = this.props;\n        onLayout('drag-start',{\n            model,\n            evt: e,\n            position: ReactDOM.findDOMNode(this).getBoundingClientRect()});\n    }\n\n}\n\nTabbedContainer.displayName = 'TabbedContainer';\nTabbedContainer.defaultProps = {\n    tabstripHeight: DEFAULT_TABSTRIP_HEIGHT\n}\n\nregisterClass('TabbedContainer', TabbedContainer, true);\n\nfunction titleFor(component){\n\n    var {title, config} = component.props;\n\n    return title || (config && config.title) || 'Tab X';\n\n}\n\nfunction isLayout(element){\n    return element.type.displayName === 'FlexBox' ||\n            element.type.displayName === 'TabbedContainer' ||\n            element.type.displayName === 'DynamicContainer';\n}\n","import React from 'react';\nimport cx from 'classnames';\n\n// need a layout prop and layout state. That way we can accept layout data both via json\n// and vis managing Flexible container\nexport default class Component extends React.Component {\n\n    render() {\n        const className = cx('Component');\n        const {children, id, flexible, onLayout, position, _style, onClick, ...props} = this.props;\n        return (\n            <div className={className} style={this.props.style} onClick={onClick}>\n                {children &&\n                    React.isValidElement(children) && !isHtmlType(children)\n                    ? React.cloneElement(children, { ...props })\n                    : children\n                }\n            </div>\n\n        );\n    }\n}\n\nComponent.defaultProps = {\n    style: {},\n    position: {},\n    _style: {},\n    onClick: () => {}\n}\n\n\nfunction isHtmlType(element){\n    const {type} = element;\n    return typeof type === 'string' && type[0] === type[0].toLowerCase();\n}\n","\nimport React from 'react';\nimport cx from 'classnames';\n\nimport './placeHolder.css';\n\n// Maybe should share a common base with LayoutItem\nexport default class PlaceHolder extends React.Component {\n\n\n    render() {\n\n        var className = cx(\n            \"PlaceHolder\",\n            this.props.className\n        );\n\n        var style = {\n            ...this.props.style,\n            backgroundColor: 'rgb(60,60,60)'\n        }\n\n\n        return (\n            <div className={className} style={style}>\n                <div className=\"close icon-arrow\" onClick={this.handleClose.bind(this)}>\n                    <span>Close</span>\n                </div>\n            </div>\n        );\n    }\n\n    handleClose() {\n        this.props.onLayout('remove');\n    }\n\n\n}\n\nPlaceHolder.defaultProps = {\n    layout: { ready: false }\n};\n","import React from 'react';\nimport Component from '../component';\nimport LayoutItem from '../layout-item';\nimport PlaceHolder from '../placeHolder';\n\nimport { registerClass, ComponentRegistry } from '../componentRegistry';\n\nregisterClass('PlaceHolder', PlaceHolder);\nregisterClass('LayoutItem', LayoutItem);\nregisterClass('Component', Component);\n\nexport function renderDynamicLayout(container, props, layoutModel) {\n\n    var { children, dragContainer, ...remainingProps } = container.props;\n    var { style: propStyle, ...rest } = props;\n    var { active, style: layoutStyle = {} } = layoutModel;\n\n    var finalProps = {\n        ...remainingProps,\n        active,\n        ...rest,\n        layoutModel,\n        style: { ...layoutStyle, ...propStyle }\n    };\n\n    //onsole.log('renderDynamicContainer about to create a new component (fom json) which will be cloned)',layout,finalProps);\n\n    return React.cloneElement(componentFromLayout(layoutModel), finalProps);\n\n}\n\nexport function componentFromLayout(layout) {\n    //onsole.log(`%ccomponentFromLayout\\n${JSON.stringify(json,null,2)}`,'background-color:ivory;color:brown;')\n    return _componentFromLayout(layout);\n}\n\nfunction notSplitterOrLayout(model) {\n    return model.type !== 'Splitter' && model.type !== 'layout';\n}\n\nfunction _componentFromLayout(layoutModel) {\n\n    if (Array.isArray(layoutModel)) {\n        return layoutModel.map(_componentFromLayout);\n    } else if (layoutModel == null) {\n        return null\n    }\n\n    const { $id, $path, type, ...props } = layoutModel;\n    const [ReactType, reactBuiltIn] = getComponentType(type);\n\n    let children;\n\n    if (type === 'Container') {\n        children = null;\n    } else {\n        children = layoutModel.children && layoutModel.children.length\n            ? layoutModel.children.filter(notSplitterOrLayout).map(_componentFromLayout)\n            : null;\n        if (children && children.length === 1) children = children[0];\n    }\n\n    return reactBuiltIn\n        ? <ReactType {...props} key={$id}>{children}</ReactType>\n        : <ReactType {...props} key={$id} layoutModel={layoutModel}>{children}</ReactType>;\n}\n\nfunction getComponentType(type){\n    if (ComponentRegistry[type]){\n        return [ComponentRegistry[type], false];\n    } else if (type === type.toLowerCase()){\n        return [type, true];\n    }\n    throw Error('componentFromLayout: unknown component type: ' + type)\n}\n","import React from 'react';\nimport Container from './container';\nimport { DragContainer } from './draggable';\nimport LayoutItem from './layout-item';\nimport { renderDynamicLayout } from './util/componentFromLayout';\nimport {isLayout} from './util/component-utils'\nimport { registerClass } from './componentRegistry';\n\nexport default class DynamicContainer extends Container {\n\n    componentDidMount(){\n        super.componentDidMount();\n        DragContainer.register(this.state.layoutModel.$path);\n    }\n\n    renderChild(layoutModel, idx) {\n\n        var { layoutModel: { $version }, onLayout } = this.props;\n\n        if ($version === 1 && this.props.children) {\n            // WHAT wa sthis for ?\n            return super.renderChild(layoutModel, idx);\n        }\n\n        var props = {\n            layoutModel,\n            onLayout\n        }\n\n        props.key = props.id = layoutModel.$id;\n\n        if (isLayout(layoutModel.type)) {\n            return this.renderFromLayout(this, props, layoutModel);\n        } else {\n            return <LayoutItem {...props} layout={layoutModel}>{this.renderFromLayout(this, props, layoutModel)}</LayoutItem>;\n        }\n    }\n\n    getState() {\n        return {\n            dragging: -1\n        };\n    }\n\n    // not currently called from FlexBox, but might need to be\n    // routinely called by top-level Container of Application\n    renderFromLayout(element, props, layout) {\n        return renderDynamicLayout(element, props, layout);\n    }\n\n    getLayoutModelChildren() {\n        if (this.props.contentModel) {\n            return [this.props.contentModel];\n        } else {\n            return super.getLayoutModelChildren();\n        }\n    }\n\n    drop(component, dropTarget) {\n\n        this.setState({\n            dragging: -1,\n            tempDimensions: undefined\n        });\n    }\n}\n\nDynamicContainer.displayName = 'DynamicContainer';\nDynamicContainer.defaultProps = {\n    style: { flex: 1 },\n    config: {}\n};\n\n\nregisterClass('DynamicContainer', DynamicContainer, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport LayoutItem from './layout-item';\nimport DynamicContainer from './dynamic-container';\nimport {isLayout} from './util/component-utils';\nimport { handleLayout } from './model/index';\nimport {componentFromLayout} from './util/componentFromLayout';\nimport { registerClass } from './componentRegistry';\nimport { Draggable } from './draggable';\nconst UUID = require('pure-uuid');\n\n\nconst NO_CHILDREN = [];\nconst EMPTY_OBJECT = {};\n\nexport default class Surface extends DynamicContainer {\n\n    constructor(props){\n        super(props);\n        this.handleDragStart = this.handleDragStart.bind(this);\n        this.handleDrag = this.handleDrag.bind(this);\n        this.handleDrop = this.handleDrop.bind(this);\n    }\n\n    getState() {\n        return {\n            dragging: false,\n            draggedIcon: null,\n            draggedComponent: null\n        };\n    }\n\n    render() {\n        var className = cx(\n            this.props.className,\n            'rect-layout',\n            'rect-container',\n            'Surface'\n        );\n\n        const {layoutModel: {children=NO_CHILDREN}, draggedComponent} = this.state;\n        const childrenToRender = draggedComponent\n            ? [...children, draggedComponent]\n            : children\n        \n        return (\n            <div id={this.state.id} className={className} style={this.props.style}>\n                {\n                    childrenToRender.map(\n                        (child, idx) => this.renderChild(child, idx)\n                    )\n                }\n            </div>\n        );\n    }\n\n    renderChild(layoutModel, idx) {\n\n        const { children } = this.props;\n        const child = React.isValidElement(children) && idx === 0\n            ? children\n            : Array.isArray(children) && children[idx]\n                ? children[idx]\n                : componentFromLayout(layoutModel)\n\n        const props = {\n            key: layoutModel.$id,\n            onLayout: this.handleLayout,\n            layoutModel\n        };\n        const dragging = layoutModel === this.state.draggedComponent;\n\n        const style = {\n            ...child.props.style,\n            boxSizing: 'content-box'\n        };\n\n        if (isLayout(child)) {\n            return React.cloneElement(child, { ...props, style });\n        } else {\n            return (\n                <LayoutItem dragging={dragging} {...props} style={style}>{child}</LayoutItem>)\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        const {layoutModel} = nextProps;\n        if (layoutModel && layoutModel !== this.state.layoutModel) {\n            this.setState({layoutModel});\n        } else {\n        // QUESTION: is this reliable ? WOn't the children be different array/\n        // instances, even though nothing has changed ?\n        // how do we update the layoutModel if we aquire/lose children in mid-flight ?\n            // const { children } = nextProps;\n\n            // if (differentChildren(children, this.props.children) && Array.isArray(children)) {\n\n            //     const { layoutModel } = this.state;\n\n            //     // temp hardcoding to test the principal - we need to be able to map \n            //     // children to layoutModel.children\n            //     // this works because sample surface gives ID to all children\n            //     // and new child is aways last\n\n            //     const idx = children.length - 1;\n            //     const lastChild = children[idx];\n\n            //     this.setState({\n            //         layoutModel: {\n            //             ...layoutModel,\n            //             children: [\n            //                 ...layoutModel.children,\n            //                 layout(this.getLayoutModelChild(lastChild), {}, `${layoutModel.$path}.${idx}`)\n            //             ]\n            //         }\n\n            //     });\n            // }\n\n        }\n\n    }\n\n    renderChildren() {\n        return null;\n    }\n\n    getDragPermission(/*component*/) {\n        return { x: true, y: true }\n    }\n\n    handleDragStart({model, position, instructions=EMPTY_OBJECT}, e){\n        var {top,left} = position;\n\n        // Can we find a better way than these clumsy instructions\n\n        const layoutModel = !instructions.DoNotRemove\n            ? handleLayout(this.state.layoutModel,'remove', {targetNode: model})\n            : this.state.layoutModel;\n\n        const {draggableWidth: width,\n            draggableHeight: height,\n            ...dragTransform} = Draggable.initDrag(e, layoutModel, model.$path, position, {\n            drag: this.handleDrag,\n            drop: this.handleDrop\n        });\n\n        var {$path, layout: modelLayout, style, dragAsIcon, ...rest} = model;\n        const layout = modelLayout\n            ? {width, height, ...modelLayout, top, left}\n            : {top, left, width, height}\n\n\n        var draggedIcon = dragAsIcon\n            ? componentFromLayout({\n                type: 'ComponentIcon',\n                color: 'red',\n                style: {...style, position: 'absolute', width: 120, height: 45, visibility: 'visible'},\n                layout\n            })\n            : undefined;\n\n        // what if draggedComponent is a Layout ?    \n        var draggedComponent = dragAsIcon\n            ? {$id: new UUID(1), $path, layout, style, ...rest}\n            : {\n                ...rest,\n                style: {\n                    ...style,\n                    position: 'absolute',\n                    ...(!instructions.DoNotTransform && dragTransform),\n                    visibility: 'visible'\n                },\n                layout,\n                children: [{\n                    type: 'layout', style: {}, layout: {...layout, top: 0, left: 0}\n                }]\n            };\n\n            // don't set dragging yet, it will suppress the final render of app with draggedComonent\n        // removed.\n        this.setState({\n            dragX: left,\n            dragY: top,\n            draggedIcon,\n            draggedComponent,\n            layoutModel\n        });\n\n        return true;\n\n    }\n\n    handleDrag(x,y){\n\n        const {draggedComponent} = this.state;\n        let {layout, style} = draggedComponent;\n\n        if (typeof x === 'number' && x !== layout.left){\n            layout = {...layout, left: x}\n            style = {...style, left: x}\n        }\n\n        if (typeof y === 'number' && y !== layout.top){\n            layout = {...layout, top: y}\n            style = {...style, top: y}\n        }\n\n        if (layout !== draggedComponent.layout){\n            this.setState({\n                dragging: true,\n                draggedComponent: {\n                    ...draggedComponent,\n                    style,\n                    layout\n                }\n            });\n        }\n    }\n\n    handleDrop(dropTarget){\n        const {draggedComponent} = this.state;\n        this.setState({draggedComponent: undefined, draggedIcon: undefined, dragging: false});\n        // TODO need somehow to animate dropped component to final resting place\n        /* \n            perhaps rerender new layout, bt mke new component a placeholder\n            measure new position\n            animate dragged component to new location\n            show new component & hide draggee\n            -- becomes a lot more efficient if we render all to a flat plane\n        */\n        this.handleLayout('drop', {draggedComponent, dropTarget});\n    }\n\n}\nSurface.displayName = 'Surface';\nregisterClass('Surface', Surface, true);\n","import React from 'react';\nimport cx from 'classnames';\nimport LayoutItem from './layout-item';\n\nexport default function DragSurface(props) {\n\n    var { style, children: child, x, y } = props;\n\n    var draggedComponent = null;\n    var visibility = child ? 'visible' : 'hidden';\n\n    if (child) {\n\n        let { style: childStyle/*, ...rest */} = child.props;\n\n        var layoutModel = child.props.layoutModel;\n\n        let childProps = {\n            key: layoutModel.$id,\n            layoutModel\n        };\n\n        childStyle = { // ...rest ?\n            ...childStyle,\n            borderWidth: 3,\n            borderStyle: 'solid',\n            borderColor: '#ccc',\n            boxSizing: 'content-box'\n        };\n\n        if (y !== undefined && x !== undefined) {\n\n            childProps.layoutModel = {\n                ...layoutModel,\n                layout: { ...layoutModel.layout, top: y, left: x }\n            }\n        }\n\n        draggedComponent =\n            <LayoutItem {...childProps} style={childStyle}>\n                {child}\n            </LayoutItem>;\n\n    }\n\n    var className = cx(\n        'DragSurface',\n        'rect-layout',\n        'rect-container',\n        'Surface',\n        props.className);\n\n    return (\n        <div className={className} style={{ ...style, visibility }}>\n            {draggedComponent}\n        </div>\n    );\n\n}\n","import React, {Component} from 'react'\nimport cx from 'classnames';\nimport {registerClass} from '../componentRegistry';\n\nexport default class ComponentIcon extends Component {\n\n\trender(){\n\t\tconst {color, text, style} = this.props;\n\t\tconst className = cx('ComponentIcon', this.props.className);\n\t\tconsole.log(`ComponentIcon color=${color}`);\n\n\t\treturn (\n\t\t\t<div className={className}\n\t\t\t\tstyle={{...style,backgroundColor:color}}>\n\t\t\t\t<span>{text}</span>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nregisterClass('ComponentIcon', ComponentIcon);\n","import {LAYOUT_MODEL, DROP, LAYOUT_REMOVE, LAYOUT_SWITCH_TAB, LAYOUT_REPLACE} from './actions';\n\nimport {handleLayout} from '../model/index';\n\n// Make sure we don't handle any layout actions before the layoutModel has\n// been initialized\n\nexport default function layoutReducer(state=null, {type, ...action}){\n\t\n\t//onsole.log(`%clayoutReducer ${type} ${JSON.stringify(action)}` ,'color:white;background-color:green;font-weight:bold;');\n\n    switch (type){\n\n    case LAYOUT_MODEL: \treturn action.layoutModel;\n    \n    case LAYOUT_REMOVE: return handleLayout(state, 'remove', action);\n\n    case LAYOUT_REPLACE : return handleLayout(state, 'replace', action);\n    \n    case LAYOUT_SWITCH_TAB : return handleLayout(state, 'switch-tab', action);\n\n    case DROP : return handleLayout(state, 'drop', action); \t\n       \n    default:  return state;\n\n}\n\n\n}\n\nexport const getLayoutModel = state => state.layoutModel;","\nimport React from 'react';\nimport {Surface} from './layoutContainers';\nimport './components/ComponentIcon';\nimport {followPath} from './model/index';\nimport cx from 'classnames';\nimport {\n    switchTab,\n    replace as replaceInLayout\n} from './redux/actions';\nimport {getLayoutModel} from './redux/layoutReducer';\nimport './application.css';\n\nconst UUID = require('pure-uuid');\n\n\n// Redux -------------------------\n// import { createStore, combineReducers, applyMiddleware, compose } from 'redux';\n// import componentState from './redux/componentReducer';\n// import thunk from 'redux-thunk';\n\nconst NO_STYLE = {}\n\nexport default class Application extends React.Component {\n\n    constructor(props){\n        super(props);\n\n        var {width: appWidth, height: appHeight, dialogs=[], style: {width=appWidth, height=appHeight, backgroundColor}=NO_STYLE} = props;\n\n        this.resizeListener = this.resizeListener.bind(this);\n        // const reduxDevTools = window.devToolsExtension ? window.devToolsExtension() : f => f;\n\n        // const reducers = combineReducers({\n        //     ...this.props.reducers,\n        //     componentState,\n        //     layoutModel\n        // });\n\n        // this.store = createStore(\n        //     reducers,\n        //     compose(applyMiddleware(thunk/*, logger*/), reduxDevTools)\n        // );\n\n        // this.store.subscribe(this.handleChange);\n\n        this.state = {\n            height,\n            width,\n            backgroundColor,\n            content: this.props.layout, // REALLY ???\n            draggedComponent: null,\n            dialogs,\n            hasError: false\n            // layoutModel: this.getLayoutModel(width, height)\n        };\n\n        // this.props.bootstrap(this.store.dispatch);\n    }\n\n    componentDidCatch(error, info){\n        console.log(`error`,error)\n        this.setState({hasError: true})\n    }\n\n    render(){\n        // dragging will suppress render in all children except the DragSurface\n        const {width, height, backgroundColor, dragging, hasError} = this.state;\n        const style = {position: 'absolute', top: 0, left: 0,width,height, backgroundColor};\n        const className = cx('Application', this.props.className);\n\n        //TODO make the default Container a Surface, which can host dialogs/popups as well\n        // as root layout. Default style will be 100% x 100%\n        //TODO maybe DragSurface should be part of Surface ?\n\n        // TRY scrap the DragSurface. pass dragging to each child. If it is set and they do not\n        // match do not render. So dialogs can be moved without dom removal. Layout items \n        // will be transplanted to Surface. Means every container and LayoutItem will have to\n        // implement this in shouldComponentUpdate\n        // if (nextProps.dragOperation && nextProps.dragOperation.draggedComponent !== this)\n\n        // we want something like \n        // <Surface dragOperation={{draggedComponent,x,y}}\n\n        if (hasError){\n            return <div style={style} className={className}>Error</div>\n        }\n\n        return (\n            <div style={style} className={className}>\n                <Surface layoutModel={this.props.layoutModel}\n                    style={{width,height}}\n                    dragging={dragging}\n                    onLayout={(command, options) => this.handleLayout(command, options)}\n                    onLayoutModel={this.props.onLayoutModel}>\n                    {this.getContent()}\n                </Surface>\n            </div>\n        );\n    }\n\n    getContent(){\n\n        var {children} = this.props;\n        var {dialogs} = this.state;\n\n        if (React.isValidElement(children)){\n            if (dialogs.length === 0){\n                return children;\n            }\n            else {\n                children = [children];\n            }\n        }\n\n        return children.concat(dialogs);\n\n    }\n\n    // handleChange = () => {\n    //     const layoutModel = getLayoutModel(this.store.getState());\n\n    //     // console.log(`Application.handleChange \n    //     // \tstate version ${this.state ? this.state.layoutModel.$version : 'null'}\n    //     // \tstore version ${layoutModel ? layoutModel.$version : 'null'}`);\n\n    //     if (layoutModel !== null && layoutModel !== this.state.layoutModel){\n    //         //onsole.log(`Application:store change triggers setState EXPECT RENDER`);\n    //         this.setState({layoutModel});\n    //     }\n    // }\n\n    getLayoutModel(width, height, id=new UUID(1)){\n\n        console.log(`%cApplication.getLayoutModel width ${width} height ${height} id ${id}`,'color:blue;font-weight:bold');\n        return {\n            type: 'Surface', // Should it be 'Application' ?\n            $id: id,\n            $path: '0',\n            $version: 1,\n            style: {position: 'absolute', width, height},\n            layout: {top: 0,left: 0, width, height},\n            children: []\n        };\n\n    }\n\n    componentDidMount(){\n        window.addEventListener('resize', this.resizeListener, false);\n        // this.store.dispatch(initializeLayoutModel(this.state.layoutModel));\n    }\n\n    componentWillUnmount(){\n        window.removeEventListener('resize', this.resizeListener, false);\n    }\n\n    componentWillReceiveProps(nextProps){\n        const {dialogs} = nextProps;\n        if (dialogs !== this.props.dialogs){\n            // could this mess with dialogs already in state ?\n            this.setState({dialogs});\n        }\n    }\n\n    shouldComponentUpdate(nextProps, nextState){\n        var {width, height} = this.state;\n\n        return  nextState.width !== width || \n                nextState.height !== height ||\n                nextState.draggedComponent !== undefined ||\n                nextState.dialogs !== this.state.dialogs ||\n                nextState.layoutModel !== this.state.layoutModel;\n    }\n\n    resizeListener(){\n        // var {width, height} = document.body.getBoundingClientRect();\n\n        // if (width !== this.state.width || height !== this.state.height){\n\n        //     const {layoutModel} = this.state;\n\n        //     this.store.dispatch(initializeLayoutModel(layout(layoutModel, {top:0,left:0,width,height}, layoutModel.$path, 'visible', true)));\n\n        //     this.setState({\twidth, height });\n        // }\n\n    }\n\n    handleLayout(command, options) {\n\n        if (command === 'dialog'){\n            // const dialog = componentFromLayout(layout(options.component));\n            const {dialogs} = this.state;\t\n            this.setState({\n                dialogs: dialogs.concat(options.component)\n            });\n        } else {\n            var layoutModel = getLayoutModel(this.store.getState());\n\n            if (command === 'replace'){\n                this.store.dispatch(replaceInLayout(followPath(layoutModel, options.model.$path), options.model));\n            } else if (command === 'switch-tab'){\n                const {path, idx, nextIdx} = options;\n                this.store.dispatch(switchTab(path, idx, nextIdx));\n            } else {\n                console.error(`Application.handleLayout dont't know what to do with ${command}`);\n            }\n\n        }\n\n    }\n\n\t// TODO where does this belong\n    getComponentState(componentId){\n\n        const {componentState} = this.store.getState();\n        return componentState[componentId];\n\n    }\n\n}\n\nApplication.defaultProps = {\n    reducers: {},\n    bootstrap: () => {}\n};\n"],"names":["_containers","ComponentRegistry","isContainer","className","registerClass","component","UUID","require","typeOf","element","type","displayName","name","constructor","LayoutProps","resizeable","header","title","active","tabstripHeight","dragStyle","layoutProps","props","results","Object","entries","forEach","key","value","getLayoutModel","$id","id","style","children","isLayout","getLayoutModelChildren","contentModel","React","isValidElement","Array","isArray","filter","child","map","ComponentHeader","Component","render","fixed","minimized","onMouseDown","menu","e","handleMenuClick","onAction","left","clientX","top","clientY","ComponentContextMenu","doAction","menuItems","state","targetComponent","maximized","normal","console","log","push","contextMenuItems","componentMenuItems","text","action","length","LAYOUT_REMOVE","LAYOUT_REPLACE","LAYOUT_SWITCH_TAB","remove","targetNode","replace","replacementNode","switchTab","path","idx","nextIdx","positionValues","Position","freeze","_position","str","offset","NaN","valueOf","toString","North","South","East","West","Header","Centre","NorthOrSouth","EastOrWest","NorthOrWest","SouthOrEast","Absolute","NORTH","SOUTH","EAST","WEST","HEADER","CENTRE","BoxModel","measure","model","measurements","addMeasurements","smallestBoxContainingPoint","layout","x","y","pointPositionWithinRect","rect","width","right","height","bottom","posX","posY","pctX","pctY","closeToTheEdge","position","borderZone","containsPoint","w","h","centerBox","quadrant","preX","preY","componentMeasurements","addClientMeasurements","collectChildMeasurements","$path","start","performance","now","tabMeasurements","measureTabs","end","tabs","isSplitter","components","reduce","arr","all","localPreX","localPosX","localPreY","localPosY","flexDirection","prev","next","n","c","subLayout","i","from","document","getElementById","querySelectorAll","tab","getBoundingClientRect","followPath","indexOf","Error","route","slice","paths","split","undefined","join","followPathToParent","nextStep","pathSoFar","targetPath","finalStep","regex","RegExp","parseInt","SURFACE","TABBED_CONTAINER","NO_CHILDREN","NO_STYLE","CSS_DIGIT","CSS_MEASURE","CSS_REX","BORDER_REX","ROW","COLUMN","FLEX_DIRECTION","yoga","FLEX_DIRECTION_ROW","FLEX_DIRECTION_COLUMN","LAYOUT","FLEXBOX","SPLITTER","BORDER_STYLES","border","borderWidth","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","BORDER_LIST","keys","LAYOUT_STYLES","margin","marginTop","marginRight","marginBottom","marginLeft","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","LAYOUT_LIST","layoutStyleDiff","style1","style2","some","computeLayout","tree","createTree","layoutModel","createYogaTree","node","calculateLayout","DIRECTION_LTR","setLayout","freeRecursive","normalizeLayoutStyles","expandChildren","splitters","getSplitterPositions","list","flex","backgroundColor","match","exec","error","pos1","pos2","pos3","pos4","pos123","paddinggLeft","normalizeBorderStyle","bs","borderColor","rest","boxShadow","borderStyle","DEFAULT_HEADER","parent","parentIsTabbedContainer","parentIsSurface","display","Node","create","increaseCSSMeasure","setCSSMeasure","setDisplay","DISPLAY_FLEX","setFlexDirection","setAlignItems","ALIGN_STRETCH","DISPLAY_NONE","setFlexGrow","setFlexShrink","setFlexBasis","setMargin","EDGE_TOP","getFlexDirection","flexGrow","flexShrink","flexBasis","setPositionType","POSITION_TYPE_ABSOLUTE","setPosition","EDGE_START","setWidth","setHeight","expandedChild","insertChild","ret","thisFlexible","isFlexible","lastFlexible","getComputedLayout","CSS_MEASURE_SETTERS","CSS_MEASURES","measureTop","measureRight","measureBottom","measureLeft","edge","setMeasure","EDGE_ALL","EDGE_END","EDGE_BOTTOM","EMPTY_OBJECT","containerOf","target","handleLayout","command","options","resizeLayout","replaceChild","result","removeChild","drop","visibility","force","firstNumber","n1","n2","n3","Math","round","firstDefined","m","flexLayout","isActive","computeLayoutYoga","container","newContainer","draggedComponent","source","dropTarget","pos","tabIndex","before","after","transform","insert","wrap","dropLayoutIntoContainer","targetContainer","absoluteDrop","isDraggableRoot","withTheGrain","againstTheGrain","nodeToBeInserted","nodeAfterWhichToInsert","nodeBeforeWhichToInsert","nodeSize","op","opts","into","size","oneMoreStepNeeded","flexBox","dim","concat","transformOrigin","modelLayout","getLayoutSpec","childLayout","wrapperStyle","wrapper","splice","dimension","shift","resizedTarget","measurement","newLayout","simpleClone","o1","o2","unversioned","value1","value2","property","versionIncrement","$version","clone","overrides","s1","rest1","s2","rest2","noEffectiveOverrides","properties","getOwnPropertyNames","replacement","isTower","isTerrace","isTabset","DEFAULT_HEADER_SPEC","LayoutItem","applyLayout","bind","dragging","_","isSelected","cx","headerHeight","componentStyle","handleMousedown","handleAction","cloneElement","onLayout","componentDidMount","self","context","store","unsubscribe","subscribe","myState","getState","setState","componentWillUnmount","componentWillReceiveProps","nextProps","dispatch","componentId","config","targetId","removeFromLayout","contextMenu","handleContextMenuAction","PopupService","showPopup","onConfigChange","evt","ReactDOM","findDOMNode","defaultProps","COLOURS","DropMenu","layer","hover","_group","Konva","Group","on","add","visible","isVisible","addPaths","computeMenuPosition","offsetTop","offsetLeft","box","dropTargets","getDropTargets","menuPosition","Path","strokeWidth","fill","data","pathPosition","removeChildren","unit","depth","lo","count","nextDropTarget","_dropTarget","_multiDropOptions","_currentDropTarget","_dropMenu","_stage","_layer","_konvaDropMenu","_hoverDropTarget","_dropTargetIsTabstrip","_currentTabIndex","_shiftedTab","DropTargetCanvas","canvas","createElement","sketchpad","root","body","insertBefore","appendChild","t","l","clientWidth","clientHeight","window","addEventListener","Stage","Layer","prepare","r","b","cssText","classList","clear","hidePopup","hoverDropTarget","dropTargetIsTabstrip","currentTabIndex","draw","SameDropTarget","wasMultiDrop","drawTarget","drawDropOptions","ctx","getContext","tabstrip","drawTabbedOutline","drawOutline","mouseX","mouseY","tabCount","find","lastTab","selector","querySelector","tabLeft","tabRight","beginPath","lineWidth","inset","gap","setCanvasStyles","strokeStyle","drawTab","stroke","radius","lineJoin","moveTo","lineTo","quadraticCurveTo","closePath","targetPosition","halfHeight","sizeHeight","min","drawRect","halfWidth","sizeWidth","styles","fillStyle","x1","y1","x2","y2","DropTarget","activate","getActiveDropTarget","identifyDropTarget","dragState","getNextDropTarget","constraint","zone","north","south","east","west","eastwest","northsouth","containerPos","positionedAtOuterContainerEdge","isVBox","isTabbedContainer","isHBox","containingComponent","containingBox","closeToTop","closeToRight","closeToBottom","closeToLeft","SCALE_FACTOR","DragState","init","mousePosition","scaleFactor","leadX","trailX","leadY","trailY","scaledWidth","scaledHeight","scaleDiff","leadXScaleDiff","leadYScaleDiff","trailXScaleDiff","trailYScaleDiff","hi","mouse","mousePos","mousePct","outOfBounds","inBounds","dropX","dropXY","call","dropY","update","xy","mouseConstraint","posConstraint","previousPos","diff","dir","max","_dragCallback","_dragStartX","_dragStartY","_dragContainer","_dragState","_dragThreshold","_measurements","_simpleDrag","_dropTargetCanvas","_dragContainers","DragContainer","register","unregister","getDraggable","refs","draggable","Draggable","mouseDownHandler","removeEventListener","dragStartCallback","preDragMousemoveHandler","preDragMouseupHandler","preventDefault","initDrag","dragHandler","x_diff","y_diff","mouseMoveDistance","abs","dragMousemoveHandler","dragMouseupHandler","getDragContainer","pathToContainer","maxSteps","steps","dragRect","dragZone","draggableWidth","draggableHeight","currentDropTarget","newX","newY","drag","onDragEnd","Container","isLayoutRoot","$position","renderChild","onLayoutModel","shouldComponentUpdate","getManagedDimension","handleDragStart","_splitter","_mousedown","_direction","Splitter","cursor","_mouseDownHandler","mouseMoved","mouseUp","onDrag","direction","vertical","lastPos","onDragStart","absIdx","clientPos","FlexBox","JSON","stringify","handleMouseDown","renderFlexibleChildren","splitterIdx","layoutChildren","propChildren","childIdx","childLayoutModel","splitterDragStart","splitterMoved","handleSplitterDragEnd","childProps","handleConfigChange","dragContainer","VISIBLE","FORCE_LAYOUT","getDragPermission","splitChildren","identifySplitChildren","distance","idx1","idx2","RESIZE","handleModelLayout","dimensions","assignExplicitSizeToFlexElements","json","OVERFLOW_WIDTH","handleClick","onClick","Tab","TabstripOverflow","Tabstrip","overflowing","el","selected","handleTabClick","showOverflow","checkOverflowState","componentDidUpdate","ensureSelectedTabisVisible","freeSpace","measureFreeSpace","selectedIdx","onSelectionChange","tabstripInner","activeTab","tsBox","tbBox","ulBox","tbOffStageRight","floor","ulOffStageLeft","translateX","overflow","findIndex","DEFAULT_TABSTRIP_HEIGHT","TabbedContainer","isDraggable","titleFor","handleTabSelection","renderChildren","onTabSelectionChanged","stopPropagation","flexible","_style","isHtmlType","toLowerCase","PlaceHolder","handleClose","ready","renderDynamicLayout","remainingProps","propStyle","layoutStyle","finalProps","componentFromLayout","_componentFromLayout","notSplitterOrLayout","ReactType","reactBuiltIn","getComponentType","DynamicContainer","renderFromLayout","tempDimensions","Surface","handleDrag","handleDrop","draggedIcon","childrenToRender","boxSizing","instructions","DoNotRemove","dragTransform","dragAsIcon","color","DoNotTransform","dragX","dragY","DragSurface","childStyle","ComponentIcon","Application","appWidth","appHeight","dialogs","resizeListener","content","hasError","componentDidCatch","info","getContent","nextState","replaceInLayout","getComponentState","componentState","reducers","bootstrap"],"mappings":"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"}